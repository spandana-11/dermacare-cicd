import{r as o,u as B,a as L,j as t}from"./index-BZd6-648.js";import{A as R}from"./appointmentAPI-CPzz8VX6.js";import{L as $}from"./loader-Dx4sjdu_.js";import{C as T}from"./CFormCheck-i8zbNpMX.js";import{b as y}from"./index.esm-BZe2opj0.js";import{C as z,a as M,b as v,c,d as P,e as l}from"./CTable-BxVenPcb.js";import"./CFormLabel-CWNs-Shv.js";import"./CNavItem-wDeXchN9.js";const ce=()=>{const[x,k]=o.useState([]),[I,j]=o.useState(!0),[d,C]=o.useState([]),[V,X]=o.useState([]),N=B(),[p,m]=o.useState([]),[i,h]=o.useState([]),[q,G]=o.useState(1),[J,w]=o.useState([]),[u,K]=o.useState([]),[O,A]=o.useState([]),[Q,U]=o.useState([]),[W,Y]=o.useState([]),[Z,F]=o.useState(null),[b,_]=o.useState(null),D={"Service & Treatment":"services & treatments","Tele Consultation":"tele consultation","In-clinic":"in-clinic consultation"},{user:f}=L(),E=(e,s)=>{var n,r;return(r=(n=f==null?void 0:f.permissions)==null?void 0:n[e])==null?void 0:r.includes(s)},g=async e=>{try{const s=await R();if(s&&s.data){const n=e?s.data.filter(r=>a(r.clinicId)===a(e)):s.data;C(n||[]),j(!1)}}catch(s){console.error("Failed to fetch appointments:",s),C([]),j(!1)}};o.useEffect(()=>{const e=localStorage.getItem("HospitalId");e?(F(e),g(e)):(console.warn("No HospitalId found in localStorage. Displaying all relevant appointments."),g(null))},[]);const S=e=>{const s=e.target.value;i.includes(s)?h([]):h([s])};o.useEffect(()=>{let e=d;if(e=e.filter(s=>["completed","in-progress","active"].includes(a(s.status))),i.length>0&&(e=e.filter(s=>{const n=a(s.status);return i.includes("Completed")?n==="completed":i.includes("Active")?n==="active"||n==="in-progress":!0})),p.length===1){const s=p[0];if(s==="Tele Consultation")e=e.filter(n=>a(n.consultationType)==="tele consultation"||a(n.consultationType)==="online consultation");else{const n=D[s];n&&(e=e.filter(r=>a(r.consultationType)===n))}}k(e)},[d,p,i]),o.useEffect(()=>{const e=[...new Set(d.map(n=>n.servicename).filter(Boolean))],s=[...new Set(d.map(n=>n.consultationType).filter(Boolean))];w(e),A(s),console.log("Available Consultation Types:",s)},[d]);const H=e=>{p.includes(e)?m([]):m([e])};o.useEffect(()=>{const e=localStorage.getItem("HospitalId");e?g(e):console.warn("No HospitalId in localStorage")},[]);const a=e=>e==null?void 0:e.toLowerCase().trim();return t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("div",{className:"container  ",children:[t.jsx("h5",{className:"mb-3",children:"Completed Appointments"}),t.jsx("div",{className:"d-flex gap-2 mb-3",children:["Service & Treatment","In-clinic","Tele Consultation"].map(e=>t.jsx("button",{onClick:()=>H(e),className:`btn ${p.includes(e)?"btn-selected":"btn-unselected"}`,children:e},e))}),t.jsxs("div",{className:"mb-3 d-flex justify-content-between",children:[t.jsxs("div",{className:"d-flex gap-3 mb-3",style:{color:"var(--color-black)"},children:[t.jsx(T,{label:"Completed",value:"Completed",onChange:S,checked:i.includes("Completed")}),t.jsx(T,{label:"Active",value:"Active",onChange:S,checked:i.includes("Active")})]}),t.jsx(y,{style:{backgroundColor:"var(--color-black)",color:"white"},onClick:()=>{m([]),h([])},children:"Reset Filters"})]}),I?t.jsx("div",{className:"d-flex justify-content-center align-items-center",children:t.jsx($,{message:"Loading reports..."})}):b?t.jsx("div",{children:b}):t.jsxs(z,{striped:!0,hover:!0,responsive:!0,children:[t.jsx(M,{className:"pink-table",children:t.jsxs(v,{children:[t.jsx(c,{children:"S.No"}),t.jsx(c,{children:"Name"}),t.jsx(c,{children:"Consultation Type"}),t.jsx(c,{children:"Date"}),t.jsx(c,{children:"Time"}),t.jsx(c,{children:"Status"}),t.jsx(c,{children:"Action"})]})}),t.jsx(P,{children:x.length>0?x.map((e,s)=>t.jsxs(v,{className:"pink-table",children:[t.jsx(l,{children:s+1}),t.jsx(l,{children:e.name}),t.jsx(l,{children:e.consultationType}),t.jsx(l,{children:e.serviceDate}),t.jsx(l,{children:e.slot||e.servicetime}),t.jsx(l,{children:a(e.status)==="in-progress"?"Active":e.status}),t.jsx(l,{children:E("Appointments","read")&&t.jsx(y,{style:{backgroundColor:"var(--color-black)",color:"white"},className:"text-white",size:"sm",onClick:()=>N(`/reportDetails/${e.bookingId}`,{state:{report:e,appointmentInfo:{name:e.name,age:e.age,gender:e.gender,problem:e.problem,bookingId:e.bookingId,patientId:e.patientId||(u==null?void 0:u.patientId),item:e,selectedAppointment:u}}}),children:"View"})})]},`${e.bookingId}-${s}`)):t.jsx(v,{children:t.jsx(l,{colSpan:"8",className:"text-center ",style:{color:"var(--color-black)"},children:"No appointments found."})})})]})]})})};export{ce as default};
