import{h as w,q as pe,s as he,t as ue,v as xe,r as o,a as fe,b as je,R as ye,j as e,Q as Ne,B as h}from"./index-BZd6-648.js";import{b as x}from"./index.esm-BZe2opj0.js";import"./index.es-DNqHXCbs.js";import{c as Ce}from"./capitalizeWords-CuwF8AcI.js";import{C as Te}from"./ConfirmationModal-DxV_gve6.js";import{L as ge}from"./loader-Dx4sjdu_.js";import{C as R}from"./CForm-qjDyPqIY.js";import{C as A,a as B,b as H}from"./CModalHeader-Durv8XK2.js";import{C as P}from"./CModalTitle-CQh3zxe_.js";import{C as be,a as W}from"./CRow-CddRgLsf.js";import{C as Y}from"./CFormInput-Ck0ix0GZ.js";import{C as Z}from"./CModalFooter-CnaQ0PLi.js";import{C as we,a as ve,b as V,c as z,d as ke,e as b}from"./CTable-BxVenPcb.js";import{E as De}from"./eye-b51ggR7A.js";import{P as Ie,T as Se}from"./trash-2-rbTdXEzu.js";import"./CNavItem-wDeXchN9.js";import"./CFormLabel-CWNs-Shv.js";const Ee=async r=>{try{const s=await w.get(`/${pe}/${r}`);return console.log("treatment data:",s.data),s.data}catch(s){throw console.error("Error fetching treatment data:",s.message),s.response&&(console.error("Error Response Data:",s.response.data),console.error("Error Response Status:",s.response.status)),s}},Me=async r=>{try{const s={treatmentName:r.treatmentName||"",hospitalId:r.hospitalId||""},n=await w.post(`/${he}`,s,{headers:{"Content-Type":"application/json"}});return console.log("Treatment added successfully:",n.data),n.data}catch(s){throw console.error("Error adding treatment:",s.response),s}},$e=async(r,s,n)=>{try{const m={treatmentName:r.treatmentName};return(await w.put(`/${ue}/${s}/${n}`,m,{headers:{"Content-Type":"application/json"}})).data}catch(m){throw console.error("Error updating treatment:",m.response||m),m}},Le=async(r,s)=>{try{const n=await w.delete(`/${xe}/${r}/${s}`,{headers:{"Content-Type":"application/json"}});return console.log("Treatment deleted successfully:",n.data),n.data}catch(n){throw console.error("Error deleting treatment:",n.response?n.response.data:n),n}},Xe=()=>{const[r,s]=o.useState([]),[n,m]=o.useState(!1),[v,J]=o.useState(null),[K,y]=o.useState(!1),[k,F]=o.useState(null),[X,N]=o.useState(!1),[f,q]=o.useState(null),[p,u]=o.useState({}),[ee,D]=o.useState(!1),[te,U]=o.useState(null),[ae,_]=o.useState(null),[I,S]=o.useState({treatmentName:""}),[j,se]=o.useState(1),[C,Re]=o.useState(10),T=localStorage.getItem("HospitalId"),{user:E}=fe(),g=(t,a)=>{var l,c;return(c=(l=E==null?void 0:E.permissions)==null?void 0:l[t])==null?void 0:c.includes(a)},re=t=>t.map(a=>({...a,id:a.id||a._id})),O=async t=>{m(!0);try{const a=await Ee(t);s(re(a.data))}catch{J("Failed to fetch treatment data.")}finally{m(!1)}},{searchQuery:M,setSearchQuery:Ae}=je();o.useEffect(()=>{O(T)},[]);const ne=async()=>{try{await Le(te,ae),h.success("Treatment deleted successfully!",{position:"top-right"}),O(T)}catch(t){h.error("Failed to delete treatment."),console.error("Delete error:",t)}D(!1)},oe=()=>{U(null),_(null),D(!1)},Q=/^[A-Za-z\s.\-()\/']+$/,le=async()=>{var l,c,L;const t=I.treatmentName.trim();if(!t){u({treatmentName:"Treatment name is required."});return}if(!Q.test(t)){u({treatmentName:'Only alphabets, spaces, and "." are allowed.'});return}if(r.some(i=>i.treatmentName.trim().toLowerCase()===t.toLowerCase())){h.error(`Duplicate treatment name - "${t}" already exists!`,{position:"top-right"});return}try{const d=await Me({treatmentName:t,hospitalId:T}),de={id:d.data.id||d.id,treatmentName:d.data.treatmentName||t,hospitalId:d.data.hospitalId||T};s(me=>[...me,de]),h.success("Treatment added successfully!"),y(!1),S({treatmentName:""})}catch(i){const d=((c=(l=i.response)==null?void 0:l.data)==null?void 0:c.message)||((L=i.response)==null?void 0:L.statusText)||"An unexpected error occurred.";h.error(`Error adding treatment: ${d}`,{position:"top-right"})}},ce=async()=>{const{id:t,hospitalId:a,treatmentName:l}=f,c=l==null?void 0:l.trim();if(!c){u({treatmentName:"Treatment name is required."});return}if(!Q.test(c)){u({treatmentName:'Only alphabets, spaces, and "." are allowed.'});return}if(r.some(i=>i.id!==t&&i.treatmentName.trim().toLowerCase()===c.toLowerCase())){h.error(`Duplicate treatment name - "${c}" already exists!`,{position:"top-right"});return}try{await $e({treatmentName:c,hospitalId:a},t,a),h.success("Treatment updated successfully!"),s(i=>i.map(d=>d.id===t?{...d,treatmentName:c}:d)),N(!1)}catch(i){console.error("Update error:",i),h.error("Failed to update treatment.")}},ie=t=>{U(t.treatmentId||t.id||t._id),_(t.hospitalId),D(!0)},$=ye.useMemo(()=>{const t=M.toLowerCase().trim();return t?r.filter(a=>Object.values(a).some(l=>String(l).toLowerCase().includes(t))):r},[M,r]),G=$.slice((j-1)*C,j*C);return e.jsxs("div",{children:[e.jsx(Ne,{}),e.jsx(R,{className:"d-flex justify-content-between mb-3",children:g("Treatments","create")&&e.jsx("div",{className:" w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(x,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>y(!0),children:"Add Treatment"})})}),k&&e.jsxs(A,{visible:!!k,onClose:()=>F(null),backdrop:"static",children:[e.jsx(B,{children:e.jsx(P,{children:"Treatment Details"})}),e.jsx(H,{style:{color:"var(--color-black)"},children:e.jsxs(be,{className:"mb-3",children:[e.jsx(W,{sm:4,children:e.jsx("strong",{children:"Treatment Name:"})}),e.jsx(W,{sm:8,children:k.treatmentName})]})})]}),e.jsxs(A,{visible:K,onClose:()=>{y(!1),S({treatmentName:""}),u({})},backdrop:"static",children:[e.jsx(B,{children:e.jsx(P,{children:"Add New Treatment"})}),e.jsx(H,{children:e.jsxs(R,{children:[e.jsxs("h6",{children:["Treatment Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(Y,{type:"text",name:"treatmentName",value:I.treatmentName,onChange:t=>{const a=t.target.value;S({...I,treatmentName:a}),p.treatmentName&&u(l=>({...l,treatmentName:""}))},placeholder:"Enter Treatment Name",className:p.treatmentName?"is-invalid":""}),p.treatmentName&&e.jsx("div",{className:"invalid-feedback",style:{color:"red"},children:p.treatmentName})]})}),e.jsxs(Z,{children:[e.jsx(x,{color:"secondary",onClick:()=>y(!1),children:"Cancel"}),e.jsx(x,{style:{backgroundColor:"var(--color-black)"},className:"text-white",onClick:le,children:"Add"})]})]}),e.jsxs(A,{visible:X,onClose:()=>N(!1),backdrop:"static",children:[e.jsx(B,{children:e.jsx(P,{children:"Edit Treatment"})}),e.jsx(H,{children:e.jsxs(R,{children:[e.jsxs("h6",{children:["Treatment Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(Y,{type:"text",value:(f==null?void 0:f.treatmentName)||"",onChange:t=>{q({...f,treatmentName:t.target.value}),p.treatmentName&&u(a=>({...a,treatmentName:""}))},className:p.treatmentName?"is-invalid":""}),p.treatmentName&&e.jsx("div",{className:"invalid-feedback",style:{color:"red"},children:p.treatmentName})]})}),e.jsxs(Z,{children:[e.jsx(x,{color:"secondary",onClick:()=>N(!1),children:"Cancel"}),e.jsx(x,{style:{backgroundColor:"var(--color-black)"},className:"text-white",onClick:ce,children:"Update"})]})]}),e.jsx(Te,{isVisible:ee,title:"Delete Doctor",message:"Are you sure you want to delete this treatment? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:ne,onCancel:oe}),n?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(ge,{message:"Loading treatments..."})}):v?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:v}):e.jsxs(we,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(ve,{className:"pink-table",children:e.jsxs(V,{children:[e.jsx(z,{style:{paddingLeft:"40px"},children:"S.No"}),e.jsx(z,{children:"Treatment Name"}),e.jsx(z,{className:"text-end",children:"Actions"})]})}),e.jsx(ke,{className:"pink-table",children:G.length>0?G.map((t,a)=>e.jsxs(V,{children:[e.jsx(b,{style:{paddingLeft:"40px"},children:(j-1)*C+a+1}),e.jsx(b,{children:Ce(t.treatmentName)}),e.jsx(b,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2  ",children:[g("Treatments","read")&&e.jsx("button",{className:"actionBtn",onClick:()=>F(t),title:"View",children:e.jsx(De,{size:18})}),g("Treatments","update")&&e.jsx("button",{className:"actionBtn",onClick:()=>{q(t),N(!0)},title:"Edit",children:e.jsx(Ie,{size:18})}),g("Treatments","delete")&&e.jsx("button",{className:"actionBtn",onClick:()=>ie(t),title:"Delete",children:e.jsx(Se,{size:18})})]})})]},t.id)):e.jsx(V,{children:e.jsxs(b,{colSpan:5,className:"text-center text-muted",children:['🔍 No diseases found treatment "',e.jsx("b",{children:M}),'"']})})})]}),!n&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(($.length?$.length:r.length)/C)},(t,a)=>e.jsx(x,{style:{backgroundColor:j===a+1?"var(--color-black)":"#fff",color:j===a+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>se(a+1),children:a+1},a))})]})};export{Xe as default};
