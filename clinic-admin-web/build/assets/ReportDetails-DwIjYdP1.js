import{o as B,B as P,U as V,V as _,O as G,u as J,h as W,r as m,j as e}from"./index-D4bMhh6S.js";import{c as q,d as O}from"./index-DV_TRh7f.js";import{a as h}from"./index.esm-CKtuKisK.js";import{C as K,a as Q,b as v,c,d as X,e as n}from"./CTable-CM-ntns4.js";import{C as T,a as E,b as A,c as Y}from"./CModalHeader-B39GhZBu.js";import{C as Z}from"./CModalTitle-DjjdiQhg.js";import{C as ee}from"./CForm-C_BNCDef.js";import{C as x}from"./CFormLabel-DK_Gqezi.js";import{C as j}from"./CFormInput-DjftuILp.js";import"./CConditionalPortal-B5iE6UDO.js";const se=async()=>{try{const o=(await B.get(`${P}/${V}`)).data.data;return console.log(o),o}catch(d){return console.error("Error fetching report by ID:",d.message),null}},re=async d=>{try{console.log("Sending data to API to add appointment...",d);const o=await B.post(`${P}/${_}`,d,{headers:{"Content-Type":"application/json"}});return console.log("Appointment booked successfully:",o.data),o.data}catch(o){throw console.error("Error booking appointment:",o.response?o.response.data:o.message),o}},je=()=>{var w,F,D,S,I;const{id:d}=G(),o=J(),l=(w=o.state)==null?void 0:w.appointmentInfo,N=W(),[i,f]=m.useState([]),[U,b]=m.useState(!1),[$,M]=m.useState(null),[L,u]=m.useState(!1),[r,p]=m.useState({reportName:"",reportDate:"",reportStatus:"",reportType:"",reportFile:null,bookingId:l.bookingId});if((F=o.state)==null||F.report,`${((S=(D=i.reportFile)==null?void 0:D[0])==null?void 0:S.startsWith("JVBER"))?"application/pdf":"image/jpeg"}${(I=i.reportFile)==null?void 0:I[0]}`,!i)return e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("h5",{className:"text-danger",children:"No report details found!"}),e.jsx(h,{color:"primary",onClick:()=>N(-1),className:"mt-2",children:"Go Back"})]});const R=async()=>{try{const a=await se();if(console.log(a),Array.isArray(a)){const t=a.flatMap(g=>g.reportsList||[]);console.log("Flattened Reports:",t),f(t)}else console.warn("Unexpected response format:",a),f([])}catch(s){console.error("Error fetching reports:",s),f([])}};m.useEffect(()=>{R()},[]),console.log(i);const H=s=>{const a=s.target.files[0],t=new FileReader;t.onloadend=()=>{const g=t.result.split(",")[1];p(C=>({...C,reportFile:g}))},a&&t.readAsDataURL(a)},z=async()=>{if(!r.reportName||!r.reportDate||!r.reportStatus||!r.reportType||!r.reportFile){alert("Please fill all required fields and upload a file.");return}try{const s={reportsList:[{...r,reportFile:[r.reportFile]}]},a=await re(s);console.log("Report uploaded:",a),u(!1),alert("Report uploaded successfully!"),R()}catch(s){console.error("Error uploading report:",s),alert("Upload failed")}};return e.jsxs("div",{className:"container mt-4",children:[l&&e.jsx("div",{className:"container bg-light p-4 rounded shadow-sm mb-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 border-end",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",l.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",l.age]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gender:"})," ",l.gender]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Problem:"})," ",l.problem]})]}),e.jsxs("div",{className:"col-md-6 ps-md-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Doctor ID:"})," ",l.item.doctorId]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Hospital ID:"})," ",l.item.clinicId]})]})]})}),e.jsxs("div",{className:"bg-info text-white p-3 d-flex justify-content-between align-items-center rounded",children:[e.jsx("h5",{className:"mb-0",children:"Report Details"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(h,{color:"secondary",size:"sm",onClick:()=>N(-1),children:"Back"}),e.jsx(h,{color:"success",size:"sm",onClick:()=>u(!0),style:{color:"white"},children:"Upload Report"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(K,{bordered:!0,responsive:!0,children:[e.jsx(Q,{color:"light",children:e.jsxs(v,{children:[e.jsx(c,{children:"S.No"}),e.jsx(c,{children:"Booking ID"}),e.jsx(c,{children:"Report Name"}),e.jsx(c,{children:"Date"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Action"})]})}),e.jsx(X,{children:Array.isArray(i)&&i.length>0?i.map((s,a)=>{var k;console.log("Rendering report:",s);const t=(k=s.reportFile)==null?void 0:k.includes("JVBER"),g=t?"application/pdf":"image/jpeg",C=t?"pdf":"jpg",y=`data:${g};base64,${s.reportFile}`;return e.jsxs(v,{children:[e.jsx(n,{children:a+1}),e.jsx(n,{children:s.bookingId}),e.jsx(n,{children:s.reportName}),e.jsx(n,{children:s.reportDate}),e.jsx(n,{children:s.reportStatus}),e.jsx(n,{children:s.reportType}),e.jsx(n,{children:s.reportFile?e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(h,{className:"bg-info text-white border-0",size:"sm",onClick:()=>{t?window.open(y,"_blank"):(M(y),b(!0))},children:e.jsx(q,{})}),e.jsx("a",{href:y,download:`${s.reportName||"report"}_${a+1}.${C}`,className:"btn btn-sm btn-outline-success",title:"Download",children:e.jsx(O,{})})]}):"No File"})]},a)}):e.jsx(v,{children:e.jsx(n,{colSpan:"8",className:"text-center",children:"No Reports Found"})})})]})}),e.jsxs(T,{visible:U,onClose:()=>b(!1),size:"lg",children:[e.jsx(E,{onClose:()=>b(!1),children:e.jsx("strong",{children:"Image Preview"})}),e.jsx(A,{className:"text-center",children:e.jsx("img",{src:$,alt:"Preview",style:{maxWidth:"100%",maxHeight:"80vh",borderRadius:"8px"}})})]}),e.jsxs(T,{visible:L,onClose:()=>u(!1),children:[e.jsx(E,{children:e.jsx(Z,{children:"Upload Report"})}),e.jsx(A,{children:e.jsxs(ee,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(x,{children:"Report Name"}),e.jsx(j,{value:r.reportName,onChange:s=>p({...r,reportName:s.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(x,{children:"Booking Id"}),e.jsx(j,{value:r.bookingId,onChange:s=>p({...r,bookingId:s.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(x,{children:"Report Date"}),e.jsx(j,{type:"date",value:r.reportDate,onChange:s=>p({...r,reportDate:s.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(x,{children:"Report Status"}),e.jsx(j,{value:r.reportStatus,onChange:s=>p({...r,reportStatus:s.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(x,{children:"Report Type"}),e.jsx(j,{value:r.reportType,onChange:s=>p({...r,reportType:s.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(x,{children:"Upload File (PDF or Image)"}),e.jsx(j,{type:"file",accept:"image/*,application/pdf",onChange:H})]})]})}),e.jsxs(Y,{children:[e.jsx(h,{color:"secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx(h,{color:"primary",onClick:z,children:"Submit"})]})]})]})};export{je as default};
