import{v as J,I as He,J as Ke,K as Ue,L as ze,O as Ye,r as a,j as e,B as N,H as Je,S as We,F as Xe,G as he}from"./index-DwsJnlHn.js";import{F as Se,a as M,b as B}from"./index-zCTJtA6i.js";import{c as R}from"./capitalizeWords-CuwF8AcI.js";import{C as be}from"./ConfirmationModal-D9T4gQdx.js";import{C as ne,a as ae}from"./CCardBody-4LnpKMw0.js";import{a as F}from"./index.esm-j8L8OUOY.js";import{C as je}from"./CForm-OJQsngod.js";import{a as Y,C as Ze}from"./CRow-BvzboGfC.js";import{C as ee,a as oe}from"./CFormInput-F3j-R7Zc.js";import{C as ye}from"./CInputGroup-SPHZAJYl.js";import{C as Ce,a as Ie,b as we,c as Fe,d as Ae,e as Ne}from"./CListGroupItem-C4B9nVJB.js";import{S as es}from"./react-select.esm-B_g7dzQa.js";import{C as ve}from"./CFormSelect-BLkadGQI.js";import{f as ss,e as pe,d as ge}from"./CNavItem-D-_vrklN.js";import{e as rs,f as xe}from"./DefaultLayout-goNOnliL.js";import"./CModalHeader-C9V0HcQQ.js";import"./CModalTitle-JHBt9lNf.js";import"./CModalFooter-FSUtuZlu.js";import"./CFormLabel-BsqO6Mxs.js";import"./defineProperty-BAgxAJIZ.js";import"./slicedToArray-Dby63wcm.js";import"./cil-user-Ddrdy7PS.js";const ke=async(m,u,d)=>{try{const p=await J.post(`${Ue}/${u}/${d}`,m,{headers:{"Content-Type":"application/json"}});return console.log("Add API response:",p.data),p.data}catch(p){throw console.error("Error response from API:",p.response||p.message),p}},Ee=async(m,u,d)=>{try{return(await J.put(`${Ke}/${u}/${d}`,m,{headers:{"Content-Type":"application/json"}})).data}catch(p){throw console.error("Error updating consentForm:",p.response||p.message),p}},Pe=async m=>{try{const u=await J.delete(`${ze}/${m}`,{headers:{"Content-Type":"application/json"}});return console.log("ConsentForm deleted successfully:",u.data),u.data}catch(u){throw console.error("Error deleting ConsentForm:",u.response||u.message),u}},te=async(m,u)=>{try{const d=await J.get(`${He}/${m}/${u}`);return console.log("Fetched data:",d.data),d.data}catch(d){throw console.error("Error fetching test data:",d.response||d.message),d}},fe=async(m,u)=>{try{const d=await J.get(`${Ye}/${m}/${u}`);return console.log("Procedure Consent Form data:",d.data),d.data}catch(d){throw console.error("Error fetching Procedure Form data:",d.message),d.response&&(console.error("Error Response Data:",d.response.data),console.error("Error Response Status:",d.response.status)),d}},os=()=>{const[m,u]=a.useState(!1),[d,p]=a.useState([]),[S,j]=a.useState([]),[q,Q]=a.useState(""),[k,E]=a.useState(""),[g,C]=a.useState([]),[O,V]=a.useState(null),[se,D]=a.useState(null),[ce,_]=a.useState({}),[ie,W]=a.useState(!1),[X,T]=a.useState(null),[Z,H]=a.useState(null),[re,K]=a.useState(!1),f=localStorage.getItem("HospitalId"),I="1";a.useEffect(()=>{(async()=>{try{const t=await te(f,I);if(console.log("✅ Forms from API:",t.data),t!=null&&t.data){const h=(Array.isArray(t.data)?t.data:[t.data]).map(v=>({...v,consentFormQuestions:v.consentFormQuestions||[]}));p(h)}}catch(t){console.error("Error fetching saved forms",t)}})()},[f,I]);const L=()=>{if(k.trim()){if(O!==null){const n=[...g];n[O]=k.trim(),C(n),V(null)}else g.includes(k.trim())||C([...g,k.trim()]);E("")}},U=n=>{C(g.filter(t=>t!==n))},G=()=>{const n=q.trim();if(!n||g.length===0){if(n===""&&g.length===0)return;N.error("Please add a question and at least one answer.");return}if(S.some(t=>t.question===n)){N.error("This question already exists.");return}j([...S,{question:n,answers:[...g]}]),Q(""),C([])},z=n=>{j(S.filter((t,l)=>l!==n))},w=async()=>{const n={};if(S.length===0&&(n.qaList="At least one question is required."),Object.keys(n).length>0){_(n);return}_({});const t={consentFormQuestions:S.map(l=>({heading:l.question,questionsAndAnswers:l.answers.map(h=>({question:h,answer:!0}))}))};try{se!==null?await Ee(t,f,I):await ke(t,f,I);const l=await te(f,I);l!=null&&l.data&&p(Array.isArray(l.data)?l.data:[l.data]),j([]),u(!1),D(null),K(!1)}catch(l){console.error("Error saving Generic Form:",l)}},$=n=>{const t=d[n];if(!t){N.error("Selected form not found");return}const l=(t.consentFormQuestions||[]).map(h=>({question:h.heading,answers:(h.questionsAndAnswers||[]).map(v=>v.question)}));j(l),D(n),u(!0),_({})},y=async n=>{const t=d[n],l=(t==null?void 0:t.id)||(t==null?void 0:t.consentFormId)||(t==null?void 0:t.formId);if(!l){N.error("This form cannot be deleted.");return}try{await Pe(l),p(d.filter((h,v)=>v!==n)),K(!1)}catch(h){console.error("Error deleting Generic Form:",h),N.error("Failed to delete form.")}},P=n=>{const t=S[n];Q(t.question),C(t.answers),j(S.filter((l,h)=>h!==n))};return e.jsxs(ne,{className:"mt-3",children:[e.jsxs(ae,{children:[!m&&e.jsx("div",{className:"w-100 d-flex justify-content-end",children:e.jsx(F,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>{u(!0),j([]),D(null),K(!0)},disabled:re||d.length>0,children:"+ Add Generic Form"})}),m&&e.jsxs(je,{className:"mb-4",children:[e.jsxs(Y,{md:12,children:[e.jsx("h6",{className:"mb-2",children:"Question"}),e.jsx(ee,{placeholder:"Enter question",value:q,onChange:n=>Q(n.target.value)}),e.jsx("h6",{className:"mt-3 mb-2",children:"Answers"}),e.jsxs(ye,{className:"mb-2",children:[e.jsx(ee,{placeholder:"Enter answer",value:k,onChange:n=>E(n.target.value)}),e.jsx(F,{onClick:L,style:{backgroundColor:"var(--color-black)",color:"white"},children:e.jsx(Se,{})})]}),g.length>0&&e.jsx(Ce,{className:"mb-3",children:g.map((n,t)=>e.jsxs(Ie,{className:"d-flex justify-content-between align-items-center",children:[n,e.jsxs("div",{children:[e.jsx(M,{onClick:()=>{E(n),V(t)},style:{cursor:"pointer",color:"var(--color-black)",marginRight:"10px"}}),e.jsx(B,{onClick:()=>U(n),style:{cursor:"pointer",color:"var(--color-black)"}})]})]},t))}),e.jsx(F,{color:"info",className:"me-2",onClick:G,style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)",border:"none"},children:"Add Question"})]}),S.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{children:"Questions Added"}),S.map((n,t)=>e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:n.question}),e.jsx("ul",{children:n.answers.map((l,h)=>e.jsx("li",{children:l},h))}),e.jsxs("div",{children:[e.jsx(M,{onClick:()=>P(t),style:{cursor:"pointer",color:"var(--color-black)",marginRight:"10px"}}),e.jsx(B,{onClick:()=>z(t),style:{cursor:"pointer",color:"var(--color-black)"}})]})]},t))]}),e.jsxs("div",{className:"mt-3",children:[e.jsx(F,{color:"secondary",className:"me-2",onClick:()=>u(!1),children:"Cancel"}),e.jsx(F,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)",border:"none"},onClick:w,children:se!==null?"Update Generic Form":"Save Generic Form"})]})]}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h6",{children:"Saved Generic Forms"}),e.jsx(we,{children:d.map((n,t)=>e.jsxs(Fe,{itemKey:t,children:[e.jsx(Ae,{children:R(n.subServiceName)||" Generic Consent Form"}),e.jsxs(Ne,{children:[Array.isArray(n.consentFormQuestions)&&n.consentFormQuestions.map((l,h)=>e.jsxs("div",{children:[e.jsx("h6",{children:R(l.heading)}),Array.isArray(l.questionsAndAnswers)&&l.questionsAndAnswers.map((v,A)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("input",{type:"checkbox",className:"me-2",disabled:!0,checked:v.answer===void 0?!0:!!v.answer}),e.jsx("span",{children:R(v.question)})]},A))]},h)),e.jsxs("div",{className:"d-flex gap-3 mt-2",children:[e.jsx(M,{onClick:()=>$(t),style:{color:"var(--color-black)",cursor:"pointer"}}),e.jsx(B,{onClick:()=>{T(t),W(!0),H(n.subServiceName)},style:{color:"var(--color-black)",cursor:"pointer"}})]})]})]},t))})]})]}),e.jsx(be,{isVisible:ie,title:"Delete ProcedureConsentForm",message:`Are you sure you want to delete this "${Z}" ? This action cannot be undone.`,confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>{X!==null&&(y(X),T(null)),W(!1)},onCancel:()=>{T(null),W(!1)}})]})},ts=()=>{const[m,u]=a.useState([]),[d,p]=a.useState([]),[S,j]=a.useState([]),[q,Q]=a.useState([]),[k,E]=a.useState(!1),[g,C]=a.useState([]),[O,V]=a.useState(null),[se,D]=a.useState(!1),[ce,_]=a.useState(!0),[ie,W]=a.useState(null),[X,T]=a.useState(!1),[Z,H]=a.useState(null),[re,K]=a.useState(null),[f,I]=a.useState({categoryId:"",serviceId:"",subServiceid:"",subServiceName:"",consentFormQuestions:[]}),[L,U]=a.useState(""),[G,z]=a.useState(""),[w,$]=a.useState([]),[y,P]=a.useState([]),[n,t]=a.useState(null),[l,h]=a.useState({}),v=localStorage.getItem("HospitalId"),A="2";a.useEffect(()=>{(async()=>{var s;try{const o=await Je();Array.isArray(o.data)?u(o.data):Array.isArray((s=o.data)==null?void 0:s.data)?u(o.data.data):u([])}catch(o){console.error("Error fetching categories:",o)}})()},[]),a.useEffect(()=>{(async()=>{console.log(v),console.log(A);try{const s=await te(v,A);s!=null&&s.data&&C(Array.isArray(s.data)?s.data:[s.data])}catch(s){console.error("Error fetching saved forms",s)}})()},[v]),a.useEffect(()=>{if(!f.categoryId){p([]);return}(async()=>{try{const s=await We(f.categoryId);p((s==null?void 0:s.data)||[])}catch(s){console.error("Error fetching services",s),p([])}})()},[f.categoryId]),a.useEffect(()=>{if(!f.serviceId){j([]);return}(async()=>{try{const s=await Xe(f.serviceId),o=(s==null?void 0:s.data)||[];let i=[];Array.isArray(o)?i=o.flatMap(c=>c.subServices||[]):o!=null&&o.subServices&&(i=o.subServices),console.log(i),j(i)}catch(s){console.error("Error fetching subServices",s),j([])}})()},[f.serviceId]),a.useEffect(()=>{(async()=>{try{const s=await fe(v,A);if(console.log("✅ Forms from API:",s.data),s!=null&&s.data){const o=(Array.isArray(s.data)?s.data:[s.data]).map(i=>({...i,consentFormQuestions:i.consentFormQuestions||[]}));C(o)}}catch(s){console.error("Error fetching saved forms",s)}})()},[v,A]);const le=r=>{const{name:s,value:o}=r.target;I(i=>{const c={...i,[s]:o};return s==="categoryId"&&(c.serviceId="",c.subServiceid=""),s==="serviceId"&&(c.subServiceid=""),c})},de=async r=>{let s=!1;const o=localStorage.getItem("HospitalId");for(const i of r){const c=await he(o,i);if(!c||!c.price||!c.finalCost){s=!0;break}}_(!s)},qe=()=>{if(G.trim()){if(O!==null){const r=[...w];r[O]=G.trim(),$(r),V(null)}else w.includes(G.trim())||$([...w,G.trim()]);z("")}},Qe=r=>{$(w.filter(s=>s!==r))},Te=()=>{if(L.trim()&&w.length>0){if(y.some(r=>r.question===L.trim())){alert("This question already exists.");return}P([...y,{question:L.trim(),answers:[...w]}]),U(""),$([])}},Ge=r=>{P(y.filter((s,o)=>o!==r))},$e=async()=>{const r={};if((!q||q.length===0)&&(r.subServiceName="At least one Procedure must be selected."),y.length===0&&(r.qaList="At least one question is required."),Object.keys(r).length>0){h(r);return}h({});const s=q.map(o=>({subServiceid:o,consentFormQuestions:y.map(i=>({heading:i.question,questionsAndAnswers:i.answers.map(c=>({question:c,answer:!0}))}))}));try{if(n!==null)await Ee(s[0],v,A);else for(const i of s)await ke(i,v,A);const o=await fe(v,A);o!=null&&o.data&&C(Array.isArray(o.data)?o.data:[o.data]),I({categoryId:"",serviceId:"",subServiceid:"",subServiceName:"",consentFormQuestions:[]}),P([]),Q([]),E(!1),t(null)}catch(o){console.error("Error saving Procedure Form:",o)}},De=async r=>{var s;try{const o=g[r];if(!o){N.error("Selected form not found");return}const i=o.subServiceid??o.subServiceId??((s=o==null?void 0:o.subService)==null?void 0:s.subServiceId)??(o==null?void 0:o.id);i||console.warn("No subService id found on selected form:",o);let c=null;if(i)try{c=await he(v,i)}catch(x){console.warn("getSubServiceById failed:",x)}const b=i??(c==null?void 0:c.subServiceId)??"",ue=(c==null?void 0:c.subServiceName)??o.subServiceName??"",Be=(c==null?void 0:c.serviceId)??o.serviceId??"",Re=(c==null?void 0:c.categoryId)??o.categoryId??"";c?j(x=>x.some(_e=>String(_e.subServiceId)===String(c.subServiceId))?x:[...x,c]):b&&!S.some(x=>String(x.subServiceId)===String(b))&&j(x=>[...x,{subServiceId:b,subServiceName:ue||"Unknown"}]),I({categoryId:Re||"",serviceId:Be||"",subServiceid:b||"",subServiceName:ue||"",consentFormQuestions:o.consentFormQuestions||[]}),Q(b?[b]:[]);const Oe=(o.consentFormQuestions||[]).map(x=>({question:x.heading,answers:(x.questionsAndAnswers||[]).map(me=>me.question)}));P(Oe),t(r),E(!0),h({});const Ve=g.some(x=>String(x.subServiceid??x.subServiceId??"")===String(b));D(!Ve),b&&de([b])}catch(o){console.error("Error in editProcedureForm:",o),N.error("Unable to prepare edit form. Check console for details.")}},Le=async r=>{const s=g[r],o=(s==null?void 0:s.id)||(s==null?void 0:s.consentFormId)||(s==null?void 0:s.formId);if(!(s!=null&&s.id)){N.error("This form does not have an ID and cannot be deleted.");return}try{await Pe(o);const i=g.filter((c,b)=>b!==r);C(i)}catch(i){console.error("Error deleting Procedure Form:",i),N.error("Failed to delete procedure form.")}},Me=r=>{const s=y[r];U(s.question),$(s.answers);const o=y.filter((i,c)=>c!==r);P(o)};return e.jsxs(ne,{className:"mt-3",children:[e.jsxs(ae,{children:[!k&&e.jsx("div",{className:"  w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(F,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>{E(!0),I({categoryId:"",serviceId:"",subServiceid:"",subServiceName:"",consentFormQuestions:[]}),P([]),t(null)},children:"+ Add Procedure Form"})}),k&&e.jsxs(je,{className:"mb-4",children:[e.jsxs(Ze,{className:"mb-4",children:[e.jsxs(Y,{md:4,children:[e.jsxs("h6",{children:["Category Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(ve,{value:f.categoryId||"",onChange:le,name:"categoryId","aria-label":"Select Category",children:[e.jsx("option",{value:"",children:"Select a Category"}),m==null?void 0:m.map(r=>e.jsx("option",{value:r.categoryId,children:r.categoryName},r.categoryId))]}),l.categoryId&&e.jsx(oe,{className:"text-danger",children:l.categoryId})]}),e.jsxs(Y,{md:4,children:[e.jsxs("h6",{children:["Service Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(ve,{name:"serviceId",value:f.serviceId||"",onChange:le,children:[e.jsx("option",{value:"",children:"Select Service"}),d.map(r=>e.jsx("option",{value:r.serviceId,children:r.serviceName},r.serviceId))]}),l.serviceId&&e.jsx(oe,{className:"text-danger",children:l.serviceId})]}),e.jsxs(Y,{md:4,children:[e.jsxs("h6",{children:["Procedure Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(es,{isMulti:!0,name:"subServiceName",placeholder:"Select Sub Services",options:(S||[]).map(r=>({label:r.subServiceName,value:r.subServiceId})),value:(S||[]).filter(r=>q.includes(r.subServiceId)).map(r=>({label:r.subServiceName,value:r.subServiceId})),onChange:r=>{const s=r.map(i=>i.value);Q(s),r.length>0&&h(i=>({...i,subServiceName:""}));const o=s.some(i=>!g.some(c=>String(c.subServiceid)===String(i)));D(o),de(s)}}),!ce&&e.jsxs("div",{className:"text-danger mt-2",children:["Some selected Procedures are missing details like price or final cost.",e.jsx("br",{}),e.jsx("a",{href:"/procedure-Management",className:"text-primary",children:"Please add Procedure details"})]}),l.subServiceName&&e.jsx(oe,{className:"text-danger",children:l.subServiceName})]})]}),e.jsxs(Y,{md:12,children:[e.jsx("h6",{className:"mb-2",children:"Question"}),e.jsx(ee,{placeholder:"Enter question",value:L,onChange:r=>U(r.target.value)}),e.jsx("h6",{className:"mt-3 mb-2",children:"Answers"}),e.jsxs(ye,{className:"mb-2",children:[e.jsx(ee,{placeholder:"Enter answer",value:G,onChange:r=>z(r.target.value)}),e.jsx(F,{onClick:qe,style:{backgroundColor:"var(--color-black)",color:"white"},children:e.jsx(Se,{})})]}),w.length>0&&e.jsx(Ce,{className:"mb-3",children:w.map((r,s)=>e.jsxs(Ie,{className:"d-flex justify-content-between align-items-center",children:[r,e.jsxs("div",{children:[e.jsx(M,{onClick:()=>{z(r),V(s)},style:{cursor:"pointer",color:"var(--color-black)",marginRight:"10px"}}),e.jsx(B,{onClick:()=>Qe(r),style:{cursor:"pointer",color:"var(--color-black)"}})]})]},s))}),e.jsx(F,{color:"info",className:"me-2  ",onClick:Te,style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)",border:"none"},children:"Add Question"})]}),y.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{children:"Questions Added"}),y.map((r,s)=>e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:r.question}),e.jsx("ul",{children:r.answers.map((o,i)=>e.jsx("li",{children:o},i))}),e.jsxs("div",{children:[e.jsx(M,{onClick:()=>Me(s),style:{cursor:"pointer",color:"var(--color-black)",marginRight:"10px"}}),e.jsx(B,{onClick:()=>Ge(s),style:{cursor:"pointer",color:"var(--color-black)"}})]})]},s))]}),e.jsxs("div",{className:"mt-3",children:[e.jsx(F,{color:"secondary",className:"me-2",onClick:()=>E(!1),children:"Cancel"}),e.jsx(F,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)",border:"none"},onClick:$e,children:n!==null?"Update Procedure Form":"Save Procedure Form"})]})]}),g.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h6",{children:"Saved Procedure Forms"}),e.jsx(we,{children:g.map((r,s)=>e.jsx(e.Fragment,{children:e.jsxs(Fe,{itemKey:s,children:[e.jsx(Ae,{children:R(r.subServiceName)||"Unnamed Procedure"}),e.jsxs(Ne,{children:[Array.isArray(r.consentFormQuestions)&&r.consentFormQuestions.map((o,i)=>e.jsxs("div",{children:[e.jsx("h6",{children:R(o.heading)}),Array.isArray(o.questionsAndAnswers)&&o.questionsAndAnswers.map((c,b)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("input",{type:"checkbox",checked:c.answer===void 0?!0:!!c.answer,className:"me-2",disabled:!0}),e.jsx("span",{children:R(c.question)})]},b))]},i)),e.jsxs("div",{className:"d-flex gap-3 mt-2",children:[e.jsx(M,{onClick:()=>De(s),style:{color:"var(--color-black)",cursor:"pointer"}}),e.jsx(B,{onClick:()=>{H(s),T(!0),K(r.subServiceName)},style:{color:"var(--color-black)",cursor:"pointer"}})]})]})]},s)}))})]})]}),e.jsx(be,{isVisible:X,title:"Delete Procedure Consent",message:`Are you sure you want to delete this "${re}" ? This action cannot be undone.`,confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>{Z!==null&&(Le(Z),H(null)),T(!1)},onCancel:()=>{H(null),T(!1)}})]})},As=()=>{const[m,u]=a.useState(1);return e.jsx(ne,{children:e.jsxs(ae,{children:[e.jsxs(ss,{variant:"tabs",style:{cursor:"pointer",color:"var(--color-black)"},children:[e.jsx(pe,{children:e.jsx(ge,{active:m===1,onClick:()=>u(1),style:{color:"var(--color-black)"},children:"Generic Consent Form"})}),e.jsx(pe,{children:e.jsx(ge,{active:m===2,onClick:()=>u(2),style:{color:"var(--color-black)"},children:"Procedure Consent Form"})})]}),e.jsxs(rs,{children:[e.jsx(xe,{visible:m===1,children:e.jsx(os,{})}),e.jsx(xe,{visible:m===2,children:e.jsx(ts,{})})]})]})})};export{As as default};
