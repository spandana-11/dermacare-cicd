import{r as n,j as e,B as b,h as Z,i as W,a as ne,b as de,R as me}from"./index-uxa4g2ur.js";import{f as he,a as U}from"./Features-D45jZVjg.js";import{c as T}from"./capitalizeWords-CuwF8AcI.js";import{C as ae,a as le,b as te}from"./CModalHeader-B9tHwb6P.js";import{C as xe}from"./CModalTitle-C7iQGtyU.js";import{C as ue}from"./CForm-DBDKG-J3.js";import{C as h}from"./CFormLabel-BuZXY1hU.js";import{C as j}from"./CFormInput-Bq8b7aaW.js";import{C as je}from"./CFormSelect-CgaU_adc.js";import{C as be}from"./CFormTextarea-ByafMj5b.js";import{C as ie}from"./CModalFooter-Bsfp-_9q.js";import{b as A}from"./index.esm-DjiU8BSy.js";import{C as fe}from"./ConfirmationModal-CqaUvATP.js";import{L as pe}from"./loader-Ch8liZ7R.js";import{C as ve,a as ge,b as se,c as I,d as Ne,e as k}from"./CTable-Kp0k1S59.js";import{E as Ce}from"./eye-DN3aaGKd.js";import{P as ye,T as ke}from"./trash-2-CD6lLqDu.js";import"./CNavItem-BPRZGw1g.js";const De=({visible:f,onClose:v,onSave:Y,initialData:y,viewMode:D,technicians:g,fetchTechs:re})=>{const E={},N={clinicId:localStorage.getItem("HospitalId"),branchId:localStorage.getItem("branchId"),hospitalName:localStorage.getItem("HospitalName"),fullName:"",gender:"male",dateOfBirth:"",mobileNumber:"",emailId:"",govermentId:"",getReferralDoctorByReferralId:"",dateOfJoining:"",department:"",yearOfExperience:"",currentHospitalName:"",department:"",specialization:"",firstReferralDate:"",totalReferrals:"",referredPatients:"",preferredCommunicationMethod:"",status:"",role:"ReferDoctor",address:{houseNo:"",street:"",landmark:"",city:"",state:"",postalCode:"",country:"India"},bankAccountDetails:{accountNumber:"",accountHolderName:"",ifscCode:"",bankName:"",branchName:"",panCardNumber:""},medicalFitnessCertificate:"",profilePicture:"",policeVerification:"",previousEmploymentHistory:"",traningOrGuardLicense:"",permissions:E,userName:"",password:""},[a,x]=n.useState(N),[ce,Q]=n.useState(localStorage.getItem("HospitalId")),[oe,$]=n.useState(!1),[w,R]=n.useState(!1),[_,z]=n.useState(null),[S,J]=n.useState(!1),K=["fullName","dateOfBirth","gender","contactNumber","govermentId","dateOfJoining","department","address.houseNo","address.street","address.city","address.state","address.postalCode","address.country","bankAccountDetails.accountNumber","bankAccountDetails.accountHolderName","bankAccountDetails.bankName","bankAccountDetails.branchName","bankAccountDetails.ifscCode","bankAccountDetails.panCardNumber","policeVerification","medicalFitnessCertificate"];function M(s,t){const l=[];for(const i of t){const c=i.split(".");let d=s;for(const C of c)d=d==null?void 0:d[C];(!d||String(d).trim()==="")&&l.push(i)}return l}const G=s=>{x(t=>{const l={...t.permissions};return l[s]?delete l[s]:l[s]=[],{...t,permissions:l}})},X=(s,t)=>{x(l=>{const i={...l.permissions};return i[s]||(i[s]=[]),i[s].includes(t)?i[s]=i[s].filter(c=>c!==t):i[s]=[...i[s],t],{...l,permissions:i}})},q=s=>{x(t=>{const l={...t.permissions};return l[s]?l[s].length===U.length?l[s]=[]:l[s]=[...U]:l[s]=[...U],{...t,permissions:l}})},P=s=>new Promise((t,l)=>{const i=new FileReader;i.readAsDataURL(s),i.onload=()=>t(i.result),i.onerror=c=>l(c)});n.useEffect(()=>{x(y||N)},[y]);const u=(s,t)=>{x(l=>({...l,[s]:t}))},m=(s,t,l)=>{x(i=>({...i,[s]:{...i[s],[t]:l}}))},F=(s,t)=>{const l=s.target.files[0];if(!l)return;const i=new FileReader;i.onloadend=()=>{x(c=>({...c,[t]:i.result,[`${t}Name`]:l.name,[`${t}Type`]:l.type}))},i.readAsDataURL(l)},B=()=>{const s=M(a,K);if(s.length>0){b.error(`Please fill required fields: ${s.join(", ")}`);return}if(a.dateOfBirth){const d=new Date(a.dateOfBirth),C=new Date,V=C.getFullYear()-d.getFullYear();if((C.getMonth()<d.getMonth()||C.getMonth()===d.getMonth()&&C.getDate()<d.getDate()?V-1:V)<18){b.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(a.contactNumber)){b.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.emailId)){b.error("Please enter a valid email address.");return}if(g==null?void 0:g.some(d=>d.contactNumber===a.contactNumber&&d.id!==a.id)){b.error("Contact number already exists!");return}if(g==null?void 0:g.some(d=>d.emailId===a.emailId&&d.id!==a.id)){b.error("Email already exists!");return}console.log(a),Y(a),x(N),v()},O=()=>{$(!1),z(null),J(!1)},H=(s,t)=>{z(s),J(t==null?void 0:t.includes("pdf")),$(!0)},ee=s=>{try{return atob(s)}catch{return null}},o=({title:s,children:t})=>e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-semibold border-b pb-2 mb-4",children:s}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:t})]}),r=({label:s,value:t})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:t||"N/A"})]}),p=({label:s,value:t})=>e.jsxs("div",{className:"col-span-3",children:[s&&e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:t||"N/A"})]}),L=({label:s,type:t,data:l})=>{if(!l)return e.jsxs("p",{children:[s," "]});const i=t==null?void 0:t.startsWith("image/"),c=l.startsWith("data:")?l:`data:${t};base64,${l}`;return e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsxs("strong",{children:[s,":"]}),e.jsxs("div",{className:"mt-2",children:[i?e.jsx("img",{src:c,alt:s,className:"w-32 h-32 object-cover rounded-md border cursor-pointer",onClick:()=>H(c,t)}):e.jsx("button",{type:"button ",className:" btn text-blue-600 hover:underline block mx-2",onClick:()=>H(c,t),style:{backgroundColor:"var(--color-black)",color:"white"},children:"Preview"}),e.jsx("a",{href:c,download:s.replace(/\s+/g,"_"),className:"text-green-600 hover:underline text-sm block  btn",style:{backgroundColor:"var(--color-black)",color:"white"},children:"Download"})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(ae,{visible:f,onClose:v,size:"lg",className:"custom-modal",backdrop:"static",children:[e.jsx(le,{children:e.jsx(xe,{children:D?"Personal Information":"Add / Edit ReferDoctor"})}),e.jsx(te,{children:D?e.jsxs("div",{className:"p-4 border rounded shadow-sm bg-white ",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Name : "}),e.jsx("span",{children:a.fullName})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold",children:"Email : "}),e.jsx("span",{children:a.emailId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-bold",children:"Cantact : "}),e.jsx("span",{children:a.contactNumber})]})]}),e.jsxs("div",{className:"text-center",children:[a.profilePicture?e.jsx("img",{src:ee(a.profilePicture),alt:a.fullName,width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsxs("div",{style:{color:"var(--color-black)",marginTop:"5px",fontSize:"14px",fontWeight:"500"},children:["ID: ",a.id]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-5 mt-5",children:[e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Full Name",value:a.fullName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Email",value:a.emailId})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Contact",value:a.contactNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Gender",value:a.gender})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Date of Birth",value:a.dateOfBirth})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Government ID",value:a.govermentId})})]}),e.jsx(o,{title:"Work Information",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Date of Joining",value:a.dateOfJoining})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Department",value:a.department})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Experience",value:a.yearOfExperience})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Shift Timings",value:a.shiftTimingsOrAvailability})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Emergency Contact",value:a.emergencyContact})})]})}),e.jsx(o,{title:"Address",children:e.jsx(p,{value:`${a.address.houseNo}, ${a.address.street}, ${a.address.city}, ${a.address.state} - ${a.address.postalCode}, ${a.address.country}`})}),e.jsx(o,{title:"Bank Details",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Account Number",value:a.bankAccountDetails.accountNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Account Holder Name",value:a.bankAccountDetails.accountHolderName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"IFSC Code",value:a.bankAccountDetails.ifscCode})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Bank Name",value:a.bankAccountDetails.bankName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"Branch Name",value:a.bankAccountDetails.branchName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(r,{label:"PAN Card",value:a.bankAccountDetails.panCardNumber})})]})}),e.jsx(o,{title:"Documents",children:e.jsxs("div",{className:"row",children:[a.qualificationOrCertifications!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(L,{label:"Qualification / Certifications",type:a.qualificationOrCertificationsType,data:a.qualificationOrCertifications})}):e.jsx("p",{className:"col-md-6",children:"Not Provided qualification/Certifications"}),a.medicalFitnessCertificate!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(L,{label:"Medical Fitness Certificate",type:a.medicalFitnessCertificateType||"application/pdf",data:a.medicalFitnessCertificate})}):e.jsx("p",{className:"col-md-6",children:"Not Provided medical Fitness Certificate"})]})}),e.jsx("div",{className:"mt-4"}),e.jsx(o,{title:"Other Information ",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(r,{label:"Police Verification",value:a.policeVerification})}),e.jsx("div",{className:"col-md-6",children:e.jsx(r,{label:"Vaccination Status",value:a.vaccinationStatus})}),e.jsx("div",{className:"col-md-12",children:e.jsx(p,{label:"Previous Employment",value:a.previousEmploymentHistory})}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(p,{label:"User Name",value:a.userName})}),e.jsx("div",{className:"col-md-6",children:e.jsx(p,{label:"Password",value:a.password})})]})]})})]})]}):e.jsxs(ue,{children:[e.jsx("h5",{children:"Basic Information"}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-5",children:[e.jsxs(h,{children:["ClinicID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{value:ce,disabled:!0,onChange:s=>u("clinicId",s.target.value)})]}),e.jsxs("div",{className:"col-md-7",children:[e.jsxs(h,{children:["Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{value:a.role,disabled:!0,onChange:s=>u("role",s.target.value)})]})]})}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Full Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{value:a.fullName,onChange:s=>u("fullName",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Gender ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(je,{value:a.gender,onChange:s=>u("gender",s.target.value),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Date of Birth ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{type:"date",value:a.dateOfBirth,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],onChange:s=>u("dateOfBirth",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Contact Number ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{type:"text",maxLength:10,value:a.contactNumber,onChange:s=>{const t=s.target.value;/^\d*$/.test(t)&&u("contactNumber",t)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(h,{children:"Email"}),e.jsx(j,{type:"email",value:a.emailId,onChange:s=>u("emailId",s.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["GovernmentID(AadharCard No) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{maxLength:12,value:a.govermentId,onChange:s=>{const t=s.target.value;/^\d*$/.test(t)&&u("govermentId",t)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Police Verification ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{value:T(a.policeVerification),onChange:s=>u("policeVerification",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Department ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{value:T(a.department),onChange:s=>u("department",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Date of Joining ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{type:"date",value:a.dateOfJoining,onChange:s=>u("dateOfJoining",s.target.value)})]})]}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-md-4",children:" "})}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4"}),e.jsx("div",{className:"col-md-4"})]}),e.jsx("h5",{className:"mt-3",children:"Address"}),Object.keys(a.address).reduce((s,t,l)=>(l%3===0&&s.push([]),s[s.length-1].push(t),s),[]).map((s,t)=>e.jsx("div",{className:"row mb-3",children:s.map(l=>e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{className:"text-capitalize",children:[l," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{type:"text",maxLength:l==="postalCode"?6:void 0,value:T(a.address[l]),onChange:i=>{let c=i.target.value;l==="postalCode"?/^\d*$/.test(c)&&m("address",l,c):m("address",l,c)}})]},l))},t)),e.jsx("h5",{className:"mt-3",children:"Bank Account Details"}),Object.keys(a.bankAccountDetails).reduce((s,t,l)=>(l%3===0&&s.push([]),s[s.length-1].push(t),s),[]).map((s,t)=>e.jsx("div",{className:"row mb-3",children:s.map(l=>e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{className:"text-capitalize",children:[l," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{value:a.bankAccountDetails[l],maxLength:l==="accountNumber"?20:l==="panCardNumber"?10:l==="ifscCode"?11:void 0,onChange:async i=>{let c=i.target.value;if(l==="accountNumber"){/^\d*$/.test(c)&&m("bankAccountDetails",l,c);return}if(l==="panCardNumber"){c=c.toUpperCase(),/^[A-Z]{0,5}[0-9]{0,4}[A-Z]{0,1}$/.test(c)&&m("bankAccountDetails",l,c),c.length===10&&(/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(c)||b.error("Invalid PAN format (e.g., ABCDE1234F)"));return}if(l==="ifscCode"){if(c=c.toUpperCase(),!/^[A-Z0-9]*$/.test(c))return;if(m("bankAccountDetails",l,c),c.length===11){if(!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(c)){b.error("Invalid IFSC format (e.g., HDFC0001234)"),m("bankAccountDetails","bankName",""),m("bankAccountDetails","branchName","");return}try{const C=await fetch(`https://ifsc.razorpay.com/${c}`);if(C.ok){const V=await C.json();m("bankAccountDetails","bankName",V.BANK||""),m("bankAccountDetails","branchName",V.BRANCH||"")}else b.error("Invalid IFSC Code"),m("bankAccountDetails","bankName",""),m("bankAccountDetails","branchName","")}catch{b.error("Error fetching bank details"),m("bankAccountDetails","bankName",""),m("bankAccountDetails","branchName","")}}else m("bankAccountDetails","bankName",""),m("bankAccountDetails","branchName","");return}m("bankAccountDetails",l,c)}})]},l))},t)),e.jsx("h5",{className:"mt-3",children:"Documents"}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Profile Image ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{type:"file",accept:"image/*",onChange:async s=>{const t=s.target.files[0];if(t){const l=await P(t);u("profilePicture",l)}}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Medical Fitness Certificate ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{type:"file",onChange:s=>F(s,"medicalFitnessCertificate")})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(h,{children:"Teaining Guard License"}),e.jsx(j,{type:"file",onChange:s=>F(s,"qualificationOrCertifications")})]})]}),e.jsx(h,{children:"Previous Employment History"}),e.jsx(be,{rows:3,value:a.previousEmploymentHistory,onChange:s=>u("previousEmploymentHistory",s.target.value),placeholder:"Enter previous employment history"}),e.jsx("div",{className:"mb-3 w-100 mt-4",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"}}),w&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Set User Permissions"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>R(!1)})]}),e.jsx("div",{className:"modal-body",children:e.jsx("div",{className:"row",children:he.map(s=>{const t=!!a.permissions[s],l=t&&a.permissions[s].length===U.length;return e.jsxs("div",{className:"col-md-5 mb-3 border p-2 rounded mx-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("label",{className:"fw-bold",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:()=>G(s)})," ",s]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",disabled:!t,checked:l,onChange:()=>q(s)})," ","Select All"]})]}),e.jsx("div",{className:"d-flex flex-wrap gap-3 mt-2",children:U.map(i=>{var c;return e.jsxs("label",{className:"d-flex align-items-center gap-1",children:[e.jsx("input",{type:"checkbox",disabled:!t,checked:((c=a.permissions[s])==null?void 0:c.includes(i))||!1,onChange:()=>X(s,i)}),i]},i)})})]},s)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>R(!1),children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>R(!1),children:"Save Permissions"})]})]})})}),w&&e.jsx("div",{className:"modal-backdrop fade show"})]})}),e.jsx(ie,{children:D?e.jsx(A,{color:"secondary",onClick:v,children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(A,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)"},onClick:()=>x(N),children:"Clear"}),e.jsx(A,{color:"secondary",onClick:v,children:"Cancel"}),e.jsx(A,{style:{backgroundColor:"var(--color-black)",color:"white"},onClick:B,children:"Save"})]})})]}),e.jsxs(ae,{visible:oe,onClose:O,size:"xl",children:[e.jsx(le,{onClose:O,children:e.jsx("strong",{children:S?"PDF Preview":"Image Preview"})}),e.jsx(te,{className:"text-center",children:S?e.jsx("iframe",{src:_,title:"PDF Preview",style:{width:"100%",height:"80vh",border:"none"}}):e.jsx("img",{src:_,alt:"Preview",style:{maxWidth:"100%",maxHeight:"80vh",borderRadius:"8px"}})})]})]})},we=f=>Z.get(`${W}/getReferralDoctorById/${f}`),Ie=f=>Z.post(`${W}/addReferralDoctor`,f),Ae=(f,v)=>Z.put(`${W}/updateReferralDoctorById/${f}`,v),Re=f=>Z.delete(`${W}/deleteReferralDoctorById/${f}`),Qe=()=>{const[f,v]=n.useState([]),[Y,y]=n.useState(!1),[D,g]=n.useState(null),[re,E]=n.useState(!1),[N,a]=n.useState(1),[x,ce]=n.useState(10),{searchQuery:Q,setSearchQuery:oe}=ne(),[$,w]=n.useState(!1),[R,_]=n.useState(null),[z,S]=n.useState(!1),[J,K]=n.useState(null),[M,G]=n.useState(null),[X,q]=n.useState(!1),P=async()=>{var o;w(!0);try{const r=localStorage.getItem("HospitalId");if(r){const p=await we(r);console.log("API Response:",p),w(!1),v(((o=p.data)==null?void 0:o.data)||[])}}catch(r){console.error("❌ Error fetching lab technicians:",r),v([]),w(!1)}finally{w(!1)}};n.useEffect(()=>{P()},[]);const u=async o=>{try{if(D)await Ae(D.ReferDoctorStaffId,o),P(),b.success("ReferDoctor updated successfully!");else{const r=await Ie(o);await P(),console.log(r),G({username:r.data.data.userName,password:r.data.data.password}),y(!1),q(!0),b.success("ReferDoctor added successfully!")}}catch(r){b.error("❌ Failed to save ReferDoctor."),console.error("API error:",r)}},m=async o=>{console.log(o);try{await Re(o),v(r=>r.filter(p=>p.id!==o)),b.success("ReferDoctor deleted successfully!")}catch(r){b.error("❌ Failed to delete ReferDoctor."),console.error("Delete error:",r)}finally{S(!1)}},{user:F}=de(),B=(o,r)=>{var p,L;return(L=(p=F==null?void 0:F.permissions)==null?void 0:p[o])==null?void 0:L.includes(r)},O=me.useMemo(()=>{const o=Q.toLowerCase().trim();return o?f.filter(r=>Object.values(r).some(p=>String(p).toLowerCase().includes(o))):f},[Q,f]),H=O.slice((N-1)*x,N*x),ee=o=>{try{return atob(o)}catch{return null}};return e.jsxs("div",{children:[B("Laboratory","create")&&e.jsx("div",{className:"mb-3 w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(A,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>y(!0),children:"Add ReferDoctor"})}),e.jsxs(ae,{visible:X,backdrop:"static",keyboard:!1,children:[e.jsx(le,{children:e.jsx("h5",{children:"Technician Credentials"})}),e.jsx(te,{children:M?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",M.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," ",M.password]}),e.jsx("small",{className:"text-danger",children:"⚠️ Please save these credentials securely. They will not be shown again."})]}):e.jsx("p",{children:"No data available"})}),e.jsx(ie,{children:e.jsx(A,{color:"primary",onClick:()=>{q(!1),G(null)},children:"Close"})})]}),e.jsx(fe,{isVisible:z,title:"Delete ReferDoctor",message:"Are you sure you want to delete this ReferDoctor? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>m(J),onCancel:()=>S(!1)}),$?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(pe,{message:"Loading technician..."})}):R?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:R}):e.jsxs(ve,{className:"mt-3",striped:!0,hover:!0,responsive:!0,children:[e.jsx(ge,{children:e.jsxs(se,{className:"pink-table  w-auto",children:[e.jsx(I,{children:"#"}),e.jsx(I,{children:"Photo"})," ",e.jsx(I,{children:"Name"}),e.jsx(I,{children:"Contact"}),e.jsx(I,{children:"Sex"}),e.jsx(I,{children:"Date Of Joining"}),e.jsx(I,{className:"text-end",children:"Actions"})]})}),e.jsx(Ne,{className:"pink-table",children:H.length>0?H.map((o,r)=>e.jsxs(se,{children:[e.jsx(k,{children:(N-1)*x+r+1}),e.jsx(k,{children:o.profilePicture?e.jsx("img",{src:ee(o.profilePicture),alt:o.fullName,width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}})}),e.jsx(k,{children:T(o.fullName)}),e.jsx(k,{children:T(o.contactNumber)}),e.jsx(k,{children:T(o.gender)}),e.jsx(k,{children:o.dateOfJoining}),e.jsx(k,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2  ",children:[B("Laboratory","read")&&e.jsx("button",{className:"actionBtn",onClick:()=>{g(o),E(!0),y(!0)},title:"View",children:e.jsx(Ce,{size:18})}),B("Laboratory","update")&&e.jsx("button",{className:"actionBtn",onClick:()=>{g(o),E(!1),y(!0)},title:"Edit",children:e.jsx(ye,{size:18})}),B("Laboratory","delete")&&e.jsx("button",{className:"actionBtn",onClick:()=>{console.log(o.ReferDoctorStaffId),K(o.ReferDoctorStaffId),S(!0)},title:"Delete",children:e.jsx(ke,{size:18})})]})})]},o.id)):e.jsx(se,{children:e.jsx(k,{colSpan:"9",className:"text-center",style:{color:"var(--color-black)"},children:"No ReferDoctor found."})})})]}),!$&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(O.length/x)},(o,r)=>e.jsx(A,{style:{backgroundColor:N===r+1?"var(--color-black)":"#fff",color:N===r+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>a(r+1),children:r+1},r))}),e.jsx(De,{visible:Y,onClose:()=>{y(!1),g(null),E(!1)},onSave:u,initialData:D,viewMode:re,technicians:f,fetchTechs:P})]})};export{Qe as default};
