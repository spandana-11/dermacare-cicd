import{R as Ce,u as Me,r as n,a as Fe,j as e,Q as ke,B as j}from"./index-C_57eipd.js";import{b as O}from"./index.esm-BHEIq1go.js";import{C as Ee,d as Te,a as je,u as $e,b as Ae}from"./CustomerManagementAPI-9ZZiRJpv.js";import{L as Le}from"./loader-BIB4_ekq.js";import{C as Pe}from"./ConfirmationModal-DXoiKv1A.js";import{C as v,a as i}from"./CRow-C7y-bEMs.js";import{C as Re,a as He,b as W,c as M,d as Ve,e as S}from"./CTable-DYT4YNjn.js";import{E as Ye}from"./eye-CHJBnw-K.js";import{P as qe,T as Ge}from"./trash-2-xDm_pbzu.js";import{C as ze,a as Qe,b as Ue}from"./CModalHeader-ByJ2V-Ma.js";import{C as Ke}from"./CModalTitle-DDIj9Tfs.js";import{C as We}from"./CModalFooter-BaEfHy_e.js";import{C as Ze}from"./CForm-CQ2Lc3Ee.js";import{C as c}from"./CFormLabel-88J2CuQM.js";import{C as pe}from"./CFormSelect-CG529RFZ.js";import{C as u}from"./CFormInput-B4iuloMJ.js";import"./createLucideIcon-C-shW1qm.js";import"./CNavItem-CLuTsh0o.js";const _e=()=>{var ne,ie,oe,de,ce,me,he,ue,fe;Me();const[F,$]=n.useState([]),[A,C]=n.useState(!1),[Z,_]=n.useState(null),[D,be]=n.useState(1),[k,Je]=n.useState(10),[Xe,J]=n.useState(null),[et,L]=n.useState(""),[Ne,P]=n.useState(!1),[X,R]=n.useState(null),[o,ee]=n.useState({}),{searchQuery:H,setSearchQuery:tt}=Fe(),[ye,V]=n.useState(!1),[p,te]=n.useState(!1),[ve,Y]=n.useState(!1),[m,se]=n.useState(null),[a,b]=n.useState({customerId:"",title:"",firstName:"",lastName:"",fullName:"",mobileNumber:"",gender:"",email:"",dateOfBirth:"",referralCode:"",age:"",hospitalId:localStorage.getItem("HospitalId")||"",hospitalName:localStorage.getItem("HospitalName")||"",branchId:localStorage.getItem("branchId")||"",address:{houseNo:"",street:"",landmark:"",city:"",state:"",country:"India",postalCode:""}}),[st,at]=n.useState([]),[rt,lt]=n.useState(!1),w=n.useRef(null);n.useEffect(()=>()=>{},[]);const x=(t,s,r)=>{b(l=>({...l,[t]:{...l[t],[s]:r}}))},ae=t=>{/^\d*$/.test(t)&&(x("address","postalCode",t),w.current&&clearTimeout(w.current),t.length===6&&(w.current=setTimeout(async()=>{var s;try{const r=await fetch(`https://api.postalpincode.in/pincode/${t}`);if(!r.ok)throw new Error(`pincode API ${r.status}`);const l=await r.json();if(((s=l==null?void 0:l[0])==null?void 0:s.Status)==="Success"&&Array.isArray(l[0].PostOffice)&&l[0].PostOffice.length){const h=l[0].PostOffice[0];x("address","street",h.Name||""),x("address","city",h.Region||""),x("address","landmark",h.Block||""),x("address","state",h.State||"")}else console.warn("No PostOffice data returned for pincode",t,l)}catch(r){console.warn("Error fetching pincode data:",r)}},300)))};n.useEffect(()=>()=>{w.current&&clearTimeout(w.current)},[]);const q=n.useCallback(async()=>{C(!0),_(null);try{const t=await Ee(),s=Array.isArray(t)?t.filter(r=>r&&typeof r=="object"):[];$(s)}catch(t){console.error("Error fetching customers:",t),_("Failed to fetch customer data."),$([])}finally{C(!1)}},[]);n.useEffect(()=>{q()},[q]);const I=t=>t?t.toLowerCase().replace(/\b\w/g,s=>s.toUpperCase()):"",Se=async t=>{try{C(!0);const s=await je(t),r=Array.isArray(s)?s[0]:s;se(r),Y(!0)}catch(s){console.error("Failed to fetch customer:",s),j.error("Failed to load customer data")}finally{C(!1)}},De=async t=>{var s,r,l,h,N,E,xe;try{C(!0);const B=await je(t),d=Array.isArray(B)?B[0]:B;let z="";if(d.dateOfBirth){const f=d.dateOfBirth;if(/^\d{2}-\d{2}-\d{4}$/.test(f)){const[y,U,K]=f.split("-");z=`${K}-${U}-${y}`}else{const y=new Date(f);if(!isNaN(y)){const U=y.getFullYear(),K=String(y.getMonth()+1).padStart(2,"0"),Oe=String(y.getDate()).padStart(2,"0");z=`${U}-${K}-${Oe}`}}}let Q="",T="",ge="";if(d.fullName){const f=d.fullName.trim().split(" ");f.length>=3?(Q=f[0],T=f[1],ge=f.slice(2).join(" ")):f.length===2?(Q=f[0],T=f[1]):f.length===1&&(T=f[0])}b({customerId:d.customerId||"",title:Q,firstName:T,lastName:ge,fullName:d.fullName||"",mobileNumber:d.mobileNumber||"",gender:d.gender||"",email:d.email||"",dateOfBirth:z,referralCode:d.referralCode||"",age:d.age||"",hospitalId:localStorage.getItem("HospitalId")||"",hospitalName:localStorage.getItem("HospitalName")||"",branchId:localStorage.getItem("branchId")||"",address:{houseNo:((s=d.address)==null?void 0:s.houseNo)||"",street:((r=d.address)==null?void 0:r.street)||"",landmark:((l=d.address)==null?void 0:l.landmark)||"",city:((h=d.address)==null?void 0:h.city)||"",state:((N=d.address)==null?void 0:N.state)||"",country:((E=d.address)==null?void 0:E.country)||"India",postalCode:((xe=d.address)==null?void 0:xe.postalCode)||""}}),V(!0),te(!0),J(d.mobileNumber),se(d)}catch(B){console.error("Failed to fetch customer:",B),j.error("Failed to load customer data")}finally{C(!1)}},g=t=>{const{name:s,value:r}=t.target;b({...a,[s]:r});const l={...o};l[s]&&(delete l[s],ee(l))};n.useEffect(()=>{p&&a.address.postalCode&&ae(a.address.postalCode)},[p]);const we=async t=>{var s;if(t.preventDefault(),console.log("Submitting form",a),!!Be())try{const r={...a};if(r.fullName=`${a.title} ${a.firstName} ${a.lastName}`.trim(),r.dateOfBirth){const l=new Date(r.dateOfBirth);if(!isNaN(l)){const h=String(l.getDate()).padStart(2,"0"),N=String(l.getMonth()+1).padStart(2,"0"),E=l.getFullYear();r.dateOfBirth=`${h}-${N}-${E}`}}p?(await $e(a.customerId,r),j.success("Customer updated successfully")):(await Ae(r),j.success("Customer added successfully")),await q(),re()}catch(r){console.error("Error submitting customer:",r),((s=r==null?void 0:r.response)==null?void 0:s.status)===409?j.error("Customer already exists with this mobile number or email."):j.error("Something went wrong while submitting.")}},re=()=>{V(!1),te(!1),J(null),p||setIsViewing(!1),b({customerId:"",title:"",firstName:"",lastName:"",fullName:"",mobileNumber:"",gender:"",email:"",dateOfBirth:"",referralCode:"",age:"",hospitalId:localStorage.getItem("HospitalId")||"",hospitalName:localStorage.getItem("HospitalName")||"",branchId:localStorage.getItem("branchId")||"",address:{houseNo:"",street:"",landmark:"",city:"",state:"",country:"India",postalCode:""}})},G=Ce.useMemo(()=>{const t=H.toLowerCase().trim();return t?F.filter(s=>Object.values(s).some(r=>String(r).toLowerCase().includes(t))):F},[H,F]),le=G.slice((D-1)*k,D*k);n.useEffect(()=>{if(a.dateOfBirth){const t=new Date(a.dateOfBirth);if(isNaN(t))L("");else{const s=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear();L(`${s}-${r}-${l}`)}}else L("")},[a.dateOfBirth]);const Ie=async()=>{try{await Te(X),j.success("Customer deleted successfully");const t=F.filter(s=>(s==null?void 0:s.customerId)!==X);$(t)}catch(t){console.error("Delete failed:",t),j.error("Failed to delete customer")}finally{P(!1),R(null)}},Be=()=>{const t={};if(a.title.trim()?/\d/.test(a.title)&&(t.title="Title should not contain numbers"):t.title="Title is required",a.firstName.trim()?/\d/.test(a.firstName)&&(t.firstName="First Name should not contain numbers"):t.firstName="First Name is required",a.mobileNumber.trim()?/^[1-9]\d{9}$/.test(a.mobileNumber)||(t.mobileNumber="Mobile number must be 10 digits (starting from 1-9)"):t.mobileNumber="Mobile number is required",a.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)||(t.email="Email must be valid and contain @"):t.email="Email is required",!a.dateOfBirth.trim())t.dateOfBirth="Date of Birth is required";else{const s=new Date(a.dateOfBirth),r=s.getFullYear(),l=new Date;if(isNaN(s))t.dateOfBirth="Invalid Date of Birth";else if(r.toString().length!==4)t.dateOfBirth="Year must be 4 digits";else if(s>l)t.dateOfBirth="Date of Birth cannot be in the future";else{const h=new Date;h.setFullYear(l.getFullYear()-120),s<h&&(t.dateOfBirth="Date of Birth must not be more than 120 years ago")}}return a.gender||(t.gender="Gender is required"),a.referralCode&&/[^a-zA-Z0-9]/.test(a.referralCode)&&(t.referralCode="Refer code must contain only letters and numbers"),ee(t),Object.keys(t).length===0};return e.jsx(e.Fragment,{children:ye?e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"mb-4",children:p?"Edit Customer":"Add New Customer"}),e.jsxs(Ze,{onSubmit:we,children:[e.jsxs(v,{className:"mb-3",children:[e.jsxs(i,{md:2,children:[e.jsxs(c,{children:["Title ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(pe,{name:"title",value:a.title,onChange:g,invalid:!!o.title,children:[e.jsx("option",{value:"",children:"Select Title"}),e.jsx("option",{value:"Mr.",children:"Mr."}),e.jsx("option",{value:"Mrs.",children:"Mrs."}),e.jsx("option",{value:"Miss",children:"Miss."}),e.jsx("option",{value:"Ms.",children:"Ms."}),e.jsx("option",{value:"Mx.",children:"Mx."}),e.jsx("option",{value:"Dr.",children:"Dr."}),e.jsx("option",{value:"Prof.",children:"Prof."}),e.jsx("option",{value:"Rev.",children:"Rev."}),e.jsx("option",{value:"Sir",children:"Sir."}),e.jsx("option",{value:"Dame",children:"Dame."}),e.jsx("option",{value:"Lord",children:"Lord"}),e.jsx("option",{value:"Lady",children:"Lady"}),e.jsx("option",{value:"Capt.",children:"Capt."}),e.jsx("option",{value:"Col.",children:"Col."}),e.jsx("option",{value:"Gen.",children:"Gen."}),e.jsx("option",{value:"Hon.",children:"Hon."})]}),o.title&&e.jsx("div",{className:"text-danger small",children:o.title})]}),e.jsxs(i,{md:4,children:[e.jsxs(c,{children:["First Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(u,{name:"firstName",value:a.firstName,onChange:g,invalid:!!o.firstName}),o.firstName&&e.jsx("div",{className:"text-danger small",children:o.firstName})]}),e.jsxs(i,{md:3,children:[e.jsx(c,{children:"Last Name"}),e.jsx(u,{name:"lastName",value:a.lastName,onChange:g})]}),e.jsxs(i,{md:3,children:[e.jsxs(c,{children:["Date of Birth ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(u,{type:"date",name:"dateOfBirth",value:a.dateOfBirth,onChange:t=>{g(t);const s=new Date(t.target.value);if(isNaN(s))b(r=>({...r,age:""}));else{const r=Date.now()-s.getTime(),l=new Date(r),h=Math.abs(l.getUTCFullYear()-1970);b(N=>({...N,age:h.toString()}))}},max:new Date().toISOString().split("T")[0],invalid:!!o.dateOfBirth}),o.dateOfBirth&&e.jsx("div",{className:"text-danger small",children:o.dateOfBirth})]})]}),e.jsxs(v,{className:"mb-3",children:[e.jsxs(i,{md:2,children:[e.jsx(c,{children:"Age"}),e.jsx(u,{name:"age",value:a.age||"",readOnly:!0})]}),e.jsxs(i,{md:4,children:[e.jsxs(c,{children:["Email ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(u,{type:"email",name:"email",value:a.email,onChange:g,invalid:!!o.email}),o.email&&e.jsx("div",{className:"text-danger small",children:o.email})]}),e.jsxs(i,{md:3,children:[e.jsxs(c,{children:["Mobile Number",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(u,{name:"mobileNumber",value:a.mobileNumber,onChange:g,onKeyDown:t=>{!/[0-9]/.test(t.key)&&t.key!=="Backspace"&&t.key!=="Delete"&&t.preventDefault()},onPaste:t=>t.preventDefault(),maxLength:10,invalid:!!o.mobileNumber,disabled:p}),o.mobileNumber&&e.jsx("div",{className:"text-danger small",children:o.mobileNumber})]}),e.jsxs(i,{md:3,children:[e.jsxs(c,{children:["Gender ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(pe,{name:"gender",value:a.gender,onChange:g,invalid:!!o.gender,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Others",children:"Others"})]}),o.gender&&e.jsx("div",{className:"text-danger small",children:o.gender})]})]}),e.jsxs(v,{className:"mt-3",children:[e.jsxs(i,{md:2,children:[e.jsxs(c,{children:["House No ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(u,{type:"text",value:((ue=a.address)==null?void 0:ue.houseNo)||"",onChange:t=>x("address","houseNo",t.target.value)})]}),e.jsxs(i,{md:4,children:[e.jsxs(c,{children:["Postal Code ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(u,{type:"text",maxLength:6,value:((fe=a.address)==null?void 0:fe.postalCode)||"",onChange:t=>ae(t.target.value),placeholder:"6-digit PIN"})]}),e.jsxs(i,{md:3,children:[e.jsxs(c,{children:["Street ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(u,{type:"text",value:I(a.address.street),onChange:t=>x("address","street",t.target.value)})]}),e.jsxs(i,{md:3,children:[e.jsx(c,{children:"Landmark"}),e.jsx(u,{type:"text",value:I(a.address.landmark),onChange:t=>x("address","landmark",t.target.value)})]})]}),e.jsxs(v,{children:[e.jsxs(i,{md:2,children:[e.jsxs(c,{children:["City ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(u,{type:"text",value:I(a.address.city),onChange:t=>x("address","city",t.target.value)})]}),e.jsxs(i,{md:4,children:[e.jsxs(c,{children:["State ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(u,{type:"text",value:I(a.address.state),onChange:t=>x("address","state",t.target.value)})]}),e.jsxs(i,{md:3,children:[e.jsxs(c,{children:["Country ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(u,{type:"text",value:I(a.address.country),onChange:t=>x("address","country",t.target.value)})]}),e.jsxs(i,{md:3,children:[e.jsx(c,{children:"Referral Code"}),e.jsx(u,{name:"referralCode",value:a.referralCode,onChange:g}),o.referralCode&&e.jsx("div",{className:"text-danger",children:o.referralCode})]})]}),e.jsx("br",{}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(O,{color:"secondary",className:"me-2",onClick:re,children:"Cancel"}),e.jsx(O,{type:"submit",color:"success",style:{backgroundColor:"var(--color-black)",color:"white",border:"none"},children:p?"Update":"Submit"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(v,{className:"d-flex align-items-center mb-3",children:[e.jsx(ke,{}),e.jsx("div",{className:"mb-3 w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(O,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>V(!0),children:"Add New Customer"})})]}),e.jsx(Pe,{isVisible:Ne,title:"Delete Customer",message:"Are you sure you want to delete this Customer? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:Ie,onCancel:()=>{P(!1),R(null)}}),A?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(Le,{message:"Loading customers..."})}):Z?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:Z}):G.length===0?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:"No Customer Data Found"}):e.jsxs(e.Fragment,{children:[e.jsxs(Re,{hover:!0,striped:!0,responsive:!0,children:[e.jsx(He,{className:"pink-table  w-auto",children:e.jsxs(W,{children:[e.jsx(M,{children:"S.No"}),e.jsx(M,{children:"Full Name"}),e.jsx(M,{children:"Mobile Number"}),e.jsx(M,{children:"Gender"}),e.jsx(M,{className:"text-end",children:"Actions"})]})}),e.jsx(Ve,{className:"pink-table",children:le.length>0?le.map((t,s)=>e.jsxs(W,{children:[e.jsxs(S,{children:[" ",(D-1)*k+s+1]}),e.jsx(S,{children:(t==null?void 0:t.fullName)||"-"}),e.jsx(S,{children:(t==null?void 0:t.mobileNumber)||"-"}),e.jsx(S,{children:(t==null?void 0:t.gender)||"-"}),e.jsx(S,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2  ",children:[e.jsx("button",{className:"actionBtn",onClick:()=>Se(t==null?void 0:t.customerId),title:"View",children:e.jsx(Ye,{size:18})}),e.jsx("button",{className:"actionBtn",onClick:()=>De(t==null?void 0:t.customerId),title:"Edit",children:e.jsx(qe,{size:18})}),e.jsx("button",{className:"actionBtn",onClick:()=>{R(t==null?void 0:t.customerId),P(!0)},title:"Delete",children:e.jsx(Ge,{size:18})})]})})]},t.mobileNumber||s)):e.jsx(W,{children:e.jsxs(S,{colSpan:5,className:"text-center text-muted",children:['🔍 No diseases found matching "',e.jsx("b",{children:H}),'"']})})})]}),e.jsxs(ze,{visible:ve,onClose:()=>Y(!1),size:"lg",children:[e.jsx(Qe,{children:e.jsx(Ke,{children:"Customer Details"})}),e.jsx(Ue,{children:A?e.jsx("div",{className:"text-center",children:"Loading..."}):m?e.jsxs(v,{className:"mb-2",children:[e.jsxs(i,{md:6,children:[e.jsx("strong",{children:"Full Name:"})," ",m.fullName||"-"]}),e.jsxs(i,{md:6,children:[e.jsx("strong",{children:"Mobile:"})," ",m.mobileNumber||"-"]}),e.jsxs(i,{md:6,children:[e.jsx("strong",{children:"Email:"})," ",m.email||"-"]}),e.jsxs(i,{md:6,children:[e.jsx("strong",{children:"Gender:"})," ",m.gender||"-"]}),e.jsxs(i,{md:6,children:[e.jsx("strong",{children:"DOB:"})," ",m.dateOfBirth||"-"]}),e.jsxs(i,{md:6,children:[e.jsx("strong",{children:"Age:"})," ",m.age||"-"]}),e.jsxs(i,{md:12,className:"mt-3",children:[e.jsx("h6",{children:"Address"}),e.jsxs("p",{children:[((ne=m.address)==null?void 0:ne.houseNo)||"",","," ",((ie=m.address)==null?void 0:ie.street)||"",","," ",((oe=m.address)==null?void 0:oe.landmark)||"",","," ",((de=m.address)==null?void 0:de.city)||"",","," ",((ce=m.address)==null?void 0:ce.state)||"",","," ",((me=m.address)==null?void 0:me.postalCode)||"",","," ",((he=m.address)==null?void 0:he.country)||""]})]})]}):e.jsx("p",{children:"No customer data available."})}),e.jsx(We,{children:e.jsx(O,{color:"secondary",onClick:()=>Y(!1),children:"Close"})})]}),!A&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(G.length/k)},(t,s)=>e.jsx(O,{style:{backgroundColor:D===s+1?"var(--color-black)":"#fff",color:D===s+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>be(s+1),children:s+1},s))})]})]})})},St=Ce.memo(_e);export{St as default};
