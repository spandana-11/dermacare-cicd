import{r as o,_ as W,$ as T,a as D,c as G,P as N,b as fs,j as e,Q as js,G as Ns,a2 as ys,o as Oe,B as Le,D as Ke,E as He,a3 as bs,x as X,a4 as Ss,z as As,a5 as Cs}from"./index-Bbof3Raq.js";import{X as Is}from"./index.es-BAZgkv5U.js";import{C as Ps,a as U,c as ws}from"./index.esm-DU0vhm2R.js";/* empty css                      */import{F as Qs,a as Be,b as ze}from"./index-BFJ0Sv4a.js";import{_ as Es,f as Ts,b as Fs,T as Ds,u as Ms}from"./CConditionalPortal-Brqyb-aa.js";import{a as j,C as Q}from"./CRow-C1i5i5s0.js";import{C as O,a as B}from"./CFormInput-CmKNn4Xk.js";import{C as Je}from"./CInputGroup-CtTcLUUM.js";import{C as Ue}from"./CForm-DxYkKeUQ.js";import{C as Rs}from"./CInputGroupText-C29dhTFc.js";import{c as $s}from"./cil-search-CDkY_4k-.js";import{C as ve,a as We,b as xe}from"./CModalHeader-DgAtWpAm.js";import{C as Ge}from"./CModalTitle-CUcX6T0i.js";import{C as fe}from"./CModalFooter-BQhV1fDY.js";import{C as se}from"./CFormSelect-B-39HNvI.js";import{d as Vs}from"./DefaultLayout-BA9RlpQB.js";import"./CFormLabel-siHnfzPm.js";import"./cil-user-Ddrdy7PS.js";var _e=o.createContext({}),be=o.forwardRef(function(t,c){var p=t.children,a=t.activeItemKey,u=t.alwaysOpen,x=u===void 0?!1:u,v=t.className,l=t.flush,h=W(t,["children","activeItemKey","alwaysOpen","className","flush"]),d=o.useState(a),A=d[0],S=d[1];return T.createElement("div",D({className:G("accordion",{"accordion-flush":l},v)},h,{ref:c}),T.createElement(_e.Provider,{value:{_activeItemKey:A,alwaysOpen:x,setActiveKey:S}},p))});be.propTypes={activeItemKey:N.oneOfType([N.number,N.string]),alwaysOpen:N.bool,children:N.node,className:N.string,flush:N.bool};be.displayName="CAccordion";function ye(){return ye=Object.assign?Object.assign.bind():function(t){for(var c=1;c<arguments.length;c++){var p=arguments[c];for(var a in p)({}).hasOwnProperty.call(p,a)&&(t[a]=p[a])}return t},ye.apply(null,arguments)}function ks(t,c){return t.classList?!!c&&t.classList.contains(c):(" "+(t.className.baseVal||t.className)+" ").indexOf(" "+c+" ")!==-1}function Os(t,c){t.classList?t.classList.add(c):ks(t,c)||(typeof t.className=="string"?t.className=t.className+" "+c:t.setAttribute("class",(t.className&&t.className.baseVal||"")+" "+c))}function qe(t,c){return t.replace(new RegExp("(^|\\s)"+c+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function Ls(t,c){t.classList?t.classList.remove(c):typeof t.className=="string"?t.className=qe(t.className,c):t.setAttribute("class",qe(t.className&&t.className.baseVal||"",c))}var Ks=function(c,p){return c&&p&&p.split(" ").forEach(function(a){return Os(c,a)})},je=function(c,p){return c&&p&&p.split(" ").forEach(function(a){return Ls(c,a)})},Se=function(t){Es(c,t);function c(){for(var a,u=arguments.length,x=new Array(u),v=0;v<u;v++)x[v]=arguments[v];return a=t.call.apply(t,[this].concat(x))||this,a.appliedClasses={appear:{},enter:{},exit:{}},a.onEnter=function(l,h){var d=a.resolveArguments(l,h),A=d[0],S=d[1];a.removeClasses(A,"exit"),a.addClass(A,S?"appear":"enter","base"),a.props.onEnter&&a.props.onEnter(l,h)},a.onEntering=function(l,h){var d=a.resolveArguments(l,h),A=d[0],S=d[1],E=S?"appear":"enter";a.addClass(A,E,"active"),a.props.onEntering&&a.props.onEntering(l,h)},a.onEntered=function(l,h){var d=a.resolveArguments(l,h),A=d[0],S=d[1],E=S?"appear":"enter";a.removeClasses(A,E),a.addClass(A,E,"done"),a.props.onEntered&&a.props.onEntered(l,h)},a.onExit=function(l){var h=a.resolveArguments(l),d=h[0];a.removeClasses(d,"appear"),a.removeClasses(d,"enter"),a.addClass(d,"exit","base"),a.props.onExit&&a.props.onExit(l)},a.onExiting=function(l){var h=a.resolveArguments(l),d=h[0];a.addClass(d,"exit","active"),a.props.onExiting&&a.props.onExiting(l)},a.onExited=function(l){var h=a.resolveArguments(l),d=h[0];a.removeClasses(d,"exit"),a.addClass(d,"exit","done"),a.props.onExited&&a.props.onExited(l)},a.resolveArguments=function(l,h){return a.props.nodeRef?[a.props.nodeRef.current,l]:[l,h]},a.getClassNames=function(l){var h=a.props.classNames,d=typeof h=="string",A=d&&h?h+"-":"",S=d?""+A+l:h[l],E=d?S+"-active":h[l+"Active"],R=d?S+"-done":h[l+"Done"];return{baseClassName:S,activeClassName:E,doneClassName:R}},a}var p=c.prototype;return p.addClass=function(u,x,v){var l=this.getClassNames(x)[v+"ClassName"],h=this.getClassNames("enter"),d=h.doneClassName;x==="appear"&&v==="done"&&d&&(l+=" "+d),v==="active"&&u&&Ts(u),l&&(this.appliedClasses[x][v]=l,Ks(u,l))},p.removeClasses=function(u,x){var v=this.appliedClasses[x],l=v.base,h=v.active,d=v.done;this.appliedClasses[x]={},l&&je(u,l),h&&je(u,h),d&&je(u,d)},p.render=function(){var u=this.props;u.classNames;var x=Fs(u,["classNames"]);return T.createElement(Ds,ye({},x,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},c}(T.Component);Se.defaultProps={classNames:""};Se.propTypes={};var Ae=o.forwardRef(function(t,c){var p=t.children,a=t.className,u=t.horizontal,x=t.onHide,v=t.onShow,l=t.visible,h=W(t,["children","className","horizontal","onHide","onShow","visible"]),d=o.useRef(null),A=Ms(c,d),S=o.useState(),E=S[0],R=S[1],K=o.useState(),H=K[0],$=K[1],L=function(){if(v&&v(),u){d.current&&$(d.current.scrollWidth);return}d.current&&R(d.current.scrollHeight)},n=function(){if(u){$(0);return}R(0)},y=function(){if(u){d.current&&$(d.current.scrollWidth);return}d.current&&R(d.current.scrollHeight)},F=function(){if(x&&x(),u){$(0);return}R(0)},q=function(){if(u){$(0);return}R(0)};return T.createElement(Se,{in:l,nodeRef:d,onEntering:L,onEntered:n,onExit:y,onExiting:F,onExited:q,timeout:350},function(J){var Y=E===0?null:{height:E},Qe=H===0?null:{width:H};return T.createElement("div",D({className:G(a,{"collapse-horizontal":u,collapsing:J==="entering"||J==="exiting","collapse show":J==="entered",collapse:J==="exited"}),style:D(D({},Y),Qe)},h,{ref:A}),p)})});Ae.propTypes={children:N.node,className:N.string,horizontal:N.bool,onHide:N.func,onShow:N.func,visible:N.bool};Ae.displayName="CCollapse";var Ce=o.createContext({}),re=o.forwardRef(function(t,c){var p=t.children,a=t.className,u=W(t,["children","className"]),x=o.useContext(Ce),v=x.id,l=x.visible;return T.createElement(Ae,{className:"accordion-collapse",id:v,visible:l},T.createElement("div",D({className:G("accordion-body",a)},u,{ref:c}),p))});re.propTypes={children:N.node,className:N.string};re.displayName="CAccordionBody";var Ie=o.forwardRef(function(t,c){var p=t.children,a=t.className,u=W(t,["children","className"]),x=o.useContext(Ce),v=x.id,l=x.visible,h=x.setVisible;return T.createElement("button",D({type:"button",className:G("accordion-button",{collapsed:!l},a),"aria-controls":v,"aria-expanded":l,onClick:function(){return h(!l)}},u,{ref:c}),p)});Ie.propTypes={children:N.node,className:N.string};Ie.displayName="CAccordionButton";var te=o.forwardRef(function(t,c){var p=t.children,a=t.className,u=W(t,["children","className"]);return T.createElement("div",D({className:G("accordion-header",a)},u,{ref:c}),T.createElement(Ie,null,p))});te.propTypes={children:N.node,className:N.string};te.displayName="CAccordionHeader";var ae=o.forwardRef(function(t,c){var p=t.children,a=t.className,u=t.id,x=t.itemKey,v=W(t,["children","className","id","itemKey"]),l=o.useId(),h=u??l,d=o.useRef(x??h),A=o.useContext(_e),S=A._activeItemKey,E=A.alwaysOpen,R=A.setActiveKey,K=o.useState(S===d.current),H=K[0],$=K[1];return o.useEffect(function(){!E&&H&&R(d.current)},[H]),o.useEffect(function(){$(S===d.current)},[S]),T.createElement("div",D({className:G("accordion-item",a)},v,{ref:c}),T.createElement(Ce.Provider,{value:{id:h,setVisible:$,visible:H}},p))});ae.propTypes={children:N.node,className:N.string,itemKey:N.oneOfType([N.number,N.string])};ae.displayName="CAccordionItem";var Pe=o.forwardRef(function(t,c){var p,a=t.children,u=t.as,x=u===void 0?"ul":u,v=t.className,l=t.flush,h=t.layout,d=W(t,["children","as","className","flush","layout"]);return T.createElement(x,D({className:G("list-group",(p={"list-group-flush":l},p["list-group-".concat(h)]=h,p),v)},d,{ref:c}),a)});Pe.propTypes={as:N.elementType,children:N.node,className:N.string,flush:N.bool,layout:N.oneOf(["horizontal","horizontal-sm","horizontal-md","horizontal-lg","horizontal-xl","horizontal-xxl"])};Pe.displayName="CListGroup";var we=o.forwardRef(function(t,c){var p,a=t.children,u=t.active,x=t.as,v=x===void 0?"li":x,l=t.className,h=t.disabled,d=t.color,A=W(t,["children","active","as","className","disabled","color"]),S=v==="a"||v==="button"?Ps:v;return A=D(D(D(D({},(v==="a"||v==="button")&&{active:u,disabled:h,as:v,ref:c}),u&&{"aria-current":!0}),h&&{"aria-disabled":!0}),A),T.createElement(S,D({className:G("list-group-item",(p={},p["list-group-item-".concat(d)]=d,p["list-group-item-action"]=v==="a"||v==="button",p.active=u,p.disabled=h,p),l)},A),a)});we.propTypes={active:N.bool,as:N.elementType,children:N.node,className:N.string,color:fs,disabled:N.bool};we.displayName="CListGroupItem";const Ne=({title:t,qaList:c=[],setQAList:p})=>{const[a,u]=o.useState(""),[x,v]=o.useState(""),[l,h]=o.useState([]),[d,A]=o.useState("add"),[S,E]=o.useState(null),R=()=>{x.trim()!==""&&(h([...l,x]),v(""))},K=n=>{h(l.filter(y=>y!==n))},H=()=>{if(a.trim()&&l.length>0){const n=c.findIndex(y=>Object.keys(y)[0]===a);if(S!==null){const y=[...c];y[S]={[a]:l},p(y),E(null)}else if(n!==-1){const y=[...c];y[n]={[a]:l},p(y)}else p([...c,{[a]:l}]);u(""),h([])}},$=n=>{const y=c[n],F=Object.keys(y)[0],q=y[F];u(F),h(q),E(n)},L=n=>{const y=[...c];y.splice(n,1),p(y),S===n&&(u(""),h([]),E(null))};return o.useEffect(()=>{if(c.length>0){const n=c[c.length-1],y=Object.keys(n)[0],F=n[y];u(y),h(F)}},[c]),o.useEffect(()=>{if((d==="edit"||d==="view")&&c.length>0){const n=c[c.length-1],y=Object.keys(n)[0],F=n[y];u(y),h(F)}},[c,d]),e.jsxs(j,{md:12,className:"mt-3",children:[e.jsx("label",{className:"mb-2",children:"Question"}),e.jsx(O,{placeholder:"Enter your question",value:a,onChange:n=>u(n.target.value)}),e.jsx("label",{className:"mt-3",children:"Answers"}),e.jsxs(Je,{className:"mb-2",children:[e.jsx(O,{placeholder:"Enter answer",value:x,onChange:n=>v(n.target.value)}),e.jsx(U,{color:"success",onClick:R,className:"text-white",children:e.jsx(Qs,{})})]}),l.length>0&&e.jsx(Pe,{className:"mb-3",children:l.map((n,y)=>e.jsxs(we,{className:"d-flex justify-content-between align-items-center",children:[n,e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(Be,{onClick:()=>{v(n),K(n)},style:{color:"orange",cursor:"pointer"},title:"Edit Answer"}),e.jsx(ze,{onClick:()=>K(n),style:{color:"red",cursor:"pointer"},title:"Delete Answer"})]})]},y))}),e.jsx(U,{color:"info",className:"mb-3 text-white",onClick:H,children:S!==null?"Update Q&A":"Save Q&A"}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h6",{className:"mt-4",children:"Saved Questions & Answers"}),c.map((n,y)=>{const F=Object.keys(n)[0],q=n[F];return e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:F}),e.jsx("ul",{children:q.map((J,Y)=>e.jsx("li",{children:J},Y))}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(Be,{onClick:()=>$(y),style:{color:"orange",cursor:"pointer"},title:"Edit Q&A"}),e.jsx(ze,{onClick:()=>L(y),style:{color:"red",cursor:"pointer"},title:"Delete Q&A"})]})]},y)})]})]})},Hs=({preQAList:t,setPreQAList:c,procedureQAList:p,setProcedureQAList:a,postQAList:u,setPostQAList:x})=>e.jsxs(be,{default:!0,children:[e.jsxs(ae,{itemKey:1,children:[e.jsx(te,{children:"Pre-Procedure"}),e.jsx(re,{children:e.jsx(Ne,{title:"Pre-Procedure",qaList:t,setQAList:c})})]}),e.jsxs(ae,{itemKey:2,children:[e.jsx(te,{children:"Procedure"}),e.jsx(re,{children:e.jsx(Ne,{title:"Procedure",qaList:p,setQAList:a})})]}),e.jsxs(ae,{itemKey:3,children:[e.jsx(te,{children:"Post-Procedure"}),e.jsx(re,{children:e.jsx(Ne,{title:"Post-Procedure",qaList:u,setQAList:x})})]})]}),Ar=()=>{const[t,c]=o.useState(""),[p,a]=o.useState([]),[u,x]=o.useState([]),[v,l]=o.useState([]),[h,d]=o.useState(!1),[A,S]=o.useState(null),[E,R]=o.useState(""),[K,H]=o.useState([]),[$,L]=o.useState(!1),[n,y]=o.useState(null),[F,q]=o.useState(!1),[J,Y]=o.useState(""),[Qe,Bs]=o.useState(""),[zs,Xe]=o.useState([]),[Us,ue]=o.useState([]),[Ee,me]=o.useState([]),[Z,Te]=o.useState([]),[Ye,he]=o.useState(""),[Ze,es]=o.useState(""),[Fe,Ws]=o.useState(null),[ie,ss]=o.useState({serviceImage:"",viewImage:"",subServiceName:"",serviceName:"",serviceImageFile:null}),[Gs,qs]=o.useState([]),[Js,_s]=o.useState([]),[Xs,Ys]=o.useState([]);let De=[];try{typeof p.descriptionQA=="string"?De=JSON.parse(p.descriptionQA):De=p.descriptionQA||[]}catch(s){console.error("Invalid descriptionQA format:",s)}const[r,C]=o.useState({categoryName:"",categoryId:"",serviceName:"",subServiceName:"",description:"",price:"",gst:0,consultationFee:0,procedureQA:[],preProcedureQA:[],postProcedureQA:[]}),[ee,Me]=o.useState("add"),[Zs,er]=o.useState(null),[sr,rr]=o.useState(""),rs=()=>{Me("add"),ue([]),Xe([]),Y(""),he(""),C({categoryName:"",categoryId:"",serviceName:"",serviceId:"",subServiceId:"",subServiceName:"",price:"",discount:0,gst:0,consultationFee:0,minTime:"",taxPercentage:0,status:"",serviceImage:"",serviceImageFile:null,viewImage:"",viewDescription:"",platformFeePercentage:0,descriptionQA:[]}),L(!0)},ts=async s=>{var ke;console.log(s.subServiceId),es(s.subServiceId),Me("edit"),L(!0);const i=u.find(k=>k.categoryName===s.categoryName),m=(i==null?void 0:i.categoryId)||"";let g=[];try{g=((ke=(await Oe.get(`${Le}/${Ke}/${m}`)).data)==null?void 0:ke.data)||[],console.log(g),me(g)}catch(k){console.error("Error fetching service list:",k)}const f=g.find(k=>k.serviceName===s.serviceName),b=(f==null?void 0:f.serviceId)||"";let P=[];if(b)try{const _=(await He(b)).data;Array.isArray(_)?P=_.flatMap(xs=>xs.subServices||[]):_!=null&&_.subServices&&(P=_.subServices)}catch(k){console.error("Error fetching subservices:",k)}Te({subServices:P});const w=P.find(k=>k.subServiceName===s.subServiceName),M=(w==null?void 0:w.subServiceId)||"",z=(w==null?void 0:w.subServiceName)||"";he(M);const oe=Array.isArray(s.procedureQA)?s.procedureQA:JSON.parse(s.procedureQA||"[]"),le=Array.isArray(s.preProcedureQA)?s.preProcedureQA:JSON.parse(s.preProcedureQA||"[]"),de=Array.isArray(s.postProcedureQA)?s.postProcedureQA:JSON.parse(s.postProcedureQA||"[]"),V=s.serviceImage||"";V.startsWith("data:")||`${V}`,C({subServiceId:M,subServiceName:z,serviceName:s.serviceName||"",serviceId:b,categoryName:s.categoryName||"",categoryId:m||"",price:s.price||"",discount:s.discountPercentage||0,gst:s.gst||0,consultationFee:s.consultationFee||0,taxPercentage:s.taxPercentage||0,minTime:s.minTime||"",serviceImage:V,serviceImageFile:null,status:s.status||"",viewDescription:s.viewDescription||"",platformFeePercentage:s.platformFeePercentage||0,viewImage:s.viewImage||"",procedureQA:oe,preProcedureQA:le,postProcedureQA:de}),ue(formattedQA)},[as,pe]=o.useState(!1),[Re,is]=o.useState(null),[I,ge]=o.useState({subServiceName:"",serviceName:"",serviceId:"",categoryName:"",price:"",status:"",taxPercentage:"",descriptionQA:"",answers:"",minTime:"",discount:"",viewDescription:"",serviceImage:"",bannerImage:""}),[tr,ar]=o.useState({}),ne=async()=>{d(!0),S(null);try{const s=await Ns();if(s.data&&Array.isArray(s.data)){const m=s.data.map(g=>({categoryId:g.categoryId,categoryName:g.categoryName}));x(s.data)}else throw new Error("Invalid category data format");const i=localStorage.getItem("HospitalId");if(i){const m=await ys(i);Array.isArray(m)?(a(m),console.log(m)):(a([]),console.warn("No subservices found for this hospital."))}else console.warn("No hospitalId found in localStorage."),a([])}catch(s){console.error("Error fetching data:",s),S("Failed to fetch data. Please try again later.")}finally{d(!1)}};o.useEffect(()=>{ne()},[]),o.useEffect(()=>{if(F&&(ie!=null&&ie.descriptionQA)&&typeof ie.descriptionQA=="string")try{ss(s=>({...s,descriptionQA:JSON.parse(s.descriptionQA)}))}catch{console.error("Invalid QA format")}},[F]),o.useEffect(()=>{(()=>{const i=t.toLowerCase().trim();if(!i){l([]);return}const m=p.filter(g=>{var w,M,z;const f=(w=g.subServiceName)==null?void 0:w.toLowerCase().startsWith(i),b=(M=g.serviceName)==null?void 0:M.toLowerCase().startsWith(i),P=(z=g.categoryName)==null?void 0:z.toLowerCase().startsWith(i);return f||b||P});l(m)})()},[t,p]);const ns=[{name:"S.No",selector:(s,i)=>i+1,width:"70px",sortable:!1},{name:"Procedure Name",selector:s=>s.subServiceName,sortable:!0,width:"230px"},{name:"Service Name",selector:s=>s.serviceName,width:"230px"},{name:"Category Name",selector:s=>s.categoryName,width:"180px"},{name:"Price",selector:s=>s.price,width:"100px"},{name:"Actions",cell:s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"250px"},children:[e.jsx("div",{color:"primary",onClick:()=>y(s),style:{marginRight:"5px",width:"50px",color:"green"},children:"View"}),e.jsx("div",{color:"primary",onClick:()=>ts(s),style:{marginRight:"5px",width:"50px",color:"blue"},children:"Edit"}),e.jsx("div",{color:"danger",onClick:()=>hs(s),style:{width:"50px",color:"red"},children:"Delete"}),e.jsx(cs,{isVisible:as,message:"Are you sure you want to delete this service?",onConfirm:ps,onCancel:gs})]}),width:"150px",headerStyle:{textAlign:"center"}}],cs=({isVisible:s,message:i,onConfirm:m,onCancel:g})=>e.jsxs(ve,{visible:s,onClose:g,backdrop:!1,children:[e.jsx(Vs,{style:{marginLeft:"200px"},children:" !Alert"}),e.jsx(xe,{style:{textAlign:"center"},children:i}),e.jsxs(fe,{children:[e.jsx(U,{color:"secondary",onClick:g,children:"Cancel"}),e.jsx(U,{color:"danger",onClick:m,children:"Confirm"})]})]}),os=parseFloat(r.minTime),ls=()=>{const s={};return r.serviceName||(s.serviceName="Service name is required."),r.categoryName||(s.categoryName="Category is required."),r.price?isNaN(r.price)?s.price="price must be a valid number.":parseFloat(r.price)<0&&(s.price="price cannot be a negative number."):s.price="price is required.",r.status||(s.status="Status is required."),(r.gst===""||isNaN(r.gst)||parseFloat(r.gst)<0)&&(s.gst="GST must be a valid number and not negative."),(r.consultationFee===""||isNaN(r.consultationFee)||parseFloat(r.consultationFee)<0)&&(s.consultationFee="Consultation fee must be a valid number and not negative."),!r.discount&&r.discount!==0?s.discount="Discount is required.":parseFloat(r.discount)<0&&(s.discount="Discount cannot be a negative number."),!r.taxPercentage&&r.taxPercentage!==0?s.taxPercentage="taxPercentage is required.":parseFloat(r.taxPercentage)<0&&(s.taxPercentage="taxPercentage cannot be a negative number."),!r.minTimeValue||isNaN(r.minTimeValue)?s.minTime="Minimum time is required":parseFloat(r.minTimeValue)<=0&&(s.minTime="Minimum time must be greater than zero."),r.viewDescription||(s.viewDescription="View description is Required."),r.serviceImage||(console.log("Service Image in Form:",r.serviceImage),s.serviceImage="Please upload a service image."),r.categoryId||(s.categoryId="Please select a valid category."),ge(s),Object.keys(s).length===0},ds=async()=>{var le,de;console.log("--- handleAddService START ---");const s=r.price*r.discount/100,i=r.price-s,m=i*r.taxPercentage/100,g=r.gst||0,f=i*(r.platformFeePercentage||0)/100,b=i+m-f,P=b+g+(r.consultationFee||0),w=`${r.minTimeValue} ${r.minTimeUnit}`;console.log("Calculated values:",{discountAmount:s,discountedCost:i,taxAmount:m,platformFee:f,clinicPay:b,finalCost:P});const M=await $e(r.serviceImageFile),z=(M==null?void 0:M.split(",")[1])||"";if(!ls()){X.error("Validation failed",{position:"top-right"});return}const oe={hospitalId:localStorage.getItem("HospitalId"),subServiceName:r.subServiceName,subServiceId:r.subServiceId,serviceId:r.serviceId,serviceName:r.serviceName,categoryName:r.categoryName,categoryId:r.categoryId,price:r.price,discountPercentage:r.discount,discountAmount:s,discountedCost:i,taxPercentage:r.taxPercentage,taxAmount:m,platformFeePercentage:r.platformFeePercentage,platformFee:f,clinicPay:b,finalCost:P,gst:r.gst,consultationFee:r.consultationFee,minTime:w,status:r.status,subServiceImage:z,procedureQA:r.procedureQA,preProcedureQA:r.preProcedureQA,postProcedureQA:r.postProcedureQA,viewDescription:r.viewDescription};console.log("Payload ready to submit:",oe);try{const V=await Ss(oe,r.subServiceId);console.log("Response received:",V),V.status===201&&(X.success(V.data.message,{position:"top-right"}),L(!1),ne(),As())}catch(V){console.error("Error in handleAddService:",V.response),X.error((de=(le=V.response)==null?void 0:le.data)==null?void 0:de.message,{position:"top-right"})}C({categoryName:"",categoryId:"",serviceName:"",serviceId:"",subServiceId:"",subServiceName:"",price:0,discount:0,gst:0,consultationFee:0,taxPercentage:0,minTimeValue:os,minTimeUnit:"",status:"",serviceImage:"",viewDescription:"",procedureQA:[],preProcedureQA:[],postProcedureQA:[],platformFeePercentage:0,descriptionQA:[]}),ue([]),console.log("--- handleAddService END ---")},us=s=>{const i=parseInt(s,10);if(isNaN(i))return"Invalid time";if(i<60)return`${i} min`;const m=Math.floor(i/60),g=i%60;return g===0?`${m} hour${m>1?"s":""}`:`${m} hour${m>1?"s":""} ${g} min`},ms=async()=>{var s;try{const i=localStorage.getItem("HospitalId");let m="";r.serviceImageFile?m=(await $e(r.serviceImageFile)).split(",")[1]:(s=r.serviceImage)!=null&&s.startsWith("data:")?m=r.serviceImage.split(",")[1]:m=r.serviceImage||"";const g=r.price>0?Number(r.price):0,f={hospitalId:i,subServiceName:r.subServiceName||"",viewDescription:r.viewDescription||"",status:r.status||"",minTime:r.minTimeValue?`${r.minTimeValue} ${r.minTimeUnit}`:"",procedureQA:Array.isArray(r.procedureQA)?r.procedureQA:[],preProcedureQA:Array.isArray(r.preProcedureQA)?r.preProcedureQA:[],postProcedureQA:Array.isArray(r.postProcedureQA)?r.postProcedureQA:[],price:r.price||0,discountPercentage:r.discount||0,taxPercentage:r.taxPercentage||0,platformFeePercentage:r.platformFeePercentage||0,subServiceImage:m,gst:r.gst||0,consultationFee:r.consultationFee||0};console.log("Payload for updateSubServiceData:",f);const b=await bs(Ze,i,f);X.success("Procedure updated successfully!",{position:"top-right"}),q(!1),L(!1),ne()}catch(i){console.error("Update failed:",i),X.error("Error updating service.",{position:"top-right"})}},$e=s=>new Promise((i,m)=>{const g=new FileReader;g.readAsDataURL(s),g.onload=()=>i(g.result),g.onerror=f=>m(f)}),hs=async s=>{console.log(s),is(s.subServiceId),pe(!0)},ps=async()=>{console.log(Re);const s=localStorage.getItem("HospitalId");try{const i=await Cs(Re,s);console.log("Service deleted:",i),X.success("Procedure deleted successfully!",{position:"top-right"}),ne()}catch(i){console.error("Error deleting Procedure:",i)}pe(!1)},gs=()=>{pe(!1),console.log("Service deletion canceled")},ce=s=>{const{name:i,value:m}=s.target;C(g=>{if(i==="categoryName"){const f=u.find(b=>b.categoryName===m);return{...g,[i]:m,categoryId:f?f.categoryId:""}}return i==="gst"||i==="consultationFee"||i==="price"||i==="discount"||i==="taxPercentage"||i==="minTime"?{...g,[i]:parseFloat(m)||0}:{...g,[i]:m}}),ge(g=>({...g,[i]:""}))},vs=()=>{C({serviceName:"",categoryName:"",price:"",discount:0,taxPercentage:0,minTime:"",minTimeValue:"",minTimeUnit:"minutes",status:"",serviceImage:"",viewImage:"",viewDescription:"",categoryId:""}),L(!1),ge({})},Ve=async s=>{var g;const{name:i,value:m}=s.target;if(i==="categoryName"){const f=u.find(b=>b.categoryId===m);C(b=>({...b,categoryName:(f==null?void 0:f.categoryName)||"",categoryId:m,serviceName:"",serviceId:""}));try{const P=((g=(await Oe.get(`${Le}/${Ke}/${m}`)).data)==null?void 0:g.data)||[];me(P)}catch(b){console.error("Failed to fetch services:",b),me([])}}else if(i==="serviceName"){const f=Ee.find(P=>P.serviceName===m),b=(f==null?void 0:f.serviceId)||"";if(C(P=>({...P,serviceName:m,serviceId:b})),b){const w=(await He(b)).data;let M=[];Array.isArray(w)?M=w.flatMap(z=>z.subServices||[]):w&&w.subServices&&(M=w.subServices),Te({subServices:M})}}else C(f=>({...f,[i]:m}))};return console.log(r),console.log(n),e.jsxs("div",{style:{overflow:"hidden"},children:[e.jsx(js,{}),e.jsx("div",{children:e.jsxs(Ue,{className:"d-flex justify-content-end mb-3",children:[e.jsxs(Je,{className:"mb-3",style:{marginRight:"20px",width:"400px"},children:[e.jsx(O,{type:"text",placeholder:"Search by Procedure Name, Category",value:t,onChange:s=>c(s.target.value),style:{height:"40px"}}),e.jsx(Rs,{style:{height:"40px"},children:e.jsx(ws,{icon:$s})})]}),e.jsx(U,{color:"primary",style:{height:"40px"},onClick:()=>rs(),children:"Add Procedure Details"})]})}),n&&e.jsxs(ve,{visible:!!n,onClose:()=>y(null),size:"xl",children:[e.jsx(We,{children:e.jsx(Ge,{className:"w-100 text-center text-primary fs-4",children:"Procedure Details"})}),e.jsxs(xe,{children:[e.jsxs(Q,{className:"mb-3",children:[e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Procedure Name:"}),e.jsx("div",{children:n.subServiceName})]}),e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Procedure ID:"}),e.jsx("div",{children:n.subServiceId})]})]}),e.jsxs(Q,{className:"mb-3",children:[e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Service Name:"}),e.jsx("div",{children:n.serviceName})]}),e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Service Id:"}),e.jsx("div",{children:n.serviceId})]})]}),e.jsxs(Q,{className:"mb-3",children:[e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Category Name:"}),e.jsx("div",{children:n.categoryName})]}),e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Category Id:"}),e.jsx("div",{children:n.categoryId})]})]}),e.jsx(Q,{className:"mb-3",children:e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Status:"}),e.jsx("div",{children:n.status})]})}),e.jsx("hr",{}),e.jsxs(Q,{className:"mb-3",children:[e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Price:"}),e.jsxs("div",{children:["₹ ",Math.round(n.price)]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Discount %:"}),e.jsxs("div",{children:[Math.round(n.discountPercentage),"%"]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Discount Amount:"}),e.jsxs("div",{children:["₹ ",Math.round(n.discountAmount)]})]})]}),e.jsxs(Q,{className:"mb-3",children:[e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Discounted Cost:"}),e.jsxs("div",{children:["₹ ",Math.round(n.discountedCost)]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Tax %:"}),e.jsxs("div",{children:[Math.round(n.taxPercentage),"%"]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Tax Amount:"}),e.jsxs("div",{children:["₹ ",Math.round(n.taxAmount)]})]})]}),e.jsxs(Q,{className:"mb-3",children:[e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Platform Fee %:"}),e.jsxs("div",{children:[Math.round(n.platformFeePercentage),"%"]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Platform Fee:"}),e.jsxs("div",{children:["₹ ",Math.round(n.platformFee)]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Clinic Pay:"}),e.jsxs("div",{children:["₹ ",Math.round(n.clinicPay)]})]})]}),e.jsxs(Q,{className:"mb-3",children:[e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"GST:"}),e.jsxs("div",{children:["₹ ",Math.round(n.gst)]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Consultation Fee:"}),e.jsxs("div",{children:["₹ ",n.consultationFee]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Final Cost:"}),e.jsxs("div",{children:["₹ ",Math.round(n.finalCost)]})]})]}),e.jsx(Q,{className:"mb-3",children:e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Service Time:"}),e.jsx("div",{children:us(n.minTime)})]})}),e.jsx("hr",{}),e.jsx(Q,{className:"mb-3",children:e.jsxs(j,{sm:12,children:[e.jsx("strong",{className:"mb-3",children:"Pre-Procedure QA:"}),Array.isArray(n.preProcedureQA)&&n.preProcedureQA.length>0?n.preProcedureQA.map((s,i)=>{const m=Object.keys(s)[0],g=s[m];return e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("strong",{children:m}),e.jsx("ul",{children:g.map((f,b)=>e.jsx("li",{children:f},b))})]},i)}):e.jsx("div",{children:"No Pre-Procedure Q&A available"})]})}),e.jsx(Q,{className:"mb-3",children:e.jsxs(j,{sm:12,children:[e.jsx("strong",{className:"mb-3",children:"Procedure QA:"}),Array.isArray(n.procedureQA)&&n.procedureQA.length>0?n.procedureQA.map((s,i)=>{const m=Object.keys(s)[0],g=s[m];return e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("strong",{children:m}),e.jsx("ul",{children:g.map((f,b)=>e.jsx("li",{children:f},b))})]},i)}):e.jsx("div",{children:"No Procedure Q&A available"})]})}),e.jsx(Q,{className:"mb-3",children:e.jsxs(j,{sm:12,children:[e.jsx("strong",{className:"mb-3",children:"Post-Procedure QA:"}),Array.isArray(n.postProcedureQA)&&n.postProcedureQA.length>0?n.postProcedureQA.map((s,i)=>{const m=Object.keys(s)[0],g=s[m];return e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("strong",{children:m}),e.jsx("ul",{children:g.map((f,b)=>e.jsx("li",{children:f},b))})]},i)}):e.jsx("div",{children:"No Post-Procedure Q&A available"})]})}),e.jsx("hr",{}),e.jsxs(Q,{children:[e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Service Image:"}),n.subServiceImage?e.jsxs("div",{className:"mt-2",children:[e.jsx("img",{src:`data:image/png;base64,${n.subServiceImage}`,alt:"Service",style:{width:"100%",maxWidth:"250px",borderRadius:"8px"}}),Fe&&e.jsx("img",{src:Fe,alt:"Preview",height:"80",className:"mt-2"})]}):e.jsx("div",{children:"No image available"})]}),e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"View Description:"}),e.jsx("div",{children:n.viewDescription})]})]})]}),e.jsx(fe,{children:e.jsx(U,{color:"secondary",onClick:()=>y(null),children:"Close"})})]}),e.jsxs(ve,{visible:$,onClose:()=>L(!1),size:"xl",backdrop:"static",children:[e.jsx(We,{children:e.jsx(Ge,{style:{textAlign:"center",width:"100%"},children:ee==="edit"?"Edit Procedure Details":"Add New Procedure Details"})}),e.jsx(xe,{children:e.jsxs(Ue,{children:[e.jsxs(Q,{className:"mb-4",children:[e.jsxs(j,{md:4,children:[e.jsxs("h6",{children:["Category Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(se,{value:r.categoryId||"",onChange:Ve,"aria-label":"Select Category",name:"categoryName",disabled:ee==="edit",children:[e.jsx("option",{value:"",children:"Select a Category"}),u==null?void 0:u.map(s=>e.jsx("option",{value:s.categoryId,children:s.categoryName},s.categoryId))]}),I.categoryName&&e.jsx(B,{className:"text-danger",children:I.categoryName})]}),e.jsxs(j,{md:4,children:[e.jsxs("h6",{children:["Service Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(se,{name:"serviceName",value:r.serviceName||"",onChange:Ve,disabled:ee==="edit",children:[e.jsx("option",{value:"",children:"Select Service"}),Ee.map(s=>e.jsx("option",{value:s.serviceName,children:s.serviceName},s.serviceId))]}),I.serviceName&&e.jsx(B,{className:"text-danger",children:I.serviceName})]}),e.jsxs(j,{md:4,children:[e.jsxs("h6",{children:["Procedure Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(se,{name:"subServiceId",value:Ye,onChange:s=>{var g;const i=s.target.value;he(i);const m=(g=Z==null?void 0:Z.subServices)==null?void 0:g.find(f=>f.subServiceId===i);C(f=>({...f,subServiceId:i,subServiceName:(m==null?void 0:m.subServiceName)||"",preProcedureQA:p.preProcedureQA||[],procedureQA:p.procedureQA||[],postProcedureQA:p.postProcedureQA||[]}))},children:[e.jsx("option",{value:"",children:"Select Procedure"}),Array.isArray(Z.subServices)&&Z.subServices.map(s=>e.jsx("option",{value:s.subServiceId,children:s.subServiceName},s.subServiceId))]}),I.subServiceName&&e.jsx(B,{className:"text-danger",children:I.subServiceName})]})]}),e.jsxs(Q,{className:"mb-4",children:[e.jsxs(j,{md:4,children:[e.jsxs("h6",{children:["Procedure Image ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(O,{type:"file",accept:"image/*",onChange:s=>{const i=s.target.files[0];if(i){const m=new FileReader;m.onloadend=()=>{var f;const g=((f=m.result)==null?void 0:f.split(",")[1])||"";C(b=>({...b,serviceImage:g,serviceImageFile:i}))},m.readAsDataURL(i)}}}),(r==null?void 0:r.serviceImage)&&e.jsx("img",{src:r.serviceImage.startsWith("data:")?r.serviceImage:`data:image/jpeg;base64,${r.serviceImage}`,alt:"Preview",style:{width:100,height:100,marginTop:10}})]}),e.jsxs(j,{md:4,children:[e.jsxs("h6",{children:["View Description ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(O,{type:"text",placeholder:"View Description",value:r.viewDescription||"",name:"viewDescription",onChange:ce,maxLength:100}),I.viewDescription&&e.jsx(B,{className:"text-danger",children:I.viewDescription})]}),e.jsxs(j,{md:4,children:[e.jsxs("h6",{children:["Status ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(se,{value:r.status||"",onChange:ce,name:"status",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"InActive",children:"Inactive"})]}),I.status&&e.jsx(B,{className:"text-danger",children:I.status})]})]}),e.jsxs(Q,{className:"mb-4",children:[e.jsxs(j,{md:4,children:[e.jsxs("h6",{children:["Price ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(O,{type:"number",value:r.price||"",onChange:s=>C(i=>({...i,price:s.target.value}))}),I.price&&e.jsx(B,{className:"text-danger",children:I.price})]}),e.jsx(j,{md:4,children:e.jsx(O,{label:"GST (%)",type:"number",value:r.gst||"",onChange:s=>C(i=>({...i,gst:Number(s.target.value)}))})}),e.jsx(j,{md:4,children:e.jsx(O,{label:"Consultation Fee",type:"number",value:r.consultationFee||"",onChange:s=>C(i=>({...i,consultationFee:Number(s.target.value)}))})})]}),e.jsxs(Q,{className:"mb-4",children:[e.jsxs(j,{md:4,children:[e.jsxs("h6",{children:["Discount % ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(O,{type:"number",placeholder:"Discount",value:r.discount||"",name:"discount",onChange:ce,min:1,onKeyDown:s=>{(s.key==="-"||s.key==="e")&&s.preventDefault()}}),I.discount&&e.jsx(B,{className:"text-danger",children:I.discount})]}),e.jsxs(j,{md:4,children:[e.jsxs("h6",{children:["TaxPercentage % ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(O,{type:"number",placeholder:"Tax Percentage",value:r.taxPercentage||"",name:"taxPercentage",onChange:ce,min:1,onKeyDown:s=>{(s.key==="-"||s.key==="e")&&s.preventDefault()}}),I.taxPercentage&&e.jsx(B,{className:"text-danger",children:I.taxPercentage})]}),e.jsx(j,{children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{children:["Min Time ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex",children:[e.jsx(O,{type:"number",name:"minTimeValue",value:r.minTimeValue||"",onChange:s=>C({...r,minTimeValue:s.target.value}),placeholder:"Enter time"}),e.jsxs(se,{name:"minTimeUnit",className:"ms-2",value:r.minTimeUnit||"minutes",onChange:s=>C({...r,minTimeUnit:s.target.value}),children:[e.jsx("option",{value:"minutes",children:"Minutes"}),e.jsx("option",{value:"hours",children:"Hours"})]})]}),I.minTime&&e.jsx(B,{className:"text-danger",children:I.minTime})]})})]}),e.jsx("h6",{className:"m-3",children:"Procedure (Optional)"}),e.jsx(Hs,{preQAList:r.preProcedureQA,setPreQAList:s=>C(i=>({...i,preProcedureQA:s})),procedureQAList:r.procedureQA,setProcedureQAList:s=>C(i=>({...i,procedureQA:s})),postQAList:r.postProcedureQA,setPostQAList:s=>C(i=>({...i,postProcedureQA:s}))})]})}),e.jsxs(fe,{children:[e.jsx(U,{color:"secondary",onClick:vs,children:"Cancel"}),e.jsx(U,{color:"primary",onClick:ee==="edit"?ms:ds,children:ee==="edit"?"Update":"Add"})]})]}),h?e.jsx("div",{style:{display:"flex",justifyContent:"center",height:"300px",fontSize:"1.5rem"},children:"Loading..."}):A?e.jsx("div",{style:{display:"flex",justifyContent:"center",height:"300px",fontSize:"1.5rem"},children:A}):e.jsx(Is,{columns:ns,data:v.length>0?v:p,pagination:!0,highlightOnHover:!0,pointerOnHover:!0})]})};export{Ar as default};
