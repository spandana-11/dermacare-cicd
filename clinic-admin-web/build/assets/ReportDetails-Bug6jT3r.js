import{o as P,B as $,a1 as _,Y as G,u as J,h as V,r as p,j as e}from"./index-BZIHVNN9.js";import{c as W,d as q}from"./index-B0d8QLcy.js";import{a as m}from"./index.esm-Bjt0apr0.js";import{C as Y,a as K,b as v,c,d as O,e as n}from"./CTable-C6_YY7io.js";import{C as T,a as B,b as E}from"./CModalHeader-CgyImOGh.js";import{C as Q}from"./CModalTitle-Dw5zFzgn.js";import{C as X}from"./CForm-B8mew5bq.js";import{C as h}from"./CFormLabel-D18V28jy.js";import{C as x}from"./CFormInput-D9IcgCQ0.js";import{C as Z}from"./CModalFooter-BmPJ_RM6.js";import"./CConditionalPortal-C5Po9cCc.js";const ee=async j=>{try{const o=await P.get(`${$}/getReportByBookingId/${j}`);return console.log(o),o.data.data}catch(o){return console.error("Error fetching report by ID:",o.message),null}},se=async j=>{try{console.log("Sending data to API to add appointment...",j);const o=await P.post(`${$}/${_}`,j,{headers:{"Content-Type":"application/json"}});return console.log("Appointment booked successfully:",o.data),o.data}catch(o){throw console.error("Error booking appointment:",o.response?o.response.data:o.message),o}},je=()=>{var w,F,k,D,I;const{id:j}=G(),o=J(),t=(w=o.state)==null?void 0:w.appointmentInfo,N=V(),[i,f]=p.useState([]),[A,b]=p.useState(!1),[M,U]=p.useState(null),[L,u]=p.useState(!1),[r,d]=p.useState({reportName:"",reportDate:"",reportStatus:"",reportType:"",reportFile:null,bookingId:t.bookingId});if((F=o.state)==null||F.report,`${((D=(k=i.reportFile)==null?void 0:k[0])==null?void 0:D.startsWith("JVBER"))?"application/pdf":"image/jpeg"}${(I=i.reportFile)==null?void 0:I[0]}`,!i)return e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("h5",{className:"text-danger",children:"No report details found!"}),e.jsx(m,{color:"primary",onClick:()=>N(-1),className:"mt-2",children:"Go Back"})]});const R=async()=>{try{const a=await ee(t.bookingId);if(console.log(a),Array.isArray(a)){const l=a.flatMap(g=>g.reportsList||[]);console.log("Flattened Reports:",l),f(l)}else console.warn("Unexpected response format:",a),f([])}catch(s){console.error("Error fetching reports:",s),f([])}};p.useEffect(()=>{t!=null&&t.bookingId&&R()},[]),console.log(i);const H=s=>{const a=s.target.files[0],l=new FileReader;l.onloadend=()=>{const g=l.result.split(",")[1];d(C=>({...C,reportFile:g}))},a&&l.readAsDataURL(a)},z=async()=>{if(!r.reportName||!r.reportDate||!r.reportStatus||!r.reportType||!r.reportFile){alert("Please fill all required fields and upload a file.");return}try{const s={reportsList:[{...r,reportFile:[r.reportFile]}]},a=await se(s);console.log("Report uploaded:",a),u(!1),alert("Report uploaded successfully!"),R()}catch(s){console.error("Error uploading report:",s),alert("Upload failed")}};return e.jsxs("div",{className:"container mt-4",children:[t&&e.jsx("div",{className:"container bg-light p-4 rounded shadow-sm mb-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 border-end",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",t.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",t.age]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gender:"})," ",t.gender]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Problem:"})," ",t.problem]})]}),e.jsxs("div",{className:"col-md-6 ps-md-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Doctor ID:"})," ",t.item.doctorId]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Hospital ID:"})," ",t.item.clinicId]})]})]})}),e.jsxs("div",{className:"bg-info text-white p-3 d-flex justify-content-between align-items-center rounded",children:[e.jsx("h5",{className:"mb-0",children:"Report Details"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(m,{color:"secondary",size:"sm",onClick:()=>N(-1),children:"Back"}),e.jsx(m,{color:"success",size:"sm",onClick:()=>u(!0),style:{color:"white"},children:"Upload Report"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsxs(Y,{bordered:!0,responsive:!0,children:[e.jsx(K,{color:"light",children:e.jsxs(v,{children:[e.jsx(c,{children:"S.No"}),e.jsx(c,{children:"Booking ID"}),e.jsx(c,{children:"Report Name"}),e.jsx(c,{children:"Date"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Type"}),e.jsx(c,{children:"Action"})]})}),e.jsx(O,{children:Array.isArray(i)&&i.length>0?i.map((s,a)=>{var S;console.log("Rendering report:",s);const l=(S=s.reportFile)==null?void 0:S.includes("JVBER"),g=l?"application/pdf":"image/jpeg",C=l?"pdf":"jpg",y=`data:${g};base64,${s.reportFile}`;return e.jsxs(v,{children:[e.jsx(n,{children:a+1}),e.jsx(n,{children:s.bookingId}),e.jsx(n,{children:s.reportName}),e.jsx(n,{children:s.reportDate}),e.jsx(n,{children:s.reportStatus}),e.jsx(n,{children:s.reportType}),e.jsx(n,{children:s.reportFile?e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(m,{className:"bg-info text-white border-0",size:"sm",onClick:()=>{l?window.open(y,"_blank"):(U(y),b(!0))},children:e.jsx(W,{})}),e.jsx("a",{href:y,download:`${s.reportName||"report"}_${a+1}.${C}`,className:"btn btn-sm btn-outline-success",title:"Download",children:e.jsx(q,{})})]}):"No File"})]},a)}):e.jsx(v,{children:e.jsx(n,{colSpan:"8",className:"text-center",children:"No Reports Found"})})})]})}),e.jsxs(T,{visible:A,onClose:()=>b(!1),size:"lg",children:[e.jsx(B,{onClose:()=>b(!1),children:e.jsx("strong",{children:"Image Preview"})}),e.jsx(E,{className:"text-center",children:e.jsx("img",{src:M,alt:"Preview",style:{maxWidth:"100%",maxHeight:"80vh",borderRadius:"8px"}})})]}),e.jsxs(T,{visible:L,onClose:()=>u(!1),children:[e.jsx(B,{children:e.jsx(Q,{children:"Upload Report"})}),e.jsx(E,{children:e.jsxs(X,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx(h,{children:"Report Name"}),e.jsx(x,{value:r.reportName,onChange:s=>d({...r,reportName:s.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(h,{children:"Booking Id"}),e.jsx(x,{value:r.bookingId,onChange:s=>d({...r,bookingId:s.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(h,{children:"Report Date"}),e.jsx(x,{type:"date",value:r.reportDate,onChange:s=>d({...r,reportDate:s.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(h,{children:"Report Status"}),e.jsx(x,{value:r.reportStatus,onChange:s=>d({...r,reportStatus:s.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(h,{children:"Report Type"}),e.jsx(x,{value:r.reportType,onChange:s=>d({...r,reportType:s.target.value})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(h,{children:"Upload File (PDF or Image)"}),e.jsx(x,{type:"file",accept:"image/*,application/pdf",onChange:H})]})]})}),e.jsxs(Z,{children:[e.jsx(m,{color:"secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx(m,{color:"primary",onClick:z,children:"Submit"})]})]})]})};export{je as default};
