import{o as D,B as b,I as ae,J as le,U as ne,K as ie,r as o,j as e,Q as ce,G as h}from"./index-djBqUPT0.js";import{c as de,a as p}from"./index.esm-DUU_D5Td.js";/* empty css                      */import{X as he}from"./index.es-HI4CY5Sn.js";import{C as k}from"./CForm-DhlsLPS-.js";import{C as pe}from"./CInputGroup-CRaktkm8.js";import{C as x}from"./CFormInput-LqSk0Wke.js";import{C as ue}from"./CInputGroupText-BjZEweQx.js";import{c as me}from"./cil-search-CDkY_4k-.js";import{C as T,a as g,b as I}from"./CModalHeader-DDYTujZq.js";import{C as N}from"./CModalTitle-l04AQkyV.js";import{C as B,a as w}from"./CRow-D_t7w9AM.js";import{C as $}from"./CModalFooter-DVRWL7Mi.js";import"./CFormLabel-Dn5StpaC.js";import"./CConditionalPortal-an2aDlym.js";const xe=async()=>{try{const t=await D.get(`${b}/${ae}`);return console.log("test data:",t.data),t.data}catch(t){throw console.error("Error fetching test data:",t.message),t.response&&(console.error("Error Response Data:",t.response.data),console.error("Error Response Status:",t.response.status)),t}},je=async t=>{try{const l={testName:t.testName||"",hospitalId:t.hospitalId||""},r=await D.post(`${b}/${le}`,l,{headers:{"Content-Type":"application/json"}});return console.log(r),r.data}catch(l){throw console.error("Error response from API:",l.response),l}},Ce=async(t,l,r)=>{try{return(await D.put(`${b}/${ne}/${l}/${r}`,t,{headers:{"Content-Type":"application/json"}})).data}catch(u){throw console.error("Error updating tet:",u),u}},fe=async(t,l)=>{try{const r=await D.delete(`${b}/${ie}/${t}/${l}`,{headers:{"Content-Type":"application/json"}});return console.log("Test deleted successfully:",r.data),r.data}catch(r){throw console.error("Error deleting tet:",r.response?r.response.data:r),r}},Ve=()=>{const[t,l]=o.useState(""),[r,u]=o.useState([]),[M,A]=o.useState([]),[Q,F]=o.useState(!1),[L,q]=o.useState(null),[G,j]=o.useState(!1),[C,V]=o.useState(null),[_,f]=o.useState(!1),[n,v]=o.useState(null),[ye,X]=o.useState({testName:"",hospitalId:""}),[z,S]=o.useState(!1),[J,H]=o.useState(null),[i,E]=o.useState({testName:"",hospitalId:""}),[K,R]=o.useState(null),O=s=>s.map(a=>({...a,id:a.id||a._id})),y=async()=>{F(!0);try{const s=await xe();u(O(s.data))}catch{q("Failed to fetch test data.")}finally{F(!1)}},P=async()=>{try{await fe(J,K),h.success("Test deleted successfully!",{position:"top-right"}),y()}catch(s){h.error("Failed to delete test."),console.error("Delete error:",s)}S(!1)},W=()=>{H(null),R(null),S(!1)};o.useEffect(()=>{y()},[]),o.useEffect(()=>{const s=t.toLowerCase().trim();if(!s){A([]);return}const a=r.filter(c=>{var d;return(d=c.testName)==null?void 0:d.toLowerCase().includes(s)});A(a)},[t,r]);const Y=()=>{const s={};return i.testName.trim()||(s.testName="Test name is required."),i.hospitalId.trim()||(s.hospitalId="Hospital ID is required."),X(s),Object.keys(s).length===0},Z=async()=>{var s,a,c,d;if(Y())try{const m={testName:i.testName,hospitalId:i.hospitalId};await je(m),h.success("Test added successfully!"),y(),j(!1),E({testName:"",hospitalId:""})}catch(m){const U=((a=(s=m.response)==null?void 0:s.data)==null?void 0:a.message)||((c=m.response)==null?void 0:c.statusText)||"An unexpected error occurred.";((d=m.response)==null?void 0:d.status)===409||U.toLowerCase().includes("duplicate")?h.error(`Error: Duplicate test name - ${i.testName} already exists!`,{position:"top-right"}):h.error(`Error adding test: ${U}`,{position:"top-right"})}},ee=s=>{v(s),f(!0)},se=async()=>{const{id:s,hospitalId:a}=n;try{await Ce(n,s,a),h.success("Test updated successfully!"),f(!1),y()}catch(c){console.error("Update error:",c),h.error("Failed to update test.")}},te=s=>{H(s.testId||s.id||s._id),R(s.hospitalId),S(!0)},re=[{name:"S.No",selector:(s,a)=>a+1,width:"10%"},{name:"Test Name",selector:s=>s.testName,sortable:!0,width:"45%"},{name:"Actions",cell:s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"250px"},children:[e.jsx("div",{onClick:()=>V(s),style:{color:"green",cursor:"pointer"},children:"View"}),e.jsx("div",{onClick:()=>ee(s),style:{color:"blue",cursor:"pointer"},children:"Edit"}),e.jsx("div",{onClick:()=>te(s),style:{color:"red",cursor:"pointer"},children:"Delete"})]})}],oe=({isVisible:s,message:a,onConfirm:c,onCancel:d})=>e.jsxs(T,{visible:s,onClose:d,backdrop:"static",children:[e.jsx(g,{children:e.jsx(N,{children:"Confirmation"})}),e.jsx(I,{children:a}),e.jsxs($,{children:[e.jsx(p,{color:"secondary",onClick:d,children:"Cancel"}),e.jsx(p,{color:"danger",onClick:c,children:"Confirm"})]})]});return e.jsxs("div",{children:[e.jsx(ce,{}),e.jsxs(k,{className:"d-flex justify-content-between mb-3",children:[e.jsxs(pe,{className:"mb-3",style:{width:"300px",marginLeft:"40px"},children:[e.jsx(x,{type:"text",placeholder:"Search by Test Name",value:t,onChange:s=>l(s.target.value)}),e.jsx(ue,{children:e.jsx(de,{icon:me})})]}),e.jsx(p,{color:"primary",style:{marginRight:"100px"},onClick:()=>j(!0),children:"Add Test"})]}),C&&e.jsxs(T,{visible:!!C,onClose:()=>V(null),children:[e.jsx(g,{children:e.jsx(N,{children:"Test Details"})}),e.jsxs(I,{children:[e.jsxs(B,{className:"mb-3",children:[e.jsx(w,{sm:4,children:e.jsx("strong",{children:"Test Name:"})}),e.jsx(w,{sm:8,children:C.testName})]}),e.jsxs(B,{className:"mb-3",children:[e.jsx(w,{sm:4,children:e.jsx("strong",{children:"Hospital ID:"})}),e.jsx(w,{sm:8,children:C.hospitalId})]})]})]}),e.jsxs(T,{visible:G,onClose:()=>j(!1),backdrop:"static",children:[e.jsx(g,{children:e.jsx(N,{children:"Add New Test"})}),e.jsx(I,{children:e.jsxs(k,{children:[e.jsxs("h6",{children:["Test Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(x,{type:"text",name:"testName",value:i.testName,onChange:s=>E({...i,testName:s.target.value})}),e.jsxs("h6",{className:"mt-3",children:["Hospital ID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(x,{type:"text",name:"hospitalId",value:i.hospitalId,onChange:s=>E({...i,hospitalId:s.target.value})})]})}),e.jsxs($,{children:[e.jsx(p,{color:"primary",onClick:Z,children:"Add"}),e.jsx(p,{color:"secondary",onClick:()=>j(!1),children:"Cancel"})]})]}),e.jsxs(T,{visible:_,onClose:()=>f(!1),backdrop:"static",children:[e.jsx(g,{children:e.jsx(N,{children:"Edit Test"})}),e.jsx(I,{children:e.jsxs(k,{children:[e.jsx("h6",{children:"Test Name"}),e.jsx(x,{type:"text",value:(n==null?void 0:n.testName)||"",onChange:s=>v({...n,testName:s.target.value})}),e.jsx("h6",{className:"mt-3",children:"Hospital ID"}),e.jsx(x,{type:"text",value:(n==null?void 0:n.hospitalId)||"",onChange:s=>v({...n,hospitalId:s.target.value})})]})}),e.jsxs($,{children:[e.jsx(p,{color:"primary",onClick:se,children:"Update"}),e.jsx(p,{color:"secondary",onClick:()=>f(!1),children:"Cancel"})]})]}),e.jsx(oe,{isVisible:z,message:"Are you sure you want to delete this test?",onConfirm:P,onCancel:W}),Q?e.jsx("div",{style:{textAlign:"center"},children:"Loading..."}):L?e.jsx("div",{children:L}):e.jsx(he,{columns:re,data:M.length?M:r,pagination:!0})]})};export{Ve as default};
