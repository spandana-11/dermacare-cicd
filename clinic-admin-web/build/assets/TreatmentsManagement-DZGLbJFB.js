import{o as b,B as I,a0 as ne,a1 as oe,a2 as le,r as n,j as e,Q as ie,x as c}from"./index-D4EgioAp.js";import{c as ce,a as m}from"./index.esm--WqZM78H.js";/* empty css                      */import{X as de}from"./index.es-DN_MbvvP.js";import{C as E}from"./CForm-DnvnHnhV.js";import{C as me}from"./CInputGroup-ZOd-amrn.js";import{C as k}from"./CFormInput-Dzx3nEck.js";import{C as pe}from"./CInputGroupText-Ccdw2IMc.js";import{c as ue}from"./cil-search-CDkY_4k-.js";import{C as T,a as N,b as g}from"./CModalHeader-jkZgTmf2.js";import{C as w}from"./CModalTitle-DGQxAg26.js";import{C as he,a as _}from"./CRow-CSRD6VWD.js";import{C as $}from"./CModalFooter-BFk4iTv2.js";import"./CFormLabel-CxEZYpEj.js";import"./CConditionalPortal-DMe4fTxW.js";const xe=async o=>{try{const a=await b.get(`${I}/${ne}/${o}`);return console.log("treatment data:",a.data),a.data}catch(a){throw console.error("Error fetching treatment data:",a.message),a.response&&(console.error("Error Response Data:",a.response.data),console.error("Error Response Status:",a.response.status)),a}},je=async o=>{try{const a={treatmentName:o.treatmentName||"",hospitalId:o.hospitalId||""},s=await b.post(`${I}/${oe}`,a,{headers:{"Content-Type":"application/json"}});return console.log("Treatment added successfully:",s.data),s.data}catch(a){throw console.error("Error adding treatment:",a.response),a}},fe=async(o,a,s)=>{try{const d={testName:o.treatmentName};return(await b.put(`${I}/labtest/updateLabTest/${a}/${s}`,d,{headers:{"Content-Type":"application/json"}})).data}catch(d){throw console.error("Error updating treatment:",d.response||d),d}},ye=async(o,a)=>{try{const s=await b.delete(`${I}/${le}/${o}/${a}`,{headers:{"Content-Type":"application/json"}});return console.log("Treatment deleted successfully:",s.data),s.data}catch(s){throw console.error("Error deleting treatment:",s.response?s.response.data:s),s}},Le=()=>{const[o,a]=n.useState(""),[s,d]=n.useState([]),[v,M]=n.useState([]),[q,A]=n.useState(!1),[B,G]=n.useState(null),[X,x]=n.useState(!1),[S,L]=n.useState(null),[z,j]=n.useState(!1),[p,F]=n.useState(null),[f,V]=n.useState({}),[J,D]=n.useState(!1),[K,R]=n.useState(null),[O,H]=n.useState(null),[u,Q]=n.useState({treatmentName:""}),y=localStorage.getItem("HospitalId"),P=t=>t.map(r=>({...r,id:r.id||r._id})),C=async t=>{A(!0);try{const r=await xe(t);d(P(r.data))}catch{G("Failed to fetch treatment data.")}finally{A(!1)}};n.useEffect(()=>{C(y)},[]),n.useEffect(()=>{const t=o.toLowerCase().trim();if(!t){M([]);return}const r=s.filter(l=>{var i;return(i=l.treatmentName)==null?void 0:i.toLowerCase().includes(t)});M(r)},[o,s]);const W=async()=>{try{await ye(K,O),c.success("Treatment deleted successfully!",{position:"top-right"}),C(y)}catch(t){c.error("Failed to delete treatment."),console.error("Delete error:",t)}D(!1)},Y=()=>{R(null),H(null),D(!1)},Z=async()=>{var t,r,l,i;if(!u.treatmentName.trim()){V({treatmentName:"Treatment name is required."});return}try{const h={treatmentName:u.treatmentName,hospitalId:y};await je(h),c.success("Treatment added successfully!"),C(y),x(!1),Q({treatmentName:""})}catch(h){const U=((r=(t=h.response)==null?void 0:t.data)==null?void 0:r.message)||((l=h.response)==null?void 0:l.statusText)||"An unexpected error occurred.";((i=h.response)==null?void 0:i.status)===409||U.toLowerCase().includes("duplicate")?c.error(`Error: Duplicate treatment name - ${u.treatmentName} already exists!`,{position:"top-right"}):c.error(`Error adding treatment: ${U}`,{position:"top-right"})}},ee=t=>{F(t),j(!0)},te=async()=>{const{id:t,hospitalId:r,treatmentName:l}=p;if(!l.trim()){c.error("Treatment name is required.");return}try{await fe({treatmentName:l.trim(),hospitalId:r.trim()},t,r),c.success("Treatment updated successfully!"),j(!1),C(r)}catch(i){console.error("Update error:",i),c.error("Failed to update treatment.")}},re=t=>{R(t.treatmentId||t.id||t._id),H(t.hospitalId),D(!0)},ae=[{name:"S.No",selector:(t,r)=>r+1,width:"10%"},{name:"Treatment Name",selector:t=>t.treatmentName,sortable:!0,width:"45%"},{name:"Actions",cell:t=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"250px"},children:[e.jsx("div",{onClick:()=>L(t),style:{color:"green",cursor:"pointer"},children:"View"}),e.jsx("div",{onClick:()=>ee(t),style:{color:"blue",cursor:"pointer"},children:"Edit"}),e.jsx("div",{onClick:()=>re(t),style:{color:"red",cursor:"pointer"},children:"Delete"})]})}],se=({isVisible:t,message:r,onConfirm:l,onCancel:i})=>e.jsxs(T,{visible:t,onClose:i,backdrop:"static",children:[e.jsx(N,{children:e.jsx(w,{children:"Confirmation"})}),e.jsx(g,{children:r}),e.jsxs($,{children:[e.jsx(m,{color:"secondary",onClick:i,children:"Cancel"}),e.jsx(m,{color:"danger",onClick:l,children:"Confirm"})]})]});return e.jsxs("div",{children:[e.jsx(ie,{}),e.jsxs(E,{className:"d-flex justify-content-between mb-3",children:[e.jsxs(me,{className:"mb-3",style:{width:"300px",marginLeft:"40px"},children:[e.jsx(k,{type:"text",placeholder:"Search by Treatment Name",value:o,onChange:t=>a(t.target.value)}),e.jsx(pe,{children:e.jsx(ce,{icon:ue})})]}),e.jsx(m,{color:"primary",style:{marginRight:"100px"},onClick:()=>x(!0),children:"Add Treatment"})]}),S&&e.jsxs(T,{visible:!!S,onClose:()=>L(null),backdrop:"static",children:[e.jsx(N,{children:e.jsx(w,{children:"Treatment Details"})}),e.jsx(g,{children:e.jsxs(he,{className:"mb-3",children:[e.jsx(_,{sm:4,children:e.jsx("strong",{children:"Treatment Name:"})}),e.jsx(_,{sm:8,children:S.treatmentName})]})})]}),e.jsxs(T,{visible:X,onClose:()=>x(!1),backdrop:"static",children:[e.jsx(N,{children:e.jsx(w,{children:"Add New Treatment"})}),e.jsx(g,{children:e.jsxs(E,{children:[e.jsxs("h6",{children:["Treatment Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(k,{type:"text",name:"treatmentName",value:u.treatmentName,onChange:t=>{const r=t.target.value;Q({...u,treatmentName:r}),f.treatmentName&&V(l=>({...l,treatmentName:""}))},placeholder:"Enter Treatment Name",className:f.treatmentName?"is-invalid":""}),f.treatmentName&&e.jsx("div",{className:"invalid-feedback",style:{color:"red"},children:f.treatmentName})]})}),e.jsxs($,{children:[e.jsx(m,{color:"primary",onClick:Z,children:"Add"}),e.jsx(m,{color:"secondary",onClick:()=>x(!1),children:"Cancel"})]})]}),e.jsxs(T,{visible:z,onClose:()=>j(!1),backdrop:"static",children:[e.jsx(N,{children:e.jsx(w,{children:"Edit Treatment"})}),e.jsx(g,{children:e.jsxs(E,{children:[e.jsx("h6",{children:"Treatment Name"}),e.jsx(k,{type:"text",value:(p==null?void 0:p.treatmentName)||"",onChange:t=>F({...p,treatmentName:t.target.value})})]})}),e.jsxs($,{children:[e.jsx(m,{color:"primary",onClick:te,children:"Update"}),e.jsx(m,{color:"secondary",onClick:()=>j(!1),children:"Cancel"})]})]}),e.jsx(se,{isVisible:J,message:"Are you sure you want to delete this treatment?",onConfirm:W,onCancel:Y}),q?e.jsx("div",{style:{textAlign:"center"},children:"Loading..."}):B?e.jsx("div",{children:B}):e.jsx(de,{columns:ae,data:v.length?v:s,pagination:!0})]})};export{Le as default};
