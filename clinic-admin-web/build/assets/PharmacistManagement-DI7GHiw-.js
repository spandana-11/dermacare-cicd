import{r as d,j as e,B as m,h as ce,i as K,e as xe,a as je,b as pe,R as be}from"./index-CE8wgZIf.js";import{a as _,f as ge}from"./Features-D45jZVjg.js";import{c as Q}from"./capitalizeWords-CuwF8AcI.js";import{U as fe}from"./UserPermissionModal-CzldWoA8.js";import{C as re,a as le,b as ie}from"./CModalHeader-bTJJxI9I.js";import{C as ve}from"./CModalTitle-B0ZxrCNp.js";import{C as Ne}from"./CForm-C9vHVwto.js";import{C as h}from"./CFormLabel-1p4Lfu_H.js";import{C as p}from"./CFormInput-Po4QMieX.js";import{C as Ce}from"./CFormSelect-CaEax12Y.js";import{C as ye}from"./CFormTextarea-CygHvoyJ.js";import{b as A}from"./index.esm-D3SzBvqQ.js";import{C as oe}from"./CModalFooter-26nQh_i4.js";import{C as Pe}from"./ConfirmationModal-CS0aBXT7.js";import{L as ke}from"./loader-CsxI0wUU.js";import{C as we,a as De,b as te,c as I,d as Ie,e as P}from"./CTable-D7EOl3_R.js";import{E as Ae}from"./eye-vIkjkHwb.js";import{P as Se,T as Be}from"./trash-2-B9Iv_Lgk.js";import"./CNavItem-D_DanzKb.js";const Fe=({visible:b,onClose:C,onSave:X,editData:O,initialData:y,viewMode:S,pharmacists:f,fetchTechs:U})=>{const k={viewPatients:!1,manageInventory:!1,accessReports:!1},w={hospitalId:localStorage.getItem("HospitalId"),branchId:localStorage.getItem("branchId"),hospitalName:localStorage.getItem("HospitalName"),fullName:"",gender:"",dateOfBirth:"",contactNumber:"",emailID:"",governmentId:"",dPharmaOrBPharmaCertificate:"",experienceCertificates:"",statePharmacyCouncilRegistration:"",dateOfJoining:"",department:"",qualification:"",role:"pharmacist",address:{houseNo:"",street:"",landmark:"",city:"",state:"",postalCode:"",country:"India"},emergencyContactNumber:"",bankAccountDetails:{accountNumber:"",accountHolderName:"",ifscCode:"",bankName:"",branchName:"",panCardNumber:""},profilePicture:"",pharmacyLicense:"",previousEmploymentHistory:"",permissions:k},[a,v]=d.useState(w),[z,de]=d.useState(localStorage.getItem("HospitalId")),[V,$]=d.useState(!1),[J,E]=d.useState(!1),[q,B]=d.useState(null),[Y,Z]=d.useState(!1),[ne,me]=d.useState([]),ee=["fullName","gender","dateOfBirth","contactNumber","emailID","governmentId","dateOfJoining","department","hospitalId","profilePicture","role","address.houseNo","address.street","address.city","address.state","address.postalCode","address.country","bankAccountDetails.accountNumber","bankAccountDetails.accountHolderName","bankAccountDetails.bankName","bankAccountDetails.branchName","bankAccountDetails.ifscCode","bankAccountDetails.panCardNumber"];function se(s,r){const t=[];for(const c of r){const l=c.split(".");let o=s;for(const x of l)o=o==null?void 0:o[x];(!o||String(o).trim()==="")&&t.push(c)}return t}const ae=s=>{v(r=>{const t={...r.permissions};return t[s]?delete t[s]:t[s]=[],{...r,permissions:t}})},G=(s,r)=>{v(t=>{const c={...t.permissions};return c[s]||(c[s]=[]),c[s].includes(r)?c[s]=c[s].filter(l=>l!==r):c[s]=[...c[s],r],{...t,permissions:c}})},F=s=>{v(r=>{const t={...r.permissions};return t[s]?t[s].length===_.length?t[s]=[]:t[s]=[..._]:t[s]=[..._],{...r,permissions:t}})},W=s=>new Promise((r,t)=>{const c=new FileReader;c.readAsDataURL(s),c.onload=()=>r(c.result),c.onerror=l=>t(l)});d.useEffect(()=>{v(y?s=>({...s,...y,address:{...w.address,...y.address||{}},bankAccountDetails:{...w.bankAccountDetails,...y.bankAccountDetails||{}},permissions:{...k,...y.permissions||{}}}):w)},[y]);const u=(s,r)=>{v(t=>({...t,[s]:r}))},j=(s,r,t)=>{v(c=>({...c,[s]:{...c[s],[r]:t}}))},M=(s,r)=>{const t=s.target.files[0];if(!t)return;const c=new FileReader;c.onloadend=()=>{v(l=>({...l,[r]:c.result,[`${r}Name`]:t.name,[`${r}Type`]:t.type}))},c.readAsDataURL(t)},L=()=>{const s=se(a,ee);if(s.length>0){m.error(`Please fill required fields: ${s.join(", ")}`);return}if(a.dateOfBirth){const o=new Date(a.dateOfBirth),x=new Date,D=x.getFullYear()-o.getFullYear();if((x.getMonth()<o.getMonth()||x.getMonth()===o.getMonth()&&x.getDate()<o.getDate()?D-1:D)<18){m.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(a.contactNumber)){m.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.emailID)){m.error("Please enter a valid email address.");return}if(f==null?void 0:f.some(o=>o.contactNumber===a.contactNumber&&o.pharmacistId!==a.pharmacistId)){m.error("Contact number already exists!");return}if(ne.some(o=>o.emailID===a.emailID&&o.pharmacistId!==a.pharmacistId)){m.error("Email already exists!");return}if(!a.pharmacistId&&!Object.values(a.permissions||{}).some(x=>Array.isArray(x)?x.length>0:!!x)){m.error("Please assign at least one user permission before saving.");return}console.log("Saving pharmacist data:",a),X(a),a.pharmacistId||v(w),C()},R=()=>{const s=se(a,ee);if(s.length>0){m.error(`Please fill required fields: ${s.join(", ")}`);return}if(a.dateOfBirth){const o=new Date(a.dateOfBirth),x=new Date,D=x.getFullYear()-o.getFullYear();if((x.getMonth()<o.getMonth()||x.getMonth()===o.getMonth()&&x.getDate()<o.getDate()?D-1:D)<18){m.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(a.contactNumber)){m.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.emailID)){m.error("Please enter a valid email address.");return}if(f==null?void 0:f.some(o=>o.contactNumber===a.contactNumber&&o.pharmacistId!==a.pharmacistId)){m.error("Contact number already exists!");return}if(f==null?void 0:f.some(o=>o.emailID===a.emailID&&o.pharmacistId!==a.pharmacistId)){m.error("Email already exists!");return}console.log(a),E(!0)},T=()=>{$(!1),B(null),Z(!1)},H=(s,r)=>{B(s),Z(r==null?void 0:r.includes("pdf")),$(!0)},n=({title:s,children:r})=>e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-semibold border-b pb-2 mb-4",children:s}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:r})]}),i=({label:s,value:r})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:r||"N/A"})]}),g=({label:s,value:r})=>e.jsxs("div",{className:"col-span-3",children:[s&&e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:r||"N/A"})]}),N=({label:s,type:r,data:t})=>{if(!t)return e.jsxs("p",{children:[s," "]});const c=r==null?void 0:r.startsWith("image/"),l=t.startsWith("data:")?t:`data:${r};base64,${t}`;return e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsxs("strong",{children:[s,":"]}),e.jsxs("div",{className:"mt-2",children:[c?e.jsx("img",{src:l,alt:s,className:"w-32 h-32 object-cover rounded-md border cursor-pointer",onClick:()=>H(l,r)}):e.jsx("button",{type:"button ",className:" btn text-blue-600 hover:underline block mx-2",onClick:()=>H(l,r),style:{backgroundColor:"var(--color-black)",color:"white"},children:"Preview"}),e.jsx("a",{href:l,download:s.replace(/\s+/g,"_"),className:"text-green-600 hover:underline text-sm block  btn",style:{backgroundColor:"var(--color-black)",color:"white"},children:"Download"})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(re,{visible:b,onClose:C,size:"lg",className:"custom-modal",backdrop:"static",children:[e.jsx(le,{children:e.jsx(ve,{children:S?"Personal Information":"Add / Edit Pharmacist "})}),e.jsx(ie,{children:S?e.jsxs("div",{className:"p-4 border rounded shadow-sm bg-white ",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Name : "}),e.jsx("span",{children:a.fullName})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Email : "}),e.jsx("span",{children:a.emailID})]}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-bold",children:"Contact : "}),e.jsx("span",{children:a.contactNumber})]})]}),e.jsxs("div",{className:"text-center",children:[a.profilePicture?e.jsx("img",{src:a.profilePicture||"/assets/images/default-avatar.png",alt:a.fullName,width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsxs("div",{style:{color:"var(--color-black)",marginTop:"5px",fontSize:"14px",fontWeight:"500"},children:["ID: ",a.pharmacistId]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-5 mt-5",children:[e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Full Name",value:a.fullName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Email",value:a.emailID})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Contact",value:a.contactNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Gender",value:a.gender})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Date of Birth",value:a.dateOfBirth})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Government ID",value:a.governmentId})})]}),e.jsx(n,{title:"Work Information",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Date of Joining",value:a.dateOfJoining})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Department",value:a.department})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Specialization",value:a.qualification})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Emergency Contact",value:a.emergencyContactNumber})})]})}),e.jsx(n,{title:"Address",children:e.jsx(g,{value:`${a.address.houseNo}, ${a.address.street}, ${a.address.city}, ${a.address.state} - ${a.address.postalCode}, ${a.address.country}`})}),e.jsx(n,{title:"Bank Details",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Account Number",value:a.bankAccountDetails.accountNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Account Holder Name",value:a.bankAccountDetails.accountHolderName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Bank Name",value:a.bankAccountDetails.bankName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Branch Name",value:a.bankAccountDetails.branchName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"PAN Card",value:a.bankAccountDetails.panCardNumber})})]})}),e.jsx(n,{title:"Documents",children:e.jsxs("div",{className:"row",children:[a.dPharmaOrBPharmaCertificate!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(N,{label:"dPharmaOrBPharmaCertificate",type:a.dPharmaOrBPharmaCertificateType||"application/pdf",data:a.dPharmaOrBPharmaCertificate})}):e.jsx("p",{className:"col-md-6",children:"Not Provided dPharmaOrBPharmaCertificate"}),a.statePharmacyCouncilRegistration!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(N,{label:"statePharmacyCouncilRegistration",type:a.statePharmacyCouncilRegistrationType||"application/pdf",data:a.statePharmacyCouncilRegistration})}):e.jsx("p",{className:"col-md-6",children:"Not Provided statePharmacyCouncilRegistration"}),a.experienceCertificates!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(N,{label:"experienceCertificates",type:a.experienceCertificatesType||"application/pdf",data:a.experienceCertificates})}):e.jsx("p",{className:"col-md-6",children:"Not Provided experienceCertificates"})]})}),e.jsx("div",{className:"mt-4"}),e.jsx(n,{title:"Other Information ",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(i,{label:"Pharmacy License",value:a.pharmacyLicense})}),e.jsx("div",{className:"col-md-12",children:e.jsx(g,{label:"Previous Employment",value:a.previousEmploymentHistory})})]})})]})]}):e.jsxs(Ne,{children:[e.jsx("h5",{children:"Basic Information"}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-5",children:[e.jsxs(h,{children:["ClinicID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{value:z,disabled:!0,onChange:s=>u("hospitalId",s.target.value)})]}),e.jsxs("div",{className:"col-md-7",children:[e.jsxs(h,{children:["Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{value:a.role,disabled:!0,onChange:s=>u("role",s.target.value)})]})]})}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Full Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{value:a.fullName,onChange:s=>u("fullName",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Gender ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(Ce,{value:a.gender,onChange:s=>u("gender",s.target.value),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Date of Birth ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"date",value:a.dateOfBirth,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],onChange:s=>u("dateOfBirth",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Contact Number ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"text",maxLength:10,value:a.contactNumber,onChange:s=>{const r=s.target.value;/^\d*$/.test(r)&&u("contactNumber",r)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Email ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"email",value:a.emailID,onChange:s=>u("emailID",s.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["GovernmentID(AadharCard No) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{maxLength:12,value:a.governmentId,onChange:s=>{const r=s.target.value;/^\d*$/.test(r)&&u("governmentId",r)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(h,{children:"Pharmacy License"}),e.jsx(p,{type:"text",placeholder:"Enter Pharmacy License",value:a.pharmacyLicense,onChange:s=>u("pharmacyLicense",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Date of Joining ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"date",value:a.dateOfJoining,onChange:s=>u("dateOfJoining",s.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[" ",e.jsx(h,{children:"Department"}),e.jsx(p,{value:Q(a.department),onChange:s=>u("department",s.target.value)})," "]}),e.jsxs("div",{className:"col-md-4",children:[" ",e.jsx(h,{children:"Specialization"}),e.jsx(p,{value:Q(a.qualification),onChange:s=>u("qualification",s.target.value)})]})]}),e.jsx("div",{className:"row mb-3",children:e.jsxs("div",{className:"col-md-4",children:[e.jsx(h,{children:"Emergency Contact"}),e.jsx(p,{type:"text",maxLength:10,value:a.emergencyContactNumber,onChange:s=>{const r=s.target.value;/^\d*$/.test(r)&&u("emergencyContactNumber",s.target.value)}})]})}),e.jsx("h5",{className:"mt-3",children:"Address"}),Object.keys(a.address).reduce((s,r,t)=>(t%3===0&&s.push([]),s[s.length-1].push(r),s),[]).map((s,r)=>e.jsx("div",{className:"row mb-3",children:s.map(t=>e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{className:"text-capitalize",children:[t," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"text",maxLength:t==="postalCode"?6:void 0,value:Q(a.address[t]),onChange:c=>{let l=c.target.value;t==="postalCode"?/^\d*$/.test(l)&&j("address",t,l):j("address",t,l)}})]},t))},r)),e.jsx("h5",{className:"mt-3",children:"Bank Account Details"}),Object.keys(a.bankAccountDetails).reduce((s,r,t)=>(t%3===0&&s.push([]),s[s.length-1].push(r),s),[]).map((s,r)=>e.jsx("div",{className:"row mb-3",children:s.map(t=>e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{className:"text-capitalize",children:[t," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{value:a.bankAccountDetails[t],maxLength:t==="accountNumber"?20:t==="panCardNumber"?10:t==="ifscCode"?11:void 0,onChange:async c=>{let l=c.target.value;if(t==="accountNumber"){/^\d*$/.test(l)&&j("bankAccountDetails",t,l);return}if(t==="panCardNumber"){l=l.toUpperCase(),/^[A-Z]{0,5}[0-9]{0,4}[A-Z]{0,1}$/.test(l)&&j("bankAccountDetails",t,l),l.length===10&&(/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(l)||m.error("Invalid PAN format (e.g., ABCDE1234F)"));return}if(t==="ifscCode"){if(l=l.toUpperCase(),!/^[A-Z0-9]*$/.test(l))return;if(j("bankAccountDetails",t,l),l.length===11){if(!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(l)){m.error("Invalid IFSC format (e.g., HDFC0001234)"),j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","");return}try{const x=await fetch(`https://ifsc.razorpay.com/${l}`);if(x.ok){const D=await x.json();j("bankAccountDetails","bankName",D.BANK||""),j("bankAccountDetails","branchName",D.BRANCH||"")}else m.error("Invalid IFSC Code"),j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","")}catch{m.error("Error fetching bank details"),j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","")}}else j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","");return}j("bankAccountDetails",t,l)}})]},t))},r)),e.jsx("h5",{className:"mt-3",children:"Documents"}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Profile Picture",e.jsx("span",{className:"text-danger",children:"*"})]}),a.profilePicture&&e.jsxs("div",{className:"mb-2",children:[e.jsx("img",{src:a.profilePicture,alt:"Profile",width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsx("br",{}),e.jsx("a",{href:a.profilePicture,download:"profile-picture",target:"_blank",rel:"noopener noreferrer",children:"Download"})]}),e.jsx(p,{type:"file",accept:"image/*",onChange:async s=>{const r=s.target.files[0];if(r){const t=await W(r);u("profilePicture",t)}}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(h,{children:"dPharma/BPharma Certificate"}),e.jsx(p,{type:"file",onChange:s=>M(s,"dPharmaOrBPharmaCertificate")})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(h,{children:"statePharmacyCouncilRegistration"}),e.jsx(p,{type:"file",onChange:s=>M(s,"statePharmacyCouncilRegistration")})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(h,{children:"experience Certificate"}),e.jsx(p,{type:"file",onChange:s=>M(s,"experienceCertificates")})]})]}),e.jsx(h,{children:"Previous Employment History"}),e.jsx(ye,{rows:3,value:a.previousEmploymentHistory,onChange:s=>u("previousEmploymentHistory",s.target.value),placeholder:"Enter previous employment history"}),e.jsx("div",{className:"mb-3 w-100 mt-4",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(A,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:R,children:"User Permissions"})}),e.jsx(fe,{show:J,onClose:()=>E(!1),features:ge,actions:_,permissions:a.permissions,toggleFeature:ae,toggleAllActions:F,togglePermission:G,onSave:()=>{console.log("Saved Permissions",a.permissions),E(!1)}})]})}),e.jsx(oe,{children:S?e.jsx(A,{color:"secondary",onClick:C,children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(A,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)"},onClick:()=>v(w),children:"Clear"}),e.jsx(A,{color:"secondary",onClick:C,children:"Cancel"}),e.jsx(A,{style:{backgroundColor:"var(--color-black)",color:"white"},onClick:L,children:"Save"})]})})]}),e.jsxs(re,{visible:V,onClose:T,size:"xl",children:[e.jsx(le,{onClose:T,children:e.jsx("strong",{children:Y?"PDF Preview":"Image Preview"})}),e.jsx(ie,{className:"text-center",children:Y?e.jsx("iframe",{src:q,title:"PDF Preview",style:{width:"100%",height:"80vh",border:"none"}}):e.jsx("img",{src:q,alt:"Preview",style:{maxWidth:"100%",maxHeight:"80vh",borderRadius:"8px"}})})]})]})},Re=b=>ce.get(`${K}/getAllPharmacists/${b}`),Oe=b=>xe.post(`${K}/addPharmacist`,b,{headers:{"Content-Type":"application/json"}}),$e=(b,C)=>ce.put(`${K}/updatePharmacist/${b}`,C,{headers:{"Content-Type":"application/json"}}),Ee=b=>ce.delete(`${K}/deletePharmacist/${b}`),as=()=>{const[b,C]=d.useState([]),[X,O]=d.useState(!1),[y,S]=d.useState(null),[f,U]=d.useState(!1),[k,w]=d.useState(1),[a,v]=d.useState(10),{searchQuery:z,setSearchQuery:de}=je(),[V,$]=d.useState(!1),[J,E]=d.useState(null),[q,B]=d.useState(!1),[Y,Z]=d.useState(null),[ne,me]=d.useState(null),[ee,se]=d.useState(!1),[ae,G]=d.useState(!1),[F,W]=d.useState(null),u=async()=>{var n;$(!0);try{const i=localStorage.getItem("HospitalId");if(i){const g=await Re(i),N=((n=g.data)==null?void 0:n.data)||g.data||[];C(N)}}catch(i){console.error("❌ Error fetching pharmacists:",i),C([]),E("Failed to fetch pharmacists.")}finally{$(!1)}};d.useEffect(()=>{u()},[]);const j=async n=>{var i,g,N,s,r,t;try{const c={...n,permissions:{Laboratory:Object.entries(n.permissions.Laboratory||{}).filter(([l,o])=>o).map(([l])=>l),viewPatients:n.permissions.viewPatients?["read"]:[]}};if(y)await $e(y.pharmacistId,c),m.success("Pharmacist updated successfully!");else{const l=await Oe(c);await u(),(g=(i=l==null?void 0:l.data)==null?void 0:i.data)!=null&&g.userName&&((s=(N=l==null?void 0:l.data)==null?void 0:N.data)!=null&&s.password)&&(W({username:l.data.data.userName,password:l.data.data.password,pharmacistName:l.data.data.fullName}),G(!0)),m.success("Pharmacist added successfully!")}}catch(c){console.error("API error:",c),m.error(((t=(r=c.response)==null?void 0:r.data)==null?void 0:t.message)||"❌ Failed to save pharmacist.")}},M=async n=>{try{await Ee(n),C(i=>i.filter(g=>g.pharmacistId!==n)),m.success("Pharmacist deleted successfully!")}catch(i){console.error("Delete error:",i),m.error("❌ Failed to delete pharmacist.")}finally{B(!1)}},{user:L}=pe(),R=(n,i)=>{var g,N;return(N=(g=L==null?void 0:L.permissions)==null?void 0:g[n])==null?void 0:N.includes(i)},T=be.useMemo(()=>{const n=z.toLowerCase().trim();return n?b.filter(i=>Object.values(i).some(g=>String(g).toLowerCase().includes(n))):b},[z,b]),H=T.slice((k-1)*a,k*a);return e.jsxs("div",{children:[R("Laboratory","create")&&e.jsx("div",{className:"mb-3 w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(A,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>O(!0),children:"Add Pharmacist"})}),e.jsxs(re,{visible:ae,backdrop:"static",keyboard:!1,children:[e.jsx(le,{children:e.jsx("h5",{children:"Pharmacist Credentials"})}),e.jsx(ie,{children:F?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",F.pharmacistName||"New Pharmacist"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",F.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," ",F.password]}),e.jsx("small",{className:"text-danger",children:"⚠️ Please save these credentials securely. They will not be shown again."})]}):e.jsx("p",{children:"No data available"})}),e.jsx(oe,{children:e.jsx(A,{color:"primary",onClick:()=>{G(!1),W(null)},children:"Close"})})]}),e.jsx(Pe,{isVisible:q,title:"Delete Pharmacist",message:"Are you sure you want to delete this pharmacist? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>M(Y),onCancel:()=>B(!1)}),V?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(ke,{message:"Loading pharmacists..."})}):J?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:J}):e.jsxs(we,{className:"mt-3",striped:!0,hover:!0,responsive:!0,children:[e.jsx(De,{children:e.jsxs(te,{className:"pink-table  w-auto",children:[e.jsx(I,{children:"#"}),e.jsx(I,{children:"Photo"}),e.jsx(I,{children:"Name"}),e.jsx(I,{children:"Contact"}),e.jsx(I,{children:"Sex"}),e.jsx(I,{children:"Qualification"}),e.jsx(I,{children:"Date Of Joining"}),e.jsx(I,{className:"text-end",children:"Actions"})]})}),e.jsx(Ie,{className:"pink-table",children:H.length?H.map((n,i)=>e.jsxs(te,{children:[e.jsx(P,{children:(k-1)*a+i+1}),e.jsx(P,{children:n.profilePicture?e.jsx("img",{src:n.profilePicture,alt:n.fullName,width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}})}),e.jsx(P,{children:Q(n.fullName)}),e.jsx(P,{children:n.contactNumber||"NA"}),e.jsx(P,{children:n.gender||"NA"}),e.jsx(P,{children:n.qualification||"NA"}),e.jsx(P,{children:n.dateOfJoining||"NA"}),e.jsx(P,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[R("Laboratory","read")&&e.jsx("button",{className:"actionBtn",onClick:()=>{S(n),U(!0),O(!0)},title:"View",children:e.jsx(Ae,{size:18})}),R("Laboratory","update")&&e.jsx("button",{className:"actionBtn",onClick:()=>{S(n),U(!1),O(!0)},title:"Edit",children:e.jsx(Se,{size:18})}),R("Laboratory","delete")&&e.jsx("button",{className:"actionBtn",onClick:()=>{Z(n.pharmacistId),B(!0)},title:"Delete",children:e.jsx(Be,{size:18})})]})})]},n.id)):e.jsx(te,{children:e.jsx(P,{colSpan:"9",className:"text-center",style:{color:"var(--color-black)"},children:"No pharmacist found."})})})]}),!V&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(T.length/a)},(n,i)=>e.jsx(A,{style:{backgroundColor:k===i+1?"var(--color-black)":"#fff",color:k===i+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>w(i+1),children:i+1},i))}),e.jsx(Fe,{visible:X,onClose:()=>{O(!1),S(null),U(!1)},onSave:j,initialData:y,viewMode:f,pharmacistList:b,pharmacist:b,fetchTechs:u})]})};export{as as default};
