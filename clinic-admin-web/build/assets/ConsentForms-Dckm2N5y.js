import{h as Y,M as He,O as Ue,S as ze,T as Ke,V as We,r as a,j as e,B as N,y as Ye,E as Je,H as Xe,W as xe}from"./index-C_57eipd.js";import{b as be,c as L,d as B}from"./index-BSHdNehN.js";import{c as R}from"./capitalizeWords-CuwF8AcI.js";import{C as Se}from"./ConfirmationModal-DXoiKv1A.js";import{C as ie,a as le}from"./CCardBody-DJzj6yui.js";import{b as F}from"./index.esm-BHEIq1go.js";import{C as je}from"./CForm-CQ2Lc3Ee.js";import{a as W,C as Ze}from"./CRow-C7y-bEMs.js";import{C as ee,b as oe}from"./CFormInput-B4iuloMJ.js";import{C as ye}from"./CInputGroup-Cwtxhm07.js";import{C as Ce,a as Ie}from"./CListGroupItem-DF5wPkyz.js";import{C as we,a as Fe,b as Ae,c as Ne}from"./CAccordionItem-95ONps6L.js";import{S as es}from"./react-select.esm-B0Q3Vr0x.js";import{C as ge}from"./CFormSelect-CG529RFZ.js";import{C as ss,a as te,b as ne}from"./CNavItem-CLuTsh0o.js";import{a as rs,b as ae}from"./DefaultLayout-r43C_A3r.js";import"./CModalHeader-ByJ2V-Ma.js";import"./CModalTitle-DDIj9Tfs.js";import"./CModalFooter-BaEfHy_e.js";import"./CFormLabel-88J2CuQM.js";import"./defineProperty-DevPl9dM.js";import"./slicedToArray-D6Gft5C9.js";import"./CustomerViewDetails-DHdEXT0k.js";const ke=async(m,u,d)=>{try{const p=await Y.post(`${ze}/${u}/${d}`,m,{headers:{"Content-Type":"application/json"}});return console.log("Add API response:",p.data),p.data}catch(p){throw console.error("Error response from API:",p.response||p.message),p}},Ee=async(m,u,d)=>{try{return(await Y.put(`${Ue}/${u}/${d}`,m,{headers:{"Content-Type":"application/json"}})).data}catch(p){throw console.error("Error updating consentForm:",p.response||p.message),p}},Pe=async m=>{try{const u=await Y.delete(`${Ke}/${m}`,{headers:{"Content-Type":"application/json"}});return console.log("ConsentForm deleted successfully:",u.data),u.data}catch(u){throw console.error("Error deleting ConsentForm:",u.response||u.message),u}},ce=async(m,u)=>{try{const d=await Y.get(`${He}/${m}/${u}`);return console.log("Fetched data:",d.data),d.data}catch(d){throw console.error("Error fetching test data:",d.response||d.message),d}},fe=async(m,u)=>{try{const d=await Y.get(`${We}/${m}/${u}`);return console.log("Procedure Consent Form data:",d.data),d.data}catch(d){throw console.error("Error fetching Procedure Form data:",d.message),d.response&&(console.error("Error Response Data:",d.response.data),console.error("Error Response Status:",d.response.status)),d}},os=()=>{const[m,u]=a.useState(!1),[d,p]=a.useState([]),[b,j]=a.useState([]),[q,Q]=a.useState(""),[k,E]=a.useState(""),[x,C]=a.useState([]),[O,V]=a.useState(null),[se,D]=a.useState(null),[de,_]=a.useState({}),[ue,J]=a.useState(!1),[X,T]=a.useState(null),[Z,H]=a.useState(null),[re,U]=a.useState(!1),f=localStorage.getItem("HospitalId"),I="1";a.useEffect(()=>{(async()=>{try{const t=await ce(f,I);if(console.log("✅ Forms from API:",t.data),t!=null&&t.data){const h=(Array.isArray(t.data)?t.data:[t.data]).map(v=>({...v,consentFormQuestions:v.consentFormQuestions||[]}));p(h)}}catch(t){console.error("Error fetching saved forms",t)}})()},[f,I]);const M=()=>{if(k.trim()){if(O!==null){const n=[...x];n[O]=k.trim(),C(n),V(null)}else x.includes(k.trim())||C([...x,k.trim()]);E("")}},z=n=>{C(x.filter(t=>t!==n))},G=()=>{const n=q.trim();if(!n||x.length===0){if(n===""&&x.length===0)return;N.error("Please add a question and at least one answer.");return}if(b.some(t=>t.question===n)){N.error("This question already exists.");return}j([...b,{question:n,answers:[...x]}]),Q(""),C([])},K=n=>{j(b.filter((t,l)=>l!==n))},w=async()=>{const n={};if(b.length===0&&(n.qaList="At least one question is required."),Object.keys(n).length>0){_(n);return}_({});const t={consentFormQuestions:b.map(l=>({heading:l.question,questionsAndAnswers:l.answers.map(h=>({question:h,answer:!0}))}))};try{se!==null?await Ee(t,f,I):await ke(t,f,I);const l=await ce(f,I);l!=null&&l.data&&p(Array.isArray(l.data)?l.data:[l.data]),j([]),u(!1),D(null),U(!1)}catch(l){console.error("Error saving Generic Form:",l)}},$=n=>{const t=d[n];if(!t){N.error("Selected form not found");return}const l=(t.consentFormQuestions||[]).map(h=>({question:h.heading,answers:(h.questionsAndAnswers||[]).map(v=>v.question)}));j(l),D(n),u(!0),_({})},y=async n=>{const t=d[n],l=(t==null?void 0:t.id)||(t==null?void 0:t.consentFormId)||(t==null?void 0:t.formId);if(!l){N.error("This form cannot be deleted.");return}try{await Pe(l),p(d.filter((h,v)=>v!==n)),U(!1)}catch(h){console.error("Error deleting Generic Form:",h),N.error("Failed to delete form.")}},P=n=>{const t=b[n];Q(t.question),C(t.answers),j(b.filter((l,h)=>h!==n))};return e.jsxs(ie,{className:"mt-3",children:[e.jsxs(le,{children:[!m&&e.jsx("div",{className:"w-100 d-flex justify-content-end",children:e.jsx(F,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>{u(!0),j([]),D(null),U(!0)},disabled:re||d.length>0,children:"+ Add Generic Form"})}),m&&e.jsxs(je,{className:"mb-4",children:[e.jsxs(W,{md:12,children:[e.jsx("h6",{className:"mb-2",children:"Question"}),e.jsx(ee,{placeholder:"Enter question",value:q,onChange:n=>Q(n.target.value)}),e.jsx("h6",{className:"mt-3 mb-2",children:"Answers"}),e.jsxs(ye,{className:"mb-2",children:[e.jsx(ee,{placeholder:"Enter answer",value:k,onChange:n=>E(n.target.value)}),e.jsx(F,{onClick:M,style:{backgroundColor:"var(--color-black)",color:"white"},children:e.jsx(be,{})})]}),x.length>0&&e.jsx(Ce,{className:"mb-3",children:x.map((n,t)=>e.jsxs(Ie,{className:"d-flex justify-content-between align-items-center",children:[n,e.jsxs("div",{children:[e.jsx(L,{onClick:()=>{E(n),V(t)},style:{cursor:"pointer",color:"var(--color-black)",marginRight:"10px"}}),e.jsx(B,{onClick:()=>z(n),style:{cursor:"pointer",color:"var(--color-black)"}})]})]},t))}),e.jsx(F,{color:"info",className:"me-2",onClick:G,style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)",border:"none"},children:"Add Question"})]}),b.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{children:"Questions Added"}),b.map((n,t)=>e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:n.question}),e.jsx("ul",{children:n.answers.map((l,h)=>e.jsx("li",{children:l},h))}),e.jsxs("div",{children:[e.jsx(L,{onClick:()=>P(t),style:{cursor:"pointer",color:"var(--color-black)",marginRight:"10px"}}),e.jsx(B,{onClick:()=>K(t),style:{cursor:"pointer",color:"var(--color-black)"}})]})]},t))]}),e.jsxs("div",{className:"mt-3",children:[e.jsx(F,{color:"secondary",className:"me-2",onClick:()=>u(!1),children:"Cancel"}),e.jsx(F,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)",border:"none"},onClick:w,children:se!==null?"Update Generic Form":"Save Generic Form"})]})]}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h6",{children:"Saved Generic Forms"}),e.jsx(we,{children:d.map((n,t)=>e.jsxs(Fe,{itemKey:t,children:[e.jsx(Ae,{children:R(n.subServiceName)||" Generic Consent Form"}),e.jsxs(Ne,{children:[Array.isArray(n.consentFormQuestions)&&n.consentFormQuestions.map((l,h)=>e.jsxs("div",{children:[e.jsx("h6",{children:R(l.heading)}),Array.isArray(l.questionsAndAnswers)&&l.questionsAndAnswers.map((v,A)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("input",{type:"checkbox",className:"me-2",disabled:!0,checked:v.answer===void 0?!0:!!v.answer}),e.jsx("span",{children:R(v.question)})]},A))]},h)),e.jsxs("div",{className:"d-flex gap-3 mt-2",children:[e.jsx(L,{onClick:()=>$(t),style:{color:"var(--color-black)",cursor:"pointer"}}),e.jsx(B,{onClick:()=>{T(t),J(!0),H(n.subServiceName)},style:{color:"var(--color-black)",cursor:"pointer"}})]})]})]},t))})]})]}),e.jsx(Se,{isVisible:ue,title:"Delete ProcedureConsentForm",message:`Are you sure you want to delete this "${Z}" ? This action cannot be undone.`,confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>{X!==null&&(y(X),T(null)),J(!1)},onCancel:()=>{T(null),J(!1)}})]})},ts=()=>{const[m,u]=a.useState([]),[d,p]=a.useState([]),[b,j]=a.useState([]),[q,Q]=a.useState([]),[k,E]=a.useState(!1),[x,C]=a.useState([]),[O,V]=a.useState(null),[se,D]=a.useState(!1),[de,_]=a.useState(!0),[ue,J]=a.useState(null),[X,T]=a.useState(!1),[Z,H]=a.useState(null),[re,U]=a.useState(null),[f,I]=a.useState({categoryId:"",serviceId:"",subServiceid:"",subServiceName:"",consentFormQuestions:[]}),[M,z]=a.useState(""),[G,K]=a.useState(""),[w,$]=a.useState([]),[y,P]=a.useState([]),[n,t]=a.useState(null),[l,h]=a.useState({}),v=localStorage.getItem("HospitalId"),A="2";a.useEffect(()=>{(async()=>{var s;try{const o=await Ye();Array.isArray(o.data)?u(o.data):Array.isArray((s=o.data)==null?void 0:s.data)?u(o.data.data):u([])}catch(o){console.error("Error fetching categories:",o)}})()},[]),a.useEffect(()=>{(async()=>{console.log(v),console.log(A);try{const s=await ce(v,A);s!=null&&s.data&&C(Array.isArray(s.data)?s.data:[s.data])}catch(s){console.error("Error fetching saved forms",s)}})()},[v]),a.useEffect(()=>{if(!f.categoryId){p([]);return}(async()=>{try{const s=await Je(f.categoryId);p((s==null?void 0:s.data)||[])}catch(s){console.error("Error fetching services",s),p([])}})()},[f.categoryId]),a.useEffect(()=>{if(!f.serviceId){j([]);return}(async()=>{try{const s=await Xe(f.serviceId),o=(s==null?void 0:s.data)||[];let i=[];Array.isArray(o)?i=o.flatMap(c=>c.subServices||[]):o!=null&&o.subServices&&(i=o.subServices),console.log(i),j(i)}catch(s){console.error("Error fetching subServices",s),j([])}})()},[f.serviceId]),a.useEffect(()=>{(async()=>{try{const s=await fe(v,A);if(console.log("✅ Forms from API:",s.data),s!=null&&s.data){const o=(Array.isArray(s.data)?s.data:[s.data]).map(i=>({...i,consentFormQuestions:i.consentFormQuestions||[]}));C(o)}}catch(s){console.error("Error fetching saved forms",s)}})()},[v,A]);const me=r=>{const{name:s,value:o}=r.target;I(i=>{const c={...i,[s]:o};return s==="categoryId"&&(c.serviceId="",c.subServiceid=""),s==="serviceId"&&(c.subServiceid=""),c})},he=async r=>{let s=!1;const o=localStorage.getItem("HospitalId");for(const i of r){const c=await xe(o,i);if(!c||!c.price||!c.finalCost){s=!0;break}}_(!s)},qe=()=>{if(G.trim()){if(O!==null){const r=[...w];r[O]=G.trim(),$(r),V(null)}else w.includes(G.trim())||$([...w,G.trim()]);K("")}},Qe=r=>{$(w.filter(s=>s!==r))},Te=()=>{if(M.trim()&&w.length>0){if(y.some(r=>r.question===M.trim())){alert("This question already exists.");return}P([...y,{question:M.trim(),answers:[...w]}]),z(""),$([])}},Ge=r=>{P(y.filter((s,o)=>o!==r))},$e=async()=>{const r={};if((!q||q.length===0)&&(r.subServiceName="At least one Procedure must be selected."),y.length===0&&(r.qaList="At least one question is required."),Object.keys(r).length>0){h(r);return}h({});const s=q.map(o=>({subServiceid:o,consentFormQuestions:y.map(i=>({heading:i.question,questionsAndAnswers:i.answers.map(c=>({question:c,answer:!0}))}))}));try{if(n!==null)await Ee(s[0],v,A);else for(const i of s)await ke(i,v,A);const o=await fe(v,A);o!=null&&o.data&&C(Array.isArray(o.data)?o.data:[o.data]),I({categoryId:"",serviceId:"",subServiceid:"",subServiceName:"",consentFormQuestions:[]}),P([]),Q([]),E(!1),t(null)}catch(o){console.error("Error saving Procedure Form:",o)}},De=async r=>{var s;try{const o=x[r];if(!o){N.error("Selected form not found");return}const i=o.subServiceid??o.subServiceId??((s=o==null?void 0:o.subService)==null?void 0:s.subServiceId)??(o==null?void 0:o.id);i||console.warn("No subService id found on selected form:",o);let c=null;if(i)try{c=await xe(v,i)}catch(g){console.warn("getSubServiceById failed:",g)}const S=i??(c==null?void 0:c.subServiceId)??"",ve=(c==null?void 0:c.subServiceName)??o.subServiceName??"",Be=(c==null?void 0:c.serviceId)??o.serviceId??"",Re=(c==null?void 0:c.categoryId)??o.categoryId??"";c?j(g=>g.some(_e=>String(_e.subServiceId)===String(c.subServiceId))?g:[...g,c]):S&&!b.some(g=>String(g.subServiceId)===String(S))&&j(g=>[...g,{subServiceId:S,subServiceName:ve||"Unknown"}]),I({categoryId:Re||"",serviceId:Be||"",subServiceid:S||"",subServiceName:ve||"",consentFormQuestions:o.consentFormQuestions||[]}),Q(S?[S]:[]);const Oe=(o.consentFormQuestions||[]).map(g=>({question:g.heading,answers:(g.questionsAndAnswers||[]).map(pe=>pe.question)}));P(Oe),t(r),E(!0),h({});const Ve=x.some(g=>String(g.subServiceid??g.subServiceId??"")===String(S));D(!Ve),S&&he([S])}catch(o){console.error("Error in editProcedureForm:",o),N.error("Unable to prepare edit form. Check console for details.")}},Me=async r=>{const s=x[r],o=(s==null?void 0:s.id)||(s==null?void 0:s.consentFormId)||(s==null?void 0:s.formId);if(!(s!=null&&s.id)){N.error("This form does not have an ID and cannot be deleted.");return}try{await Pe(o);const i=x.filter((c,S)=>S!==r);C(i)}catch(i){console.error("Error deleting Procedure Form:",i),N.error("Failed to delete procedure form.")}},Le=r=>{const s=y[r];z(s.question),$(s.answers);const o=y.filter((i,c)=>c!==r);P(o)};return e.jsxs(ie,{className:"mt-3",children:[e.jsxs(le,{children:[!k&&e.jsx("div",{className:"  w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(F,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>{E(!0),I({categoryId:"",serviceId:"",subServiceid:"",subServiceName:"",consentFormQuestions:[]}),P([]),t(null)},children:"+ Add Procedure Form"})}),k&&e.jsxs(je,{className:"mb-4",children:[e.jsxs(Ze,{className:"mb-4",children:[e.jsxs(W,{md:4,children:[e.jsxs("h6",{children:["Category Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(ge,{value:f.categoryId||"",onChange:me,name:"categoryId","aria-label":"Select Category",children:[e.jsx("option",{value:"",children:"Select a Category"}),m==null?void 0:m.map(r=>e.jsx("option",{value:r.categoryId,children:r.categoryName},r.categoryId))]}),l.categoryId&&e.jsx(oe,{className:"text-danger",children:l.categoryId})]}),e.jsxs(W,{md:4,children:[e.jsxs("h6",{children:["Service Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(ge,{name:"serviceId",value:f.serviceId||"",onChange:me,children:[e.jsx("option",{value:"",children:"Select Service"}),d.map(r=>e.jsx("option",{value:r.serviceId,children:r.serviceName},r.serviceId))]}),l.serviceId&&e.jsx(oe,{className:"text-danger",children:l.serviceId})]}),e.jsxs(W,{md:4,children:[e.jsxs("h6",{children:["Procedure Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(es,{isMulti:!0,name:"subServiceName",placeholder:"Select Sub Services",options:(b||[]).map(r=>({label:r.subServiceName,value:r.subServiceId})),value:(b||[]).filter(r=>q.includes(r.subServiceId)).map(r=>({label:r.subServiceName,value:r.subServiceId})),onChange:r=>{const s=r.map(i=>i.value);Q(s),r.length>0&&h(i=>({...i,subServiceName:""}));const o=s.some(i=>!x.some(c=>String(c.subServiceid)===String(i)));D(o),he(s)}}),!de&&e.jsxs("div",{className:"text-danger mt-2",children:["Some selected Procedures are missing details like price or final cost.",e.jsx("br",{}),e.jsx("a",{href:"/procedure-Management",className:"text-primary",children:"Please add Procedure details"})]}),l.subServiceName&&e.jsx(oe,{className:"text-danger",children:l.subServiceName})]})]}),e.jsxs(W,{md:12,children:[e.jsx("h6",{className:"mb-2",children:"Question"}),e.jsx(ee,{placeholder:"Enter question",value:M,onChange:r=>z(r.target.value)}),e.jsx("h6",{className:"mt-3 mb-2",children:"Answers"}),e.jsxs(ye,{className:"mb-2",children:[e.jsx(ee,{placeholder:"Enter answer",value:G,onChange:r=>K(r.target.value)}),e.jsx(F,{onClick:qe,style:{backgroundColor:"var(--color-black)",color:"white"},children:e.jsx(be,{})})]}),w.length>0&&e.jsx(Ce,{className:"mb-3",children:w.map((r,s)=>e.jsxs(Ie,{className:"d-flex justify-content-between align-items-center",children:[r,e.jsxs("div",{children:[e.jsx(L,{onClick:()=>{K(r),V(s)},style:{cursor:"pointer",color:"var(--color-black)",marginRight:"10px"}}),e.jsx(B,{onClick:()=>Qe(r),style:{cursor:"pointer",color:"var(--color-black)"}})]})]},s))}),e.jsx(F,{color:"info",className:"me-2  ",onClick:Te,style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)",border:"none"},children:"Add Question"})]}),y.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{children:"Questions Added"}),y.map((r,s)=>e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:r.question}),e.jsx("ul",{children:r.answers.map((o,i)=>e.jsx("li",{children:o},i))}),e.jsxs("div",{children:[e.jsx(L,{onClick:()=>Le(s),style:{cursor:"pointer",color:"var(--color-black)",marginRight:"10px"}}),e.jsx(B,{onClick:()=>Ge(s),style:{cursor:"pointer",color:"var(--color-black)"}})]})]},s))]}),e.jsxs("div",{className:"mt-3",children:[e.jsx(F,{color:"secondary",className:"me-2",onClick:()=>E(!1),children:"Cancel"}),e.jsx(F,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)",border:"none"},onClick:$e,children:n!==null?"Update Procedure Form":"Save Procedure Form"})]})]}),x.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h6",{children:"Saved Procedure Forms"}),e.jsx(we,{children:x.map((r,s)=>e.jsx(e.Fragment,{children:e.jsxs(Fe,{itemKey:s,children:[e.jsx(Ae,{children:R(r.subServiceName)||"Unnamed Procedure"}),e.jsxs(Ne,{children:[Array.isArray(r.consentFormQuestions)&&r.consentFormQuestions.map((o,i)=>e.jsxs("div",{children:[e.jsx("h6",{children:R(o.heading)}),Array.isArray(o.questionsAndAnswers)&&o.questionsAndAnswers.map((c,S)=>e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("input",{type:"checkbox",checked:c.answer===void 0?!0:!!c.answer,className:"me-2",disabled:!0}),e.jsx("span",{children:R(c.question)})]},S))]},i)),e.jsxs("div",{className:"d-flex gap-3 mt-2",children:[e.jsx(L,{onClick:()=>De(s),style:{color:"var(--color-black)",cursor:"pointer"}}),e.jsx(B,{onClick:()=>{H(s),T(!0),U(r.subServiceName)},style:{color:"var(--color-black)",cursor:"pointer"}})]})]})]},s)}))})]})]}),e.jsx(Se,{isVisible:X,title:"Delete Procedure Consent",message:`Are you sure you want to delete this "${re}" ? This action cannot be undone.`,confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>{Z!==null&&(Me(Z),H(null)),T(!1)},onCancel:()=>{H(null),T(!1)}})]})},Ns=()=>{const[m,u]=a.useState(1);return e.jsx(ie,{children:e.jsxs(le,{children:[e.jsxs(ss,{variant:"tabs",style:{cursor:"pointer",color:"var(--color-black)"},children:[e.jsx(te,{children:e.jsx(ne,{active:m===1,onClick:()=>u(1),style:{color:"var(--color-black)"},children:"Generic Consent Form"})}),e.jsx(te,{children:e.jsx(ne,{active:m===2,onClick:()=>u(2),style:{color:"var(--color-black)"},children:"Procedure Consent Form"})}),e.jsx(te,{children:e.jsx(ne,{active:m===3,onClick:()=>u(2),style:{color:"var(--color-black)"},children:"Privacy and policy"})})]}),e.jsxs(rs,{children:[e.jsx(ae,{visible:m===1,children:e.jsx(os,{})}),e.jsx(ae,{visible:m===2,children:e.jsx(ts,{})}),e.jsx(ae,{visible:m===3})]})]})})};export{Ns as default};
