import{o as S,B as Z,I as K,J as ee,K as se,r as j,i as oe,h as re,j as e,Q as te,G as g}from"./index-Cpi758hF.js";/* empty css                      */import{a as u}from"./index.esm-C7yr2Uvz.js";import{C as ae,a as ne,b as w,c as x,d as ce,e as i}from"./CTable-DEXNsAeo.js";import{C as _,a as z,b as G}from"./CModalHeader-DDJokkaa.js";import{C as U}from"./CModalTitle-Cu1Roa9E.js";import{C as J}from"./CModalFooter-BV2JySvV.js";import{C as ie}from"./CFormLabel-BaJPW12u.js";import{C as le}from"./CFormInput-DNY9nWJM.js";import"./CConditionalPortal-bf5S_2dI.js";const de=async(l,t)=>{console.log("DoctorNotifyData calling...");try{const o=await S.get(`${K}/${ee}/${l}/${t}`);return console.log("DoctorNotifyData response:",o.data),o}catch(o){throw console.error("Error fetching doctor notifications:",o.message),o.response?(console.error("Error Response Data:",o.response.data),console.error("Error Response Status:",o.response.status),console.error("Error Response Headers:",o.response.headers)):o.request?console.error("Error Request:",o.request):console.error("Error Message:",o.message),o}},he=async l=>{var t,o,b,D;try{return console.log("Sending data to API"),(await S.post(`${K}/${se}`,l,{headers:{"Content-Type":"application/json"}})).data}catch(p){throw console.error("Error response:",p.response),alert(`Error: ${(t=p.response)==null?void 0:t.status} - ${((b=(o=p.response)==null?void 0:o.data)==null?void 0:b.message)||((D=p.response)==null?void 0:D.statusText)}`),p}},je=async l=>{try{return await S.get(`${Z}/doctors/hospitalById/${l}`)}catch(t){throw console.error("Error fetching doctor notifications:",t),t}},Ie=()=>{var A,T,M,$,k,F,B,H,P,L,q,V;const[l,t]=j.useState([]),[o,b]=j.useState(!1),[D,p]=j.useState(null),[s,Q]=j.useState(null),[O,C]=j.useState(!1),[W,y]=j.useState(!1),[I,R]=j.useState(""),{setNotificationCount:v}=oe(),E=async(r,d="")=>{var f,n,m,h;const a={hospitalId:(f=s==null?void 0:s.data)==null?void 0:f.clinicId,doctorId:(n=s==null?void 0:s.data)==null?void 0:n.doctorId,notificationId:s==null?void 0:s.notificationId,appointmentId:(m=s==null?void 0:s.data)==null?void 0:m.bookingId,subServiceId:(h=s==null?void 0:s.data)==null?void 0:h.subServiceId,status:r,reasonForCancel:d};try{(await he(a)).status===200&&(g.success(`Notification ${r} successfully`),C(!1),y(!1),R(""),t(N=>N.filter(Y=>Y.notificationId!==s.notificationId)),v(N=>N-1))}catch{g.error("Something went wrong!")}},X=re();return j.useEffect(()=>{(async()=>{const d=localStorage.getItem("HospitalId");if(!d){g.error("Missing Hospital ID in localStorage");return}try{const a=await je(d);if(a.status===200&&Array.isArray(a.data.data)&&a.data.data.length>0){const f=a.data.data;let n=[];for(const m of f){const h=m.doctorId;try{const c=await de(d,h);c.status===200&&Array.isArray(c.data.data)&&(n=[...n,...c.data.data])}catch(c){console.error(`Error fetching notifications for doctor ${h}:`,c)}}t(n),v(n.length)}else g.warning("No doctors found for this hospital.")}catch{g.error("Error fetching doctor list.")}})()},[]),e.jsxs("div",{className:"container mt-4",children:[e.jsx(te,{}),e.jsx("h5",{children:"Doctor Notifications"}),e.jsxs(ae,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(ne,{children:e.jsxs(w,{children:[e.jsx(x,{children:"S.No"}),e.jsx(x,{children:"Doctor Name"}),e.jsx(x,{children:"Patient Name"}),e.jsx(x,{children:"Mobile Number"}),e.jsx(x,{children:"Consultation Type"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Time"}),e.jsx(x,{children:"Action"})]})}),e.jsx(ce,{children:l.length>0?l.map((r,d)=>{var a,f,n,m,h,c;return e.jsxs(w,{children:[" ",e.jsx(i,{children:d+1}),e.jsx(i,{children:((a=r.data)==null?void 0:a.doctorName)||"-"}),e.jsx(i,{children:((f=r.data)==null?void 0:f.name)||"-"}),e.jsx(i,{children:((n=r.data)==null?void 0:n.mobileNumber)||"-"}),e.jsx(i,{children:((m=r.data)==null?void 0:m.consultationType)||"-"}),e.jsx(i,{children:((h=r.data)==null?void 0:h.serviceDate)||"-"}),e.jsx(i,{children:((c=r.data)==null?void 0:c.servicetime)||"-"}),e.jsx(i,{children:e.jsx(u,{color:"primary",size:"sm",onClick:()=>{Q(r),C(!0)},children:"View"})})]},r.notificationId||d)}):e.jsx(w,{children:e.jsx(i,{colSpan:"9",className:"text-center text-secondary fw-bold",children:"No notifications available or data could not be loaded."})})})]}),e.jsxs(_,{visible:O,onClose:()=>C(!1),children:[e.jsx(z,{children:e.jsx(U,{children:"Appointment Details"})}),e.jsx(G,{children:s&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Doctor:"})," ",(A=s.data)==null?void 0:A.doctorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Patient:"})," ",(T=s.data)==null?void 0:T.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",(M=s.data)==null?void 0:M.age]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gender:"})," ",($=s.data)==null?void 0:$.gender]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mobile:"})," ",(k=s.data)==null?void 0:k.mobileNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Problem:"})," ",(F=s.data)==null?void 0:F.problem]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Clinic:"})," ",(B=s.data)==null?void 0:B.clinicName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Service:"})," ",(H=s.data)==null?void 0:H.subServiceName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",(P=s.data)==null?void 0:P.serviceDate]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",(L=s.data)==null?void 0:L.servicetime]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",(q=s.data)==null?void 0:q.consultationType]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fee:"})," â‚¹",(V=s.data)==null?void 0:V.consultationFee]})]})}),e.jsxs(J,{children:[e.jsx(u,{color:"primary",size:"sm",className:"px-3",onClick:()=>X("/doctor"),children:"Doctor Details"}),e.jsx(u,{color:"success",className:"text-white",onClick:()=>E("Accepted"),children:"Accept"}),e.jsx(u,{color:"danger",className:"text-white",onClick:()=>{C(!1),y(!0)},children:"Reject"}),e.jsx(u,{color:"secondary",onClick:()=>C(!1),children:"Close"})]})]}),e.jsxs(_,{visible:W,onClose:()=>y(!1),children:[e.jsx(z,{children:e.jsx(U,{children:"Reject Appointment"})}),e.jsxs(G,{children:[e.jsx(ie,{htmlFor:"rejectReason",children:"Reason for Rejection"}),e.jsx(le,{id:"rejectReason",value:I,onChange:r=>R(r.target.value),placeholder:"Enter reason here"})]}),e.jsxs(J,{children:[e.jsx(u,{color:"danger",className:"text-white",onClick:()=>{if(!I.trim()){g.warning("Please provide a reason.");return}E("Rejected",I)},children:"Submit"}),e.jsx(u,{color:"secondary",onClick:()=>y(!1),children:"Cancel"})]})]})]})};export{Ie as default};
