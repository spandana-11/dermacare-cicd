import{o as b,B as D,X as le,Y as ne,Z as ie,a0 as ce,r as o,j as e,Q as de,y as p}from"./index-BQRndUr-.js";import{c as he,a as m}from"./index.esm-kPg_xJHJ.js";/* empty css                      */import{X as pe}from"./index.es-CnO2hUzf.js";import{C as M}from"./CForm-ErNLGUDF.js";import{C as me}from"./CInputGroup-5zPXr3Y-.js";import{C as j}from"./CFormInput-CGpy1-2P.js";import{C as ue}from"./CInputGroupText-Df5m6PW7.js";import{c as xe}from"./cil-search-CDkY_4k-.js";import{C as g,a as N,b as I}from"./CModalHeader-CnBCdOSi.js";import{C as v}from"./CModalTitle-CTMCnDzP.js";import{C as q,a as w}from"./CRow-CiETNr7h.js";import{C as A}from"./CModalFooter-Do3Y1geN.js";import"./CFormLabel-DMA6u-r3.js";import"./CConditionalPortal-D0WgdB7t.js";const je=async()=>{try{const t=await b.get(`${D}/${le}`);return console.log("test data:",t.data),t.data}catch(t){throw console.error("Error fetching test data:",t.message),t.response&&(console.error("Error Response Data:",t.response.data),console.error("Error Response Status:",t.response.status)),t}},fe=async t=>{try{const n={testName:t.testName||"",hospitalId:t.hospitalId||""},a=await b.post(`${D}/${ne}`,n,{headers:{"Content-Type":"application/json"}});return console.log(a),a.data}catch(n){throw console.error("Error response from API:",n.response),n}},ye=async(t,n,a)=>{try{return(await b.put(`${D}/${ie}/${n}/${a}`,t,{headers:{"Content-Type":"application/json"}})).data}catch(u){throw console.error("Error updating tet:",u),u}},Ce=async(t,n)=>{try{const a=await b.delete(`${D}/${ce}/${t}/${n}`,{headers:{"Content-Type":"application/json"}});return console.log("Test deleted successfully:",a.data),a.data}catch(a){throw console.error("Error deleting tet:",a.response?a.response.data:a),a}},Le=()=>{const[t,n]=o.useState(""),[a,u]=o.useState([]),[F,H]=o.useState([]),[X,L]=o.useState(!1),[V,_]=o.useState(null),[G,f]=o.useState(!1),[y,R]=o.useState(null),[z,C]=o.useState(!1),[i,E]=o.useState(null),[d,S]=o.useState({}),[O,k]=o.useState(!1),[P,B]=o.useState(null),[c,$]=o.useState({testName:"",hospitalId:""}),[Y,U]=o.useState(null),Z=s=>s.map(r=>({...r,id:r.id||r._id})),T=async()=>{L(!0);try{const s=await je();u(Z(s.data))}catch{_("Failed to fetch test data.")}finally{L(!1)}},J=async()=>{try{await Ce(P,Y),p.success("Test deleted successfully!",{position:"top-right"}),T()}catch(s){p.error("Failed to delete test."),console.error("Delete error:",s)}k(!1)},K=()=>{B(null),U(null),k(!1)};o.useEffect(()=>{T()},[]),o.useEffect(()=>{const s=t.toLowerCase().trim();if(!s){H([]);return}const r=a.filter(l=>{var h;return(h=l.testName)==null?void 0:h.toLowerCase().includes(s)});H(r)},[t,a]);const W=()=>{const s={};return c.testName.trim()||(s.testName="Test name is required."),c.hospitalId.trim()||(s.hospitalId="Hospital ID is required."),S(s),Object.keys(s).length===0},ee=async()=>{var s,r,l,h;if(W())try{const x={testName:c.testName,hospitalId:c.hospitalId};await fe(x),p.success("Test added successfully!"),T(),f(!1),$({testName:"",hospitalId:""})}catch(x){const Q=((r=(s=x.response)==null?void 0:s.data)==null?void 0:r.message)||((l=x.response)==null?void 0:l.statusText)||"An unexpected error occurred.";((h=x.response)==null?void 0:h.status)===409||Q.toLowerCase().includes("duplicate")?p.error(`Error: Duplicate test name - ${c.testName} already exists!`,{position:"top-right"}):p.error(`Error adding test: ${Q}`,{position:"top-right"})}},se=s=>{E(s),C(!0)},te=async()=>{const{id:s,hospitalId:r}=i;try{await ye(i,s,r),p.success("Test updated successfully!"),C(!1),T()}catch(l){console.error("Update error:",l),p.error("Failed to update test.")}},re=s=>{B(s.testId||s.id||s._id),U(s.hospitalId),k(!0)},ae=[{name:"S.No",selector:(s,r)=>r+1,width:"10%"},{name:"Test Name",selector:s=>s.testName,sortable:!0,width:"45%"},{name:"Actions",cell:s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"250px"},children:[e.jsx("div",{onClick:()=>R(s),style:{color:"green",cursor:"pointer"},children:"View"}),e.jsx("div",{onClick:()=>se(s),style:{color:"blue",cursor:"pointer"},children:"Edit"}),e.jsx("div",{onClick:()=>re(s),style:{color:"red",cursor:"pointer"},children:"Delete"})]})}],oe=({isVisible:s,message:r,onConfirm:l,onCancel:h})=>e.jsxs(g,{visible:s,onClose:h,backdrop:"static",children:[e.jsx(N,{children:e.jsx(v,{children:"Confirmation"})}),e.jsx(I,{children:r}),e.jsxs(A,{children:[e.jsx(m,{color:"secondary",onClick:h,children:"Cancel"}),e.jsx(m,{color:"danger",onClick:l,children:"Confirm"})]})]});return e.jsxs("div",{children:[e.jsx(de,{}),e.jsxs(M,{className:"d-flex justify-content-between mb-3",children:[e.jsxs(me,{className:"mb-3",style:{width:"300px",marginLeft:"40px"},children:[e.jsx(j,{type:"text",placeholder:"Search by Test Name",value:t,onChange:s=>n(s.target.value)}),e.jsx(ue,{children:e.jsx(he,{icon:xe})})]}),e.jsx(m,{color:"primary",style:{marginRight:"100px"},onClick:()=>f(!0),children:"Add Test"})]}),y&&e.jsxs(g,{visible:!!y,onClose:()=>R(null),children:[e.jsx(N,{children:e.jsx(v,{children:"Test Details"})}),e.jsxs(I,{children:[e.jsxs(q,{className:"mb-3",children:[e.jsx(w,{sm:4,children:e.jsx("strong",{children:"Test Name:"})}),e.jsx(w,{sm:8,children:y.testName})]}),e.jsxs(q,{className:"mb-3",children:[e.jsx(w,{sm:4,children:e.jsx("strong",{children:"Hospital ID:"})}),e.jsx(w,{sm:8,children:y.hospitalId})]})]})]}),e.jsxs(g,{visible:G,onClose:()=>f(!1),backdrop:"static",children:[e.jsx(N,{children:e.jsx(v,{children:"Add New Test"})}),e.jsx(I,{children:e.jsxs(M,{children:[e.jsxs("h6",{children:["Test Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{type:"text",name:"testName",value:c.testName,onChange:s=>{const r=s.target.value;$({...c,testName:r}),d.testName&&S(l=>({...l,testName:""}))},placeholder:"Enter test name",className:d.testName?"is-invalid":""}),d.testName&&e.jsx("div",{className:"invalid-feedback",style:{color:"red"},children:d.testName}),e.jsxs("h6",{className:"mt-3",children:["Hospital ID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(j,{type:"text",name:"hospitalId",value:c.hospitalId,onChange:s=>{const r=s.target.value;$({...c,hospitalId:r}),d.hospitalId&&S(l=>({...l,hospitalId:""}))},placeholder:"Enter Hospital Id",className:d.hospitalId?"is-invalid":""}),d.hospitalId&&e.jsx("div",{className:"invalid-feedback",style:{color:"red"},children:d.hospitalId})]})}),e.jsxs(A,{children:[e.jsx(m,{color:"primary",onClick:ee,children:"Add"}),e.jsx(m,{color:"secondary",onClick:()=>f(!1),children:"Cancel"})]})]}),e.jsxs(g,{visible:z,onClose:()=>C(!1),backdrop:"static",children:[e.jsx(N,{children:e.jsx(v,{children:"Edit Test"})}),e.jsx(I,{children:e.jsxs(M,{children:[e.jsx("h6",{children:"Test Name"}),e.jsx(j,{type:"text",value:(i==null?void 0:i.testName)||"",onChange:s=>E({...i,testName:s.target.value})}),e.jsx("h6",{className:"mt-3",children:"Hospital ID"}),e.jsx(j,{type:"text",value:(i==null?void 0:i.hospitalId)||"",onChange:s=>E({...i,hospitalId:s.target.value})})]})}),e.jsxs(A,{children:[e.jsx(m,{color:"primary",onClick:te,children:"Update"}),e.jsx(m,{color:"secondary",onClick:()=>C(!1),children:"Cancel"})]})]}),e.jsx(oe,{isVisible:O,message:"Are you sure you want to delete this test?",onConfirm:J,onCancel:K}),X?e.jsx("div",{style:{textAlign:"center"},children:"Loading..."}):V?e.jsx("div",{children:V}):e.jsx(pe,{columns:ae,data:F.length?F:a,pagination:!0})]})};export{Le as default};
