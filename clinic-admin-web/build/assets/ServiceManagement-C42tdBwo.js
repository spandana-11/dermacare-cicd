import{r as n,_ as z,$ as T,a as M,c as W,P as N,b as vs,j as e,Q as xs,G as fs,a8 as js,o as ke,B as Ke,D as Ve,E as Be,a9 as Ns,x as J,aa as ys,z as bs,ab as Ss}from"./index-D4EgioAp.js";import{X as As}from"./index.es-DN_MbvvP.js";import{C as Cs,a as H,c as Is}from"./index.esm--WqZM78H.js";/* empty css                      */import{F as Ps,a as He}from"./index-D3wLgZkS.js";import{_ as ws,f as Qs,b as Es,T as Fs,u as Ts}from"./CConditionalPortal-DMe4fTxW.js";import{a as j,C as w}from"./CRow-CSRD6VWD.js";import{C as O,a as K}from"./CFormInput-Dzx3nEck.js";import{C as Ue}from"./CInputGroup-ZOd-amrn.js";import{C as ze}from"./CForm-DnvnHnhV.js";import{C as Ds}from"./CInputGroupText-Ccdw2IMc.js";import{c as Ms}from"./cil-search-CDkY_4k-.js";import{C as ve,a as We,b as xe}from"./CModalHeader-jkZgTmf2.js";import{C as Ge}from"./CModalTitle-DGQxAg26.js";import{C as fe}from"./CModalFooter-BFk4iTv2.js";import{C as oe}from"./CFormSelect-C0XdJDmP.js";import{g as Rs}from"./DefaultLayout-BXdUDKRE.js";import"./CFormLabel-CxEZYpEj.js";var Je=n.createContext({}),be=n.forwardRef(function(t,c){var h=t.children,a=t.activeItemKey,u=t.alwaysOpen,v=u===void 0?!1:u,g=t.className,o=t.flush,m=z(t,["children","activeItemKey","alwaysOpen","className","flush"]),l=n.useState(a),A=l[0],C=l[1];return T.createElement("div",M({className:W("accordion",{"accordion-flush":o},g)},m,{ref:c}),T.createElement(Je.Provider,{value:{_activeItemKey:A,alwaysOpen:v,setActiveKey:C}},h))});be.propTypes={activeItemKey:N.oneOfType([N.number,N.string]),alwaysOpen:N.bool,children:N.node,className:N.string,flush:N.bool};be.displayName="CAccordion";function ye(){return ye=Object.assign?Object.assign.bind():function(t){for(var c=1;c<arguments.length;c++){var h=arguments[c];for(var a in h)({}).hasOwnProperty.call(h,a)&&(t[a]=h[a])}return t},ye.apply(null,arguments)}function $s(t,c){return t.classList?!!c&&t.classList.contains(c):(" "+(t.className.baseVal||t.className)+" ").indexOf(" "+c+" ")!==-1}function Ls(t,c){t.classList?t.classList.add(c):$s(t,c)||(typeof t.className=="string"?t.className=t.className+" "+c:t.setAttribute("class",(t.className&&t.className.baseVal||"")+" "+c))}function qe(t,c){return t.replace(new RegExp("(^|\\s)"+c+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function Os(t,c){t.classList?t.classList.remove(c):typeof t.className=="string"?t.className=qe(t.className,c):t.setAttribute("class",qe(t.className&&t.className.baseVal||"",c))}var ks=function(c,h){return c&&h&&h.split(" ").forEach(function(a){return Ls(c,a)})},je=function(c,h){return c&&h&&h.split(" ").forEach(function(a){return Os(c,a)})},Se=function(t){ws(c,t);function c(){for(var a,u=arguments.length,v=new Array(u),g=0;g<u;g++)v[g]=arguments[g];return a=t.call.apply(t,[this].concat(v))||this,a.appliedClasses={appear:{},enter:{},exit:{}},a.onEnter=function(o,m){var l=a.resolveArguments(o,m),A=l[0],C=l[1];a.removeClasses(A,"exit"),a.addClass(A,C?"appear":"enter","base"),a.props.onEnter&&a.props.onEnter(o,m)},a.onEntering=function(o,m){var l=a.resolveArguments(o,m),A=l[0],C=l[1],D=C?"appear":"enter";a.addClass(A,D,"active"),a.props.onEntering&&a.props.onEntering(o,m)},a.onEntered=function(o,m){var l=a.resolveArguments(o,m),A=l[0],C=l[1],D=C?"appear":"enter";a.removeClasses(A,D),a.addClass(A,D,"done"),a.props.onEntered&&a.props.onEntered(o,m)},a.onExit=function(o){var m=a.resolveArguments(o),l=m[0];a.removeClasses(l,"appear"),a.removeClasses(l,"enter"),a.addClass(l,"exit","base"),a.props.onExit&&a.props.onExit(o)},a.onExiting=function(o){var m=a.resolveArguments(o),l=m[0];a.addClass(l,"exit","active"),a.props.onExiting&&a.props.onExiting(o)},a.onExited=function(o){var m=a.resolveArguments(o),l=m[0];a.removeClasses(l,"exit"),a.addClass(l,"exit","done"),a.props.onExited&&a.props.onExited(o)},a.resolveArguments=function(o,m){return a.props.nodeRef?[a.props.nodeRef.current,o]:[o,m]},a.getClassNames=function(o){var m=a.props.classNames,l=typeof m=="string",A=l&&m?m+"-":"",C=l?""+A+o:m[o],D=l?C+"-active":m[o+"Active"],R=l?C+"-done":m[o+"Done"];return{baseClassName:C,activeClassName:D,doneClassName:R}},a}var h=c.prototype;return h.addClass=function(u,v,g){var o=this.getClassNames(v)[g+"ClassName"],m=this.getClassNames("enter"),l=m.doneClassName;v==="appear"&&g==="done"&&l&&(o+=" "+l),g==="active"&&u&&Qs(u),o&&(this.appliedClasses[v][g]=o,ks(u,o))},h.removeClasses=function(u,v){var g=this.appliedClasses[v],o=g.base,m=g.active,l=g.done;this.appliedClasses[v]={},o&&je(u,o),m&&je(u,m),l&&je(u,l)},h.render=function(){var u=this.props;u.classNames;var v=Es(u,["classNames"]);return T.createElement(Fs,ye({},v,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},c}(T.Component);Se.defaultProps={classNames:""};Se.propTypes={};var Ae=n.forwardRef(function(t,c){var h=t.children,a=t.className,u=t.horizontal,v=t.onHide,g=t.onShow,o=t.visible,m=z(t,["children","className","horizontal","onHide","onShow","visible"]),l=n.useRef(null),A=Ts(c,l),C=n.useState(),D=C[0],R=C[1],V=n.useState(),b=V[0],S=V[1],F=function(){if(g&&g(),u){l.current&&S(l.current.scrollWidth);return}l.current&&R(l.current.scrollHeight)},f=function(){if(u){S(0);return}R(0)},G=function(){if(u){l.current&&S(l.current.scrollWidth);return}l.current&&R(l.current.scrollHeight)},q=function(){if(v&&v(),u){S(0);return}R(0)},le=function(){if(u){S(0);return}R(0)};return T.createElement(Se,{in:o,nodeRef:l,onEntering:F,onEntered:f,onExit:G,onExiting:q,onExited:le,timeout:350},function(_){var de=D===0?null:{height:D},Qe=b===0?null:{width:b};return T.createElement("div",M({className:W(a,{"collapse-horizontal":u,collapsing:_==="entering"||_==="exiting","collapse show":_==="entered",collapse:_==="exited"}),style:M(M({},de),Qe)},m,{ref:A}),h)})});Ae.propTypes={children:N.node,className:N.string,horizontal:N.bool,onHide:N.func,onShow:N.func,visible:N.bool};Ae.displayName="CCollapse";var Ce=n.createContext({}),Z=n.forwardRef(function(t,c){var h=t.children,a=t.className,u=z(t,["children","className"]),v=n.useContext(Ce),g=v.id,o=v.visible;return T.createElement(Ae,{className:"accordion-collapse",id:g,visible:o},T.createElement("div",M({className:W("accordion-body",a)},u,{ref:c}),h))});Z.propTypes={children:N.node,className:N.string};Z.displayName="CAccordionBody";var Ie=n.forwardRef(function(t,c){var h=t.children,a=t.className,u=z(t,["children","className"]),v=n.useContext(Ce),g=v.id,o=v.visible,m=v.setVisible;return T.createElement("button",M({type:"button",className:W("accordion-button",{collapsed:!o},a),"aria-controls":g,"aria-expanded":o,onClick:function(){return m(!o)}},u,{ref:c}),h)});Ie.propTypes={children:N.node,className:N.string};Ie.displayName="CAccordionButton";var ee=n.forwardRef(function(t,c){var h=t.children,a=t.className,u=z(t,["children","className"]);return T.createElement("div",M({className:W("accordion-header",a)},u,{ref:c}),T.createElement(Ie,null,h))});ee.propTypes={children:N.node,className:N.string};ee.displayName="CAccordionHeader";var se=n.forwardRef(function(t,c){var h=t.children,a=t.className,u=t.id,v=t.itemKey,g=z(t,["children","className","id","itemKey"]),o=n.useId(),m=u??o,l=n.useRef(v??m),A=n.useContext(Je),C=A._activeItemKey,D=A.alwaysOpen,R=A.setActiveKey,V=n.useState(C===l.current),b=V[0],S=V[1];return n.useEffect(function(){!D&&b&&R(l.current)},[b]),n.useEffect(function(){S(C===l.current)},[C]),T.createElement("div",M({className:W("accordion-item",a)},g,{ref:c}),T.createElement(Ce.Provider,{value:{id:m,setVisible:S,visible:b}},h))});se.propTypes={children:N.node,className:N.string,itemKey:N.oneOfType([N.number,N.string])};se.displayName="CAccordionItem";var Pe=n.forwardRef(function(t,c){var h,a=t.children,u=t.as,v=u===void 0?"ul":u,g=t.className,o=t.flush,m=t.layout,l=z(t,["children","as","className","flush","layout"]);return T.createElement(v,M({className:W("list-group",(h={"list-group-flush":o},h["list-group-".concat(m)]=m,h),g)},l,{ref:c}),a)});Pe.propTypes={as:N.elementType,children:N.node,className:N.string,flush:N.bool,layout:N.oneOf(["horizontal","horizontal-sm","horizontal-md","horizontal-lg","horizontal-xl","horizontal-xxl"])};Pe.displayName="CListGroup";var we=n.forwardRef(function(t,c){var h,a=t.children,u=t.active,v=t.as,g=v===void 0?"li":v,o=t.className,m=t.disabled,l=t.color,A=z(t,["children","active","as","className","disabled","color"]),C=g==="a"||g==="button"?Cs:g;return A=M(M(M(M({},(g==="a"||g==="button")&&{active:u,disabled:m,as:g,ref:c}),u&&{"aria-current":!0}),m&&{"aria-disabled":!0}),A),T.createElement(C,M({className:W("list-group-item",(h={},h["list-group-item-".concat(l)]=l,h["list-group-item-action"]=g==="a"||g==="button",h.active=u,h.disabled=m,h),o)},A),a)});we.propTypes={active:N.bool,as:N.elementType,children:N.node,className:N.string,color:vs,disabled:N.bool};we.displayName="CListGroupItem";const Ne=({title:t,qaList:c=[],setQAList:h})=>{const[a,u]=n.useState(""),[v,g]=n.useState(""),[o,m]=n.useState([]),[l,A]=n.useState("add"),C=()=>{v.trim()!==""&&(m([...o,v]),g(""))},D=b=>{m(o.filter(S=>S!==b))},R=()=>{a.trim()&&o.length>0&&(h([...c,{[a]:o}]),u(""),m([]))},V=b=>{const S=[...c];S.splice(b,1),h(S)};return n.useEffect(()=>{if(c.length>0){const b=c[c.length-1],S=Object.keys(b)[0],F=b[S];u(S),m(F)}},[c]),n.useEffect(()=>{if((l==="edit"||l==="view")&&c.length>0){const b=c[c.length-1],S=Object.keys(b)[0],F=b[S];u(S),m(F)}},[c,l]),e.jsxs(j,{md:12,className:"mt-3",children:[e.jsxs("label",{className:"mb-2",children:["Question ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(O,{placeholder:"Enter your question",value:a,onChange:b=>u(b.target.value)}),e.jsxs("label",{className:"mt-3",children:["Answers ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(Ue,{className:"mb-2",children:[e.jsx(O,{placeholder:"Enter answer",value:v,onChange:b=>g(b.target.value)}),e.jsx(H,{color:"success",onClick:C,className:"text-white",children:e.jsx(Ps,{})})]}),o.length>0&&e.jsx(Pe,{className:"mb-3",children:o.map((b,S)=>e.jsxs(we,{className:"d-flex justify-content-between align-items-center",children:[b,e.jsx(He,{onClick:()=>D(b),style:{color:"gray",cursor:"pointer"}})]},S))}),e.jsx(H,{color:"info",className:"mb-3 text-white",onClick:R,children:"Save Q&A"}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h6",{className:"mt-4",children:"Saved Questions & Answers"}),c.map((b,S)=>{const F=Object.keys(b)[0],f=b[F];return e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:F}),e.jsx("ul",{children:f.map((G,q)=>e.jsx("li",{children:G},q))}),e.jsx(He,{onClick:()=>V(S),style:{color:"red",cursor:"pointer"}})]},S)})]})]})},Ks=({preQAList:t,setPreQAList:c,procedureQAList:h,setProcedureQAList:a,postQAList:u,setPostQAList:v})=>e.jsxs(be,{default:!0,children:[e.jsxs(se,{itemKey:1,children:[e.jsx(ee,{children:"Pre-Procedure"}),e.jsx(Z,{children:e.jsx(Ne,{title:"Pre-Procedure",qaList:t,setQAList:c})})]}),e.jsxs(se,{itemKey:2,children:[e.jsx(ee,{children:"Procedure"}),e.jsx(Z,{children:e.jsx(Ne,{title:"Procedure",qaList:h,setQAList:a})})]}),e.jsxs(se,{itemKey:3,children:[e.jsx(ee,{children:"Post-Procedure"}),e.jsx(Z,{children:e.jsx(Ne,{title:"Post-Procedure",qaList:u,setQAList:v})})]})]}),yr=()=>{const[t,c]=n.useState(""),[h,a]=n.useState([]),[u,v]=n.useState([]),[g,o]=n.useState([]),[m,l]=n.useState(!1),[A,C]=n.useState(null),[D,R]=n.useState(""),[V,b]=n.useState([]),[S,F]=n.useState(!1),[f,G]=n.useState(null),[q,le]=n.useState(!1),[_,de]=n.useState(""),[Qe,Vs]=n.useState(""),[Bs,_e]=n.useState([]),[Hs,ue]=n.useState([]),[Ee,me]=n.useState([]),[X,Fe]=n.useState([]),[Xe,he]=n.useState(""),[Ye,Ze]=n.useState(""),[Te,zs]=n.useState(null),[re,es]=n.useState({serviceImage:"",viewImage:"",subServiceName:"",serviceName:"",serviceImageFile:null}),[Ws,Gs]=n.useState([]),[qs,Us]=n.useState([]),[Js,_s]=n.useState([]);let De=[];try{typeof h.descriptionQA=="string"?De=JSON.parse(h.descriptionQA):De=h.descriptionQA||[]}catch(s){console.error("Invalid descriptionQA format:",s)}const[r,Q]=n.useState({categoryName:"",categoryId:"",serviceName:"",subServiceName:"",description:"",price:"",gst:0,consultationFee:0,procedureQA:[],preProcedureQA:[],postProcedureQA:[]}),[Y,Me]=n.useState("add"),[Xs,Ys]=n.useState(null),[Zs,er]=n.useState(""),ss=()=>{Me("add"),ue([]),_e([]),de(""),he(""),Q({categoryName:"",categoryId:"",serviceName:"",serviceId:"",subServiceId:"",subServiceName:"",price:"",discount:0,gst:0,consultationFee:0,minTime:"",taxPercentage:0,status:"",serviceImage:"",serviceImageFile:null,viewImage:"",viewDescription:"",platformFeePercentage:0,descriptionQA:[]}),F(!0)},rs=async s=>{var Oe;console.log(s.subServiceId),Ze(s.subServiceId),Me("edit"),F(!0);const i=u.find(L=>L.categoryName===s.categoryName),d=(i==null?void 0:i.categoryId)||"";let p=[];try{p=((Oe=(await ke.get(`${Ke}/${Ve}/${d}`)).data)==null?void 0:Oe.data)||[],console.log(p),me(p)}catch(L){console.error("Error fetching service list:",L)}const x=p.find(L=>L.serviceName===s.serviceName),y=(x==null?void 0:x.serviceId)||"";let E=[];if(y)try{const U=(await Be(y)).data;Array.isArray(U)?E=U.flatMap(gs=>gs.subServices||[]):U!=null&&U.subServices&&(E=U.subServices)}catch(L){console.error("Error fetching subservices:",L)}Fe({subServices:E});const I=E.find(L=>L.subServiceName===s.subServiceName),$=(I==null?void 0:I.subServiceId)||"",k=(I==null?void 0:I.subServiceName)||"";he($);const ie=Array.isArray(s.procedureQA)?s.procedureQA:JSON.parse(s.procedureQA||"[]"),ne=Array.isArray(s.preProcedureQA)?s.preProcedureQA:JSON.parse(s.preProcedureQA||"[]"),B=Array.isArray(s.postProcedureQA)?s.postProcedureQA:JSON.parse(s.postProcedureQA||"[]"),ce=s.serviceImage||"";ce.startsWith("data:")||`${ce}`,Q({subServiceId:$,subServiceName:k,serviceName:s.serviceName||"",serviceId:y,categoryName:s.categoryName||"",categoryId:d||"",price:s.price||"",discount:s.discountPercentage||0,gst:s.gst||0,consultationFee:s.consultationFee||0,taxPercentage:s.taxPercentage||0,minTime:s.minTime||"",serviceImage:ce,serviceImageFile:null,status:s.status||"",viewDescription:s.viewDescription||"",platformFeePercentage:s.platformFeePercentage||0,viewImage:s.viewImage||"",procedureQA:ie,preProcedureQA:ne,postProcedureQA:B}),ue(formattedQA)},[ts,pe]=n.useState(!1),[Re,as]=n.useState(null),[P,ge]=n.useState({subServiceName:"",serviceName:"",serviceId:"",categoryName:"",price:"",status:"",taxPercentage:"",descriptionQA:"",answers:"",minTime:"",discount:"",viewDescription:"",serviceImage:"",bannerImage:""}),[sr,rr]=n.useState({}),te=async()=>{l(!0),C(null);try{const s=await fs();if(s.data&&Array.isArray(s.data)){const d=s.data.map(p=>({categoryId:p.categoryId,categoryName:p.categoryName}));v(s.data)}else throw new Error("Invalid category data format");const i=localStorage.getItem("HospitalId");if(i){const d=await js(i);Array.isArray(d)?(a(d),console.log(d)):(a([]),console.warn("No subservices found for this hospital."))}else console.warn("No hospitalId found in localStorage."),a([])}catch(s){console.error("Error fetching data:",s),C("Failed to fetch data. Please try again later.")}finally{l(!1)}};n.useEffect(()=>{te()},[]),n.useEffect(()=>{if(q&&(re!=null&&re.descriptionQA)&&typeof re.descriptionQA=="string")try{es(s=>({...s,descriptionQA:JSON.parse(s.descriptionQA)}))}catch{console.error("Invalid QA format")}},[q]),n.useEffect(()=>{(()=>{const i=t.toLowerCase().trim();if(!i){o([]);return}const d=h.filter(p=>{var I,$,k;const x=(I=p.subServiceName)==null?void 0:I.toLowerCase().startsWith(i),y=($=p.serviceName)==null?void 0:$.toLowerCase().startsWith(i),E=(k=p.categoryName)==null?void 0:k.toLowerCase().startsWith(i);return x||y||E});o(d)})()},[t,h]);const is=[{name:"S.No",selector:(s,i)=>i+1,width:"70px",sortable:!1},{name:"Procedure Name",selector:s=>s.subServiceName,sortable:!0,width:"230px"},{name:"Service Name",selector:s=>s.serviceName,width:"230px"},{name:"Category Name",selector:s=>s.categoryName,width:"180px"},{name:"Price",selector:s=>s.price,width:"100px"},{name:"Actions",cell:s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"250px"},children:[e.jsx("div",{color:"primary",onClick:()=>G(s),style:{marginRight:"5px",width:"50px",color:"green"},children:"View"}),e.jsx("div",{color:"primary",onClick:()=>rs(s),style:{marginRight:"5px",width:"50px",color:"blue"},children:"Edit"}),e.jsx("div",{color:"danger",onClick:()=>us(s),style:{width:"50px",color:"red"},children:"Delete"}),e.jsx(ns,{isVisible:ts,message:"Are you sure you want to delete this service?",onConfirm:ms,onCancel:hs})]}),width:"150px",headerStyle:{textAlign:"center"}}],ns=({isVisible:s,message:i,onConfirm:d,onCancel:p})=>e.jsxs(ve,{visible:s,onClose:p,backdrop:!1,children:[e.jsx(Rs,{style:{marginLeft:"200px"},children:" !Alert"}),e.jsx(xe,{style:{textAlign:"center"},children:i}),e.jsxs(fe,{children:[e.jsx(H,{color:"secondary",onClick:p,children:"Cancel"}),e.jsx(H,{color:"danger",onClick:d,children:"Confirm"})]})]}),cs=()=>{const s={};return r.serviceName||(s.serviceName="Service name is required."),r.categoryName||(s.categoryName="Category is required."),r.price?isNaN(r.price)?s.price="price must be a valid number.":parseFloat(r.price)<0&&(s.price="price cannot be a negative number."):s.price="price is required.",r.status||(s.status="Status is required."),(r.gst===""||isNaN(r.gst)||parseFloat(r.gst)<0)&&(s.gst="GST must be a valid number and not negative."),(r.consultationFee===""||isNaN(r.consultationFee)||parseFloat(r.consultationFee)<0)&&(s.consultationFee="Consultation fee must be a valid number and not negative."),!r.discount&&r.discount!==0?s.discount="Discount is required.":parseFloat(r.discount)<0&&(s.discount="Discount cannot be a negative number."),!r.taxPercentage&&r.taxPercentage!==0?s.taxPercentage="taxPercentage is required.":parseFloat(r.taxPercentage)<0&&(s.taxPercentage="taxPercentage cannot be a negative number."),!r.minTime||isNaN(r.minTime)?s.minTime="Minimum time is required and must be a Minutes.":parseFloat(r.minTime)<=0&&(s.minTime="Minimum time must be greater than zero."),r.viewDescription||(s.viewDescription="View description is Required."),r.serviceImage||(console.log("Service Image in Form:",r.serviceImage),s.serviceImage="Please upload a service image."),r.categoryId||(s.categoryId="Please select a valid category."),ge(s),Object.keys(s).length===0},os=async()=>{var ie,ne;console.log("--- handleAddService START ---");const s=r.price*r.discount/100,i=r.price-s,d=i*r.taxPercentage/100,p=r.gst||0,x=i*(r.platformFeePercentage||0)/100,y=i+d-x,E=y+p+(r.consultationFee||0);console.log("Calculated values:",{discountAmount:s,discountedCost:i,taxAmount:d,platformFee:x,clinicPay:y,finalCost:E});const I=await $e(r.serviceImageFile),$=(I==null?void 0:I.split(",")[1])||"";if(!cs()){J.error("Validation failed",{position:"top-right"});return}const k={hospitalId:localStorage.getItem("HospitalId"),subServiceName:r.subServiceName,subServiceId:r.subServiceId,serviceId:r.serviceId,serviceName:r.serviceName,categoryName:r.categoryName,categoryId:r.categoryId,price:r.price,discountPercentage:r.discount,discountAmount:s,discountedCost:i,taxPercentage:r.taxPercentage,taxAmount:d,platformFeePercentage:r.platformFeePercentage,platformFee:x,clinicPay:y,finalCost:E,gst:r.gst,consultationFee:r.consultationFee,minTime:r.minTime,status:r.status,subServiceImage:$,procedureQA:r.procedureQA,preProcedureQA:r.preProcedureQA,postProcedureQA:r.postProcedureQA,viewDescription:r.viewDescription};console.log("Payload ready to submit:",k);try{const B=await ys(k,r.subServiceId);console.log("Response received:",B),B.status===201&&(J.success(B.data.message,{position:"top-right"}),F(!1),te(),bs())}catch(B){console.error("Error in handleAddService:",B.response),J.error((ne=(ie=B.response)==null?void 0:ie.data)==null?void 0:ne.message,{position:"top-right"})}Q({categoryName:"",categoryId:"",serviceName:"",serviceId:"",subServiceId:"",subServiceName:"",price:0,discount:0,gst:0,consultationFee:0,taxPercentage:0,minTime:"",status:"",serviceImage:"",viewDescription:"",procedureQA:[],preProcedureQA:[],postProcedureQA:[],platformFeePercentage:0,descriptionQA:[]}),ue([]),console.log("--- handleAddService END ---")},ls=s=>{const i=parseInt(s,10);if(isNaN(i))return"Invalid time";if(i<60)return`${i} min`;const d=Math.floor(i/60),p=i%60;return p===0?`${d} hour${d>1?"s":""}`:`${d} hour${d>1?"s":""} ${p} min`},ds=async()=>{var s;try{const i=localStorage.getItem("HospitalId");let d="";r.serviceImageFile?d=(await $e(r.serviceImageFile)).split(",")[1]:(s=r.serviceImage)!=null&&s.startsWith("data:")?d=r.serviceImage.split(",")[1]:d=r.serviceImage||"";const p=r.price>0?Number(r.price):0,x={hospitalId:i,subServiceName:r.subServiceName||"",viewDescription:r.viewDescription||"",status:r.status||"",minTime:r.minTime||"",procedureQA:Array.isArray(r.procedureQA)?r.procedureQA:[],preProcedureQA:Array.isArray(r.preProcedureQA)?r.preProcedureQA:[],postProcedureQA:Array.isArray(r.postProcedureQA)?r.postProcedureQA:[],price:r.price||0,discountPercentage:r.discount||0,taxPercentage:r.taxPercentage||0,platformFeePercentage:r.platformFeePercentage||0,subServiceImage:d,gst:r.gst||0,consultationFee:r.consultationFee||0};console.log("Payload for updateSubServiceData:",x);const y=await Ns(Ye,i,x);J.success("SubService updated successfully!",{position:"top-right"}),le(!1),F(!1),te()}catch(i){console.error("Update failed:",i),J.error("Error updating service.",{position:"top-right"})}},$e=s=>new Promise((i,d)=>{const p=new FileReader;p.readAsDataURL(s),p.onload=()=>i(p.result),p.onerror=x=>d(x)}),us=async s=>{console.log(s),as(s.subServiceId),pe(!0)},ms=async()=>{console.log(Re);const s=localStorage.getItem("HospitalId");try{const i=await Ss(Re,s);console.log("Service deleted:",i),J.success("SubService deleted successfully!",{position:"top-right"}),te()}catch(i){console.error("Error deleting service:",i)}pe(!1)},hs=()=>{pe(!1),console.log("Service deletion canceled")},ae=s=>{const{name:i,value:d}=s.target;Q(p=>{if(i==="categoryName"){const x=u.find(y=>y.categoryName===d);return{...p,[i]:d,categoryId:x?x.categoryId:""}}return i==="gst"||i==="consultationFee"||i==="price"||i==="discount"||i==="taxPercentage"||i==="minTime"?{...p,[i]:parseFloat(d)||0}:{...p,[i]:d}}),ge(p=>({...p,[i]:""}))},ps=()=>{Q({serviceName:"",categoryName:"",price:"",discount:0,taxPercentage:0,minTime:"",status:"",serviceImage:"",viewImage:"",viewDescription:"",categoryId:""}),F(!1),ge({})},Le=async s=>{var p;const{name:i,value:d}=s.target;if(i==="categoryName"){const x=u.find(y=>y.categoryId===d);Q(y=>({...y,categoryName:(x==null?void 0:x.categoryName)||"",categoryId:d,serviceName:"",serviceId:""}));try{const E=((p=(await ke.get(`${Ke}/${Ve}/${d}`)).data)==null?void 0:p.data)||[];me(E)}catch(y){console.error("Failed to fetch services:",y),me([])}}else if(i==="serviceName"){const x=Ee.find(E=>E.serviceName===d),y=(x==null?void 0:x.serviceId)||"";if(Q(E=>({...E,serviceName:d,serviceId:y})),y){const I=(await Be(y)).data;let $=[];Array.isArray(I)?$=I.flatMap(k=>k.subServices||[]):I&&I.subServices&&($=I.subServices),Fe({subServices:$})}}else Q(x=>({...x,[i]:d}))};return console.log(r),console.log(f),e.jsxs("div",{style:{overflow:"hidden"},children:[e.jsx(xs,{}),e.jsx("div",{children:e.jsxs(ze,{className:"d-flex justify-content-end mb-3",children:[e.jsxs(Ue,{className:"mb-3",style:{marginRight:"20px",width:"400px"},children:[e.jsx(O,{type:"text",placeholder:"Search by ServiceName, Category",value:t,onChange:s=>c(s.target.value),style:{height:"40px"}}),e.jsx(Ds,{style:{height:"40px"},children:e.jsx(Is,{icon:Ms})})]}),e.jsx(H,{color:"primary",style:{height:"40px"},onClick:()=>ss(),children:"Add Procedure Details"})]})}),f&&e.jsxs(ve,{visible:!!f,onClose:()=>G(null),size:"xl",children:[e.jsx(We,{children:e.jsx(Ge,{className:"w-100 text-center text-primary fs-4",children:"Procedure Details"})}),e.jsxs(xe,{children:[e.jsxs(w,{className:"mb-3",children:[e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Procedure Name:"}),e.jsx("div",{children:f.subServiceName})]}),e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Procedure ID:"}),e.jsx("div",{children:f.subServiceId})]})]}),e.jsxs(w,{className:"mb-3",children:[e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Service Name:"}),e.jsx("div",{children:f.serviceName})]}),e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Service Id:"}),e.jsx("div",{children:f.serviceId})]})]}),e.jsxs(w,{className:"mb-3",children:[e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Category Name:"}),e.jsx("div",{children:f.categoryName})]}),e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Category Id:"}),e.jsx("div",{children:f.categoryId})]})]}),e.jsx(w,{className:"mb-3",children:e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Status:"}),e.jsx("div",{children:f.status})]})}),e.jsx("hr",{}),e.jsxs(w,{className:"mb-3",children:[e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Price:"}),e.jsxs("div",{children:["₹ ",Math.round(f.price)]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Discount %:"}),e.jsxs("div",{children:[Math.round(f.discountPercentage),"%"]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Discount Amount:"}),e.jsxs("div",{children:["₹ ",Math.round(f.discountAmount)]})]})]}),e.jsxs(w,{className:"mb-3",children:[e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Discounted Cost:"}),e.jsxs("div",{children:["₹ ",Math.round(f.discountedCost)]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Tax %:"}),e.jsxs("div",{children:[Math.round(f.taxPercentage),"%"]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Tax Amount:"}),e.jsxs("div",{children:["₹ ",Math.round(f.taxAmount)]})]})]}),e.jsxs(w,{className:"mb-3",children:[e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Platform Fee %:"}),e.jsxs("div",{children:[Math.round(f.platformFeePercentage),"%"]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Platform Fee:"}),e.jsxs("div",{children:["₹ ",Math.round(f.platformFee)]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Clinic Pay:"}),e.jsxs("div",{children:["₹ ",Math.round(f.clinicPay)]})]})]}),e.jsxs(w,{className:"mb-3",children:[e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"GST:"}),e.jsxs("div",{children:["₹ ",Math.round(f.gst)]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Consultation Fee:"}),e.jsxs("div",{children:["₹ ",f.consultationFee]})]}),e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Final Cost:"}),e.jsxs("div",{children:["₹ ",Math.round(f.finalCost)]})]})]}),e.jsx(w,{className:"mb-3",children:e.jsxs(j,{sm:4,children:[e.jsx("strong",{children:"Service Time:"}),e.jsx("div",{children:ls(f.minTime)})]})}),e.jsx("hr",{}),e.jsx(w,{className:"mb-3",children:e.jsxs(j,{sm:12,children:[e.jsx("strong",{className:"mb-3",children:"Pre-Procedure QA:"}),Array.isArray(f.preProcedureQA)&&f.preProcedureQA.length>0?f.preProcedureQA.map((s,i)=>{const d=Object.keys(s)[0],p=s[d];return e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("strong",{children:d}),e.jsx("ul",{children:p.map((x,y)=>e.jsx("li",{children:x},y))})]},i)}):e.jsx("div",{children:"No Pre-Procedure Q&A available"})]})}),e.jsx(w,{className:"mb-3",children:e.jsxs(j,{sm:12,children:[e.jsx("strong",{className:"mb-3",children:"Procedure QA:"}),Array.isArray(f.procedureQA)&&f.procedureQA.length>0?f.procedureQA.map((s,i)=>{const d=Object.keys(s)[0],p=s[d];return e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("strong",{children:d}),e.jsx("ul",{children:p.map((x,y)=>e.jsx("li",{children:x},y))})]},i)}):e.jsx("div",{children:"No Procedure Q&A available"})]})}),e.jsx(w,{className:"mb-3",children:e.jsxs(j,{sm:12,children:[e.jsx("strong",{className:"mb-3",children:"Post-Procedure QA:"}),Array.isArray(f.postProcedureQA)&&f.postProcedureQA.length>0?f.postProcedureQA.map((s,i)=>{const d=Object.keys(s)[0],p=s[d];return e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("strong",{children:d}),e.jsx("ul",{children:p.map((x,y)=>e.jsx("li",{children:x},y))})]},i)}):e.jsx("div",{children:"No Post-Procedure Q&A available"})]})}),e.jsx("hr",{}),e.jsxs(w,{children:[e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"Service Image:"}),f.subServiceImage?e.jsxs("div",{className:"mt-2",children:[e.jsx("img",{src:`data:image/png;base64,${f.subServiceImage}`,alt:"Service",style:{width:"100%",maxWidth:"250px",borderRadius:"8px"}}),Te&&e.jsx("img",{src:Te,alt:"Preview",height:"80",className:"mt-2"})]}):e.jsx("div",{children:"No image available"})]}),e.jsxs(j,{sm:6,children:[e.jsx("strong",{children:"View Description:"}),e.jsx("div",{children:f.viewDescription})]})]})]}),e.jsx(fe,{children:e.jsx(H,{color:"secondary",onClick:()=>G(null),children:"Close"})})]}),e.jsxs(ve,{visible:S,onClose:()=>F(!1),size:"xl",backdrop:"static",children:[e.jsx(We,{children:e.jsx(Ge,{style:{textAlign:"center",width:"100%"},children:Y==="edit"?"Edit Procedure Details":"Add New Procedure Details"})}),e.jsx(xe,{children:e.jsxs(ze,{children:[e.jsxs(w,{className:"mb-4",children:[e.jsxs(j,{md:6,children:[e.jsxs("h6",{children:["Category Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(oe,{value:r.categoryId||"",onChange:Le,"aria-label":"Select Category",name:"categoryName",disabled:Y==="edit",children:[e.jsx("option",{value:"",children:"Select a Category"}),u==null?void 0:u.map(s=>e.jsx("option",{value:s.categoryId,children:s.categoryName},s.categoryId))]}),P.categoryName&&e.jsx(K,{className:"text-danger",children:P.categoryName})]}),e.jsxs(j,{md:6,children:[e.jsxs("h6",{children:["Service Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(oe,{name:"serviceName",value:r.serviceName||"",onChange:Le,disabled:Y==="edit",children:[e.jsx("option",{value:"",children:"Select Service"}),Ee.map(s=>e.jsx("option",{value:s.serviceName,children:s.serviceName},s.serviceId))]}),P.serviceName&&e.jsx(K,{className:"text-danger",children:P.serviceName})]})]}),e.jsxs(w,{className:"mb-4",children:[e.jsxs(j,{md:6,children:[e.jsxs("h6",{children:["Procedure Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(oe,{name:"subServiceId",value:Xe,onChange:s=>{var p;const i=s.target.value;he(i);const d=(p=X==null?void 0:X.subServices)==null?void 0:p.find(x=>x.subServiceId===i);Q(x=>({...x,subServiceId:i,subServiceName:(d==null?void 0:d.subServiceName)||"",preProcedureQA:h.preProcedureQA||[],procedureQA:h.procedureQA||[],postProcedureQA:h.postProcedureQA||[]}))},children:[e.jsx("option",{value:"",children:"Select Sub Service"}),Array.isArray(X.subServices)&&X.subServices.map(s=>e.jsx("option",{value:s.subServiceId,children:s.subServiceName},s.subServiceId))]}),P.subServiceName&&e.jsx(K,{className:"text-danger",children:P.subServiceName})]}),e.jsxs(j,{md:6,children:[e.jsxs("h6",{children:["View Description ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(O,{type:"text",placeholder:"View Description",value:r.viewDescription||"",name:"viewDescription",onChange:ae,maxLength:100}),P.viewDescription&&e.jsx(K,{className:"text-danger",children:P.viewDescription})]})]}),e.jsxs(w,{className:"mb-4",children:[e.jsxs(j,{md:6,children:[e.jsxs("h6",{children:["Status ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(oe,{value:r.status||"",onChange:ae,name:"status",children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"InActive",children:"Inactive"})]}),P.status&&e.jsx(K,{className:"text-danger",children:P.status})]}),e.jsxs(j,{md:6,children:[e.jsxs("h6",{children:["Price ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(O,{type:"number",value:r.price||"",onChange:s=>Q(i=>({...i,price:s.target.value}))}),P.price&&e.jsx(K,{className:"text-danger",children:P.price})]})]}),e.jsxs(w,{className:"mb-4",children:[e.jsxs(j,{md:4,children:[e.jsxs("h6",{children:["Discount % ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(O,{type:"number",placeholder:"Discount",value:r.discount||"",name:"discount",onChange:ae,min:1,onKeyDown:s=>{(s.key==="-"||s.key==="e")&&s.preventDefault()}}),P.discount&&e.jsx(K,{className:"text-danger",children:P.discount})]}),e.jsxs(j,{md:4,children:[e.jsxs("h6",{children:["TaxPercentage % ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(O,{type:"number",placeholder:"Tax Percentage",value:r.taxPercentage||"",name:"taxPercentage",onChange:ae,min:1,onKeyDown:s=>{(s.key==="-"||s.key==="e")&&s.preventDefault()}}),P.taxPercentage&&e.jsx(K,{className:"text-danger",children:P.taxPercentage})]}),e.jsx(j,{children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{children:["Min Time ",e.jsx("span",{className:"text-danger",children:"*"})]})," ",e.jsx(O,{type:"number",name:"minTime",value:r.minTime||"",onChange:s=>Q({...r,minTime:s.target.value}),placeholder:"Must be in Minutes"}),P.minTime&&e.jsx(K,{className:"text-danger",children:P.minTime})]})})]}),e.jsxs(w,{className:"mt-3",children:[e.jsx(j,{md:6,children:e.jsx(O,{label:"GST (%)",type:"number",value:r.gst||"",onChange:s=>Q(i=>({...i,gst:Number(s.target.value)}))})}),e.jsx(j,{md:6,children:e.jsx(O,{label:"Consultation Fee",type:"number",value:r.consultationFee||"",onChange:s=>Q(i=>({...i,consultationFee:Number(s.target.value)}))})})]}),e.jsxs(j,{md:12,children:[e.jsxs("h6",{children:["Service Image ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(O,{type:"file",accept:"image/*",onChange:s=>{const i=s.target.files[0];if(i){const d=new FileReader;d.onloadend=()=>{var x;const p=((x=d.result)==null?void 0:x.split(",")[1])||"";Q(y=>({...y,serviceImage:p,serviceImageFile:i}))},d.readAsDataURL(i)}}}),(r==null?void 0:r.serviceImage)&&e.jsx("img",{src:r.serviceImage.startsWith("data:")?r.serviceImage:`data:image/jpeg;base64,${r.serviceImage}`,alt:"Preview",style:{width:100,height:100,marginTop:10}})]}),e.jsx("h6",{className:"m-3",children:"Procedure (Optional)"}),e.jsx(Ks,{preQAList:r.preProcedureQA,setPreQAList:s=>Q(i=>({...i,preProcedureQA:s})),procedureQAList:r.procedureQA,setProcedureQAList:s=>Q(i=>({...i,procedureQA:s})),postQAList:r.postProcedureQA,setPostQAList:s=>Q(i=>({...i,postProcedureQA:s}))})]})}),e.jsxs(fe,{children:[e.jsx(H,{color:"secondary",onClick:ps,children:"Cancel"}),e.jsx(H,{color:"primary",onClick:Y==="edit"?ds:os,children:Y==="edit"?"Update":"Add"})]})]}),m?e.jsx("div",{style:{display:"flex",justifyContent:"center",height:"300px",fontSize:"1.5rem"},children:"Loading..."}):A?e.jsx("div",{style:{display:"flex",justifyContent:"center",height:"300px",fontSize:"1.5rem"},children:A}):e.jsx(As,{columns:is,data:g.length>0?g:h,pagination:!0,highlightOnHover:!0,pointerOnHover:!0})]})};export{yr as default};
