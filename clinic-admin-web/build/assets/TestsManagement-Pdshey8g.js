import{o as v,B as D,W as ne,X as le,Y as ce,Z as ie,r as a,j as e,Q as de,x as i}from"./index-D4EgioAp.js";import{c as pe,a as d}from"./index.esm--WqZM78H.js";/* empty css                      */import{X as he}from"./index.es-DN_MbvvP.js";import{C as E}from"./CForm-DnvnHnhV.js";import{C as me}from"./CInputGroup-ZOd-amrn.js";import{C as k}from"./CFormInput-Dzx3nEck.js";import{C as ue}from"./CInputGroupText-Ccdw2IMc.js";import{c as xe}from"./cil-search-CDkY_4k-.js";import{C as g,a as N,b as w}from"./CModalHeader-jkZgTmf2.js";import{C as I}from"./CModalTitle-DGQxAg26.js";import{C as X,a as b}from"./CRow-CSRD6VWD.js";import{C as $}from"./CModalFooter-BFk4iTv2.js";import"./CFormLabel-CxEZYpEj.js";import"./CConditionalPortal-DMe4fTxW.js";const je=async n=>{try{const r=await v.get(`${D}/${ne}/${n}`);return console.log("test data:",r.data),r.data}catch(r){throw console.error("Error fetching test data:",r.message),r.response&&(console.error("Error Response Data:",r.response.data),console.error("Error Response Status:",r.response.status)),r}},fe=async n=>{try{const r={testName:n.testName||"",hospitalId:n.hospitalId||""},o=await v.post(`${D}/${le}`,r,{headers:{"Content-Type":"application/json"}});return console.log(o),o.data}catch(r){throw console.error("Error response from API:",r.response),r}},ye=async(n,r,o)=>{try{return(await v.put(`${D}/${ce}/${r}/${o}`,n,{headers:{"Content-Type":"application/json"}})).data}catch(h){throw console.error("Error updating tet:",h),h}},Ce=async(n,r)=>{try{const o=await v.delete(`${D}/${ie}/${n}/${r}`,{headers:{"Content-Type":"application/json"}});return console.log("Test deleted successfully:",o.data),o.data}catch(o){throw console.error("Error deleting tet:",o.response?o.response.data:o),o}},Le=()=>{const[n,r]=a.useState(""),[o,h]=a.useState([]),[M,A]=a.useState([]),[_,B]=a.useState(!1),[F,q]=a.useState(null),[z,j]=a.useState(!1),[f,L]=a.useState(null),[P,y]=a.useState(!1),[p,V]=a.useState(null),[C,R]=a.useState({}),[W,S]=a.useState(!1),[Y,H]=a.useState(null),[m,U]=a.useState({testName:"",hospitalId:""}),[Z,Q]=a.useState(null),u=localStorage.getItem("HospitalId"),J=s=>s.map(t=>({...t,id:t.id||t._id})),T=async s=>{B(!0);try{const t=await je(s);h(J(t.data))}catch{q("Failed to fetch test data.")}finally{B(!1)}},K=async()=>{try{await Ce(Y,Z),i.success("Test deleted successfully!",{position:"top-right"}),T(u)}catch(s){i.error("Failed to delete test."),console.error("Delete error:",s)}S(!1)},O=()=>{H(null),Q(null),S(!1)};a.useEffect(()=>{T(u)},[u]),a.useEffect(()=>{const s=n.toLowerCase().trim();if(!s){A([]);return}const t=o.filter(l=>{var c;return(c=l.testName)==null?void 0:c.toLowerCase().includes(s)});A(t)},[n,o]);const ee=async()=>{var s,t,l,c;if(!m.testName.trim()){R({testName:"Test name is required."});return}try{const x={testName:m.testName,hospitalId:u};await fe(x),i.success("Test added successfully!"),T(u),j(!1),U({testName:""})}catch(x){const G=((t=(s=x.response)==null?void 0:s.data)==null?void 0:t.message)||((l=x.response)==null?void 0:l.statusText)||"An unexpected error occurred.";((c=x.response)==null?void 0:c.status)===409||G.toLowerCase().includes("duplicate")?i.error(`Error: Duplicate test name - ${m.testName} already exists!`,{position:"top-right"}):i.error(`Error adding test: ${G}`,{position:"top-right"})}},se=s=>{V(s),y(!0)},te=async()=>{const{id:s,hospitalId:t}=p;try{await ye(p,s,t),i.success("Test updated successfully!"),y(!1),T(t)}catch(l){console.error("Update error:",l),i.error("Failed to update test.")}},re=s=>{H(s.testId||s.id||s._id),Q(s.hospitalId),S(!0)},oe=[{name:"S.No",selector:(s,t)=>t+1,width:"10%"},{name:"Test Name",selector:s=>s.testName,sortable:!0,width:"45%"},{name:"Actions",cell:s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"250px"},children:[e.jsx("div",{onClick:()=>L(s),style:{color:"green",cursor:"pointer"},children:"View"}),e.jsx("div",{onClick:()=>se(s),style:{color:"blue",cursor:"pointer"},children:"Edit"}),e.jsx("div",{onClick:()=>re(s),style:{color:"red",cursor:"pointer"},children:"Delete"})]})}],ae=({isVisible:s,message:t,onConfirm:l,onCancel:c})=>e.jsxs(g,{visible:s,onClose:c,backdrop:"static",children:[e.jsx(N,{children:e.jsx(I,{children:"Confirmation"})}),e.jsx(w,{children:t}),e.jsxs($,{children:[e.jsx(d,{color:"secondary",onClick:c,children:"Cancel"}),e.jsx(d,{color:"danger",onClick:l,children:"Confirm"})]})]});return e.jsxs("div",{children:[e.jsx(de,{}),e.jsxs(E,{className:"d-flex justify-content-between mb-3",children:[e.jsxs(me,{className:"mb-3",style:{width:"300px",marginLeft:"40px"},children:[e.jsx(k,{type:"text",placeholder:"Search by Test Name",value:n,onChange:s=>r(s.target.value)}),e.jsx(ue,{children:e.jsx(pe,{icon:xe})})]}),e.jsx(d,{color:"primary",style:{marginRight:"100px"},onClick:()=>j(!0),children:"Add Test"})]}),f&&e.jsxs(g,{visible:!!f,onClose:()=>L(null),backdrop:"static",children:[e.jsx(N,{children:e.jsx(I,{children:"Test Details"})}),e.jsxs(w,{children:[e.jsxs(X,{className:"mb-3",children:[e.jsx(b,{sm:4,children:e.jsx("strong",{children:"Test Name:"})}),e.jsx(b,{sm:8,children:f.testName})]}),e.jsxs(X,{className:"mb-3",children:[e.jsx(b,{sm:4,children:e.jsx("strong",{children:"Hospital ID:"})}),e.jsx(b,{sm:8,children:f.hospitalId})]})]})]}),e.jsxs(g,{visible:z,onClose:()=>j(!1),backdrop:"static",children:[e.jsx(N,{children:e.jsx(I,{children:"Add New Test"})}),e.jsx(w,{children:e.jsxs(E,{children:[e.jsxs("h6",{children:["Test Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(k,{type:"text",name:"testName",value:m.testName,onChange:s=>{const t=s.target.value;U({...m,testName:t}),C.testName&&R(l=>({...l,testName:""}))},placeholder:"Enter test name",className:C.testName?"is-invalid":""}),C.testName&&e.jsx("div",{className:"invalid-feedback",style:{color:"red"},children:C.testName})]})}),e.jsxs($,{children:[e.jsx(d,{color:"primary",onClick:ee,children:"Add"}),e.jsx(d,{color:"secondary",onClick:()=>j(!1),children:"Cancel"})]})]}),e.jsxs(g,{visible:P,onClose:()=>y(!1),backdrop:"static",children:[e.jsx(N,{children:e.jsx(I,{children:"Edit Test"})}),e.jsx(w,{children:e.jsxs(E,{children:[e.jsx("h6",{children:"Test Name"}),e.jsx(k,{type:"text",value:(p==null?void 0:p.testName)||"",onChange:s=>V({...p,testName:s.target.value})})]})}),e.jsxs($,{children:[e.jsx(d,{color:"primary",onClick:te,children:"Update"}),e.jsx(d,{color:"secondary",onClick:()=>y(!1),children:"Cancel"})]})]}),e.jsx(ae,{isVisible:W,message:"Are you sure you want to delete this test?",onConfirm:K,onCancel:O}),_?e.jsx("div",{style:{textAlign:"center"},children:"Loading..."}):F?e.jsx("div",{children:F}):e.jsx(he,{columns:oe,data:M.length?M:o,pagination:!0})]})};export{Le as default};
