import{r as n,h as F,j as t}from"./index-Bbof3Raq.js";import{A as D}from"./appointmentAPI-CNP23f_7.js";import{a as C}from"./index.esm-DU0vhm2R.js";import{C as S}from"./CFormCheck-BcXq__90.js";import{C as B,a as E,b as p,c,d as H,e as a}from"./CTable-DrFMuIJT.js";import"./CFormLabel-siHnfzPm.js";import"./CConditionalPortal-Brqyb-aa.js";const _=()=>{const[x,T]=n.useState([]),[b,g]=n.useState(!0),[r,j]=n.useState([]),[R,$]=n.useState([]),y=F(),[d,u]=n.useState([]),[l,h]=n.useState([]),[L,z]=n.useState(1),[M,I]=n.useState([]),[P,k]=n.useState([]),[V,X]=n.useState([]),[q,G]=n.useState([]),[J,N]=n.useState(null),w={"Service & Treatment":"services & treatments","Tele Consultation":"tele consultation","In-clinic":"in-clinic consultation"},f=async e=>{try{const s=await D();if(s&&s.data){const o=e?s.data.filter(m=>i(m.clinicId)===i(e)):s.data;j(o||[]),g(!1)}}catch(s){console.error("Failed to fetch appointments:",s),j([]),g(!1)}};n.useEffect(()=>{const e=localStorage.getItem("HospitalId");e?(N(e),f(e)):(console.warn("No HospitalId found in localStorage. Displaying all relevant appointments."),f(null))},[]);const v=e=>{const s=e.target.value;["Completed","Active"].includes(s)&&(l.includes(s)?h(l.filter(o=>o!==s)):h([...l,s]))};n.useEffect(()=>{let e=r;if(e=e.filter(s=>["completed","active"].includes(i(s.status))),l.length>0&&(e=e.filter(s=>l.some(o=>i(s.status)===i(o)))),d.length===1){const s=d[0];if(s==="Tele Consultation")e=e.filter(o=>i(o.consultationType)==="tele consultation"||i(o.consultationType)==="online consultation");else{const o=w[s];o&&(e=e.filter(m=>i(m.consultationType)===o))}}T(e)},[r,d,l]),n.useEffect(()=>{const e=[...new Set(r.map(o=>o.servicename).filter(Boolean))],s=[...new Set(r.map(o=>o.consultationType).filter(Boolean))];I(e),k(s),console.log("Available Consultation Types:",s)},[r]);const A=e=>{d.includes(e)?u([]):u([e])};n.useEffect(()=>{const e=localStorage.getItem("HospitalId");e?f(e):console.warn("No HospitalId in localStorage")},[]);const i=e=>e==null?void 0:e.toLowerCase().trim();return t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("div",{className:"container mt-4",children:[t.jsx("h5",{className:"mb-3",children:"Appointments"}),t.jsx("div",{className:"d-flex gap-2 mb-3",children:["Service & Treatment","In-clinic","Tele Consultation"].map(e=>t.jsx("button",{onClick:()=>A(e),className:`btn ${d.includes(e)?"btn-dark":"btn-outline-dark"}`,children:e},e))}),t.jsx("div",{className:"mb-3",children:t.jsx(C,{color:"secondary",onClick:()=>{u([]),h([])},children:"Reset Filters"})}),t.jsxs("div",{className:"d-flex gap-3 mb-3",children:[t.jsx(S,{label:"Completed",value:"Completed",onChange:v,checked:l.includes("Completed")}),t.jsx(S,{label:"Active",value:"Active",onChange:v,checked:l.includes("Active")})]}),t.jsxs(B,{striped:!0,hover:!0,responsive:!0,children:[t.jsx(E,{children:t.jsxs(p,{children:[t.jsx(c,{children:"S.No"}),t.jsx(c,{children:"Name"}),t.jsx(c,{children:"Consultation Type"}),t.jsx(c,{children:"Date"}),t.jsx(c,{children:"Time"}),t.jsx(c,{children:"Status"}),t.jsx(c,{children:"Action"})]})}),t.jsx(H,{children:b?t.jsx(p,{children:t.jsx(a,{colSpan:"8",className:"text-center text-info fw-bold",children:"Loading reports..."})}):x.length>0?x.map((e,s)=>t.jsxs(p,{children:[t.jsx(a,{children:s+1}),t.jsx(a,{children:e.name}),t.jsx(a,{children:e.consultationType}),t.jsx(a,{children:e.serviceDate}),t.jsx(a,{children:e.slot||e.servicetime}),t.jsx(a,{children:e.status}),t.jsx(a,{children:t.jsx(C,{color:"info",size:"sm",onClick:()=>y(`/reportDetails/${e.bookingId}`,{state:{report:e,appointmentInfo:{name:e.name,age:e.age,gender:e.gender,problem:e.problem,bookingId:e.bookingId,item:e}}}),children:"View"})})]},`${e.bookingId}-${s}`)):t.jsx(p,{children:t.jsx(a,{colSpan:"8",className:"text-center text-danger fw-bold",children:"No appointments found."})})})]})]})})};export{_ as default};
