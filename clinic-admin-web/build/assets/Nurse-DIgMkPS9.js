import{r as v,a as je,j as e,B as x,h as ae,i as te,b as be,R as Ne}from"./index-BZd6-648.js";import{v as N,a as Z,f as xe}from"./Validators-FoVLkSgm.js";import{c as $}from"./capitalizeWords-CuwF8AcI.js";import{U as ge}from"./UserPermissionModal-CI7dZmvK.js";import{C as ce,a as de,b as me}from"./CModalHeader-Durv8XK2.js";import{C as Ce}from"./CModalTitle-CQh3zxe_.js";import{C as ye}from"./CForm-qjDyPqIY.js";import{C as h}from"./CFormLabel-CWNs-Shv.js";import{C as f}from"./CFormInput-Ck0ix0GZ.js";import{C as ne}from"./CFormSelect-DCAectsn.js";import{C as ke}from"./CFormTextarea-1_ucRcIb.js";import{b as M}from"./index.esm-BZe2opj0.js";import{C as ve}from"./CModalFooter-CnaQ0PLi.js";import{C as De}from"./ConfirmationModal-DxV_gve6.js";import{L as Ae}from"./loader-Dx4sjdu_.js";import{C as we,a as Se,b as oe,c as F,d as Pe,e as I}from"./CTable-BxVenPcb.js";import{E as Ie}from"./eye-b51ggR7A.js";import{P as Fe,T as Me}from"./trash-2-rbTdXEzu.js";import"./CNavItem-wDeXchN9.js";const Oe=({visible:y,onClose:D,onSave:z,initialData:S,viewMode:O,nurses:p,fetchNurses:ue})=>{const E={},A={hospitalId:localStorage.getItem("HospitalId"),branchId:localStorage.getItem("branchId"),hospitalName:localStorage.getItem("HospitalName"),fullName:"",gender:"Female",dateOfBirth:"",nurseContactNumber:"",emailId:"",governmentId:"",qualifications:"",dateOfJoining:"",department:"",yearsOfExperience:"",specialization:"",shiftTimingOrAvailability:"",role:"nurse",address:{houseNo:"",street:"",landmark:"",city:"",state:"",postalCode:"",country:"India"},emergencyContactNumber:"",bankAccountDetails:{accountNumber:"",accountHolderName:"",ifscCode:"",bankName:"",branchName:"",panCardNumber:""},medicalFitnessCertificate:"",profilePicture:"",nursingLicense:"",nursingDegreeOrDiplomaCertificate:"",nursingCouncilRegistration:"",nursePreviousEmploymentHistory:"",experienceCertificates:"",vaccinationStatus:!0,insuranceOrESIdetails:{policyOrEsiNumber:"",providerName:"",type:"",status:""},permissions:E},[t,C]=v.useState(A),[G,re]=v.useState(localStorage.getItem("HospitalId")),[B,V]=v.useState(!1),[Q,R]=v.useState(!1),[T,_]=v.useState(null),[K,L]=v.useState(!1),[o,j]=v.useState({}),{user:le}=je(),H=["fullName","gender","dateOfBirth","nurseContactNumber","emailId","governmentId","dateOfJoining","department","yearsOfExperience","hospitalId","vaccinationStatus","profilePicture","role","nursingLicense","nursingCouncilRegistration","nursingDegreeOrDiplomaCertificate","address.houseNo","address.street","address.city","address.state","address.postalCode","address.country","bankAccountDetails.accountNumber","bankAccountDetails.accountHolderName","bankAccountDetails.bankName","bankAccountDetails.branchName","bankAccountDetails.ifscCode","bankAccountDetails.panCardNumber"];function q(s,r){const a=[];for(const l of r){const c=l.split(".");let i=s;for(const g of c)i=i==null?void 0:i[g];(!i||String(i).trim()==="")&&a.push(l)}return a}const U=s=>{C(r=>{const a={...r.permissions};return a[s]?delete a[s]:a[s]=[],{...r,permissions:a}})},X=(s,r)=>{C(a=>{const l={...a.permissions};return l[s]||(l[s]=[]),l[s].includes(r)?l[s]=l[s].filter(c=>c!==r):l[s]=[...l[s],r],{...a,permissions:l}})},ee=s=>{C(r=>{const a={...r.permissions};return a[s]?a[s].length===Z.length?a[s]=[]:a[s]=[...Z]:a[s]=[...Z],{...r,permissions:a}})},J=s=>new Promise((r,a)=>{const l=new FileReader;l.readAsDataURL(s),l.onload=()=>{const i=l.result.split(",")[1];r(i)},l.onerror=c=>a(c)});v.useEffect(()=>{C(S||A)},[S]);const u=(s,r)=>{C(a=>({...a,[s]:r}))},n=(s,r,a)=>{C(l=>({...l,[s]:{...l[s],[r]:a}}))},d=(s,r)=>{const a=s.target.files[0];if(!a)return;const l=new FileReader;l.onloadend=()=>{C(c=>({...c,[r]:l.result,[`${r}Name`]:a.name,[`${r}Type`]:a.type}))},l.readAsDataURL(a)},k=()=>{const s=q(t,H);if(s.length>0){x.error(`Please fill required fields: ${s.join(", ")}`);return}if(t.dob){const i=new Date(t.dob),g=new Date,b=g.getFullYear()-i.getFullYear();if((g.getMonth()<i.getMonth()||g.getMonth()===i.getMonth()&&g.getDate()<i.getDate()?b-1:b)<18){x.error("Nurse must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(t.nurseContactNumber)){x.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.emailId)){x.error("Please enter a valid email address.");return}if(p==null?void 0:p.some(i=>i.nurseContactNumber===t.nurseContactNumber&&i.id!==t.id)){x.error("Contact number already exists!");return}if(p==null?void 0:p.some(i=>i.email===t.emailId&&i.id!==t.id)){x.error("Email already exists!");return}if(Object.keys(t.permissions).length===0){x.error("Please assign at least one user permission before saving.");return}console.log("Saving nurse data:",t),z(t),C(A),D()},P=()=>{const s=q(t,H);if(s.length>0){x.error(`Please fill required fields: ${s.join(", ")}`);return}if(t.dob){const i=new Date(t.dob),g=new Date,b=g.getFullYear()-i.getFullYear();if((g.getMonth()<i.getMonth()||g.getMonth()===i.getMonth()&&g.getDate()<i.getDate()?b-1:b)<18){x.error("Nurse must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(t.nurseContactNumber)){x.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.emailId)){x.error("Please enter a valid email address.");return}if(p==null?void 0:p.some(i=>i.nurseContactNumber===t.nurseContactNumber&&i.id!==t.id)){x.error("Contact number already exists!");return}if(p==null?void 0:p.some(i=>i.email===t.emailId&&i.id!==t.id)){x.error("Email already exists!");return}console.log("Nurse data ready for permissions:",t),R(!0)},W=()=>{V(!1),_(null),L(!1)},Y=(s,r)=>{_(s),L(r==null?void 0:r.includes("pdf")),V(!0)},w=({title:s,children:r})=>e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-semibold border-b pb-2 mb-4",children:s}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:r})]}),m=({label:s,value:r})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:r||"N/A"})]}),he=({label:s,value:r})=>e.jsxs("div",{className:"col-span-3",children:[s&&e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:r||"N/A"})]}),fe=(s,r="image/png")=>s?s.startsWith("data:")?s:`data:${r};base64,${s}`:null,ie=({label:s,type:r,data:a})=>{if(!a)return e.jsxs("p",{children:[s," "]});const l=r==null?void 0:r.startsWith("image/"),c=a.startsWith("data:")?a:`data:${r};base64,${a}`;return e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsxs("strong",{children:[s,":"]}),e.jsxs("div",{className:"mt-2",children:[l?e.jsx("img",{src:c,alt:s,className:"w-32 h-32 object-cover rounded-md border cursor-pointer",onClick:()=>Y(c,r)}):e.jsx("button",{type:"button ",className:" btn text-blue-600 hover:underline block mx-2",onClick:()=>Y(c,r),style:{backgroundColor:"var(--color-black)",color:"white"},children:"Preview"}),e.jsx("a",{href:c,download:s.replace(/\s+/g,"_"),className:"text-green-600 hover:underline text-sm block  btn",style:{backgroundColor:"var(--color-black)",color:"white"},children:"Download"})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(ce,{visible:y,onClose:D,size:"lg",className:"custom-modal",backdrop:"static",children:[e.jsx(de,{children:e.jsx(Ce,{children:O?"Personal Information":"Add / Edit  Nurse"})}),e.jsx(me,{children:O?e.jsxs("div",{className:"p-4 border rounded shadow-sm bg-white ",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Name : "}),e.jsx("span",{children:t.fullName})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold",children:"Email : "}),e.jsx("span",{children:t.emailId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-bold",children:"Cantact : "}),e.jsx("span",{children:t.nurseContactNumber})]})]}),e.jsxs("div",{className:"text-center",children:[t.profilePicture?e.jsx("img",{src:fe(t.profilePicture,t.profilePictureType),alt:t.fullName,width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsxs("div",{style:{color:"var(--color-black)",marginTop:"5px",fontSize:"14px",fontWeight:"500"},children:["ID: ",t.id]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-5 mt-5",children:[e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Full Name",value:t.fullName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Email",value:t.emailId})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Contact",value:t.nurseContactNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Gender",value:t.gender})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Date of Birth",value:t.dateOfBirth})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Government ID",value:t.governmentId})})]}),e.jsx(w,{title:"Work Information",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Date of Joining",value:t.dateOfJoining})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Department",value:t.department})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Experience",value:t.yearsOfExperience})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Qualifications",value:t.qualifications})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Shift Timings",value:t.shiftTimingOrAvailability})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Emergency Contact",value:t.emergencyContactNumber})})]})}),e.jsx(w,{title:"Address",children:e.jsx(he,{value:`${t.address.houseNo}, ${t.address.street}, ${t.address.city}, ${t.address.state} - ${t.address.postalCode}, ${t.address.country}`})}),e.jsx(w,{title:"Bank Details",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Account Number",value:t.bankAccountDetails.accountNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Account Holder Name",value:t.bankAccountDetails.accountHolderName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"IFSC Code",value:t.bankAccountDetails.ifscCode})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Bank Name",value:t.bankAccountDetails.bankName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Branch Name",value:t.bankAccountDetails.branchName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"PAN Card",value:t.bankAccountDetails.panCardNumber})})]})}),e.jsx(w,{title:"Documents",children:e.jsxs("div",{className:"row",children:[t.qualificationOrCertifications!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(ie,{label:"Qualification / NursingDegreeOrDiplomaCertificate",type:t.nursingDegreeOrDiplomaCertificateType,data:t.nursingDegreeOrDiplomaCertificate})}):e.jsx("p",{className:"col-md-6",children:"Not Provided qualification/Certifications"}),t.medicalFitnessCertificate!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(ie,{label:"Medical Fitness Certificate",type:t.medicalFitnessCertificate||"application/pdf",data:t.medicalFitnessCertificate})}):e.jsx("p",{className:"col-md-6",children:"Not Provided Medical Fitness Certificate"}),t.nursingCouncilRegistration!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(ie,{label:"Nursing Council Registration",type:t.nursingCouncilRegistration||"application/pdf",data:t.nursingCouncilRegistration})}):e.jsx("p",{className:"col-md-6",children:"Nursing Council Registration not provided"})]})}),e.jsx("div",{className:"mt-4"}),e.jsx(w,{title:"Other Information",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(m,{label:"Vaccination Status",value:t.vaccinationStatus})}),e.jsx("div",{className:"col-md-12",children:e.jsx(he,{label:"Previous Employment",value:t.previousEmploymentHistory})})]})})]})]}):e.jsxs(ye,{children:[e.jsx("h5",{children:"Basic Information"}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-5",children:[e.jsxs(h,{children:["ClinicID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{value:G,disabled:!0,onChange:s=>u("clinicId",s.target.value)})]}),e.jsxs("div",{className:"col-md-7",children:[e.jsxs(h,{children:["Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{value:t.role,disabled:!0,onChange:s=>u("role",s.target.value)})]})]})}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Full Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{value:t.fullName,onChange:s=>{const r=s.target.value;u("fullName",r);const a=N("fullName",r);j(l=>({...l,fullName:a}))}}),o.fullName&&e.jsx("div",{className:"text-danger mt-1",children:o.fullName})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Gender ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(ne,{value:t.gender,onChange:s=>u("gender",s.target.value),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Date of Birth ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{type:"date",value:t.dateOfBirth,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],onChange:s=>u("dateOfBirth",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Contact Number ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{type:"text",maxLength:10,value:t.nurseContactNumber,onChange:s=>{const r=s.target.value;/^\d*$/.test(r)&&u("nurseContactNumber",r);const a=N("nurseContactNumber",r);j(l=>({...l,nurseContactNumber:a}))}}),o.nurseContactNumber&&e.jsx("small",{className:"text-danger",children:o.nurseContactNumber})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Email ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{type:"email",value:t.emailId,onChange:s=>{const r=s.target.value;u("emailId",r);const a=N("emailId",r);j(l=>({...l,emailId:a}))}}),o.emailId&&e.jsx("small",{className:"text-danger",children:o.emailId})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["GovernmentID(AadharCard No) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{maxLength:12,value:t.governmentId,onChange:s=>{const r=s.target.value;if(/^\d*$/.test(r)){u("governmentId",r);const a=N("governmentId",r);j(l=>({...l,governmentId:a}))}}}),o.governmentId&&e.jsx("small",{className:"text-danger",children:o.governmentId})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Nursing Council Registration",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{value:$(t.nursingCouncilRegistration),onChange:s=>{const r=s.target.value;u("nursingCouncilRegistration",r);const a=N("nursingCouncilRegistration",r);j(l=>({...l,nursingCouncilRegistration:a}))}}),o.nursingCouncilRegistration&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem"},children:o.nursingCouncilRegistration})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Date of Joining ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{type:"date",value:t.dateOfJoining,onChange:s=>{const r=s.target.value;u("dateOfJoining",r);const a=N("dateOfJoining",r);j(l=>({...l,dateOfJoining:a}))}}),o.dateOfJoining&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem"},children:o.dateOfJoining})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Department",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{value:$(t.department),onChange:s=>{const r=s.target.value;u("department",r);const a=N("department",r);j(l=>({...l,department:a}))}}),o.department&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem"},children:o.department})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Years of Experience ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{type:"number",value:t.yearsOfExperience,onChange:s=>{const r=s.target.value;u("yearsOfExperience",r);const a=N("yearsOfExperience",r);j(l=>({...l,yearsOfExperience:a}))}}),o.yearsOfExperience&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem"},children:o.yearsOfExperience})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(h,{children:"Qualifications"}),e.jsx(f,{value:$(t.qualifications),onChange:s=>{const r=s.target.value;u("qualifications",r);const a=N("qualifications",r);j(l=>({...l,qualifications:a}))}}),o.qualifications&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem"},children:o.qualifications})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Shift Timings / Availability ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(ne,{value:t.shiftTimingOrAvailability,onChange:s=>{const r=s.target.value;u("shiftTimingOrAvailability",r);const a=N("shiftTimingOrAvailability",r);j(l=>({...l,shiftTimingOrAvailability:a}))},children:[e.jsx("option",{value:"",children:"Select Shift"}),e.jsx("option",{value:"06:00-12:00",children:"Morning (06:00 AM – 12:00 PM) – 6 hrs"}),e.jsx("option",{value:"12:00-18:00",children:"Afternoon (12:00 PM – 06:00 PM) – 6 hrs"}),e.jsx("option",{value:"18:00-00:00",children:"Evening (06:00 PM – 12:00 AM) – 6 hrs"}),e.jsx("option",{value:"00:00-06:00",children:"Night (12:00 AM – 06:00 AM) – 6 hrs"}),e.jsx("option",{value:"06:00-15:00",children:"Day Shift (06:00 AM – 03:00 PM) – 9 hrs"}),e.jsx("option",{value:"15:00-00:00",children:"Evening Shift (03:00 PM – 12:00 AM) – 9 hrs"}),e.jsx("option",{value:"21:00-06:00",children:"Night Shift (09:00 PM – 06:00 AM) – 9 hrs"}),e.jsx("option",{value:"06:00-18:00",children:"Long Day (06:00 AM – 06:00 PM) – 12 hrs"}),e.jsx("option",{value:"18:00-06:00",children:"Long Night (06:00 PM – 06:00 AM) – 12 hrs"})]}),o.shiftTimingOrAvailability&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem"},children:o.shiftTimingOrAvailability})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(h,{children:"Emergency Contact"}),e.jsx(f,{type:"text",maxLength:10,value:t.emergencyContactNumber,onChange:s=>{const r=s.target.value;if(/^\d*$/.test(r)){u("emergencyContactNumber",r);const a=N("emergencyContactNumber",r);j(l=>({...l,emergencyContactNumber:a}))}}}),o.emergencyContactNumber&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem"},children:o.emergencyContactNumber})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{children:["Vaccination Status ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(ne,{value:t.vaccinationStatus,onChange:s=>{const r=s.target.value;u("vaccinationStatus",r);const a=N("vaccinationStatus",r);j(l=>({...l,vaccinationStatus:a}))},children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Not Vaccinated",children:"Not Vaccinated"}),e.jsx("option",{value:"Partially Vaccinated",children:"Partially Vaccinated"}),e.jsx("option",{value:"Fully Vaccinated",children:"Fully Vaccinated"})]}),o.vaccinationStatus&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem"},children:o.vaccinationStatus})]})]}),e.jsx("h5",{className:"mt-3",children:"Address"}),Object.keys(t.address).reduce((s,r,a)=>(a%3===0&&s.push([]),s[s.length-1].push(r),s),[]).map((s,r)=>e.jsx("div",{className:"row mb-3",children:s.map(a=>{var l;return e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{className:"text-capitalize",children:[a," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{type:"text",maxLength:a==="postalCode"?6:void 0,value:$(t.address[a]),onChange:c=>{let i=c.target.value;if(a==="postalCode"){if(/^\d*$/.test(i)){n("address",a,i);const g=N(a,i,t);j(b=>({...b,address:{...b.address,[a]:g}}))}}else{n("address",a,i);const g=N(a,i,t);j(b=>({...b,address:{...b.address,[a]:g}}))}}}),((l=o.address)==null?void 0:l[a])&&e.jsx("div",{className:"text-danger mt-1",children:o.address[a]})]},a)})},r)),e.jsx("h5",{className:"mt-3",children:"Bank Account Details"}),Object.keys(t.bankAccountDetails).reduce((s,r,a)=>(a%3===0&&s.push([]),s[s.length-1].push(r),s),[]).map((s,r)=>e.jsx("div",{className:"row mb-3",children:s.map(a=>{var l;return e.jsxs("div",{className:"col-md-4",children:[e.jsxs(h,{className:"text-capitalize",children:[a," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{value:t.bankAccountDetails[a],maxLength:a==="accountNumber"?20:a==="panCardNumber"?10:a==="ifscCode"?11:void 0,onChange:async c=>{let i=c.target.value;a==="accountNumber"?/^\d*$/.test(i)&&n("bankAccountDetails",a,i):a==="panCardNumber"?(i=i.toUpperCase(),/^[A-Z]{0,5}[0-9]{0,4}[A-Z]{0,1}$/.test(i)&&n("bankAccountDetails",a,i)):a==="ifscCode"?(i=i.toUpperCase(),/^[A-Z0-9]*$/.test(i)&&n("bankAccountDetails",a,i)):n("bankAccountDetails",a,i);const g=N(a,i,t);j(b=>({...b,bankAccountDetails:{...b.bankAccountDetails,[a]:g}}))},onBlur:async()=>{const c=t.bankAccountDetails[a],i=N(a,c,t);if(j(g=>({...g,bankAccountDetails:{...g.bankAccountDetails,[a]:i}})),a==="panCardNumber"&&c.length===10&&(/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(c)||x.error("Invalid PAN format (e.g., ABCDE1234F)")),a==="ifscCode"&&c.length===11)if(!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(c))x.error("Invalid IFSC format (e.g., HDFC0001234)"),n("bankAccountDetails","bankName",""),n("bankAccountDetails","branchName","");else try{const b=await fetch(`https://ifsc.razorpay.com/${c}`);if(b.ok){const se=await b.json();n("bankAccountDetails","bankName",se.BANK||""),n("bankAccountDetails","branchName",se.BRANCH||"")}}catch{x.error("Error fetching bank details"),n("bankAccountDetails","bankName",""),n("bankAccountDetails","branchName","")}}}),((l=o.bankAccountDetails)==null?void 0:l[a])&&e.jsx("div",{className:"text-danger mt-1",children:o.bankAccountDetails[a]})]},a)})},r)),e.jsx("h5",{className:"mt-3",children:"Documents"}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsxs(h,{children:["Profile Image ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{type:"file",accept:"image/*",onChange:async s=>{const r=s.target.files[0];if(r){const a=await J(r);u("profilePicture",a);const l=N("profilePicture",a);j(c=>({...c,profilePicture:l}))}else u("profilePicture",""),j(a=>({...a,profilePicture:"Profile Image is required."}))}}),o.profilePicture&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem"},children:o.profilePicture})]}),e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsxs(h,{children:["Nursing License ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:async s=>{const r=s.target.files[0];if(!r)return;const a=await J(r);u("nursingLicense",a);const l=N("nursingLicense",a);j(c=>({...c,nursingLicense:l}))}}),o.nursingLicense&&e.jsx("div",{style:{color:"red",fontSize:"0.8rem"},children:o.nursingLicense})]}),e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx(h,{children:"Medical Fitness Certificate"}),e.jsx(f,{type:"file",onChange:s=>d(s,"medicalFitnessCertificate")})]}),e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsxs(h,{children:["Qualification/Nursing Certificate",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{type:"file",onChange:s=>d(s,"nursingDegreeOrDiplomaCertificate")})]})]}),e.jsx(h,{children:"Previous Employment History"}),e.jsx(ke,{rows:3,value:t.nursePreviousEmploymentHistory,onChange:s=>u("nursePreviousEmploymentHistory",s.target.value)}),e.jsx("div",{className:"mb-3 w-100 mt-4",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(M,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:P,children:"User Permissions"})}),e.jsx(ge,{show:Q,onClose:()=>R(!1),features:xe,actions:Z,permissions:t.permissions,toggleFeature:U,toggleAllActions:ee,togglePermission:X,onSave:()=>{console.log("Saved Permissions",t.permissions),R(!1)}}),e.jsx(ge,{show:Q,onClose:()=>R(!1),features:xe,actions:Z,permissions:t.permissions,toggleFeature:U,toggleAllActions:ee,togglePermission:X,onSave:()=>{console.log("Saved Permissions",t.permissions),R(!1)}})]})}),e.jsx(ve,{children:O?e.jsx(M,{color:"secondary",onClick:D,children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(M,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)"},onClick:()=>C(A),children:"Clear"}),e.jsx(M,{color:"secondary",onClick:D,children:"Cancel"}),e.jsx(M,{style:{backgroundColor:"var(--color-black)",color:"white"},onClick:k,children:"Save"})]})})]}),e.jsxs(ce,{visible:B,onClose:W,size:"xl",children:[e.jsx(de,{onClose:W,children:e.jsx("strong",{children:K?"PDF Preview":"Image Preview"})}),e.jsx(me,{className:"text-center",children:K?e.jsx("iframe",{src:T,title:"PDF Preview",style:{width:"100%",height:"80vh",border:"none"}}):e.jsx("img",{src:T,alt:"Preview",style:{maxWidth:"100%",maxHeight:"80vh",borderRadius:"8px"}})})]})]})},Ee=y=>ae.post(`${te}/addNurse`,y),Re=y=>ae.get(`${te}/getAllNurses/${y}`),$e=(y,D,z)=>ae.put(`${te}/updateNurse/${y}/${D}`,z),Be=(y,D)=>ae.delete(`${te}/deleteNurse/${y}/${D}`),ts=()=>{const[y,D]=v.useState([]),[z,S]=v.useState(!1),[O,p]=v.useState(null),[ue,E]=v.useState(!1),[A,t]=v.useState(1),[C]=v.useState(10),{searchQuery:G}=be(),[re,B]=v.useState(!1),[V,Q]=v.useState(null),[R,T]=v.useState(!1),[_,K]=v.useState(null),{user:L}=je(),o=(n,d)=>{var k,P;return(P=(k=L==null?void 0:L.permissions)==null?void 0:k[n])==null?void 0:P.includes(d)},[j,le]=v.useState(!1),[H,q]=v.useState(null),U=async()=>{var n;B(!0);try{const d=localStorage.getItem("HospitalId");if(d){const k=await Re(d);D(((n=k.data)==null?void 0:n.data)||[])}}catch(d){console.error("Error fetching nurses:",d),D([]),Q("Failed to load nurses.")}finally{B(!1)}};v.useEffect(()=>{U()},[]);const X=async n=>{var d,k,P,W,Y;B(!0);try{const w=localStorage.getItem("HospitalId");if(O)await $e(w,O.nurseId,n),x.success("Nurse updated successfully!");else{const m=await Ee(n);(k=(d=m.data)==null?void 0:d.data)!=null&&k.userName&&((W=(P=m.data)==null?void 0:P.data)!=null&&W.password)&&(q({username:m.data.data.userName,password:m.data.data.password}),le(!0)),x.success("Nurse added successfully!")}U(),S(!1),p(null),E(!1)}catch(w){w.response?x.error(((Y=w.response.data)==null?void 0:Y.message)||"Failed to save nurse."):x.error("Failed to save nurse.")}finally{B(!1)}},ee=async n=>{try{const d=localStorage.getItem("HospitalId");if(!d||!n){x.error("Missing hospitalId or nurseId");return}await Be(d,n),D(k=>k.filter(P=>P.nurseId!==n)),x.success("Nurse deleted successfully!")}catch(d){x.error("Failed to delete nurse."),console.error("Delete error:",d)}finally{T(!1)}},J=Ne.useMemo(()=>{const n=G.toLowerCase().trim();return n?y.filter(d=>Object.values(d).some(k=>String(k).toLowerCase().includes(n))):y},[G,y]),u=J.slice((A-1)*C,A*C);return e.jsxs("div",{children:[o("Nurses","create")&&e.jsx("div",{className:"mb-3 d-flex justify-content-end",children:e.jsx(M,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>{p(null),E(!1),S(!0)},children:"Add Nurse"})}),e.jsxs(ce,{visible:j,backdrop:"static",keyboard:!1,children:[e.jsx(de,{children:e.jsx("h5",{children:"Nurse Credentials"})}),e.jsx(me,{children:H?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",H.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," ",H.password]}),e.jsx("small",{className:"text-danger",children:"⚠️ Please save these credentials securely. They will not be shown again."})]}):e.jsx("p",{children:"No data available"})}),e.jsx(ve,{children:e.jsx(M,{color:"primary",onClick:()=>{le(!1),q(null)},children:"Close"})})]}),e.jsx(De,{isVisible:R,title:"Delete Nurse",message:"Are you sure you want to delete this nurse? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>ee(_),onCancel:()=>T(!1)}),re?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(Ae,{message:"Loading nurses..."})}):V?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh"},children:V}):e.jsxs(we,{className:"mt-3",striped:!0,hover:!0,responsive:!0,children:[e.jsx(Se,{children:e.jsxs(oe,{className:"pink-table",children:[e.jsx(F,{children:"#"}),e.jsx(F,{children:"Photo"}),e.jsx(F,{children:"Name"}),e.jsx(F,{children:"Contact"}),e.jsx(F,{children:"Sex"}),e.jsx(F,{children:"Qualification"}),e.jsx(F,{children:"Date Of Joining"}),e.jsx(F,{className:"text-end",children:"Actions"})]})}),e.jsx(Pe,{children:u.length>0?u.map((n,d)=>e.jsxs(oe,{children:[e.jsx(I,{children:(A-1)*C+d+1}),e.jsx(I,{children:n.profilePicture?e.jsx("img",{src:n.profilePicture?n.profilePicture.startsWith("data:")?n.profilePicture:`data:image/png;base64,${n.profilePicture}`:"/assets/images/default-avatar.png",alt:n.fullName||"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}})}),e.jsx(I,{children:$(n.fullName)}),e.jsx(I,{children:$(n.nurseContactNumber)}),e.jsx(I,{children:$(n.gender)}),e.jsx(I,{children:n.qualifications||"NA"}),e.jsx(I,{children:n.dateOfJoining}),e.jsx(I,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[o("Nurses","read")&&e.jsx("button",{className:"actionBtn",onClick:()=>{p(n),E(!0),S(!0)},title:"View",children:e.jsx(Ie,{size:18})}),o("Nurses","update")&&e.jsx("button",{className:"actionBtn",onClick:()=>{p(n),E(!1),S(!0)},title:"Edit",children:e.jsx(Fe,{size:18})}),o("Nurses","delete")&&e.jsx("button",{className:"actionBtn",onClick:()=>{K(n.nurseId),T(!0)},title:"Delete",children:e.jsx(Me,{size:18})})]})})]},n.nurseId)):e.jsx(oe,{children:e.jsx(I,{colSpan:"8",className:"text-center",children:"No nurse found."})})})]}),!re&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(J.length/C)},(n,d)=>e.jsx(M,{style:{backgroundColor:A===d+1?"var(--color-black)":"#fff",color:A===d+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>t(d+1),children:d+1},d))}),e.jsx(Oe,{visible:z,onClose:()=>{S(!1),p(null),E(!1)},onSave:X,initialData:O,viewMode:ue})]})};export{ts as default};
