import{r as x,j as e,B as m,v as ie,T as X,z as he,n as ue,i as xe,R as je}from"./index-C7YuJAAI.js";import{f as be,a as z}from"./Features-D45jZVjg.js";import{c as K}from"./capitalizeWords-CuwF8AcI.js";import{C as le,a as re,b as ce}from"./CModalHeader-Bku5iNpS.js";import{C as pe}from"./CModalTitle-CrSU8CaH.js";import{C as ge}from"./CForm-B3RLrqng.js";import{C as u}from"./CFormLabel-C_a-pvv2.js";import{C as b}from"./CFormInput-CNM-faD4.js";import{C as fe}from"./CFormSelect-DDyQ53N9.js";import{C as ve}from"./CFormTextarea-CsOwBSQs.js";import{a as B}from"./index.esm-B3sb08FX.js";import{C as ne}from"./CModalFooter-BtK5r1_p.js";import{C as Ne}from"./ConfirmationModal-Dkioqmh-.js";import{L as ye}from"./loader-CAA1vNCh.js";import{C as Ce,a as Pe,b as te,c as S,d as ke,e as w}from"./CTable-nsP1Y0CA.js";import{E as we}from"./eye--1BT-mqr.js";import{P as De,T as Ie}from"./trash-2-BXEuflO5.js";import"./CNavItem-BHTEVeIb.js";import"./createLucideIcon-Cqvp34RQ.js";const Ae=({visible:f,onClose:C,onSave:ee,editData:E,initialData:P,viewMode:F,pharmacists:v,fetchTechs:J})=>{const R={viewPatients:!1,manageInventory:!1,accessReports:!1},k={hospitalId:localStorage.getItem("HospitalId"),branchId:localStorage.getItem("branchId"),hospitalName:localStorage.getItem("HospitalName"),fullName:"",gender:"male",dateOfBirth:"",contactNumber:"",emailID:"",governmentId:"",dPharmaOrBPharmaCertificate:"",experienceCertificates:"",statePharmacyCouncilRegistration:"",dateOfJoining:"",department:"",qualification:"",role:"pharmacist",address:{houseNo:"",street:"",landmark:"",city:"",state:"",postalCode:"",country:"India"},emergencyContactNumber:"",bankAccountDetails:{accountNumber:"",accountHolderName:"",ifscCode:"",bankName:"",branchName:"",panCardNumber:""},profilePicture:"",pharmacyLicense:"",previousEmploymentHistory:"",permissions:R},[a,y]=x.useState(k),[V,oe]=x.useState(localStorage.getItem("HospitalId")),[q,M]=x.useState(!1),[L,T]=x.useState(!1),[Y,O]=x.useState(null),[Z,G]=x.useState(!1),$=["fullName","gender","dateOfBirth","contactNumber","emailID","governmentId","dateOfJoining","department","hospitalId","profilePicture","role","address.houseNo","address.street","address.city","address.state","address.postalCode","address.country","bankAccountDetails.accountNumber","bankAccountDetails.accountHolderName","bankAccountDetails.bankName","bankAccountDetails.branchName","bankAccountDetails.ifscCode","bankAccountDetails.panCardNumber"];function H(s,l){const t=[];for(const c of l){const r=c.split(".");let n=s;for(const g of r)n=n==null?void 0:n[g];(!n||String(n).trim()==="")&&t.push(c)}return t}const se=s=>{y(l=>{const t={...l.permissions};return t[s]?delete t[s]:t[s]=[],{...l,permissions:t}})},W=(s,l)=>{y(t=>{const c={...t.permissions};return c[s]||(c[s]=[]),c[s].includes(l)?c[s]=c[s].filter(r=>r!==l):c[s]=[...c[s],l],{...t,permissions:c}})},U=s=>{y(l=>{const t={...l.permissions};return t[s]?t[s].length===z.length?t[s]=[]:t[s]=[...z]:t[s]=[...z],{...l,permissions:t}})},ae=s=>new Promise((l,t)=>{const c=new FileReader;c.readAsDataURL(s),c.onload=()=>l(c.result),c.onerror=r=>t(r)});x.useEffect(()=>{y(P?{...k,...P,address:{...k.address,...P.address},bankAccountDetails:{...k.bankAccountDetails,...P.bankAccountDetails},permissions:{...k.permissions,...P.permissions}}:k)},[P]);const p=(s,l)=>{y(t=>({...t,[s]:l}))},h=(s,l,t)=>{y(c=>({...c,[s]:{...c[s],[l]:t}}))},D=(s,l)=>{const t=s.target.files[0];if(!t)return;const c=new FileReader;c.onloadend=()=>{y(r=>({...r,[l]:c.result,[`${l}Name`]:t.name,[`${l}Type`]:t.type}))},c.readAsDataURL(t)},_=()=>{const s=H(a,$);if(s.length>0){m.error(`Please fill required fields: ${s.join(", ")}`);return}if(a.dateOfBirth){const n=new Date(a.dateOfBirth),g=new Date,A=g.getFullYear()-n.getFullYear();if((g.getMonth()<n.getMonth()||g.getMonth()===n.getMonth()&&g.getDate()<n.getDate()?A-1:A)<18){m.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(a.contactNumber)){m.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.emailID)){m.error("Please enter a valid email address.");return}if(v==null?void 0:v.some(n=>n.contactNumber===a.contactNumber&&n.id!==a.id)){m.error("Contact number already exists!");return}if(v==null?void 0:v.some(n=>n.emailID===a.emailID&&n.pharmacistId!==a.pharmacistId)){m.error("Email already exists!");return}if(Object.keys(a.permissions).length===0){m.error("Please assign at least one user permission before saving.");return}console.log(a),ee(a),y(k),C()},Q=()=>{const s=H(a,$);if(s.length>0){m.error(`Please fill required fields: ${s.join(", ")}`);return}if(a.dateOfBirth){const n=new Date(a.dateOfBirth),g=new Date,A=g.getFullYear()-n.getFullYear();if((g.getMonth()<n.getMonth()||g.getMonth()===n.getMonth()&&g.getDate()<n.getDate()?A-1:A)<18){m.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(a.contactNumber)){m.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.emailID)){m.error("Please enter a valid email address.");return}if(v==null?void 0:v.some(n=>n.contactNumber===a.contactNumber&&n.pharmacistId!==a.pharmacistId)){m.error("Contact number already exists!");return}if(v==null?void 0:v.some(n=>n.emailID===a.emailID&&n.pharmacistId!==a.pharmacistId)){m.error("Email already exists!");return}console.log(a),T(!0)},i=()=>{M(!1),O(null),G(!1)},o=(s,l)=>{O(s),G(l==null?void 0:l.includes("pdf")),M(!0)},j=({title:s,children:l})=>e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-semibold border-b pb-2 mb-4",children:s}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:l})]}),d=({label:s,value:l})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:l||"N/A"})]}),I=({label:s,value:l})=>e.jsxs("div",{className:"col-span-3",children:[s&&e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:l||"N/A"})]}),N=({label:s,type:l,data:t})=>{if(!t)return e.jsxs("p",{children:[s," "]});const c=l==null?void 0:l.startsWith("image/"),r=t.startsWith("data:")?t:`data:${l};base64,${t}`;return e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsxs("strong",{children:[s,":"]}),e.jsxs("div",{className:"mt-2",children:[c?e.jsx("img",{src:r,alt:s,className:"w-32 h-32 object-cover rounded-md border cursor-pointer",onClick:()=>o(r,l)}):e.jsx("button",{type:"button ",className:" btn text-blue-600 hover:underline block mx-2",onClick:()=>o(r,l),style:{backgroundColor:"var(--color-black)",color:"white"},children:"Preview"}),e.jsx("a",{href:r,download:s.replace(/\s+/g,"_"),className:"text-green-600 hover:underline text-sm block  btn",style:{backgroundColor:"var(--color-black)",color:"white"},children:"Download"})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(le,{visible:f,onClose:C,size:"lg",className:"custom-modal",backdrop:"static",children:[e.jsx(re,{children:e.jsx(pe,{children:F?"Personal Information":"Add / Edit Pharmacist "})}),e.jsx(ce,{children:F?e.jsxs("div",{className:"p-4 border rounded shadow-sm bg-white ",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Name : "}),e.jsx("span",{children:a.fullName})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Email : "}),e.jsx("span",{children:a.emailID})]}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-bold",children:"Contact : "}),e.jsx("span",{children:a.contactNumber})]})]}),e.jsxs("div",{className:"text-center",children:[a.profilePicture?e.jsx("img",{src:a.profilePicture||"/assets/images/default-avatar.png",alt:a.fullName,width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsxs("div",{style:{color:"var(--color-black)",marginTop:"5px",fontSize:"14px",fontWeight:"500"},children:["ID: ",a.pharmacistId]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-5 mt-5",children:[e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Full Name",value:a.fullName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Email",value:a.emailID})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Contact",value:a.contactNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Gender",value:a.gender})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Date of Birth",value:a.dateOfBirth})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Government ID",value:a.governmentId})})]}),e.jsx(j,{title:"Work Information",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Date of Joining",value:a.dateOfJoining})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Department",value:a.department})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Specialization",value:a.qualification})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Emergency Contact",value:a.emergencyContactNumber})})]})}),e.jsx(j,{title:"Address",children:e.jsx(I,{value:`${a.address.houseNo}, ${a.address.street}, ${a.address.city}, ${a.address.state} - ${a.address.postalCode}, ${a.address.country}`})}),e.jsx(j,{title:"Bank Details",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Account Number",value:a.bankAccountDetails.accountNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Account Holder Name",value:a.bankAccountDetails.accountHolderName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Bank Name",value:a.bankAccountDetails.bankName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Branch Name",value:a.bankAccountDetails.branchName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"PAN Card",value:a.bankAccountDetails.panCardNumber})})]})}),e.jsx(j,{title:"Documents",children:e.jsxs("div",{className:"row",children:[a.dPharmaOrBPharmaCertificate!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(N,{label:"dPharmaOrBPharmaCertificate",type:a.dPharmaOrBPharmaCertificateType||"application/pdf",data:a.dPharmaOrBPharmaCertificate})}):e.jsx("p",{className:"col-md-6",children:"Not Provided dPharmaOrBPharmaCertificate"}),a.statePharmacyCouncilRegistration!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(N,{label:"statePharmacyCouncilRegistration",type:a.statePharmacyCouncilRegistrationType||"application/pdf",data:a.statePharmacyCouncilRegistration})}):e.jsx("p",{className:"col-md-6",children:"Not Provided statePharmacyCouncilRegistration"}),a.experienceCertificates!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(N,{label:"experienceCertificates",type:a.experienceCertificatesType||"application/pdf",data:a.experienceCertificates})}):e.jsx("p",{className:"col-md-6",children:"Not Provided experienceCertificates"})]})}),e.jsx("div",{className:"mt-4"}),e.jsx(j,{title:"Other Information ",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(d,{label:"Pharmacy License",value:a.pharmacyLicense})}),e.jsx("div",{className:"col-md-12",children:e.jsx(I,{label:"Previous Employment",value:a.previousEmploymentHistory})})]})})]})]}):e.jsxs(ge,{children:[e.jsx("h5",{children:"Basic Information"}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-5",children:[e.jsxs(u,{children:["ClinicID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:V,disabled:!0,onChange:s=>p("hospitalId",s.target.value)})]}),e.jsxs("div",{className:"col-md-7",children:[e.jsxs(u,{children:["Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:a.role,disabled:!0,onChange:s=>p("role",s.target.value)})]})]})}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Full Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:a.fullName,onChange:s=>p("fullName",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Gender ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(fe,{value:a.gender,onChange:s=>p("gender",s.target.value),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Date of Birth ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"date",value:a.dateOfBirth,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],onChange:s=>p("dateOfBirth",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Contact Number ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"text",maxLength:10,value:a.contactNumber,onChange:s=>{const l=s.target.value;/^\d*$/.test(l)&&p("contactNumber",l)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Email ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"email",value:a.emailID,onChange:s=>p("emailID",s.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["GovernmentID(AadharCard No) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{maxLength:12,value:a.governmentId,onChange:s=>{const l=s.target.value;/^\d*$/.test(l)&&p("governmentId",l)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"Pharmacy License"}),e.jsx(b,{type:"text",placeholder:"Enter Pharmacy License",value:a.pharmacyLicense,onChange:s=>p("pharmacyLicense",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Date of Joining ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"date",value:a.dateOfJoining,onChange:s=>p("dateOfJoining",s.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[" ",e.jsx(u,{children:"Department"}),e.jsx(b,{value:K(a.department),onChange:s=>p("department",s.target.value)})," "]}),e.jsxs("div",{className:"col-md-4",children:[" ",e.jsx(u,{children:"Specialization"}),e.jsx(b,{value:K(a.qualification),onChange:s=>p("qualification",s.target.value)})]})]}),e.jsx("div",{className:"row mb-3",children:e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"Emergency Contact"}),e.jsx(b,{type:"text",maxLength:10,value:a.emergencyContactNumber,onChange:s=>{const l=s.target.value;/^\d*$/.test(l)&&p("emergencyContactNumber",s.target.value)}})]})}),e.jsx("h5",{className:"mt-3",children:"Address"}),Object.keys(a.address).reduce((s,l,t)=>(t%3===0&&s.push([]),s[s.length-1].push(l),s),[]).map((s,l)=>e.jsx("div",{className:"row mb-3",children:s.map(t=>e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{className:"text-capitalize",children:[t," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"text",maxLength:t==="postalCode"?6:void 0,value:K(a.address[t]),onChange:c=>{let r=c.target.value;t==="postalCode"?/^\d*$/.test(r)&&h("address",t,r):h("address",t,r)}})]},t))},l)),e.jsx("h5",{className:"mt-3",children:"Bank Account Details"}),Object.keys(a.bankAccountDetails).reduce((s,l,t)=>(t%3===0&&s.push([]),s[s.length-1].push(l),s),[]).map((s,l)=>e.jsx("div",{className:"row mb-3",children:s.map(t=>e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{className:"text-capitalize",children:[t," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:a.bankAccountDetails[t],maxLength:t==="accountNumber"?20:t==="panCardNumber"?10:t==="ifscCode"?11:void 0,onChange:async c=>{let r=c.target.value;if(t==="accountNumber"){/^\d*$/.test(r)&&h("bankAccountDetails",t,r);return}if(t==="panCardNumber"){r=r.toUpperCase(),/^[A-Z]{0,5}[0-9]{0,4}[A-Z]{0,1}$/.test(r)&&h("bankAccountDetails",t,r),r.length===10&&(/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(r)||m.error("Invalid PAN format (e.g., ABCDE1234F)"));return}if(t==="ifscCode"){if(r=r.toUpperCase(),!/^[A-Z0-9]*$/.test(r))return;if(h("bankAccountDetails",t,r),r.length===11){if(!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(r)){m.error("Invalid IFSC format (e.g., HDFC0001234)"),h("bankAccountDetails","bankName",""),h("bankAccountDetails","branchName","");return}try{const g=await fetch(`https://ifsc.razorpay.com/${r}`);if(g.ok){const A=await g.json();h("bankAccountDetails","bankName",A.BANK||""),h("bankAccountDetails","branchName",A.BRANCH||"")}else m.error("Invalid IFSC Code"),h("bankAccountDetails","bankName",""),h("bankAccountDetails","branchName","")}catch{m.error("Error fetching bank details"),h("bankAccountDetails","bankName",""),h("bankAccountDetails","branchName","")}}else h("bankAccountDetails","bankName",""),h("bankAccountDetails","branchName","");return}h("bankAccountDetails",t,r)}})]},t))},l)),e.jsx("h5",{className:"mt-3",children:"Documents"}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"Profile Picture"}),a.profilePicture&&e.jsxs("div",{className:"mb-2",children:[e.jsx("img",{src:a.profilePicture,alt:"Profile",width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsx("br",{}),e.jsx("a",{href:a.profilePicture,download:"profile-picture",target:"_blank",rel:"noopener noreferrer",children:"Download"})]}),e.jsx(b,{type:"file",accept:"image/*",onChange:async s=>{const l=s.target.files[0];if(l){const t=await ae(l);p("profilePicture",t)}}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"dPharma/BPharma Certificate"}),e.jsx(b,{type:"file",onChange:s=>D(s,"dPharmaOrBPharmaCertificate")})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"statePharmacyCouncilRegistration"}),e.jsx(b,{type:"file",onChange:s=>D(s,"statePharmacyCouncilRegistration")})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"experience Certificate"}),e.jsx(b,{type:"file",onChange:s=>D(s,"experienceCertificates")})]})]}),e.jsx(u,{children:"Previous Employment History"}),e.jsx(ve,{rows:3,value:a.previousEmploymentHistoryType,onChange:s=>p("previousEmploymentHistory",s.target.value),placeholder:"Enter previous employment history"}),e.jsx("div",{className:"mb-3 w-100 mt-4",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(B,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:Q,children:"User Permissions"})}),L&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Set User Permissions"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>T(!1)})]}),e.jsx("div",{className:"modal-body",children:e.jsx("div",{className:"row",children:be.map(s=>{const l=!!a.permissions[s],t=l&&a.permissions[s].length===z.length;return e.jsxs("div",{className:"col-md-5 mb-3 border p-2 rounded mx-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("label",{className:"fw-bold",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>se(s)})," ",s]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",disabled:!l,checked:t,onChange:()=>U(s)})," ","Select All"]})]}),e.jsx("div",{className:"d-flex flex-wrap gap-3 mt-2",children:z.map(c=>{var r;return e.jsxs("label",{className:"d-flex align-items-center gap-1",children:[e.jsx("input",{type:"checkbox",disabled:!l,checked:((r=a.permissions[s])==null?void 0:r.includes(c))||!1,onChange:()=>W(s,c)}),c]},c)})})]},s)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>T(!1),children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{m.success("Permissions saved"),T(!1)},children:"Save Permissions"})]})]})})}),L&&e.jsx("div",{className:"modal-backdrop fade show"})]})}),e.jsx(ne,{children:F?e.jsx(B,{color:"secondary",onClick:C,children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(B,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)"},onClick:()=>y(k),children:"Clear"}),e.jsx(B,{color:"secondary",onClick:C,children:"Cancel"}),e.jsx(B,{style:{backgroundColor:"var(--color-black)",color:"white"},onClick:_,children:"Save"})]})})]}),e.jsxs(le,{visible:q,onClose:i,size:"xl",children:[e.jsx(re,{onClose:i,children:e.jsx("strong",{children:Z?"PDF Preview":"Image Preview"})}),e.jsx(ce,{className:"text-center",children:Z?e.jsx("iframe",{src:Y,title:"PDF Preview",style:{width:"100%",height:"80vh",border:"none"}}):e.jsx("img",{src:Y,alt:"Preview",style:{maxWidth:"100%",maxHeight:"80vh",borderRadius:"8px"}})})]})]})},Se=f=>ie.get(`${X}/getAllPharmacists/${f}`),Be=f=>he.post(`${X}/addPharmacist`,f,{headers:{"Content-Type":"application/json"}}),Fe=(f,C)=>ie.put(`${X}/updatePharmacist/${f}`,C,{headers:{"Content-Type":"application/json"}}),Re=f=>ie.delete(`${X}/deletePharmacist/${f}`),Xe=()=>{const[f,C]=x.useState([]),[ee,E]=x.useState(!1),[P,F]=x.useState(null),[v,J]=x.useState(!1),[R,k]=x.useState(1),[a,y]=x.useState(10),{searchQuery:V,setSearchQuery:oe}=ue(),[q,M]=x.useState(!1),[L,T]=x.useState(null),[Y,O]=x.useState(!1),[Z,G]=x.useState(null),[$,H]=x.useState(null),[se,W]=x.useState(!1),U=async()=>{var i;M(!0);try{const o=localStorage.getItem("HospitalId");if(o){const j=await Se(o),d=((i=j.data)==null?void 0:i.data)||j.data||[];C(d)}}catch(o){console.error("❌ Error fetching pharmacists:",o),C([]),T("Failed to fetch pharmacists.")}finally{M(!1)}};x.useEffect(()=>{U()},[]);const ae=async i=>{var o,j,d;try{const I={...i,permissions:{Laboratory:Object.entries(i.permissions.Laboratory||{}).filter(([N,s])=>s).map(([N])=>N),viewPatients:i.permissions.viewPatients?["read"]:[]}};if(P)await Fe(P.pharmacistId,I),m.success("Pharmacist updated successfully!");else{const N=await Be(I);await U(),(o=N==null?void 0:N.data)!=null&&o.data&&(H({username:N.data.data.userName,password:N.data.data.password,pharmacistName:N.data.data.fullName}),E(!1),W(!0)),m.success("Pharmacist added successfully!")}}catch(I){console.error("API error:",I),m.error(((d=(j=I.response)==null?void 0:j.data)==null?void 0:d.message)||"❌ Failed to save pharmacist.")}},p=async i=>{try{await Re(i),C(o=>o.filter(j=>j.pharmacistId!==i)),m.success("Pharmacist deleted successfully!")}catch(o){console.error("Delete error:",o),m.error("❌ Failed to delete pharmacist.")}finally{O(!1)}},{user:h}=xe(),D=(i,o)=>{var j,d;return(d=(j=h==null?void 0:h.permissions)==null?void 0:j[i])==null?void 0:d.includes(o)},_=je.useMemo(()=>{const i=V.toLowerCase().trim();return i?f.filter(o=>Object.values(o).some(j=>String(j).toLowerCase().includes(i))):f},[V,f]),Q=_.slice((R-1)*a,R*a);return e.jsxs("div",{children:[D("Laboratory","create")&&e.jsx("div",{className:"mb-3 w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(B,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>E(!0),children:"Add Pharmacist"})}),e.jsxs(le,{visible:se,backdrop:"static",keyboard:!1,children:[e.jsx(re,{children:e.jsx("h5",{children:"Pharmacist Credentials"})}),e.jsx(ce,{children:$?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",$.pharmacistName||"New Pharmacist"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",$.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," ",$.password]}),e.jsx("small",{className:"text-danger",children:"⚠️ Please save these credentials securely. They will not be shown again."})]}):e.jsx("p",{children:"No data available"})}),e.jsx(ne,{children:e.jsx(B,{color:"primary",onClick:()=>{W(!1),H(null)},children:"Close"})})]}),e.jsx(Ne,{isVisible:Y,title:"Delete Pharmacist",message:"Are you sure you want to delete this pharmacist? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>p(Z),onCancel:()=>O(!1)}),q?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(ye,{message:"Loading pharmacists..."})}):L?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:L}):e.jsxs(Ce,{className:"mt-3",striped:!0,hover:!0,responsive:!0,children:[e.jsx(Pe,{children:e.jsxs(te,{className:"pink-table  w-auto",children:[e.jsx(S,{children:"#"}),e.jsx(S,{children:"Photo"}),e.jsx(S,{children:"Name"}),e.jsx(S,{children:"Contact"}),e.jsx(S,{children:"Sex"}),e.jsx(S,{children:"Qualification"}),e.jsx(S,{children:"Date Of Joining"}),e.jsx(S,{className:"text-end",children:"Actions"})]})}),e.jsx(ke,{className:"pink-table",children:Q.length?Q.map((i,o)=>e.jsxs(te,{children:[e.jsx(w,{children:(R-1)*a+o+1}),e.jsx(w,{children:i.profilePicture?e.jsx("img",{src:i.profilePicture,alt:i.fullName,width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}})}),e.jsx(w,{children:K(i.fullName)}),e.jsx(w,{children:i.contactNumber||"NA"}),e.jsx(w,{children:i.gender||"NA"}),e.jsx(w,{children:i.qualification||"NA"}),e.jsx(w,{children:i.dateOfJoining||"NA"}),e.jsx(w,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[D("Laboratory","read")&&e.jsx("button",{className:"actionBtn",onClick:()=>{F(i),J(!0),E(!0)},title:"View",children:e.jsx(we,{size:18})}),D("Laboratory","update")&&e.jsx("button",{className:"actionBtn",onClick:()=>{F(i),J(!1),E(!0)},title:"Edit",children:e.jsx(De,{size:18})}),D("Laboratory","delete")&&e.jsx("button",{className:"actionBtn",onClick:()=>{G(i.pharmacistId),O(!0)},title:"Delete",children:e.jsx(Ie,{size:18})})]})})]},i.id)):e.jsx(te,{children:e.jsx(w,{colSpan:"9",className:"text-center",style:{color:"var(--color-black)"},children:"No pharmacist found."})})})]}),!q&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(_.length/a)},(i,o)=>e.jsx(B,{style:{backgroundColor:R===o+1?"var(--color-black)":"#fff",color:R===o+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>k(o+1),children:o+1},o))}),e.jsx(Ae,{visible:ee,onClose:()=>{E(!1),F(null),J(!1)},onSave:ae,initialData:P,viewMode:v,pharmacist:f,fetchTechs:U})]})};export{Xe as default};
