import{h as A,o as ie,p as de,U as pe,D as me,r as c,a as he,R as ue,j as e,Q as xe,B as m}from"./index-DIpuK5ve.js";import{b as x}from"./index.esm-D1QouA3b.js";import"./index.es-CE881Lt4.js";import{C as je}from"./ConfirmationModal-Bmer8Hpk.js";import{c as L}from"./capitalizeWords-CuwF8AcI.js";import{L as fe}from"./loader-m2E4dacC.js";import{C as P}from"./CForm-C0ZON6IQ.js";import{C as R,a as B,b as z}from"./CModalHeader-CaIVx0Az.js";import{C as V}from"./CModalTitle-CKY4mbYL.js";import{C as F,a as j}from"./CRow-Bc5toSNl.js";import{C as f}from"./CFormInput-BUyqDmRK.js";import{C as W}from"./CModalFooter-CUSCQX1g.js";import{C as ye,a as Ce,b as H,c as v,d as Ne,e as y}from"./CTable-BtWMeZmL.js";import{E as ge}from"./eye-CHLB3bq4.js";import{P as Te,T as be}from"./trash-2-CGfOkLXM.js";import"./CNavItem-bk6AY8R-.js";import"./CFormLabel-DjU27C7A.js";import"./createLucideIcon-DUvW7aVj.js";const ve=async o=>{try{const a=await A.get(`/${ie}/${o}`);return console.log("test data:",a.data),a.data}catch(a){throw console.error("Error fetching test data:",a.message),a.response&&(console.error("Error Response Data:",a.response.data),console.error("Error Response Status:",a.response.status)),a}},we=async o=>{try{const a={testName:o.testName||"",hospitalId:o.hospitalId||"",description:o.description||"",purpose:o.purpose||""},l=await A.post(`/${de}`,a,{headers:{"Content-Type":"application/json"}});return console.log(l),l.data}catch(a){throw console.error("Error response from API:",a.response),a}},De=async(o,a,l)=>{try{return(await A.put(`/${pe}/${a}/${l}`,o,{headers:{"Content-Type":"application/json"}})).data}catch(h){throw console.error("Error updating tet:",h),h}},ke=async(o,a)=>{try{const l=await A.delete(`/${me}/${o}/${a}`,{headers:{"Content-Type":"application/json"}});return console.log("Test deleted successfully:",l.data),l.data}catch(l){throw console.error("Error deleting tet:",l.response?l.response.data:l),l}},We=()=>{const[o,a]=c.useState([]),[l,h]=c.useState(!1),[U,Y]=c.useState(null),[Z,C]=c.useState(!1),[N,q]=c.useState(null),[J,w]=c.useState(!1),[r,D]=c.useState(null),[d,p]=c.useState({}),[K,M]=c.useState(!1),[X,O]=c.useState(null),[g,ee]=c.useState(1),[k,Ie]=c.useState(10),{searchQuery:E,setSearchQuery:Se}=he(),[i,I]=c.useState({testName:"",hospitalId:"",description:"",purpose:""}),[se,Q]=c.useState(null),T=localStorage.getItem("HospitalId"),te=s=>s.map(t=>({...t,id:t.id||t._id})),S=async s=>{h(!0);try{const t=await ve(s);a(te(t.data).reverse())}catch{Y("Failed to fetch test data.")}finally{h(!1)}},re=async()=>{try{await ke(X,se),m.success("Test deleted successfully!",{position:"top-right"}),S(T)}catch(s){m.error("Failed to delete test."),console.error("Delete error:",s)}M(!1)},ae=()=>{O(null),Q(null),M(!1)};c.useEffect(()=>{S(T)},[T]);const $=ue.useMemo(()=>{const s=E.toLowerCase().trim();return s?o.filter(t=>Object.values(t).some(n=>String(n).toLowerCase().includes(s))):o},[E,o]),_=/^[A-Za-z\s.]+$/,oe=async()=>{var t,n,b;if(!i.testName.trim()){p({testName:"Test name is required."});return}if(!_.test(i.testName.trim())){p({testName:'Only alphabets, spaces, and "." are allowed.'});return}if(o.some(u=>u.testName.trim().toLowerCase()===i.testName.trim().toLowerCase())){m.error(`Duplicate test name,Add another test - ${i.testName} already exists!`,{position:"top-right"}),C(!1);return}try{const u={testName:i.testName,hospitalId:T,description:i.description,purpose:i.purpose};await we(u),m.success("Test added successfully!"),S(T),C(!1),I({testName:"",description:"",purpose:""})}catch(u){const ce=((n=(t=u.response)==null?void 0:t.data)==null?void 0:n.message)||((b=u.response)==null?void 0:b.statusText)||"An unexpected error occurred.";m.error(`Error adding test: ${ce}`,{position:"top-right"})}},ne=async()=>{var t;if(!((t=r==null?void 0:r.testName)!=null&&t.trim())){p({testName:"Test name is required."});return}if(!_.test(r.testName.trim())){p({testName:'Only alphabets, spaces, and "." are allowed.'});return}if(o.some(n=>n.testName.trim().toLowerCase()===r.testName.trim().toLowerCase()&&n.id!==r.id)){m.error(`Duplicate test name - ${r.testName} already exists!`,{position:"top-right"});return}try{const{id:n,hospitalId:b}=r;await De(r,n,b),m.success("Test updated successfully!"),w(!1),S(b)}catch(n){console.error("Update error:",n),m.error("Failed to update test.")}},le=s=>{O(s.testId||s.id||s._id),Q(s.hospitalId),M(!0)},G=$.slice((g-1)*k,g*k);return e.jsxs("div",{children:[e.jsx(xe,{}),e.jsx(P,{className:"d-flex justify-content-between mb-3",children:e.jsx("div",{className:" w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(x,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>C(!0),children:"Add Test"})})}),N&&e.jsxs(R,{visible:!!N,onClose:()=>q(null),backdrop:"static",children:[e.jsx(B,{children:e.jsx(V,{children:"Test Details"})}),e.jsxs(z,{style:{color:"var(--color-black)"},children:[e.jsxs(F,{className:"mb-3",children:[e.jsx(j,{sm:4,children:e.jsx("strong",{children:"Test Name:"})}),e.jsx(j,{sm:8,children:N.testName})]}),e.jsxs(F,{className:"mb-3",children:[e.jsx(j,{sm:4,children:e.jsx("strong",{children:"Description:"})}),e.jsx(j,{sm:8,children:N.description})]}),e.jsxs(F,{className:"mb-3",children:[e.jsx(j,{sm:4,children:e.jsx("strong",{children:"Purpose:"})}),e.jsx(j,{sm:8,children:N.purpose||"NA"})]})]})]}),e.jsxs(R,{visible:Z,onClose:()=>C(!1),backdrop:"static",children:[e.jsx(B,{children:e.jsx(V,{children:"Add New Test"})}),e.jsx(z,{children:e.jsxs(P,{children:[e.jsxs("h6",{children:["Test Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{type:"text",name:"testName",value:i.testName,onChange:s=>{const t=s.target.value;I({...i,testName:t}),d.testName&&p(n=>({...n,testName:""}))},placeholder:"Enter test name",className:d.testName?"is-invalid":""}),d.testName&&e.jsx("div",{className:"invalid-feedback",style:{color:"red"},children:d.testName}),e.jsx("h6",{children:"Description"}),e.jsx(f,{type:"text",name:"description",value:i.description,onChange:s=>{const t=s.target.value;I({...i,description:t}),d.description&&p(n=>({...n,description:""}))},placeholder:"Enter description",className:d.description?"is-invalid":""}),e.jsx("h6",{children:"Purpose"}),e.jsx(f,{type:"text",name:"purpose",value:i.purpose,onChange:s=>{const t=s.target.value;I({...i,purpose:t}),d.purpose&&p(n=>({...n,purpose:""}))},placeholder:"Enter purpose",className:d.purpose?"is-invalid":""})]})}),e.jsxs(W,{children:[e.jsx(x,{color:"secondary",onClick:()=>C(!1),children:"Cancel"}),e.jsx(x,{style:{backgroundColor:"var(--color-black)"},className:"text-white",onClick:oe,children:"Add"})]})]}),e.jsxs(R,{visible:J,onClose:()=>w(!1),backdrop:"static",children:[e.jsx(B,{children:e.jsx(V,{children:"Edit Test"})}),e.jsx(z,{children:e.jsxs(P,{children:[e.jsxs("h6",{children:["Test Name",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(f,{type:"text",value:(r==null?void 0:r.testName)||"",onChange:s=>{D({...r,testName:s.target.value}),d.testName&&p({...d,testName:""})}}),d.testName&&e.jsx("p",{style:{color:"red",fontSize:"0.9rem",marginTop:"5px"},children:d.testName}),e.jsx("h6",{children:"Description"}),e.jsx(f,{type:"text",value:(r==null?void 0:r.description)||"",onChange:s=>D({...r,description:s.target.value})}),e.jsx("h6",{children:"purpose"}),e.jsx(f,{type:"text",value:(r==null?void 0:r.purpose)||"",onChange:s=>D({...r,purpose:s.target.value})})]})}),e.jsxs(W,{children:[e.jsx(x,{color:"secondary",onClick:()=>w(!1),children:"Cancel"}),e.jsx(x,{style:{backgroundColor:"var(--color-black)"},className:"text-white",onClick:ne,children:"Update"})]})]}),e.jsx(je,{isVisible:K,title:"Delete Doctor",message:"Are you sure you want to delete this test? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:re,onCancel:ae}),l?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(fe,{message:"Loading Test..."})}):U?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:U}):e.jsxs(ye,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(Ce,{className:"pink-table",children:e.jsxs(H,{children:[e.jsx(v,{style:{paddingLeft:"40px"},children:"S.No"}),e.jsx(v,{children:"Test Name"}),e.jsx(v,{children:"Description"}),e.jsx(v,{children:"Purpose"}),e.jsx(v,{className:"text-end",children:"Actions"})]})}),e.jsx(Ne,{className:"pink-table",children:G.length>0?G.map((s,t)=>e.jsxs(H,{children:[e.jsx(y,{style:{paddingLeft:"40px"},children:(g-1)*k+t+1}),e.jsx(y,{children:L(s.testName)}),e.jsx(y,{children:L(s.description||"NA")}),e.jsx(y,{children:L(s.purpose||"NA")}),e.jsx(y,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2  ",children:[e.jsx("button",{className:"actionBtn",onClick:()=>q(s),title:"View",children:e.jsx(ge,{size:18})}),e.jsx("button",{className:"actionBtn",onClick:()=>{D(s),w(!0)},title:"Edit",children:e.jsx(Te,{size:18})}),e.jsx("button",{className:"actionBtn",onClick:()=>le(s),title:"Delete",children:e.jsx(be,{size:18})})]})})]},s.id)):e.jsx(H,{children:e.jsxs(y,{colSpan:5,className:"text-center text-muted",children:['🔍 No tests found matching "',e.jsx("b",{children:E}),'"']})})})]}),!l&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(($.length?$.length:o.length)/k)},(s,t)=>e.jsx(x,{style:{margin:"0 5px",padding:"5px 10px",backgroundColor:g===t+1?"var(--color-black)":"#fff",color:g===t+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>ee(t+1),children:t+1},t))})]})};export{We as default};
