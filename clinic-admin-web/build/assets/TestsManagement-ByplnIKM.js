import{o as I,B as v,X as ne,Y as le,Z as ce,a0 as ie,r as a,j as e,Q as de,y as i}from"./index-D-oDOyWO.js";import{c as pe,a as d}from"./index.esm-Dag7HEVz.js";/* empty css                      */import{X as he}from"./index.es-CyaLuy6q.js";import{C as S}from"./CForm-C_9ZANgI.js";import{C as me}from"./CInputGroup-DFlVQaGa.js";import{C as E}from"./CFormInput-CxOD02nI.js";import{C as ue}from"./CInputGroupText-Bw8sjWME.js";import{c as xe}from"./cil-search-CDkY_4k-.js";import{C as T,a as g,b as N}from"./CModalHeader-DCaq31xv.js";import{C as w}from"./CModalTitle-B_oINO8I.js";import{C as X,a as b}from"./CRow-C5UAjCDF.js";import{C as k}from"./CModalFooter-Cjr_bjNp.js";import"./CFormLabel-ccOuQI7Q.js";import"./CConditionalPortal-Cy0Xk2dr.js";const je=async()=>{try{const t=await I.get(`${v}/${ne}`);return console.log("test data:",t.data),t.data}catch(t){throw console.error("Error fetching test data:",t.message),t.response&&(console.error("Error Response Data:",t.response.data),console.error("Error Response Status:",t.response.status)),t}},fe=async t=>{try{const n={testName:t.testName||"",hospitalId:t.hospitalId||""},r=await I.post(`${v}/${le}`,n,{headers:{"Content-Type":"application/json"}});return console.log(r),r.data}catch(n){throw console.error("Error response from API:",n.response),n}},Ce=async(t,n,r)=>{try{return(await I.put(`${v}/${ce}/${n}/${r}`,t,{headers:{"Content-Type":"application/json"}})).data}catch(h){throw console.error("Error updating tet:",h),h}},ye=async(t,n)=>{try{const r=await I.delete(`${v}/${ie}/${t}/${n}`,{headers:{"Content-Type":"application/json"}});return console.log("Test deleted successfully:",r.data),r.data}catch(r){throw console.error("Error deleting tet:",r.response?r.response.data:r),r}},Ve=()=>{const[t,n]=a.useState(""),[r,h]=a.useState([]),[$,M]=a.useState([]),[_,A]=a.useState(!1),[F,q]=a.useState(null),[G,x]=a.useState(!1),[j,L]=a.useState(null),[z,f]=a.useState(!1),[p,V]=a.useState(null),[C,R]=a.useState({}),[P,D]=a.useState(!1),[Y,B]=a.useState(null),[m,U]=a.useState({testName:"",hospitalId:""}),[Z,H]=a.useState(null),J=localStorage.getItem("HospitalId"),K=s=>s.map(o=>({...o,id:o.id||o._id})),y=async()=>{A(!0);try{const s=await je();h(K(s.data))}catch{q("Failed to fetch test data.")}finally{A(!1)}},O=async()=>{try{await ye(Y,Z),i.success("Test deleted successfully!",{position:"top-right"}),y()}catch(s){i.error("Failed to delete test."),console.error("Delete error:",s)}D(!1)},W=()=>{B(null),H(null),D(!1)};a.useEffect(()=>{y()},[]),a.useEffect(()=>{const s=t.toLowerCase().trim();if(!s){M([]);return}const o=r.filter(l=>{var c;return(c=l.testName)==null?void 0:c.toLowerCase().includes(s)});M(o)},[t,r]);const ee=async()=>{var s,o,l,c;if(!m.testName.trim()){R({testName:"Test name is required."});return}try{const u={testName:m.testName,hospitalId:J};await fe(u),i.success("Test added successfully!"),y(),x(!1),U({testName:""})}catch(u){const Q=((o=(s=u.response)==null?void 0:s.data)==null?void 0:o.message)||((l=u.response)==null?void 0:l.statusText)||"An unexpected error occurred.";((c=u.response)==null?void 0:c.status)===409||Q.toLowerCase().includes("duplicate")?i.error(`Error: Duplicate test name - ${m.testName} already exists!`,{position:"top-right"}):i.error(`Error adding test: ${Q}`,{position:"top-right"})}},se=s=>{V(s),f(!0)},te=async()=>{const{id:s,hospitalId:o}=p;try{await Ce(p,s,o),i.success("Test updated successfully!"),f(!1),y()}catch(l){console.error("Update error:",l),i.error("Failed to update test.")}},re=s=>{B(s.testId||s.id||s._id),H(s.hospitalId),D(!0)},oe=[{name:"S.No",selector:(s,o)=>o+1,width:"10%"},{name:"Test Name",selector:s=>s.testName,sortable:!0,width:"45%"},{name:"Actions",cell:s=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"250px"},children:[e.jsx("div",{onClick:()=>L(s),style:{color:"green",cursor:"pointer"},children:"View"}),e.jsx("div",{onClick:()=>se(s),style:{color:"blue",cursor:"pointer"},children:"Edit"}),e.jsx("div",{onClick:()=>re(s),style:{color:"red",cursor:"pointer"},children:"Delete"})]})}],ae=({isVisible:s,message:o,onConfirm:l,onCancel:c})=>e.jsxs(T,{visible:s,onClose:c,backdrop:"static",children:[e.jsx(g,{children:e.jsx(w,{children:"Confirmation"})}),e.jsx(N,{children:o}),e.jsxs(k,{children:[e.jsx(d,{color:"secondary",onClick:c,children:"Cancel"}),e.jsx(d,{color:"danger",onClick:l,children:"Confirm"})]})]});return e.jsxs("div",{children:[e.jsx(de,{}),e.jsxs(S,{className:"d-flex justify-content-between mb-3",children:[e.jsxs(me,{className:"mb-3",style:{width:"300px",marginLeft:"40px"},children:[e.jsx(E,{type:"text",placeholder:"Search by Test Name",value:t,onChange:s=>n(s.target.value)}),e.jsx(ue,{children:e.jsx(pe,{icon:xe})})]}),e.jsx(d,{color:"primary",style:{marginRight:"100px"},onClick:()=>x(!0),children:"Add Test"})]}),j&&e.jsxs(T,{visible:!!j,onClose:()=>L(null),backdrop:"static",children:[e.jsx(g,{children:e.jsx(w,{children:"Test Details"})}),e.jsxs(N,{children:[e.jsxs(X,{className:"mb-3",children:[e.jsx(b,{sm:4,children:e.jsx("strong",{children:"Test Name:"})}),e.jsx(b,{sm:8,children:j.testName})]}),e.jsxs(X,{className:"mb-3",children:[e.jsx(b,{sm:4,children:e.jsx("strong",{children:"Hospital ID:"})}),e.jsx(b,{sm:8,children:j.hospitalId})]})]})]}),e.jsxs(T,{visible:G,onClose:()=>x(!1),backdrop:"static",children:[e.jsx(g,{children:e.jsx(w,{children:"Add New Test"})}),e.jsx(N,{children:e.jsxs(S,{children:[e.jsxs("h6",{children:["Test Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(E,{type:"text",name:"testName",value:m.testName,onChange:s=>{const o=s.target.value;U({...m,testName:o}),C.testName&&R(l=>({...l,testName:""}))},placeholder:"Enter test name",className:C.testName?"is-invalid":""}),C.testName&&e.jsx("div",{className:"invalid-feedback",style:{color:"red"},children:C.testName})]})}),e.jsxs(k,{children:[e.jsx(d,{color:"primary",onClick:ee,children:"Add"}),e.jsx(d,{color:"secondary",onClick:()=>x(!1),children:"Cancel"})]})]}),e.jsxs(T,{visible:z,onClose:()=>f(!1),backdrop:"static",children:[e.jsx(g,{children:e.jsx(w,{children:"Edit Test"})}),e.jsx(N,{children:e.jsxs(S,{children:[e.jsx("h6",{children:"Test Name"}),e.jsx(E,{type:"text",value:(p==null?void 0:p.testName)||"",onChange:s=>V({...p,testName:s.target.value})})]})}),e.jsxs(k,{children:[e.jsx(d,{color:"primary",onClick:te,children:"Update"}),e.jsx(d,{color:"secondary",onClick:()=>f(!1),children:"Cancel"})]})]}),e.jsx(ae,{isVisible:P,message:"Are you sure you want to delete this test?",onConfirm:O,onCancel:W}),_?e.jsx("div",{style:{textAlign:"center"},children:"Loading..."}):F?e.jsx("div",{children:F}):e.jsx(he,{columns:oe,data:$.length?$:r,pagination:!0})]})};export{Ve as default};
