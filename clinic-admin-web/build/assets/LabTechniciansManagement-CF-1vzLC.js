import{r as g,j as e,B as x,h as _,i as K,b as ge,a as be,R as ve}from"./index-BpN0qZrt.js";import{v as y,a as Q,f as pe}from"./Validators-FoVLkSgm.js";import{c as L}from"./capitalizeWords-CuwF8AcI.js";import{U as fe}from"./UserPermissionModal-Cy15BOgE.js";import{C as ne,a as ce,b as oe}from"./CModalHeader-DLH-68_W.js";import{C as Ne}from"./CModalTitle-CwvqIfsB.js";import{C as ye}from"./CForm-D_Fm9Pc8.js";import{C as u}from"./CFormLabel-DO0eStXP.js";import{C as p}from"./CFormInput-DMF4wKOV.js";import{C as re}from"./CFormSelect-DDJD4c8G.js";import{C as Ce}from"./CFormTextarea-BePoUAyB.js";import{b as F}from"./index.esm-BAveQmLP.js";import{C as xe}from"./CModalFooter-Dm04Litg.js";import{C as Ae}from"./ConfirmationModal-Blpddd1P.js";import{L as ke}from"./loader-OBkaezw1.js";import{C as we,a as De,b as ie,c as S,d as Ie,e as O}from"./CTable-Bgk4qBUR.js";import{E as Oe}from"./eye-BuIXT__x.js";import{P as Pe,T as Se}from"./trash-2-CRkTwtCJ.js";import"./CNavItem-DIVzBTzM.js";const Fe=({visible:A,onClose:w,onSave:X,initialData:I,viewMode:T,technicians:f,fetchTechs:de})=>{const $={},D={clinicId:localStorage.getItem("HospitalId"),branchId:localStorage.getItem("branchId"),hospitalName:localStorage.getItem("HospitalName"),fullName:"",gender:"",dateOfBirth:"",contactNumber:"",emailId:"",governmentId:"",qualificationOrCertifications:"",dateOfJoining:"",departmentOrAssignedLab:"",yearOfExperience:"",specialization:"",shiftTimingsOrAvailability:"",role:"lab_technician",address:{houseNo:"",street:"",landmark:"",city:"",state:"",postalCode:"",country:"India"},emergencyContact:"",bankAccountDetails:{accountNumber:"",accountHolderName:"",ifscCode:"",bankName:"",branchName:"",panCardNumber:""},medicalFitnessCertificate:"",profilePicture:"",labLicenseOrRegistration:"",vaccinationStatus:"Fully Vaccinated",previousEmploymentHistory:"",permissions:$,userName:"",password:""},[t,C]=g.useState(D),[me,ee]=g.useState(localStorage.getItem("HospitalId")),[he,z]=g.useState(!1),[M,B]=g.useState(!1),[se,U]=g.useState(null),[E,J]=g.useState(!1),[c,j]=g.useState({}),H=["fullName","gender","dateOfBirth","contactNumber","emailId","governmentId","dateOfJoining","departmentOrAssignedLab","yearOfExperience","clinicId","vaccinationStatus","profilePicture","role","address.houseNo","address.street","address.city","address.state","address.postalCode","address.country","bankAccountDetails.accountNumber","bankAccountDetails.accountHolderName","bankAccountDetails.bankName","bankAccountDetails.branchName","bankAccountDetails.ifscCode","bankAccountDetails.panCardNumber"];function q(s,l){const a=[];for(const r of l){const d=r.split(".");let i=s;for(const h of d)i=i==null?void 0:i[h];(!i||String(i).trim()==="")&&a.push(r)}return a}const Y=s=>{C(l=>{const a={...l.permissions};return a[s]?delete a[s]:a[s]=[],{...l,permissions:a}})},R=(s,l)=>{C(a=>{const r={...a.permissions};return r[s]||(r[s]=[]),r[s].includes(l)?r[s]=r[s].filter(d=>d!==l):r[s]=[...r[s],l],{...a,permissions:r}})},ae=s=>{C(l=>{const a={...l.permissions};return a[s]?a[s].length===Q.length?a[s]=[]:a[s]=[...Q]:a[s]=[...Q],{...l,permissions:a}})},te=s=>new Promise((l,a)=>{const r=new FileReader;r.readAsDataURL(s),r.onload=()=>l(r.result),r.onerror=d=>a(d)});g.useEffect(()=>{C(I||D)},[I]);const m=(s,l)=>{C(r=>({...r,[s]:l}));const a=y(s,l,{...t,[s]:l},f);j(r=>({...r,[s]:a}))},N=(s,l,a)=>{C(r=>({...r,[s]:{...r[s],[l]:a}}))},V=(s,l)=>{const a=s.target.files[0];if(!a)return;const r=new FileReader;r.onloadend=()=>{C(d=>({...d,[l]:r.result,[`${l}Name`]:a.name,[`${l}Type`]:a.type}))},r.readAsDataURL(a)},G=()=>{const s=q(t,H);if(s.length>0){x.error(`Please fill required fields: ${s.join(", ")}`);return}if(t.dateOfBirth){const i=new Date(t.dateOfBirth),h=new Date,v=h.getFullYear()-i.getFullYear();if((h.getMonth()<i.getMonth()||h.getMonth()===i.getMonth()&&h.getDate()<i.getDate()?v-1:v)<18){x.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(t.contactNumber)){x.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.emailId)){x.error("Please enter a valid email address.");return}if(f==null?void 0:f.some(i=>i.contactNumber===t.contactNumber&&i.id!==t.id)){x.error("Contact number already exists!");return}if(f==null?void 0:f.some(i=>i.emailId===t.emailId&&i.id!==t.id)){x.error("Email already exists!");return}if(Object.keys(t.permissions).length===0){x.error("Please assign at least one user permission before saving.");return}console.log(t),X(t),C(D),w()},le=()=>{const s=q(t,H);if(s.length>0){x.error(`Please fill required fields: ${s.join(", ")}`);return}if(t.dateOfBirth){const i=new Date(t.dateOfBirth),h=new Date,v=h.getFullYear()-i.getFullYear();if((h.getMonth()<i.getMonth()||h.getMonth()===i.getMonth()&&h.getDate()<i.getDate()?v-1:v)<18){x.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(t.contactNumber)){x.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.emailId)){x.error("Please enter a valid email address.");return}if(f==null?void 0:f.some(i=>i.contactNumber===t.contactNumber&&i.id!==t.id)){x.error("Contact number already exists!");return}if(f==null?void 0:f.some(i=>i.emailId===t.emailId&&i.id!==t.id)){x.error("Email already exists!");return}console.log(t),B(!0)},n=()=>{z(!1),U(null),J(!1)},o=(s,l)=>{U(s),J(l==null?void 0:l.includes("pdf")),z(!0)},k=s=>{try{return atob(s)}catch{return null}},P=({title:s,children:l})=>e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-semibold border-b pb-2 mb-4",children:s}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:l})]}),b=({label:s,value:l})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:l||"N/A"})]}),Z=({label:s,value:l})=>e.jsxs("div",{className:"col-span-3",children:[s&&e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:l||"N/A"})]}),ue=({label:s,type:l,data:a})=>{if(!a)return e.jsxs("p",{children:[s," "]});const r=l==null?void 0:l.startsWith("image/"),d=a.startsWith("data:")?a:`data:${l};base64,${a}`;return e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsxs("strong",{children:[s,":"]}),e.jsxs("div",{className:"mt-2",children:[r?e.jsx("img",{src:d,alt:s,className:"w-32 h-32 object-cover rounded-md border cursor-pointer",onClick:()=>o(d,l)}):e.jsx("button",{type:"button ",className:" btn text-blue-600 hover:underline block mx-2",onClick:()=>o(d,l),style:{backgroundColor:"var(--color-black)",color:"white"},children:"Preview"}),e.jsx("a",{href:d,download:s.replace(/\s+/g,"_"),className:"text-green-600 hover:underline text-sm block  btn",style:{backgroundColor:"var(--color-black)",color:"white"},children:"Download"})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{visible:A,onClose:w,size:"lg",className:"custom-modal",backdrop:"static",children:[e.jsx(ce,{children:e.jsx(Ne,{children:T?"Personal Information":"Add / Edit Lab Technician"})}),e.jsx(oe,{children:T?e.jsxs("div",{className:"p-4 border rounded shadow-sm bg-white ",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Name : "}),e.jsx("span",{children:t.fullName})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold",children:"Email : "}),e.jsx("span",{children:t.emailId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-bold",children:"Cantact : "}),e.jsx("span",{children:t.contactNumber})]})]}),e.jsxs("div",{className:"text-center",children:[t.profilePicture?e.jsx("img",{src:k(t.profilePicture),alt:t.fullName,width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsxs("div",{style:{color:"var(--color-black)",marginTop:"5px",fontSize:"14px",fontWeight:"500"},children:["ID: ",t.id]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-5 mt-5",children:[e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Full Name",value:t.fullName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Email",value:t.emailId})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Contact",value:t.contactNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Gender",value:t.gender})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Date of Birth",value:t.dateOfBirth})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Government ID",value:t.governmentId})})]}),e.jsx(P,{title:"Work Information",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Date of Joining",value:t.dateOfJoining})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Department",value:t.departmentOrAssignedLab})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Experience",value:t.yearOfExperience})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Specialization",value:t.specialization})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Shift Timings",value:t.shiftTimingsOrAvailability})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Emergency Contact",value:t.emergencyContact})})]})}),e.jsx(P,{title:"Address",children:e.jsx(Z,{value:`${t.address.houseNo}, ${t.address.street}, ${t.address.city}, ${t.address.state} - ${t.address.postalCode}, ${t.address.country}`})}),e.jsx(P,{title:"Bank Details",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Account Number",value:t.bankAccountDetails.accountNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Account Holder Name",value:t.bankAccountDetails.accountHolderName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"IFSC Code",value:t.bankAccountDetails.ifscCode})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Bank Name",value:t.bankAccountDetails.bankName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"Branch Name",value:t.bankAccountDetails.branchName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(b,{label:"PAN Card",value:t.bankAccountDetails.panCardNumber})})]})}),e.jsx(P,{title:"Documents",children:e.jsxs("div",{className:"row",children:[t.qualificationOrCertifications!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(ue,{label:"Qualification / Certifications",type:t.qualificationOrCertificationsType,data:t.qualificationOrCertifications})}):e.jsx("p",{className:"col-md-6",children:"Not Provided qualification/Certifications"}),t.medicalFitnessCertificate!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(ue,{label:"Medical Fitness Certificate",type:t.medicalFitnessCertificateType||"application/pdf",data:t.medicalFitnessCertificate})}):e.jsx("p",{className:"col-md-6",children:"Not Provided medical Fitness Certificate"})]})}),e.jsx("div",{className:"mt-4"}),e.jsx(P,{title:"Other Information ",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(b,{label:"Lab License",value:t.labLicenseOrRegistration})}),e.jsx("div",{className:"col-md-6",children:e.jsx(b,{label:"Vaccination Status",value:t.vaccinationStatus})}),e.jsx("div",{className:"col-md-12",children:e.jsx(Z,{label:"Previous Employment",value:t.previousEmploymentHistory})}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(Z,{label:"User Name",value:t.userName})}),e.jsx("div",{className:"col-md-6",children:e.jsx(Z,{label:"Password",value:t.password})})]})]})})]})]}):e.jsxs(ye,{children:[e.jsx("h5",{children:"Basic Information"}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-5",children:[e.jsxs(u,{children:["ClinicID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{value:me,disabled:!0,onChange:s=>m("clinicId",s.target.value)})]}),e.jsxs("div",{className:"col-md-7",children:[e.jsxs(u,{children:["Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{value:t.role,disabled:!0,onChange:s=>m("role",s.target.value)})]})]})}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Full Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{value:t.fullName,onChange:s=>{const l=s.target.value;m("fullName",l);const a=y("fullName",l);j(r=>({...r,fullName:a}))}}),c.fullName&&e.jsx("div",{className:"text-danger mt-1",children:c.fullName})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Gender ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(re,{value:t.gender,onChange:s=>{const l=s.target.value;m("gender",l);const a=l?"":"Gender is required.";j(r=>({...r,gender:a}))},children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]}),c.gender&&e.jsx("div",{className:"text-danger mt-1",children:c.gender})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Date of Birth ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"date",value:t.dateOfBirth,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],onChange:s=>{const l=s.target.value;m("dateOfBirth",l);const a=y("dateOfBirth",l);j(r=>({...r,dateOfBirth:a}))}}),c.dateOfBirth&&e.jsx("div",{className:"text-danger mt-1",children:c.dateOfBirth})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Contact Number ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"text",maxLength:10,value:t.contactNumber,onChange:s=>{const l=s.target.value;if(/^\d*$/.test(l)){m("contactNumber",l);const a=y("contactNumber",l);j(r=>({...r,contactNumber:a}))}}}),c.contactNumber&&e.jsx("div",{className:"text-danger mt-1",children:c.contactNumber})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Email ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"email",value:t.emailId,onChange:s=>{const l=s.target.value;m("emailId",l);const a=y("emailId",l);j(r=>({...r,emailId:a}))}}),c.emailId&&e.jsx("div",{className:"text-danger mt-1",children:c.emailId})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["GovernmentID(AadharCard No) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{maxLength:12,value:t.governmentId,onChange:s=>{const l=s.target.value;if(/^\d*$/.test(l)){m("governmentId",l);const a=y("governmentId",l);j(r=>({...r,governmentId:a}))}}}),c.governmentId&&e.jsx("div",{className:"text-danger mt-1",children:c.governmentId})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"Lab License / Registration"}),e.jsx(p,{value:L(t.labLicenseOrRegistration),onChange:s=>{const l=s.target.value;m("labLicenseOrRegistration",l);const a=y("labLicenseOrRegistration",l);j(r=>({...r,labLicenseOrRegistration:a}))}}),c.labLicenseOrRegistration&&e.jsx("div",{className:"text-danger mt-1",children:c.labLicenseOrRegistration})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Date of Joining ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"date",value:t.dateOfJoining,onChange:s=>{const l=s.target.value;m("dateOfJoining",l);const a=y("dateOfJoining",l);j(r=>({...r,dateOfJoining:a}))}}),c.dateOfJoining&&e.jsx("div",{className:"text-danger mt-1",children:c.dateOfJoining})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[" ",e.jsx(u,{children:"Department / Assigned Lab"}),e.jsx(p,{value:L(t.departmentOrAssignedLab),onChange:s=>{const l=s.target.value;m("departmentOrAssignedLab",l);const a=y("departmentOrAssignedLab",l);j(r=>({...r,departmentOrAssignedLab:a}))}}),c.departmentOrAssignedLab&&e.jsx("div",{className:"text-danger mt-1",children:c.departmentOrAssignedLab})]}),e.jsxs("div",{className:"col-md-4",children:[" ",e.jsxs(u,{children:["Years of Experience ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"number",value:t.yearOfExperience,onChange:s=>{const l=s.target.value;m("yearOfExperience",l);const a=y("yearOfExperience",l);j(r=>({...r,yearOfExperience:a}))}}),c.yearOfExperience&&e.jsx("div",{className:"text-danger mt-1",children:c.yearOfExperience})]}),e.jsxs("div",{className:"col-md-4",children:[" ",e.jsx(u,{children:"Specialization"}),e.jsx(p,{value:L(t.specialization),onChange:s=>{const l=s.target.value;m("specialization",l);const a=y("specialization",l);j(r=>({...r,specialization:a}))}}),c.specialization&&e.jsx("div",{className:"text-danger mt-1",children:c.specialization})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Shift Timings / Availability ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(re,{value:t.shiftTimingsOrAvailability,onChange:s=>{const l=s.target.value;m("shiftTimingsOrAvailability",l);const a=l?"":"Shift Timing / Availability is required.";j(r=>({...r,shiftTimingsOrAvailability:a}))},children:[e.jsx("option",{value:"",children:"Select Shift"}),e.jsx("option",{value:"06:00-12:00",children:"Morning (06:00 AM – 12:00 PM) – 6 hrs"}),e.jsx("option",{value:"12:00-18:00",children:"Afternoon (12:00 PM – 06:00 PM) – 6 hrs"}),e.jsx("option",{value:"18:00-00:00",children:"Evening (06:00 PM – 12:00 AM) – 6 hrs"}),e.jsx("option",{value:"00:00-06:00",children:"Night (12:00 AM – 06:00 AM) – 6 hrs"}),e.jsx("option",{value:"06:00-15:00",children:"Day Shift (06:00 AM – 03:00 PM) – 9 hrs"}),e.jsx("option",{value:"15:00-00:00",children:"Evening Shift (03:00 PM – 12:00 AM) – 9 hrs"}),e.jsx("option",{value:"21:00-06:00",children:"Night Shift (09:00 PM – 06:00 AM) – 9 hrs"}),e.jsx("option",{value:"06:00-18:00",children:"Long Day (06:00 AM – 06:00 PM) – 12 hrs"}),e.jsx("option",{value:"18:00-06:00",children:"Long Night (06:00 PM – 06:00 AM) – 12 hrs"})]}),c.shiftTimingsOrAvailability&&e.jsx("div",{className:"text-danger mt-1",children:c.shiftTimingsOrAvailability})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"Emergency Contact"}),e.jsx(p,{type:"text",maxLength:10,value:t.emergencyContact,onChange:s=>{const l=s.target.value;/^\d*$/.test(l)&&m("emergencyContact",s.target.value)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Vaccination Status ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(re,{value:t.vaccinationStatus,onChange:s=>m("vaccinationStatus",s.target.value),children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Not Vaccinated",children:"Not Vaccinated"}),e.jsx("option",{value:"Partially Vaccinated",children:"Partially Vaccinated"}),e.jsx("option",{value:"Fully Vaccinated",children:"Fully Vaccinated"})]})]})]}),e.jsx("h5",{className:"mt-3",children:"Address"}),Object.keys(t.address).reduce((s,l,a)=>(a%3===0&&s.push([]),s[s.length-1].push(l),s),[]).map((s,l)=>e.jsx("div",{className:"row mb-3",children:s.map(a=>{var r;return e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{className:"text-capitalize",children:[a," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"text",maxLength:a==="postalCode"?6:void 0,value:L(t.address[a]),onChange:d=>{let i=d.target.value;if(a==="postalCode"){if(/^\d*$/.test(i)){N("address",a,i);const h=y(a,i,t);j(v=>({...v,address:{...v.address,[a]:h}}))}}else{N("address",a,i);const h=y(a,i,t);j(v=>({...v,address:{...v.address,[a]:h}}))}}}),((r=c.address)==null?void 0:r[a])&&e.jsx("div",{className:"text-danger mt-1",children:c.address[a]})]},a)})},l)),e.jsx("h5",{className:"mt-3",children:"Bank Account Details"}),Object.keys(t.bankAccountDetails).reduce((s,l,a)=>(a%3===0&&s.push([]),s[s.length-1].push(l),s),[]).map((s,l)=>e.jsx("div",{className:"row mb-3",children:s.map(a=>{var r;return e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{className:"text-capitalize",children:[a," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{value:t.bankAccountDetails[a],maxLength:a==="accountNumber"?20:a==="panCardNumber"?10:a==="ifscCode"?11:void 0,onChange:async d=>{let i=d.target.value;a==="accountNumber"?/^\d*$/.test(i)&&N("bankAccountDetails",a,i):a==="panCardNumber"?(i=i.toUpperCase(),/^[A-Z]{0,5}[0-9]{0,4}[A-Z]{0,1}$/.test(i)&&N("bankAccountDetails",a,i)):a==="ifscCode"?(i=i.toUpperCase(),/^[A-Z0-9]*$/.test(i)&&N("bankAccountDetails",a,i)):N("bankAccountDetails",a,i);const h=y(a,i,t);j(v=>({...v,bankAccountDetails:{...v.bankAccountDetails,[a]:h}}))},onBlur:async()=>{const d=t.bankAccountDetails[a],i=y(a,d,t);if(j(h=>({...h,bankAccountDetails:{...h.bankAccountDetails,[a]:i}})),a==="panCardNumber"&&d.length===10&&(/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(d)||x.error("Invalid PAN format (e.g., ABCDE1234F)")),a==="ifscCode"&&d.length===11)if(!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(d))x.error("Invalid IFSC format (e.g., HDFC0001234)"),N("bankAccountDetails","bankName",""),N("bankAccountDetails","branchName","");else try{const v=await fetch(`https://ifsc.razorpay.com/${d}`);if(v.ok){const W=await v.json();N("bankAccountDetails","bankName",W.BANK||""),N("bankAccountDetails","branchName",W.BRANCH||"")}}catch{x.error("Error fetching bank details"),N("bankAccountDetails","bankName",""),N("bankAccountDetails","branchName","")}}}),((r=c.bankAccountDetails)==null?void 0:r[a])&&e.jsx("div",{className:"text-danger mt-1",children:c.bankAccountDetails[a]})]},a)})},l)),e.jsx("h5",{className:"mt-3",children:"Documents"}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Profile Image ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(p,{type:"file",accept:"image/*",onChange:async s=>{const l=s.target.files[0];if(l){const a=await te(l),r=y("profilePicture",a);if(r){x.error(r);return}m("profilePicture",a)}}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"Medical Fitness Certificate"}),e.jsx(p,{type:"file",onChange:s=>V(s,"medicalFitnessCertificate")})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"Qualification / Certifications"}),e.jsx(p,{type:"file",onChange:s=>V(s,"qualificationOrCertifications")})]})]}),e.jsx(u,{children:"Previous Employment History"}),e.jsx(Ce,{rows:3,value:t.previousEmploymentHistory,onChange:s=>m("previousEmploymentHistory",s.target.value),placeholder:"Enter previous employment history"}),e.jsx("div",{className:"mb-3 w-100 mt-4",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(F,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:le,children:"User Permissions"})}),e.jsx(fe,{show:M,onClose:()=>B(!1),features:pe,actions:Q,permissions:t.permissions,toggleFeature:Y,toggleAllActions:ae,togglePermission:R,onSave:()=>{console.log("Saved Permissions",t.permissions),B(!1)}})]})}),e.jsx(xe,{children:T?e.jsx(F,{color:"secondary",onClick:w,children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(F,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)"},onClick:()=>C(D),children:"Clear"}),e.jsx(F,{color:"secondary",onClick:w,children:"Cancel"}),e.jsx(F,{style:{backgroundColor:"var(--color-black)",color:"white"},onClick:G,children:"Save"})]})})]}),e.jsxs(ne,{visible:he,onClose:n,size:"xl",children:[e.jsx(ce,{onClose:n,children:e.jsx("strong",{children:E?"PDF Preview":"Image Preview"})}),e.jsx(oe,{className:"text-center",children:E?e.jsx("iframe",{src:se,title:"PDF Preview",style:{width:"100%",height:"80vh",border:"none"}}):e.jsx("img",{src:se,alt:"Preview",style:{maxWidth:"100%",maxHeight:"80vh",borderRadius:"8px"}})})]})]})},Te=A=>_.get(`${K}/getLabTechniciansByClinicById/${A}`),Le=A=>_.post(`${K}/addLabTechnician`,A),Me=(A,w)=>_.put(`${K}/updateById/${A}`,w),Be=A=>_.delete(`${K}/deleteById/${A}`),as=()=>{const[A,w]=g.useState([]),[X,I]=g.useState(!1),[T,f]=g.useState(null),[de,$]=g.useState(!1),[D,t]=g.useState(1),[C,me]=g.useState(10),{searchQuery:ee,setSearchQuery:he}=ge(),[z,M]=g.useState(!1),[B,se]=g.useState(null),[U,E]=g.useState(!1),[J,c]=g.useState(null),[j,H]=g.useState(null),[q,Y]=g.useState(!1),R=async()=>{var n;M(!0);try{const o=localStorage.getItem("HospitalId");if(o){const k=await Te(o);console.log("API Response:",k),M(!1),w(((n=k.data)==null?void 0:n.data)||[])}}catch(o){console.error("❌ Error fetching lab technicians:",o),w([]),M(!1)}finally{M(!1)}};g.useEffect(()=>{R()},[]);const ae=async n=>{try{if(T)await Me(T.id,n),R(),x.success("Technician updated successfully!");else{const o=await Le(n);await R(),console.log(o),H({username:o.data.data.userName,password:o.data.data.password}),I(!1),Y(!0),x.success("Technician added successfully!")}}catch(o){x.error("❌ Failed to save technician."),console.error("API error:",o)}},te=async n=>{try{await Be(n),w(o=>o.filter(k=>k.id!==n)),x.success("Technician deleted successfully!")}catch(o){x.error("❌ Failed to delete technician."),console.error("Delete error:",o)}finally{E(!1)}},{user:m}=be(),N=(n,o)=>{var k,P;return(P=(k=m==null?void 0:m.permissions)==null?void 0:k[n])==null?void 0:P.includes(o)},V=ve.useMemo(()=>{const n=ee.toLowerCase().trim();return n?A.filter(o=>Object.values(o).some(k=>String(k).toLowerCase().includes(n))):A},[ee,A]),G=V.slice((D-1)*C,D*C),le=n=>{try{return atob(n)}catch{return null}};return e.jsxs("div",{children:[N("Laboratory","create")&&e.jsx("div",{className:"mb-3 w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(F,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>I(!0),children:"Add Technician"})}),e.jsxs(ne,{visible:q,backdrop:"static",keyboard:!1,children:[e.jsx(ce,{children:e.jsx("h5",{children:"Technician Credentials"})}),e.jsx(oe,{children:j?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",j.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," ",j.password]}),e.jsx("small",{className:"text-danger",children:"⚠️ Please save these credentials securely. They will not be shown again."})]}):e.jsx("p",{children:"No data available"})}),e.jsx(xe,{children:e.jsx(F,{color:"primary",onClick:()=>{Y(!1),H(null)},children:"Close"})})]}),e.jsx(Ae,{isVisible:U,title:"Delete Technician",message:"Are you sure you want to delete this technician? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>te(J),onCancel:()=>E(!1)}),z?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(ke,{message:"Loading technician..."})}):B?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:B}):e.jsxs(we,{className:"mt-3",striped:!0,hover:!0,responsive:!0,children:[e.jsx(De,{children:e.jsxs(ie,{className:"pink-table  w-auto",children:[e.jsx(S,{children:"#"}),e.jsx(S,{children:"Photo"})," ",e.jsx(S,{children:"Name"}),e.jsx(S,{children:"Contact"}),e.jsx(S,{children:"Sex"}),e.jsx(S,{children:"Specialization"}),e.jsx(S,{children:"Date Of Joining"}),e.jsx(S,{className:"text-end",children:"Actions"})]})}),e.jsx(Ie,{className:"pink-table",children:G.length>0?G.map((n,o)=>e.jsxs(ie,{children:[e.jsx(O,{children:(D-1)*C+o+1}),e.jsx(O,{children:n.profilePicture?e.jsx("img",{src:le(n.profilePicture),alt:n.fullName,width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}})}),e.jsx(O,{children:L(n.fullName)}),e.jsx(O,{children:L(n.contactNumber)}),e.jsx(O,{children:L(n.gender)}),e.jsx(O,{children:n.specialization||"NA"}),e.jsx(O,{children:n.dateOfJoining}),e.jsx(O,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2  ",children:[N("Laboratory","read")&&e.jsx("button",{className:"actionBtn",onClick:()=>{f(n),$(!0),I(!0)},title:"View",children:e.jsx(Oe,{size:18})}),N("Laboratory","update")&&e.jsx("button",{className:"actionBtn",onClick:()=>{f(n),$(!1),I(!0)},title:"Edit",children:e.jsx(Pe,{size:18})}),N("Laboratory","delete")&&e.jsx("button",{className:"actionBtn",onClick:()=>{c(n.id),E(!0)},title:"Delete",children:e.jsx(Se,{size:18})})]})})]},n.id)):e.jsx(ie,{children:e.jsx(O,{colSpan:"9",className:"text-center",style:{color:"var(--color-black)"},children:"No lab technician found."})})})]}),!z&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(V.length/C)},(n,o)=>e.jsx(F,{style:{backgroundColor:D===o+1?"var(--color-black)":"#fff",color:D===o+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>t(o+1),children:o+1},o))}),e.jsx(Fe,{visible:X,onClose:()=>{I(!1),f(null),$(!1)},onSave:ae,initialData:T,viewMode:de,technicians:A,fetchTechs:R})]})};export{as as default};
