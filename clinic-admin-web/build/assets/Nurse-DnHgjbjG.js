import{r as x,i as me,j as e,B as d,v as ee,T as se,n as je,R as ge}from"./index-DwsJnlHn.js";import{f as be,a as Y}from"./Features-D45jZVjg.js";import{c as O}from"./capitalizeWords-CuwF8AcI.js";import{C as ne,a as ce,b as oe}from"./CModalHeader-C9V0HcQQ.js";import{C as pe}from"./CModalTitle-JHBt9lNf.js";import{C as ve}from"./CForm-OJQsngod.js";import{C as m}from"./CFormLabel-BsqO6Mxs.js";import{C as g}from"./CFormInput-F3j-R7Zc.js";import{C as re}from"./CFormSelect-BLkadGQI.js";import{C as Ne}from"./CFormTextarea-DptoSaPG.js";import{a as F}from"./index.esm-j8L8OUOY.js";import{C as ue}from"./CModalFooter-FSUtuZlu.js";import{C as fe}from"./ConfirmationModal-D9T4gQdx.js";import{L as Ce}from"./loader-Claeu4yt.js";import{C as ye,a as ke,b as ie,c as P,d as we,e as D}from"./CTable-D5A-WoAX.js";import{E as De}from"./eye-CwDnd1i1.js";import{P as Ae,T as Ie}from"./trash-2-xlXjzCT3.js";import"./CNavItem-D-_vrklN.js";import"./createLucideIcon-DHcmngCx.js";const Se=({visible:f,onClose:C,onSave:V,initialData:k,viewMode:M,nurses:b,fetchNurses:de})=>{const E={},y={hospitalId:localStorage.getItem("HospitalId"),branchId:localStorage.getItem("branchId"),hospitalName:localStorage.getItem("HospitalName"),fullName:"",gender:"Female",dateOfBirth:"",nurseContactNumber:"",emailId:"",governmentId:"",qualifications:"",dateOfJoining:"",department:"",yearsOfExperience:"",specialization:"",shiftTimingOrAvailability:"",role:"nurse",address:{houseNo:"",street:"",landmark:"",city:"",state:"",postalCode:"",country:"India"},emergencyContactNumber:"",bankAccountDetails:{accountNumber:"",accountHolderName:"",ifscCode:"",bankName:"",branchName:"",panCardNumber:""},medicalFitnessCertificate:"",profilePicture:"",nursingLicense:"",nursingDegreeOrDiplomaCertificate:"",nursingCouncilRegistration:"",previousEmploymentHistory:"",experienceCertificates:"",vaccinationStatus:!0,insuranceOrESIdetails:{policyOrEsiNumber:"",providerName:"",type:"",status:""},permissions:E},[a,p]=x.useState(y),[Z,ae]=x.useState(localStorage.getItem("HospitalId")),[$,U]=x.useState(!1),[G,B]=x.useState(!1),[T,Q]=x.useState(null),[W,H]=x.useState(!1),{user:z}=me(),_=["fullName","gender","dateOfBirth","nurseContactNumber","emailId","governmentId","dateOfJoining","department","yearsOfExperience","hospitalId","vaccinationStatus","profilePicture","role","nursingLicense","nursingCouncilRegistration","address.houseNo","address.street","address.city","address.state","address.postalCode","address.country","bankAccountDetails.accountNumber","bankAccountDetails.accountHolderName","bankAccountDetails.bankName","bankAccountDetails.branchName","bankAccountDetails.ifscCode","bankAccountDetails.panCardNumber"];function q(s,l){const t=[];for(const i of l){const r=i.split(".");let c=s;for(const v of r)c=c==null?void 0:c[v];(!c||String(c).trim()==="")&&t.push(i)}return t}const J=s=>{p(l=>{const t={...l.permissions};return t[s]?delete t[s]:t[s]=[],{...l,permissions:t}})},K=(s,l)=>{p(t=>{const i={...t.permissions};return i[s]||(i[s]=[]),i[s].includes(l)?i[s]=i[s].filter(r=>r!==l):i[s]=[...i[s],l],{...t,permissions:i}})},X=s=>{p(l=>{const t={...l.permissions};return t[s]?t[s].length===Y.length?t[s]=[]:t[s]=[...Y]:t[s]=[...Y],{...l,permissions:t}})},te=s=>new Promise((l,t)=>{const i=new FileReader;i.readAsDataURL(s),i.onload=()=>l(i.result),i.onerror=r=>t(r)});x.useEffect(()=>{p(k||y)},[k]);const h=(s,l)=>{p(t=>({...t,[s]:l}))},j=(s,l,t)=>{p(i=>({...i,[s]:{...i[s],[l]:t}}))},L=(s,l)=>{const t=s.target.files[0];if(!t)return;const i=new FileReader;i.onloadend=()=>{p(r=>({...r,[l]:i.result,[`${l}Name`]:t.name,[`${l}Type`]:t.type}))},i.readAsDataURL(t)},le=()=>{const s=q(a,_);if(s.length>0){d.error(`Please fill required fields: ${s.join(", ")}`);return}if(a.dob){const c=new Date(a.dob),v=new Date,S=v.getFullYear()-c.getFullYear();if((v.getMonth()<c.getMonth()||v.getMonth()===c.getMonth()&&v.getDate()<c.getDate()?S-1:S)<18){d.error("Nurse must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(a.nurseContactNumber)){d.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.emailId)){d.error("Please enter a valid email address.");return}if(b==null?void 0:b.some(c=>c.nurseContactNumber===a.nurseContactNumber&&c.id!==a.id)){d.error("Contact number already exists!");return}if(b==null?void 0:b.some(c=>c.email===a.emailId&&c.id!==a.id)){d.error("Email already exists!");return}if(Object.keys(a.permissions).length===0){d.error("Please assign at least one user permission before saving.");return}console.log("Saving nurse data:",a),V(a),p(y),C()},n=()=>{const s=q(a,_);if(s.length>0){d.error(`Please fill required fields: ${s.join(", ")}`);return}if(a.dob){const c=new Date(a.dob),v=new Date,S=v.getFullYear()-c.getFullYear();if((v.getMonth()<c.getMonth()||v.getMonth()===c.getMonth()&&v.getDate()<c.getDate()?S-1:S)<18){d.error("Nurse must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(a.nurseContactNumber)){d.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.emailId)){d.error("Please enter a valid email address.");return}if(b==null?void 0:b.some(c=>c.nurseContactNumber===a.nurseContactNumber&&c.id!==a.id)){d.error("Contact number already exists!");return}if(b==null?void 0:b.some(c=>c.email===a.emailId&&c.id!==a.id)){d.error("Email already exists!");return}console.log("Nurse data ready for permissions:",a),B(!0)},o=()=>{U(!1),Q(null),H(!1)},N=(s,l)=>{Q(s),H(l==null?void 0:l.includes("pdf")),U(!0)},w=s=>{try{return atob(s)}catch{return null}},A=({title:s,children:l})=>e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-semibold border-b pb-2 mb-4",children:s}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:l})]}),u=({label:s,value:l})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:l||"N/A"})]}),R=({label:s,value:l})=>e.jsxs("div",{className:"col-span-3",children:[s&&e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:l||"N/A"})]}),I=({label:s,type:l,data:t})=>{if(!t)return e.jsxs("p",{children:[s," "]});const i=l==null?void 0:l.startsWith("image/"),r=t.startsWith("data:")?t:`data:${l};base64,${t}`;return e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsxs("strong",{children:[s,":"]}),e.jsxs("div",{className:"mt-2",children:[i?e.jsx("img",{src:r,alt:s,className:"w-32 h-32 object-cover rounded-md border cursor-pointer",onClick:()=>N(r,l)}):e.jsx("button",{type:"button ",className:" btn text-blue-600 hover:underline block mx-2",onClick:()=>N(r,l),style:{backgroundColor:"var(--color-black)",color:"white"},children:"Preview"}),e.jsx("a",{href:r,download:s.replace(/\s+/g,"_"),className:"text-green-600 hover:underline text-sm block  btn",style:{backgroundColor:"var(--color-black)",color:"white"},children:"Download"})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{visible:f,onClose:C,size:"lg",className:"custom-modal",backdrop:"static",children:[e.jsx(ce,{children:e.jsx(pe,{children:M?"Personal Information":"Add / Edit  Nurse"})}),e.jsx(oe,{children:M?e.jsxs("div",{className:"p-4 border rounded shadow-sm bg-white ",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Name : "}),e.jsx("span",{children:a.fullName})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold",children:"Email : "}),e.jsx("span",{children:a.emailId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-bold",children:"Cantact : "}),e.jsx("span",{children:a.nurseContactNumber})]})]}),e.jsxs("div",{className:"text-center",children:[a.profilePicture?e.jsx("img",{src:w(a.profilePicture),alt:a.fullName,width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsxs("div",{style:{color:"var(--color-black)",marginTop:"5px",fontSize:"14px",fontWeight:"500"},children:["ID: ",a.id]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-5 mt-5",children:[e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Full Name",value:a.fullName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Email",value:a.emailId})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Contact",value:a.nurseContactNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Gender",value:a.gender})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Date of Birth",value:a.dateOfBirth})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Government ID",value:a.governmentId})})]}),e.jsx(A,{title:"Work Information",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Date of Joining",value:a.dateOfJoining})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Department",value:a.department})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Experience",value:a.yearsOfExperience})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Qualifications",value:a.qualifications})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Shift Timings",value:a.shiftTimingOrAvailability})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Emergency Contact",value:a.emergencyContactNumber})})]})}),e.jsx(A,{title:"Address",children:e.jsx(R,{value:`${a.address.houseNo}, ${a.address.street}, ${a.address.city}, ${a.address.state} - ${a.address.postalCode}, ${a.address.country}`})}),e.jsx(A,{title:"Bank Details",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Account Number",value:a.bankAccountDetails.accountNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Account Holder Name",value:a.bankAccountDetails.accountHolderName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"IFSC Code",value:a.bankAccountDetails.ifscCode})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Bank Name",value:a.bankAccountDetails.bankName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"Branch Name",value:a.bankAccountDetails.branchName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(u,{label:"PAN Card",value:a.bankAccountDetails.panCardNumber})})]})}),e.jsx(A,{title:"Documents",children:e.jsxs("div",{className:"row",children:[a.qualificationOrCertifications!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(I,{label:"Qualification / Certifications",type:a.nursingDegreeOrDiplomaCertificate,data:a.nursingDegreeOrDiplomaCertificate})}):e.jsx("p",{className:"col-md-6",children:"Not Provided qualification/Certifications"}),a.medicalFitnessCertificate!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(I,{label:"Medical Fitness Certificate",type:a.medicalFitnessCertificate||"application/pdf",data:a.medicalFitnessCertificate})}):e.jsx("p",{className:"col-md-6",children:"Not Provided Medical Fitness Certificate"}),a.nursingCouncilRegistration!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(I,{label:"Nursing Council Registration",type:a.nursingCouncilRegistration||"application/pdf",data:a.nursingCouncilRegistration})}):e.jsx("p",{className:"col-md-6",children:"Nursing Council Registration not provided"})]})}),e.jsx("div",{className:"mt-4"}),e.jsx(A,{title:"Other Information",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(u,{label:"Vaccination Status",value:a.vaccinationStatus})}),e.jsx("div",{className:"col-md-12",children:e.jsx(R,{label:"Previous Employment",value:a.previousEmploymentHistory})})]})})]})]}):e.jsxs(ve,{children:[e.jsx("h5",{children:"Basic Information"}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-5",children:[e.jsxs(m,{children:["ClinicID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{value:Z,disabled:!0,onChange:s=>h("clinicId",s.target.value)})]}),e.jsxs("div",{className:"col-md-7",children:[e.jsxs(m,{children:["Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{value:a.role,disabled:!0,onChange:s=>h("role",s.target.value)})]})]})}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Full Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{value:a.fullName,onChange:s=>h("fullName",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Gender ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(re,{value:a.gender,onChange:s=>h("gender",s.target.value),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Date of Birth ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{type:"date",value:a.dateOfBirth,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],onChange:s=>h("dateOfBirth",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Contact Number ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{type:"text",maxLength:10,value:a.nurseContactNumber,onChange:s=>{const l=s.target.value;/^\d*$/.test(l)&&h("nurseContactNumber",l)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Email ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{type:"email",value:a.emailId,onChange:s=>h("emailId",s.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["GovernmentID(AadharCard No) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{maxLength:12,value:a.governmentId,onChange:s=>{const l=s.target.value;/^\d*$/.test(l)&&h("governmentId",l)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Nursing Council Registration",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{value:O(a.nursingCouncilRegistration),onChange:s=>h("nursingCouncilRegistration",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Date of Joining ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{type:"date",value:a.dateOfJoining,onChange:s=>h("dateOfJoining",s.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Department",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{value:O(a.department),onChange:s=>h("department",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Years of Experience ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{type:"number",value:a.yearsOfExperience,onChange:s=>h("yearsOfExperience",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(m,{children:"Qualifications"}),e.jsx(g,{value:O(a.qualifications),onChange:s=>h("qualifications",s.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Shift Timings / Availability ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(re,{value:a.shiftTimingOrAvailability,onChange:s=>h("shiftTimingOrAvailability",s.target.value),children:[e.jsx("option",{value:"",children:"Select Shift"}),e.jsx("option",{value:"06:00-12:00",children:"Morning (06:00 AM – 12:00 PM) – 6 hrs"}),e.jsx("option",{value:"12:00-18:00",children:"Afternoon (12:00 PM – 06:00 PM) – 6 hrs"}),e.jsx("option",{value:"18:00-00:00",children:"Evening (06:00 PM – 12:00 AM) – 6 hrs"}),e.jsx("option",{value:"00:00-06:00",children:"Night (12:00 AM – 06:00 AM) – 6 hrs"}),e.jsx("option",{value:"06:00-15:00",children:"Day Shift (06:00 AM – 03:00 PM) – 9 hrs"}),e.jsx("option",{value:"15:00-00:00",children:"Evening Shift (03:00 PM – 12:00 AM) – 9 hrs"}),e.jsx("option",{value:"21:00-06:00",children:"Night Shift (09:00 PM – 06:00 AM) – 9 hrs"}),e.jsx("option",{value:"06:00-18:00",children:"Long Day (06:00 AM – 06:00 PM) – 12 hrs"}),e.jsx("option",{value:"18:00-06:00",children:"Long Night (06:00 PM – 06:00 AM) – 12 hrs"})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(m,{children:"Emergency Contact"}),e.jsx(g,{type:"text",maxLength:10,value:a.emergencyContactNumber,onChange:s=>{const l=s.target.value;/^\d*$/.test(l)&&h("emergencyContactNumber",s.target.value)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Vaccination Status ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(re,{value:a.vaccinationStatus,onChange:s=>h("vaccinationStatus",s.target.value),children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Not Vaccinated",children:"Not Vaccinated"}),e.jsx("option",{value:"Partially Vaccinated",children:"Partially Vaccinated"}),e.jsx("option",{value:"Fully Vaccinated",children:"Fully Vaccinated"})]})]})]}),e.jsx("h5",{className:"mt-3",children:"Address"}),Object.keys(a.address).reduce((s,l,t)=>(t%3===0&&s.push([]),s[s.length-1].push(l),s),[]).map((s,l)=>e.jsx("div",{className:"row mb-3",children:s.map(t=>e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{className:"text-capitalize",children:[t," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{type:"text",maxLength:t==="postalCode"?6:void 0,value:O(a.address[t]),onChange:i=>{let r=i.target.value;t==="postalCode"?/^\d*$/.test(r)&&j("address",t,r):j("address",t,r)}})]},t))},l)),e.jsx("h5",{className:"mt-3",children:"Bank Account Details"}),Object.keys(a.bankAccountDetails).reduce((s,l,t)=>(t%3===0&&s.push([]),s[s.length-1].push(l),s),[]).map((s,l)=>e.jsx("div",{className:"row mb-3",children:s.map(t=>e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{className:"text-capitalize",children:[t," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{value:a.bankAccountDetails[t],maxLength:t==="accountNumber"?20:t==="panCardNumber"?10:t==="ifscCode"?11:void 0,onChange:async i=>{let r=i.target.value;if(console.log(t,r),t==="accountNumber"){/^\d*$/.test(r)&&j("bankAccountDetails",t,r);return}if(t==="panCardNumber"){r=r.toUpperCase(),/^[A-Z]{0,5}[0-9]{0,4}[A-Z]{0,1}$/.test(r)&&j("bankAccountDetails",t,r),r.length===10&&(/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(r)||d.error("Invalid PAN format (e.g., ABCDE1234F)"));return}if(t==="ifscCode"){if(r=r.toUpperCase(),!/^[A-Z0-9]*$/.test(r))return;if(j("bankAccountDetails",t,r),r.length===11){if(!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(r)){d.error("Invalid IFSC format (e.g., HDFC0001234)"),j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","");return}try{const v=await fetch(`https://ifsc.razorpay.com/${r}`);if(v.ok){const S=await v.json();j("bankAccountDetails","bankName",S.BANK||""),j("bankAccountDetails","branchName",S.BRANCH||"")}else d.error("Invalid IFSC Code"),j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","")}catch{d.error("Error fetching bank details"),j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","")}}else j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","");return}j("bankAccountDetails",t,r)}})]},t))},l)),e.jsx("h5",{className:"mt-3",children:"Documents"}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsxs(m,{children:["Profile Image ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{type:"file",accept:"image/*",onChange:async s=>{const l=s.target.files[0];if(l){const t=await te(l);h("profilePicture",t)}}})]}),e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsxs(m,{children:["Nursing License ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(g,{type:"file",onChange:s=>L(s,"nursingLicense")})]}),e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx(m,{children:"Medical Fitness Certificate"}),e.jsx(g,{type:"file",onChange:s=>L(s,"medicalFitnessCertificate")})]}),e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx(m,{children:"Qualification / Certifications"}),e.jsx(g,{type:"file",onChange:s=>L(s,"nursingDegreeOrDiplomaCertificate")})]})]}),e.jsx(m,{children:"Previous Employment History"}),e.jsx(Ne,{rows:3,value:a.previousEmploymentHistory,onChange:s=>h("nursePreviousEmploymentHistory",s.target.value),placeholder:"Enter previous employment history"}),e.jsx("div",{className:"mb-3 w-100 mt-4",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(F,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:n,children:"User Permissions"})}),G&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Set User Permissions"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>B(!1)})]}),e.jsx("div",{className:"modal-body",children:e.jsx("div",{className:"row",children:be.map(s=>{const l=!!a.permissions[s],t=l&&a.permissions[s].length===Y.length;return e.jsxs("div",{className:"col-md-5 mb-3 border p-2 rounded mx-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("label",{className:"fw-bold",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>J(s)})," ",s]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",disabled:!l,checked:t,onChange:()=>X(s)})," ","Select All"]})]}),e.jsx("div",{className:"d-flex flex-wrap gap-3 mt-2",children:Y.map(i=>{var r;return e.jsxs("label",{className:"d-flex align-items-center gap-1",children:[e.jsx("input",{type:"checkbox",disabled:!l,checked:((r=a.permissions[s])==null?void 0:r.includes(i))||!1,onChange:()=>K(s,i)}),i]},i)})})]},s)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>B(!1),children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>B(!1),children:"Save Permissions"})]})]})})}),G&&e.jsx("div",{className:"modal-backdrop fade show"})]})}),e.jsx(ue,{children:M?e.jsx(F,{color:"secondary",onClick:C,children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(F,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)"},onClick:()=>p(y),children:"Clear"}),e.jsx(F,{color:"secondary",onClick:C,children:"Cancel"}),e.jsx(F,{style:{backgroundColor:"var(--color-black)",color:"white"},onClick:le,children:"Save"})]})})]}),e.jsxs(ne,{visible:$,onClose:o,size:"xl",children:[e.jsx(ce,{onClose:o,children:e.jsx("strong",{children:W?"PDF Preview":"Image Preview"})}),e.jsx(oe,{className:"text-center",children:W?e.jsx("iframe",{src:T,title:"PDF Preview",style:{width:"100%",height:"80vh",border:"none"}}):e.jsx("img",{src:T,alt:"Preview",style:{maxWidth:"100%",maxHeight:"80vh",borderRadius:"8px"}})})]})]})},Pe=f=>ee.post(`${se}/addNurse`,f),Fe=f=>ee.get(`${se}/getAllNurses/${f}`),Me=(f,C,V)=>ee.put(`${se}/updateNurse/${f}/${C}`,V),Ee=(f,C)=>ee.delete(`${se}/deleteNurse/${f}/${C}`),Xe=()=>{const[f,C]=x.useState([]),[V,k]=x.useState(!1),[M,b]=x.useState(null),[de,E]=x.useState(!1),[y,a]=x.useState(1),[p]=x.useState(10),{searchQuery:Z}=je(),[ae,$]=x.useState(!1),[U,G]=x.useState(null),[B,T]=x.useState(!1),[Q,W]=x.useState(null),{user:H}=me(),z=(n,o)=>{var N,w;return(w=(N=H==null?void 0:H.permissions)==null?void 0:N[n])==null?void 0:w.includes(o)},[_,q]=x.useState(!1),[J,K]=x.useState(null),X=async()=>{var n;$(!0);try{const o=localStorage.getItem("HospitalId");if(o){const N=await Fe(o);C(((n=N.data)==null?void 0:n.data)||[])}}catch(o){console.error("Error fetching nurses:",o),C([]),G("Failed to load nurses.")}finally{$(!1)}};x.useEffect(()=>{X()},[]);const te=async n=>{var o,N,w,A,u;$(!0);try{const R=localStorage.getItem("HospitalId");if(M)await Me(R,M.nurseId,n),d.success("Nurse updated successfully!");else{const I=await Pe(n);(N=(o=I.data)==null?void 0:o.data)!=null&&N.userName&&((A=(w=I.data)==null?void 0:w.data)!=null&&A.password)&&(K({username:I.data.data.userName,password:I.data.data.password}),q(!0)),d.success("Nurse added successfully!")}X(),k(!1),b(null),E(!1)}catch(R){R.response?d.error(((u=R.response.data)==null?void 0:u.message)||"Failed to save nurse."):d.error("Failed to save nurse.")}finally{$(!1)}},h=async n=>{try{const o=localStorage.getItem("HospitalId");if(!o||!n){d.error("Missing hospitalId or nurseId");return}await Ee(o,n),C(N=>N.filter(w=>w.nurseId!==n)),d.success("Nurse deleted successfully!")}catch(o){d.error("Failed to delete nurse."),console.error("Delete error:",o)}finally{T(!1)}},j=ge.useMemo(()=>{const n=Z.toLowerCase().trim();return n?f.filter(o=>Object.values(o).some(N=>String(N).toLowerCase().includes(n))):f},[Z,f]),L=j.slice((y-1)*p,y*p),le=n=>{try{return atob(n)}catch{return null}};return e.jsxs("div",{children:[z("Nurses","create")&&e.jsx("div",{className:"mb-3 d-flex justify-content-end",children:e.jsx(F,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>{b(null),E(!1),k(!0)},children:"Add Nurse"})}),e.jsxs(ne,{visible:_,backdrop:"static",keyboard:!1,children:[e.jsx(ce,{children:e.jsx("h5",{children:"Nurse Credentials"})}),e.jsx(oe,{children:J?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",J.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," ",J.password]}),e.jsx("small",{className:"text-danger",children:"⚠️ Please save these credentials securely. They will not be shown again."})]}):e.jsx("p",{children:"No data available"})}),e.jsx(ue,{children:e.jsx(F,{color:"primary",onClick:()=>{q(!1),K(null)},children:"Close"})})]}),e.jsx(fe,{isVisible:B,title:"Delete Nurse",message:"Are you sure you want to delete this nurse? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>h(Q),onCancel:()=>T(!1)}),ae?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(Ce,{message:"Loading nurses..."})}):U?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh"},children:U}):e.jsxs(ye,{className:"mt-3",striped:!0,hover:!0,responsive:!0,children:[e.jsx(ke,{children:e.jsxs(ie,{className:"pink-table",children:[e.jsx(P,{children:"#"}),e.jsx(P,{children:"Photo"}),e.jsx(P,{children:"Name"}),e.jsx(P,{children:"Contact"}),e.jsx(P,{children:"Sex"}),e.jsx(P,{children:"Qualification"}),e.jsx(P,{children:"Date Of Joining"}),e.jsx(P,{className:"text-end",children:"Actions"})]})}),e.jsx(we,{children:L.length>0?L.map((n,o)=>e.jsxs(ie,{children:[e.jsx(D,{children:(y-1)*p+o+1}),e.jsx(D,{children:n.profilePicture?e.jsx("img",{src:le(n.profilePicture),alt:n.fullName,width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}})}),e.jsx(D,{children:O(n.fullName)}),e.jsx(D,{children:O(n.nurseContactNumber)}),e.jsx(D,{children:O(n.gender)}),e.jsx(D,{children:n.qualifications||"NA"}),e.jsx(D,{children:n.dateOfJoining}),e.jsx(D,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[z("Nurses","read")&&e.jsx("button",{className:"actionBtn",onClick:()=>{b(n),E(!0),k(!0)},title:"View",children:e.jsx(De,{size:18})}),z("Nurses","update")&&e.jsx("button",{className:"actionBtn",onClick:()=>{b(n),E(!1),k(!0)},title:"Edit",children:e.jsx(Ae,{size:18})}),z("Nurses","delete")&&e.jsx("button",{className:"actionBtn",onClick:()=>{W(n.nurseId),T(!0)},title:"Delete",children:e.jsx(Ie,{size:18})})]})})]},n.nurseId)):e.jsx(ie,{children:e.jsx(D,{colSpan:"8",className:"text-center",children:"No nurse found."})})})]}),!ae&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(j.length/p)},(n,o)=>e.jsx(F,{style:{backgroundColor:y===o+1?"var(--color-black)":"#fff",color:y===o+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>a(o+1),children:o+1},o))}),e.jsx(Se,{visible:V,onClose:()=>{k(!1),b(null),E(!1)},onSave:te,initialData:M,viewMode:de})]})};export{Xe as default};
