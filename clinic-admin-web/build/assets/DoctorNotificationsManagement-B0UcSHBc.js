import{o as I,E as G,F as W,B as X,H as Y,r as d,k as Z,h as ee,j as e,Q as se,D as j}from"./index-C6Cu0DpS.js";/* empty css                      */import{a as p}from"./index.esm-CuIIRQYS.js";import{C as oe,a as re,b as N,c as h,d as te,e as i}from"./CTable-qb4loNj2.js";import{C as V,a as _,b as z}from"./CModalHeader-Dk8K-sO9.js";import{C as L}from"./CModalTitle-CmjU-2nF.js";import{C as U}from"./CModalFooter-Znwl01vL.js";import{C as ae}from"./CFormLabel-DMQAq1-n.js";import{C as ne}from"./CFormInput-Ducpmanj.js";import"./CConditionalPortal-DtVGpKjo.js";const ce=async(l,t)=>{console.log("DoctorNotifyData calling...");try{const s=await I.get(`${G}/${Y}/${l}/${t}`);return console.log("DoctorNotifyData response:",s.data),s}catch(s){throw console.error("Error fetching doctor notifications:",s.message),s.response?(console.error("Error Response Data:",s.response.data),console.error("Error Response Status:",s.response.status),console.error("Error Response Headers:",s.response.headers)):s.request?console.error("Error Request:",s.request):console.error("Error Message:",s.message),s}},ie=async l=>{var t,s,u,g;try{return console.log("Sending data to API"),(await I.post(`${G}/${W}`,l,{headers:{"Content-Type":"application/json"}})).data}catch(a){throw console.error("Error response:",a.response),alert(`Error: ${(t=a.response)==null?void 0:t.status} - ${((u=(s=a.response)==null?void 0:s.data)==null?void 0:u.message)||((g=a.response)==null?void 0:g.statusText)}`),a}},le=async l=>{try{return await I.get(`${X}/doctors/hospitalById/${l}`)}catch(t){throw console.error("Error fetching doctor notifications:",t),t}},ye=()=>{var v,E,A,T,M,$,F,k,H,B,P,q;const[l,t]=d.useState([]);d.useState(!1),d.useState(null);const[s,u]=d.useState(null),[g,a]=d.useState(!1),[Q,C]=d.useState(!1),[D,w]=d.useState(""),{setNotificationCount:S}=Z(),R=async(r,n="")=>{var c,x,f,m;const o={hospitalId:(c=s==null?void 0:s.data)==null?void 0:c.clinicId,doctorId:(x=s==null?void 0:s.data)==null?void 0:x.doctorId,notificationId:s==null?void 0:s.notificationId,appointmentId:(f=s==null?void 0:s.data)==null?void 0:f.bookingId,subServiceId:(m=s==null?void 0:s.data)==null?void 0:m.subServiceId,status:r,reasonForCancel:n};try{(await ie(o)).status===200&&(j.success(`Notification ${r} successfully`),a(!1),C(!1),w(""),t(b=>b.filter(O=>O.notificationId!==s.notificationId)),S(b=>b-1))}catch{j.error("Something went wrong!")}},J=ee(),K=async(r,n)=>{try{if(!r||!n){t([]);return}const o=await ce(r,n);console.log("DoctorNotifyData response:",o),o.status===200&&Array.isArray(o.data.data)?(S(o.data.data.length),t(o.data.data)):t([])}catch(o){console.error("Error in fetchNotifications:",o),j.error("Failed to fetch notifications"),t([])}};return d.useEffect(()=>{(async()=>{const n=localStorage.getItem("HospitalId");if(!n){j.error("Missing Hospital ID in localStorage");return}try{const o=await le(n);if(o.status===200&&Array.isArray(o.data.data)&&o.data.data.length>0){const c=o.data.data[0].doctorId;localStorage.setItem("DoctorId",c),console.log("✅ Doctor ID set:",c),K(n,c)}else j.warning("No doctors found for this hospital.")}catch(o){console.error("Error fetching doctors:",o),j.error("Error fetching doctor list.")}})()},[]),e.jsxs("div",{className:"container mt-4",children:[e.jsx(se,{}),e.jsx("h5",{children:"Doctor Notifications"}),e.jsxs(oe,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(re,{children:e.jsxs(N,{children:[e.jsx(h,{children:"S.No"}),e.jsx(h,{children:"Doctor Name"}),e.jsx(h,{children:"Patient Name"}),e.jsx(h,{children:"Mobile Number"}),e.jsx(h,{children:"Consultation Type"}),e.jsx(h,{children:"Date"}),e.jsx(h,{children:"Time"}),e.jsx(h,{children:"Action"})]})}),e.jsx(te,{children:l.length>0?l.map((r,n)=>{var o,c,x,f,m,y;return e.jsxs(N,{children:[" ",e.jsx(i,{children:n+1}),e.jsx(i,{children:((o=r.data)==null?void 0:o.doctorName)||"-"}),e.jsx(i,{children:((c=r.data)==null?void 0:c.name)||"-"}),e.jsx(i,{children:((x=r.data)==null?void 0:x.mobileNumber)||"-"}),e.jsx(i,{children:((f=r.data)==null?void 0:f.consultationType)||"-"}),e.jsx(i,{children:((m=r.data)==null?void 0:m.serviceDate)||"-"}),e.jsx(i,{children:((y=r.data)==null?void 0:y.servicetime)||"-"}),e.jsx(i,{children:e.jsx(p,{color:"primary",size:"sm",onClick:()=>{u(r),a(!0)},children:"View"})})]},r.notificationId||n)}):e.jsx(N,{children:e.jsx(i,{colSpan:"9",className:"text-center text-secondary fw-bold",children:"No notifications available or data could not be loaded."})})})]}),e.jsxs(V,{visible:g,onClose:()=>a(!1),children:[e.jsx(_,{children:e.jsx(L,{children:"Appointment Details"})}),e.jsx(z,{children:s&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Doctor:"})," ",(v=s.data)==null?void 0:v.doctorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Patient:"})," ",(E=s.data)==null?void 0:E.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",(A=s.data)==null?void 0:A.age]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gender:"})," ",(T=s.data)==null?void 0:T.gender]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mobile:"})," ",(M=s.data)==null?void 0:M.mobileNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Problem:"})," ",($=s.data)==null?void 0:$.problem]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Clinic:"})," ",(F=s.data)==null?void 0:F.clinicName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Service:"})," ",(k=s.data)==null?void 0:k.subServiceName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",(H=s.data)==null?void 0:H.serviceDate]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",(B=s.data)==null?void 0:B.servicetime]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",(P=s.data)==null?void 0:P.consultationType]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fee:"})," ₹",(q=s.data)==null?void 0:q.consultationFee]})]})}),e.jsxs(U,{children:[e.jsx(p,{color:"primary",size:"sm",className:"px-3",onClick:()=>J("/doctor"),children:"Doctor Details"}),e.jsx(p,{color:"success",className:"text-white",onClick:()=>R("Accepted"),children:"Accept"}),e.jsx(p,{color:"danger",className:"text-white",onClick:()=>{a(!1),C(!0)},children:"Reject"}),e.jsx(p,{color:"secondary",onClick:()=>a(!1),children:"Close"})]})]}),e.jsxs(V,{visible:Q,onClose:()=>C(!1),children:[e.jsx(_,{children:e.jsx(L,{children:"Reject Appointment"})}),e.jsxs(z,{children:[e.jsx(ae,{htmlFor:"rejectReason",children:"Reason for Rejection"}),e.jsx(ne,{id:"rejectReason",value:D,onChange:r=>w(r.target.value),placeholder:"Enter reason here"})]}),e.jsxs(U,{children:[e.jsx(p,{color:"danger",className:"text-white",onClick:()=>{if(!D.trim()){j.warning("Please provide a reason.");return}R("Rejected",D)},children:"Submit"}),e.jsx(p,{color:"secondary",onClick:()=>C(!1),children:"Cancel"})]})]})]})};export{ye as default};
