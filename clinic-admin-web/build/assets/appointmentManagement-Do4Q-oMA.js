import{r as l,b as M,u as z,j as t,C as D}from"./index-BZd6-648.js";import{b as A}from"./index.esm-BZe2opj0.js";import{G}from"./appointmentAPI-CPzz8VX6.js";import{L as V}from"./loader-Dx4sjdu_.js";import{C as T}from"./CFormCheck-i8zbNpMX.js";import{C as _,a as q,b as x,c as r,d as Q,e as c}from"./CTable-BxVenPcb.js";import{C as J}from"./DefaultLayout-Cb0EAVq0.js";import"./CFormLabel-CWNs-Shv.js";import"./CNavItem-wDeXchN9.js";import"./CustomerViewDetails-DHdEXT0k.js";const ue=()=>{const[K,U]=l.useState(null),[W,L]=l.useState([]),[X,P]=l.useState([]),[C,k]=l.useState([]),[Y,B]=l.useState([]),[Z,F]=l.useState([]),{searchQuery:i}=M(),[p,h]=l.useState([]),[d,b]=l.useState([]),[u,j]=l.useState([]),[f,w]=l.useState(1),[H,I]=l.useState(!0),m=7,$=z(),[v,E]=l.useState("asc"),O=async()=>{try{const e=localStorage.getItem("HospitalId");if(console.log("Hospital ID from localStorage:",e),!e){h([]),I(!1);return}console.log("Appointments for this Hospital:",e);const s=await G(e);console.log("Appointments for this Hospital:",s),h(s.data||[]),s!=null&&s.data||(console.warn("No data returned for Hospital ID:",e),h([]))}catch(e){console.error("Failed to fetch appointments:",e),h([])}finally{I(!1)}};l.useEffect(()=>{localStorage.getItem("HospitalId")&&O()},[localStorage.getItem("HospitalId")]),l.useEffect(()=>{let e=[...p];console.log("Initial bookings:",e);const s=o=>o==null?void 0:o.toLowerCase().trim();i.trim()!==""&&(e=e.filter(o=>Object.values(o).some(a=>s(String(a||"")).includes(s(i))))),u.length>0&&(e=e.filter(o=>u.some(a=>s(a)===s(o.status))),console.log("After status filter:",e));const n={"Service & Treatment":"services & treatments","Tele Consultation":"Tele consultation","In-clinic":"in-clinic consultation"};if(d.length===1){const o=d[0];if(o==="Tele Consultation")e=e.filter(a=>s(a.consultationType)==="tele consultation"||s(a.consultationType)==="online consultation"),console.log(`After ${o} filter:`,e);else{const a=n[o];a&&(e=e.filter(g=>s(g.consultationType)===a),console.log(`After ${o} filter:`,e))}}i.trim()&&(e=e.filter(o=>{var a,g;return((a=o.name)==null?void 0:a.toLowerCase().includes(i.toLowerCase().trim()))||((g=o.patientId)==null?void 0:g.toLowerCase().includes(i.toLowerCase().trim()))})),k(e),w(1)},[p,d,u,i]);const R={"In-Progress":"Active",Completed:"Completed",Pending:"Pending",Rejected:"Rejected",Confirmed:"Confirmed"};l.useEffect(()=>{const e=[...new Set(p.map(n=>n.subServiceName).filter(Boolean))],s=[...new Set(p.map(n=>n.consultationType).filter(Boolean))];B(e),F(s),console.log("Available Consultation Types:",s)},[p]),l.useEffect(()=>{window.scrollTo(0,0)},[f]);const N=[...C].sort((e,s)=>{const n=new Date(e.serviceDate),o=new Date(s.serviceDate);return v==="asc"?n-o:o-n}).slice((f-1)*m,f*m),y=e=>{d.includes(e)?b([]):b([e])},S=e=>{const s=e.target.value;u.includes(s)?j([]):j([s])};return l.useEffect(()=>{let e=[...p];console.log("Initial bookings:",e);const s=n=>n==null?void 0:n.toLowerCase().trim();if(i.trim()!==""){const n=s(i);e=e.filter(o=>Object.values(o).some(a=>s(String(a)).includes(n)))}k(e)},[i]),t.jsx("div",{style:{overflow:"hidden"},children:t.jsxs("div",{className:"container ",children:[t.jsx("h5",{children:"Appointments"}),t.jsx("div",{className:"mb-3 d-flex justify-content-between align-items-center flex-wrap gap-2"}),t.jsxs("div",{className:"d-flex gap-2 mb-3",children:[t.jsx("button",{onClick:()=>y("Service & Treatment"),className:`btn ${d.includes("Service & Treatment")?"btn-selected":"btn-unselected"}`,children:"Service & Treatment"}),t.jsx("button",{onClick:()=>y("In-clinic"),className:`btn ${d.includes("In-clinic")?"btn-selected":"btn-unselected"}`,children:"In-Clinic Consultation"}),t.jsx("button",{onClick:()=>y("Tele Consultation"),className:`btn ${d.includes("Tele Consultation")?"btn-selected":"btn-unselected"}`,children:"Tele Consultation"})]}),t.jsxs("div",{className:"mb-3 d-flex justify-content-between align-items-center flex-wrap gap-2",children:[t.jsxs("div",{className:"d-flex gap-2 flex-wrap",style:{color:"var(--color-black)"},children:[t.jsx(T,{style:{color:"var(--color-black)"},label:"Active",value:"In-Progress",onChange:S,checked:u.includes("In-Progress")}),t.jsx(T,{style:{color:"var(--color-black)"},label:"Completed",value:"Completed",onChange:S,checked:u.includes("Completed")}),t.jsx(T,{style:{color:"var(--color-black)"},label:"Confirmed",value:"Confirmed",onChange:S,checked:u.includes("Confirmed")})]}),t.jsx(A,{style:{backgroundColor:"var(--color-black)",color:D.white},onClick:()=>{L([]),P([]),b([]),j([])},children:"Reset Filters"})]}),t.jsxs(_,{striped:!0,hover:!0,responsive:!0,children:[t.jsx(q,{className:"pink-table  w-auto",children:t.jsxs(x,{children:[t.jsx(r,{children:"S.No"}),t.jsx(r,{children:"Patient File_ID"}),t.jsx(r,{children:"Name"}),t.jsx(r,{children:"Doctor Name"}),t.jsx(r,{children:"Consultation Type"}),t.jsxs(r,{onClick:()=>E(v==="asc"?"desc":"asc"),style:{cursor:"pointer"},children:["Date ",v==="asc"?"▲":"▼"]}),t.jsx(r,{children:"Time"}),t.jsx(r,{children:"Status"}),t.jsx(r,{children:"Action"})]})}),t.jsx(Q,{children:H?t.jsx(x,{children:t.jsx(c,{colSpan:"9",className:"text-center  ",style:{color:"var(--color-black)"},children:t.jsx("div",{className:"d-flex justify-content-center align-items-center",children:t.jsx(V,{message:"Loading appointments..."})})})}):N.length>0?N.map((e,s)=>t.jsxs(x,{className:"pink-table",children:[t.jsxs(c,{children:[" ",(f-1)*m+s+1]}),t.jsx(c,{children:e.patientId}),t.jsx(c,{children:e.name}),t.jsx(c,{children:e.doctorName}),t.jsx(c,{children:e.consultationType}),t.jsxs(c,{children:[e.sele?`${e.sele} `:"",e.serviceDate]}),t.jsx(c,{children:e.slot||e.servicetime}),t.jsx(c,{children:t.jsx(J,{style:{backgroundColor:"var(--color-black)",color:D.white},children:R[e.status]||e.status})}),t.jsx(c,{children:t.jsx(A,{style:{backgroundColor:"var(--color-black)"},className:"text-white",size:"sm",onClick:()=>$(`/appointmentDetails/${e.bookingId}`,{state:{appointment:e}}),children:"View"})})]},`${e.id}-${s}`)):t.jsx(x,{children:t.jsx(c,{colSpan:"9",className:"text-center",style:{color:"var(--color-black)"},children:"No appointments found."})})})]}),C.length>m&&t.jsx("div",{style:{marginTop:"20px",display:"flex",justifyContent:"flex-end"},children:Array.from({length:Math.ceil(C.length/m)},(e,s)=>t.jsx("button",{onClick:()=>w(s+1),style:{margin:"0 5px",padding:"5px 10px",backgroundColor:f===s+1?"var(--color-black)":"#fff",color:f===s+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},children:s+1},s))})]})})};export{ue as default};
