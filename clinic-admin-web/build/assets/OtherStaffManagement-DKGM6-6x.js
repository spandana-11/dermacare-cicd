import{r as m,j as e,B as f,h as _,i as K,a as xe,b as je,R as ge}from"./index-CE8wgZIf.js";import{a as Q,f as ve}from"./Features-D45jZVjg.js";import{c as U}from"./capitalizeWords-CuwF8AcI.js";import{U as fe}from"./UserPermissionModal-CzldWoA8.js";import{v as P,a as be}from"./Validators-Dx98MvA1.js";import{C as ne,a as ie,b as oe}from"./CModalHeader-bTJJxI9I.js";import{C as pe}from"./CModalTitle-B0ZxrCNp.js";import{C as Ne}from"./CForm-C9vHVwto.js";import{C as u}from"./CFormLabel-1p4Lfu_H.js";import{C as v}from"./CFormInput-Po4QMieX.js";import{C as me}from"./CFormSelect-CaEax12Y.js";import{C as ye}from"./CFormTextarea-CygHvoyJ.js";import{b as F}from"./index.esm-D3SzBvqQ.js";import{C as he}from"./CModalFooter-26nQh_i4.js";import{C as Ce}from"./ConfirmationModal-CS0aBXT7.js";import{L as ke}from"./loader-CsxI0wUU.js";import{C as Ae,a as we,b as le,c as O,d as De,e as w}from"./CTable-D7EOl3_R.js";import{E as Se}from"./eye-vIkjkHwb.js";import{P as Ie,T as Pe}from"./trash-2-B9Iv_Lgk.js";import"./CNavItem-D_DanzKb.js";const Oe=({visible:b,onClose:C,onSave:X,initialData:A,viewMode:B,technicians:x,fetchTechs:ce})=>{const D={wardBoyId:"",clinicId:localStorage.getItem("HospitalId"),branchId:localStorage.getItem("branchId"),hospitalName:localStorage.getItem("HospitalName"),fullName:"",gender:"male",dateOfBirth:"",contactNumber:"",emailId:"",governmentId:"",dateOfJoining:"",department:"",workExprience:"",shiftTimingOrAvailability:"",emergencyContact:"",role:"other staff",address:{houseNo:"",street:"",landmark:"",city:"",state:"",postalCode:"",country:"India"},bankAccountDetails:{accountNumber:"",accountHolderName:"",ifscCode:"",bankName:"",branchName:"",panCardNumber:""},medicalFitnessCertificate:"",profilePicture:"",basicHealthFirstAidTrainingCertificate:"",previousEmploymentHistory:"",policeVerification:"",policeVerificationCertificate:"",userName:"",password:"",permissions:{}},[a,N]=m.useState(D),[M,ue]=m.useState(localStorage.getItem("HospitalId")),[J,ee]=m.useState(!1),[V,S]=m.useState(!1),[$,se]=m.useState(null),[z,T]=m.useState(!1),[c,p]=m.useState({}),E=["fullName","dateOfBirth","contactNumber","governmentId","dateOfJoining","department","clinicId","medicalFitnessCertificate","role","address.houseNo","address.street","address.city","address.state","address.postalCode","address.country","bankAccountDetails.accountNumber","bankAccountDetails.accountHolderName","bankAccountDetails.bankName","bankAccountDetails.branchName","bankAccountDetails.ifscCode","bankAccountDetails.panCardNumber"];function W(s,r){const t=[];for(const l of r){const d=l.split(".");let n=s;for(const k of d)n=n==null?void 0:n[k];(!n||String(n).trim()==="")&&t.push(l)}return t}const ae=s=>{N(r=>{const t={...r.permissions};return t[s]?delete t[s]:t[s]=[],{...r,permissions:t}})},Z=(s,r)=>{N(t=>{const l={...t.permissions};return l[s]||(l[s]=[]),l[s].includes(r)?l[s]=l[s].filter(d=>d!==r):l[s]=[...l[s],r],{...t,permissions:l}})},R=s=>{N(r=>{const t={...r.permissions};return t[s]?t[s].length===Q.length?t[s]=[]:t[s]=[...Q]:t[s]=[...Q],{...r,permissions:t}})},te=s=>new Promise((r,t)=>{const l=new FileReader;l.readAsDataURL(s),l.onload=()=>r(l.result),l.onerror=d=>t(d)});m.useEffect(()=>{N(A||D)},[A]);const j=(s,r)=>{N(l=>({...l,[s]:r}));const t=P(s,r,{...a,[s]:r},x);p(l=>({...l,[s]:t}))},H=(s,r)=>{const t=P(s,r,a,x);p(l=>({...l,[s]:t}))},g=(s,r,t)=>{N(l=>({...l,[s]:{...l[s],[r]:t}}))},q=(s,r)=>{const t=s.target.files[0];if(!t)return;const l=new FileReader;l.onloadend=()=>{N(d=>({...d,[r]:l.result,[`${r}Name`]:t.name,[`${r}Type`]:t.type}))},l.readAsDataURL(t)},G=()=>{const s=be(a,E);if(s.length){f.error(s.join(`
`),{autoClose:1e3});return}console.log(a),X(a),N(D),C()},re=()=>{const s=W(a,E);if(s.length>0){f.error(`Please fill required fields: ${s.join(", ")}`);return}if(a.dateOfBirth){const n=new Date(a.dateOfBirth),k=new Date,L=k.getFullYear()-n.getFullYear();if((k.getMonth()<n.getMonth()||k.getMonth()===n.getMonth()&&k.getDate()<n.getDate()?L-1:L)<18){f.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(a.contactNumber)){f.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.emailId)){f.error("Please enter a valid email address.");return}if(x==null?void 0:x.some(n=>n.contactNumber===a.contactNumber&&n.id!==a.id)){f.error("Contact number already exists!");return}if(x==null?void 0:x.some(n=>n.emailId===a.emailId&&n.id!==a.id)){f.error("Email already exists!");return}console.log(a),S(!0)},i=()=>{ee(!1),se(null),T(!1)},o=(s,r)=>{se(s),T(r==null?void 0:r.includes("pdf")),ee(!0)},y=s=>{try{return atob(s)}catch{return null}},I=({title:s,children:r})=>e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-semibold border-b pb-2 mb-4",children:s}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:r})]}),h=({label:s,value:r})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:r||"N/A"})]}),Y=({label:s,value:r})=>e.jsxs("div",{className:"col-span-3",children:[s&&e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:r||"N/A"})]}),de=({label:s,type:r,data:t})=>{if(!t)return e.jsxs("p",{children:[s," "]});const l=r==null?void 0:r.startsWith("image/"),d=t.startsWith("data:")?t:`data:${r};base64,${t}`;return e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsxs("strong",{children:[s,":"]}),e.jsxs("div",{className:"mt-2",children:[l?e.jsx("img",{src:d,alt:s,className:"w-32 h-32 object-cover rounded-md border cursor-pointer",onClick:()=>o(d,r)}):e.jsx("button",{type:"button ",className:" btn text-blue-600 hover:underline block mx-2",onClick:()=>o(d,r),style:{backgroundColor:"var(--color-black)",color:"white"},children:"Preview"}),e.jsx("a",{href:d,download:s.replace(/\s+/g,"_"),className:"text-green-600 hover:underline text-sm block  btn",style:{backgroundColor:"var(--color-black)",color:"white"},children:"Download"})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{visible:b,onClose:C,size:"lg",className:"custom-modal",backdrop:"static",children:[e.jsx(ie,{children:e.jsx(pe,{children:B?"Personal Information":"Add / Edit Other Staff"})}),e.jsx(oe,{children:B?e.jsxs("div",{className:"p-4 border rounded shadow-sm bg-white ",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Name : "}),e.jsx("span",{children:a.fullName})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold",children:"Email : "}),e.jsx("span",{children:a.emailId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-bold",children:"Cantact : "}),e.jsx("span",{children:a.contactNumber})]})]}),e.jsxs("div",{className:"text-center",children:[a.profilePicture?e.jsx("img",{src:y(a.profilePicture),alt:a.fullName,width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsxs("div",{style:{color:"var(--color-black)",marginTop:"5px",fontSize:"14px",fontWeight:"500"},children:["ID: ",a.id]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-5 mt-5",children:[e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Full Name",value:a.fullName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Email",value:a.emailId})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Contact",value:a.contactNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Gender",value:a.gender})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Date of Birth",value:a.dateOfBirth})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Government ID",value:a.governmentId})})]}),e.jsx(I,{title:"Work Information",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Date of Joining",value:a.dateOfJoining})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Department",value:a.department})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Experience",value:a.yearOfExperience})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Shift Timings",value:a.shiftTimingOrAvailability})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Emergency Contact",value:a.emergencyContact})})]})}),e.jsx(I,{title:"Address",children:e.jsx(Y,{value:`${a.address.houseNo}, ${a.address.street}, ${a.address.city}, ${a.address.state} - ${a.address.postalCode}, ${a.address.country}`})}),e.jsx(I,{title:"Bank Details",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Account Number",value:a.bankAccountDetails.accountNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Account Holder Name",value:a.bankAccountDetails.accountHolderName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"IFSC Code",value:a.bankAccountDetails.ifscCode})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Bank Name",value:a.bankAccountDetails.bankName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"Branch Name",value:a.bankAccountDetails.branchName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(h,{label:"PAN Card",value:a.bankAccountDetails.panCardNumber})})]})}),e.jsx(I,{title:"Documents",children:e.jsxs("div",{className:"row",children:[a.qualificationOrCertifications!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(de,{label:"Qualification / Certifications",type:a.qualificationOrCertificationsType,data:a.qualificationOrCertifications})}):e.jsx("p",{className:"col-md-6",children:"Not Provided qualification/Certifications"}),a.medicalFitnessCertificate!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(de,{label:"Medical Fitness Certificate",type:a.medicalFitnessCertificateType||"application/pdf",data:a.medicalFitnessCertificate})}):e.jsx("p",{className:"col-md-6",children:"Not Provided medical Fitness Certificate"})]})}),e.jsx("div",{className:"mt-4"}),e.jsx(I,{title:"Other Information ",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(h,{label:"Police Verification",value:a.policeVerification})}),e.jsx("div",{className:"col-md-12",children:e.jsx(Y,{label:"Previous Employment",value:a.previousEmploymentHistory})}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(Y,{label:"User Name",value:a.userName})}),e.jsx("div",{className:"col-md-6",children:e.jsx(Y,{label:"Password",value:a.password})})]})]})})]})]}):e.jsxs(Ne,{children:[e.jsx("h5",{children:"Basic Information"}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-5",children:[e.jsxs(u,{children:["ClinicID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{value:M,disabled:!0,onChange:s=>j("clinicId",s.target.value)})]}),e.jsxs("div",{className:"col-md-7",children:[e.jsxs(u,{children:["Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{value:a.role,disabled:!0,onChange:s=>j("role",s.target.value)})]})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs(u,{children:["Full Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{value:a.fullName,onChange:s=>j("fullName",s.target.value),onBlur:()=>H("fullName",a.fullName)}),c.fullName&&e.jsx("div",{className:"text-danger mt-1",children:c.fullName})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Gender ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(me,{value:a.gender,onChange:s=>j("gender",s.target.value),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]}),c.gender&&e.jsx("div",{className:"text-danger mt-1",children:c.gender})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Date of Birth ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{type:"date",value:a.dateOfBirth,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],onChange:s=>j("dateOfBirth",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Contact Number ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{type:"text",maxLength:10,value:a.contactNumber,onChange:s=>{const r=s.target.value;if(/^\d*$/.test(r)){j("contactNumber",r);const t=validators.contactNumber(r);p(l=>({...l,contactNumber:t}))}}}),c.contactNumber&&e.jsx("div",{className:"text-danger mt-1",children:c.contactNumber})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"Email"}),e.jsx(v,{type:"email",value:a.emailId,onChange:s=>{const r=s.target.value;j("emailId",r);const t=validators.email(r);p(l=>({...l,emailId:t}))}}),c.emailId&&e.jsx("div",{className:"text-danger mt-1",children:c.emailId})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["GovernmentID (AadharCard No) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{maxLength:12,value:a.governmentId,onChange:s=>{const r=s.target.value;if(/^\d*$/.test(r)){j("governmentId",r);const t=validators.aadhar(r);p(l=>({...l,governmentId:t}))}}}),c.governmentId&&e.jsx("div",{className:"text-danger mt-1",children:c.governmentId})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Date of Joining ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{type:"date",value:a.dateOfJoining,onChange:s=>j("dateOfJoining",s.target.value),onBlur:()=>p(s=>({...s,dateOfJoining:P("dateOfJoining",a.dateOfJoining,a,x)}))}),c.dateOfJoining&&e.jsx("div",{className:"text-danger mt-1",children:c.dateOfJoining})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Department ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{value:U(a.department),onChange:s=>j("department",s.target.value),onBlur:()=>p(s=>({...s,department:P("department",a.department,a,x)}))}),c.department&&e.jsx("div",{className:"text-danger mt-1",children:c.department})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[" ",e.jsx(u,{children:"Years of Experience"}),e.jsx(v,{type:"number",value:a.yearOfExperience,onChange:s=>j("yearOfExperience",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Shift Timings / Availability ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(me,{value:a.shiftTimingOrAvailability,onChange:s=>j("shiftTimingOrAvailability",s.target.value),onBlur:()=>{const s=P("shiftTimingOrAvailability",a.shiftTimingOrAvailability,a,x);p(r=>({...r,shiftTimingOrAvailability:s}))},children:[e.jsx("option",{value:"",children:"Select Shift"}),e.jsx("option",{value:"06:00-12:00",children:"Morning (06:00 AM – 12:00 PM) – 6 hrs"}),e.jsx("option",{value:"12:00-18:00",children:"Afternoon (12:00 PM – 06:00 PM) – 6 hrs"}),e.jsx("option",{value:"18:00-00:00",children:"Evening (06:00 PM – 12:00 AM) – 6 hrs"}),e.jsx("option",{value:"00:00-06:00",children:"Night (12:00 AM – 06:00 AM) – 6 hrs"}),e.jsx("option",{value:"06:00-15:00",children:"Day Shift (06:00 AM – 03:00 PM) – 9 hrs"}),e.jsx("option",{value:"15:00-00:00",children:"Evening Shift (03:00 PM – 12:00 AM) – 9 hrs"}),e.jsx("option",{value:"21:00-06:00",children:"Night Shift (09:00 PM – 06:00 AM) – 9 hrs"}),e.jsx("option",{value:"06:00-18:00",children:"Long Day (06:00 AM – 06:00 PM) – 12 hrs"}),e.jsx("option",{value:"18:00-06:00",children:"Long Night (06:00 PM – 06:00 AM) – 12 hrs"})]}),c.shiftTimingOrAvailability&&e.jsx("div",{className:"text-danger mt-1",children:c.shiftTimingOrAvailability})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(u,{children:"Emergency Contact"}),e.jsx(v,{type:"text",maxLength:10,value:a.emergencyContact,onChange:s=>{const r=s.target.value;/^\d*$/.test(r)&&j("emergencyContact",r)},onBlur:()=>{const s=P("emergencyContact",a.emergencyContact,a,x);p(r=>({...r,emergencyContact:s}))}}),c.emergencyContact&&e.jsx("div",{className:"text-danger mt-1",children:c.emergencyContact})]})]}),e.jsx("div",{className:"row mb-3"}),e.jsx("h5",{className:"mt-3",children:"Address"}),Object.keys(a.address).reduce((s,r,t)=>(t%3===0&&s.push([]),s[s.length-1].push(r),s),[]).map((s,r)=>e.jsx("div",{className:"row mb-3",children:s.map(t=>{var l;return e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{className:"text-capitalize",children:[t," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{type:"text",maxLength:t==="postalCode"?6:void 0,value:U(a.address[t]),onChange:d=>{let n=d.target.value;t==="postalCode"?/^\d*$/.test(n)&&g("address",t,n):g("address",t,n)},onBlur:()=>{const d=P(t,a.address[t],a,x);p(n=>({...n,address:{...n.address,[t]:d}}))}}),((l=c.address)==null?void 0:l[t])&&e.jsx("div",{className:"text-danger mt-1",children:c.address[t]})]},t)})},r)),e.jsx("h5",{className:"mt-3",children:"Bank Account Details"}),Object.keys(a.bankAccountDetails).reduce((s,r,t)=>(t%3===0&&s.push([]),s[s.length-1].push(r),s),[]).map((s,r)=>e.jsx("div",{className:"row mb-3",children:s.map(t=>{var l;return e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{className:"text-capitalize",children:[t," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{value:a.bankAccountDetails[t],maxLength:t==="accountNumber"?20:t==="panCardNumber"?10:t==="ifscCode"?11:void 0,onChange:async d=>{let n=d.target.value;if(t==="accountNumber"){/^\d*$/.test(n)&&g("bankAccountDetails",t,n);return}if(t==="panCardNumber"){n=n.toUpperCase(),/^[A-Z]{0,5}[0-9]{0,4}[A-Z]{0,1}$/.test(n)&&g("bankAccountDetails",t,n);return}if(t==="ifscCode"){n=n.toUpperCase(),/^[A-Z0-9]*$/.test(n)&&g("bankAccountDetails",t,n);return}g("bankAccountDetails",t,n)},onBlur:async()=>{const d=P(t,a.bankAccountDetails[t],a);if(p(n=>({...n,bankAccountDetails:{...n.bankAccountDetails,[t]:d}})),t==="panCardNumber"&&a.bankAccountDetails[t].length===10&&(/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(a.bankAccountDetails[t])||f.error("Invalid PAN format (e.g., ABCDE1234F)")),t==="ifscCode"&&a.bankAccountDetails[t].length===11){if(!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(a.bankAccountDetails[t])){f.error("Invalid IFSC format (e.g., HDFC0001234)"),g("bankAccountDetails","bankName",""),g("bankAccountDetails","branchName","");return}try{const k=await fetch(`https://ifsc.razorpay.com/${a.bankAccountDetails[t]}`);if(k.ok){const L=await k.json();g("bankAccountDetails","bankName",L.BANK||""),g("bankAccountDetails","branchName",L.BRANCH||"")}}catch{f.error("Error fetching bank details"),g("bankAccountDetails","bankName",""),g("bankAccountDetails","branchName","")}}}}),((l=c.bankAccountDetails)==null?void 0:l[t])&&e.jsx("div",{className:"text-danger mt-1",children:c.bankAccountDetails[t]})]},t)})},r)),e.jsx("h5",{className:"mt-3",children:"Documents"}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Profile Image ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{type:"file",accept:"image/*",onChange:async s=>{const r=s.target.files[0];if(r){const t=await te(r);j("profilePicture",t)}}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(u,{children:["Medical Fitness Certificate ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(v,{type:"file",onChange:s=>q(s,"medicalFitnessCertificate")})]})]}),e.jsx(u,{children:"Previous Employment History"}),e.jsx(ye,{rows:3,value:a.previousEmploymentHistory,onChange:s=>j("previousEmploymentHistory",s.target.value),placeholder:"Enter previous employment history"}),e.jsx("div",{className:"mb-3 w-100 mt-4",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(F,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:re,children:"User Permissions"})}),e.jsx(fe,{show:V,onClose:()=>S(!1),features:ve,actions:Q,permissions:a.permissions,toggleFeature:ae,toggleAllActions:R,togglePermission:Z,onSave:()=>{console.log("Saved Permissions",a.permissions),S(!1)}})]})}),e.jsx(he,{children:B?e.jsx(F,{color:"secondary",onClick:C,children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(F,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)"},onClick:()=>N(D),children:"Clear"}),e.jsx(F,{color:"secondary",onClick:C,children:"Cancel"}),e.jsx(F,{style:{backgroundColor:"var(--color-black)",color:"white"},onClick:G,children:"Save"})]})})]}),e.jsxs(ne,{visible:J,onClose:i,size:"xl",children:[e.jsx(ie,{onClose:i,children:e.jsx("strong",{children:z?"PDF Preview":"Image Preview"})}),e.jsx(oe,{className:"text-center",children:z?e.jsx("iframe",{src:$,title:"PDF Preview",style:{width:"100%",height:"80vh",border:"none"}}):e.jsx("img",{src:$,alt:"Preview",style:{maxWidth:"100%",maxHeight:"80vh",borderRadius:"8px"}})})]})]})},Fe=b=>_.get(`${K}/getWardBoysByClinicId/${b}`),Be=b=>_.post(`${K}/addWardBoy`,b),Me=(b,C)=>_.put(`${K}/updateWardBoyById/${b}`,C),Te=b=>_.delete(`${K}/deleteWardBoyById/${b}`),rs=()=>{const[b,C]=m.useState([]),[X,A]=m.useState(!1),[B,x]=m.useState(null),[ce,D]=m.useState(!1),[a,N]=m.useState(1),[M,ue]=m.useState(10),{searchQuery:J,setSearchQuery:ee}=xe(),[V,S]=m.useState(!1),[$,se]=m.useState(null),[z,T]=m.useState(!1),[c,p]=m.useState(null),[E,W]=m.useState(null),[ae,Z]=m.useState(!1),R=async()=>{var i;S(!0);try{const o=localStorage.getItem("HospitalId");if(o){const y=await Fe(o);console.log("API Response:",y),S(!1),C(((i=y.data)==null?void 0:i.data)||[])}}catch(o){console.error("❌ Error fetching Other Staff:",o),C([]),S(!1)}finally{S(!1)}};m.useEffect(()=>{R()},[]);const te=async i=>{try{if(B)await Me(B.wardBoyId,i),R(),f.success("Other Staff updated successfully!");else{const o=await Be(i);await R(),console.log(o),W({username:o.data.data.userName,password:o.data.data.password}),A(!1),Z(!0),f.success("Other Staff added successfully!")}}catch(o){f.error("❌ Failed to save Other Staff."),console.error("API error:",o)}},j=async i=>{try{await Te(i),C(o=>o.filter(y=>y.id!==i)),f.success("Other Staff deleted successfully!")}catch(o){f.error("❌ Failed to delete Other Staff."),console.error("Delete error:",o)}finally{T(!1)}},{user:H}=je(),g=(i,o)=>{var y,I;return(I=(y=H==null?void 0:H.permissions)==null?void 0:y[i])==null?void 0:I.includes(o)},q=ge.useMemo(()=>{const i=J.toLowerCase().trim();return i?b.filter(o=>Object.values(o).some(y=>String(y).toLowerCase().includes(i))):b},[J,b]),G=q.slice((a-1)*M,a*M),re=i=>{try{return atob(i)}catch{return null}};return e.jsxs("div",{children:[g("Laboratory","create")&&e.jsx("div",{className:"mb-3 w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(F,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>A(!0),children:"Add Other Staff"})}),e.jsxs(ne,{visible:ae,backdrop:"static",keyboard:!1,children:[e.jsx(ie,{children:e.jsx("h5",{children:"Technician Credentials"})}),e.jsx(oe,{children:E?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",E.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," ",E.password]}),e.jsx("small",{className:"text-danger",children:"⚠️ Please save these credentials securely. They will not be shown again."})]}):e.jsx("p",{children:"No data available"})}),e.jsx(he,{children:e.jsx(F,{color:"primary",onClick:()=>{Z(!1),W(null)},children:"Close"})})]}),e.jsx(Ce,{isVisible:z,title:"Delete Other Staff",message:"Are you sure you want to delete this Other staff? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>j(c),onCancel:()=>T(!1)}),V?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(ke,{message:"Loading technician..."})}):$?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:$}):e.jsxs(Ae,{className:"mt-3",striped:!0,hover:!0,responsive:!0,children:[e.jsx(we,{children:e.jsxs(le,{className:"pink-table  w-auto",children:[e.jsx(O,{children:"#"}),e.jsx(O,{children:"Photo"})," ",e.jsx(O,{children:"Name"}),e.jsx(O,{children:"Contact"}),e.jsx(O,{children:"Sex"}),e.jsx(O,{children:"Specialization"}),e.jsx(O,{children:"Date Of Joining"}),e.jsx(O,{className:"text-end",children:"Actions"})]})}),e.jsx(De,{className:"pink-table",children:G.length>0?G.map((i,o)=>e.jsxs(le,{children:[e.jsx(w,{children:(a-1)*M+o+1}),e.jsx(w,{children:i.profilePicture?e.jsx("img",{src:re(i.profilePicture),alt:i.fullName,width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}})}),e.jsx(w,{children:U(i.fullName)}),e.jsx(w,{children:U(i.contactNumber)}),e.jsx(w,{children:U(i.gender)}),e.jsx(w,{children:i.specialization||"NA"}),e.jsx(w,{children:i.dateOfJoining}),e.jsx(w,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2  ",children:[g("Laboratory","read")&&e.jsx("button",{className:"actionBtn",onClick:()=>{x(i),D(!0),A(!0)},title:"View",children:e.jsx(Se,{size:18})}),g("Laboratory","update")&&e.jsx("button",{className:"actionBtn",onClick:()=>{x(i),D(!1),A(!0)},title:"Edit",children:e.jsx(Ie,{size:18})}),g("Laboratory","delete")&&e.jsx("button",{className:"actionBtn",onClick:()=>{p(i.wardBoyId),T(!0)},title:"Delete",children:e.jsx(Pe,{size:18})})]})})]},i.id)):e.jsx(le,{children:e.jsx(w,{colSpan:"9",className:"text-center",style:{color:"var(--color-black)"},children:"No Staff found."})})})]}),!V&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(q.length/M)},(i,o)=>e.jsx(F,{style:{backgroundColor:a===o+1?"var(--color-black)":"#fff",color:a===o+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>N(o+1),children:o+1},o))}),e.jsx(Oe,{visible:X,onClose:()=>{A(!1),x(null),D(!1)},onSave:te,initialData:B,viewMode:ce,technicians:b,fetchTechs:R})]})};export{rs as default};
