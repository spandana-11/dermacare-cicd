import{h as M,o as pe,p as me,U as he,D as ue,r as c,b as xe,R as je,a as fe,j as e,Q as ye,B as h}from"./index-BpN0qZrt.js";import{b as j}from"./index.esm-BAveQmLP.js";import"./index.es-BCMPbiOB.js";import{C as Ce}from"./ConfirmationModal-Blpddd1P.js";import{c as R}from"./capitalizeWords-CuwF8AcI.js";import{L as Ne}from"./loader-OBkaezw1.js";import{C as B}from"./CForm-D_Fm9Pc8.js";import{C as z,a as H,b as V}from"./CModalHeader-DLH-68_W.js";import{C as F}from"./CModalTitle-CwvqIfsB.js";import{C as U,a as f}from"./CRow-D0GPXItY.js";import{C as y}from"./CFormInput-DMF4wKOV.js";import{C as Z}from"./CModalFooter-Dm04Litg.js";import{C as ge,a as Te,b as q,c as v,d as be,e as C}from"./CTable-Bgk4qBUR.js";import{E as ve}from"./eye-BuIXT__x.js";import{P as we,T as De}from"./trash-2-CRkTwtCJ.js";import"./CNavItem-DIVzBTzM.js";import"./CFormLabel-DO0eStXP.js";const ke=async n=>{try{const o=await M.get(`/${pe}/${n}`);return console.log("test data:",o.data),o.data}catch(o){throw console.error("Error fetching test data:",o.message),o.response&&(console.error("Error Response Data:",o.response.data),console.error("Error Response Status:",o.response.status)),o}},Ie=async n=>{try{const o={testName:n.testName||"",hospitalId:n.hospitalId||"",description:n.description||"",purpose:n.purpose||""},l=await M.post(`/${me}`,o,{headers:{"Content-Type":"application/json"}});return console.log(l),l.data}catch(o){throw console.error("Error response from API:",o.response),o}},Se=async(n,o,l)=>{try{return(await M.put(`/${he}/${o}/${l}`,n,{headers:{"Content-Type":"application/json"}})).data}catch(u){throw console.error("Error updating tet:",u),u}},Ae=async(n,o)=>{try{const l=await M.delete(`/${ue}/${n}/${o}`,{headers:{"Content-Type":"application/json"}});return console.log("Test deleted successfully:",l.data),l.data}catch(l){throw console.error("Error deleting tet:",l.response?l.response.data:l),l}},Ze=()=>{const[n,o]=c.useState([]),[l,u]=c.useState(!1),[O,J]=c.useState(null),[K,N]=c.useState(!1),[g,Q]=c.useState(null),[X,w]=c.useState(!1),[r,D]=c.useState(null),[d,p]=c.useState({}),[ee,E]=c.useState(!1),[se,_]=c.useState(null),[T,te]=c.useState(1),[k,Me]=c.useState(10),{searchQuery:$,setSearchQuery:Ee}=xe(),[i,I]=c.useState({testName:"",hospitalId:"",description:"",purpose:""}),[re,G]=c.useState(null),b=localStorage.getItem("HospitalId"),ae=s=>s.map(t=>({...t,id:t.id||t._id})),S=async s=>{u(!0);try{const t=await ke(s);o(ae(t.data).reverse())}catch{J("Failed to fetch test data.")}finally{u(!1)}},oe=async()=>{try{await Ae(se,re),h.success("Test deleted successfully!",{position:"top-right"}),S(b)}catch(s){h.error("Failed to delete test."),console.error("Delete error:",s)}E(!1)},ne=()=>{_(null),G(null),E(!1)};c.useEffect(()=>{S(b)},[b]);const L=je.useMemo(()=>{const s=$.toLowerCase().trim();return s?n.filter(t=>Object.values(t).some(a=>String(a).toLowerCase().includes(s))):n},[$,n]),{user:P}=fe(),A=(s,t)=>{var a,m;return(m=(a=P==null?void 0:P.permissions)==null?void 0:a[s])==null?void 0:m.includes(t)},W=/^[A-Za-z\s.\-()\/']+$/,le=async()=>{var t,a,m;if(!i.testName.trim()){p({testName:"Test name is required."});return}if(!W.test(i.testName.trim())){p({testName:'Only alphabets, spaces, and "." are allowed.'});return}if(n.some(x=>x.testName.trim().toLowerCase()===i.testName.trim().toLowerCase())){h.error(`Duplicate test name,Add another test - ${i.testName} already exists!`,{position:"top-right"}),N(!1);return}try{const x={testName:i.testName,hospitalId:b,description:i.description,purpose:i.purpose};await Ie(x),h.success("Test added successfully!"),S(b),N(!1),I({testName:"",description:"",purpose:""})}catch(x){const de=((a=(t=x.response)==null?void 0:t.data)==null?void 0:a.message)||((m=x.response)==null?void 0:m.statusText)||"An unexpected error occurred.";h.error(`Error adding test: ${de}`,{position:"top-right"})}},ce=async()=>{var t;if(!((t=r==null?void 0:r.testName)!=null&&t.trim())){p({testName:"Test name is required."});return}if(!W.test(r.testName.trim())){p({testName:'Only alphabets, spaces, and "." are allowed.'});return}if(n.some(a=>a.testName.trim().toLowerCase()===r.testName.trim().toLowerCase()&&a.id!==r.id)){h.error(`Duplicate test name - ${r.testName} already exists!`,{position:"top-right"});return}try{const{id:a,hospitalId:m}=r;await Se(r,a,m),h.success("Test updated successfully!"),w(!1),S(m)}catch(a){console.error("Update error:",a),h.error("Failed to update test.")}},ie=s=>{_(s.testId||s.id||s._id),G(s.hospitalId),E(!0)},Y=L.slice((T-1)*k,T*k);return e.jsxs("div",{children:[e.jsx(ye,{}),e.jsx(B,{className:"d-flex justify-content-between mb-3",children:A("Tests","create")&&e.jsx("div",{className:" w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(j,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>N(!0),children:"Add Test"})})}),g&&e.jsxs(z,{visible:!!g,onClose:()=>Q(null),backdrop:"static",children:[e.jsx(H,{children:e.jsx(F,{children:"Test Details"})}),e.jsxs(V,{style:{color:"var(--color-black)"},children:[e.jsxs(U,{className:"mb-3",children:[e.jsx(f,{sm:4,children:e.jsx("strong",{children:"Test Name:"})}),e.jsx(f,{sm:8,children:g.testName})]}),e.jsxs(U,{className:"mb-3",children:[e.jsx(f,{sm:4,children:e.jsx("strong",{children:"Description:"})}),e.jsx(f,{sm:8,children:g.description})]}),e.jsxs(U,{className:"mb-3",children:[e.jsx(f,{sm:4,children:e.jsx("strong",{children:"Purpose:"})}),e.jsx(f,{sm:8,children:g.purpose||"NA"})]})]})]}),e.jsxs(z,{visible:K,onClose:()=>N(!1),backdrop:"static",children:[e.jsx(H,{children:e.jsx(F,{children:"Add New Test"})}),e.jsx(V,{children:e.jsxs(B,{children:[e.jsxs("h6",{children:["Test Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(y,{type:"text",name:"testName",value:i.testName,onChange:s=>{const t=s.target.value;I({...i,testName:t}),d.testName&&p(a=>({...a,testName:""}))},placeholder:"Enter test name",className:d.testName?"is-invalid":""}),d.testName&&e.jsx("div",{className:"invalid-feedback",style:{color:"red"},children:d.testName}),e.jsx("h6",{children:"Description"}),e.jsx(y,{type:"text",name:"description",value:i.description,onChange:s=>{const t=s.target.value;I({...i,description:t}),d.description&&p(a=>({...a,description:""}))},placeholder:"Enter description",className:d.description?"is-invalid":""}),e.jsx("h6",{children:"Purpose"}),e.jsx(y,{type:"text",name:"purpose",value:i.purpose,onChange:s=>{const t=s.target.value;I({...i,purpose:t}),d.purpose&&p(a=>({...a,purpose:""}))},placeholder:"Enter purpose",className:d.purpose?"is-invalid":""})]})}),e.jsxs(Z,{children:[e.jsx(j,{color:"secondary",onClick:()=>N(!1),children:"Cancel"}),e.jsx(j,{style:{backgroundColor:"var(--color-black)"},className:"text-white",onClick:le,children:"Add"})]})]}),e.jsxs(z,{visible:X,onClose:()=>w(!1),backdrop:"static",children:[e.jsx(H,{children:e.jsx(F,{children:"Edit Test"})}),e.jsx(V,{children:e.jsxs(B,{children:[e.jsxs("h6",{children:["Test Name",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(y,{type:"text",value:(r==null?void 0:r.testName)||"",onChange:s=>{D({...r,testName:s.target.value}),d.testName&&p({...d,testName:""})}}),d.testName&&e.jsx("p",{style:{color:"red",fontSize:"0.9rem",marginTop:"5px"},children:d.testName}),e.jsx("h6",{children:"Description"}),e.jsx(y,{type:"text",value:(r==null?void 0:r.description)||"",onChange:s=>D({...r,description:s.target.value})}),e.jsx("h6",{children:"purpose"}),e.jsx(y,{type:"text",value:(r==null?void 0:r.purpose)||"",onChange:s=>D({...r,purpose:s.target.value})})]})}),e.jsxs(Z,{children:[e.jsx(j,{color:"secondary",onClick:()=>w(!1),children:"Cancel"}),e.jsx(j,{style:{backgroundColor:"var(--color-black)"},className:"text-white",onClick:ce,children:"Update"})]})]}),e.jsx(Ce,{isVisible:ee,title:"Delete Doctor",message:"Are you sure you want to delete this test? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:oe,onCancel:ne}),l?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(Ne,{message:"Loading Test..."})}):O?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:O}):e.jsxs(ge,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(Te,{className:"pink-table",children:e.jsxs(q,{children:[e.jsx(v,{style:{paddingLeft:"40px"},children:"S.No"}),e.jsx(v,{children:"Test Name"}),e.jsx(v,{children:"Description"}),e.jsx(v,{children:"Purpose"}),e.jsx(v,{className:"text-end",children:"Actions"})]})}),e.jsx(be,{className:"pink-table",children:Y.length>0?Y.map((s,t)=>e.jsxs(q,{children:[e.jsx(C,{style:{paddingLeft:"40px"},children:(T-1)*k+t+1}),e.jsx(C,{children:R(s.testName)}),e.jsx(C,{children:R(s.description||"NA")}),e.jsx(C,{children:R(s.purpose||"NA")}),e.jsx(C,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2  ",children:[A("Tests","read")&&e.jsx("button",{className:"actionBtn",onClick:()=>Q(s),title:"View",children:e.jsx(ve,{size:18})}),A("Tests","update")&&e.jsx("button",{className:"actionBtn",onClick:()=>{D(s),w(!0)},title:"Edit",children:e.jsx(we,{size:18})}),A("Tests","delete")&&e.jsx("button",{className:"actionBtn",onClick:()=>ie(s),title:"Delete",children:e.jsx(De,{size:18})})]})})]},s.id)):e.jsx(q,{children:e.jsxs(C,{colSpan:5,className:"text-center text-muted",children:['ðŸ” No tests found matching "',e.jsx("b",{children:$}),'"']})})})]}),!l&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil((L.length?L.length:n.length)/k)},(s,t)=>e.jsx(j,{style:{margin:"0 5px",padding:"5px 10px",backgroundColor:T===t+1?"var(--color-black)":"#fff",color:T===t+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>te(t+1),children:t+1},t))})]})};export{Ze as default};
