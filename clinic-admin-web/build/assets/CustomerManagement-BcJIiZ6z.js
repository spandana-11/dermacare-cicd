import{R as le,h as ge,r as n,n as je,j as e,Q as pe,B as x}from"./index-DOkwaX0Y.js";import{a as M}from"./index.esm-DAUg0Y0u.js";import{a as Ce,d as Ne,C as be,u as ye,b as ve}from"./CustomerManagementAPI-CnUfNEVa.js";import{L as Se}from"./loader-Y_qkV5fc.js";import{C as De}from"./ConfirmationModal-qJMVS8oW.js";import{C as S,a as d}from"./CRow-C9-Fb04l.js";import{C as Ie,a as we,b as z,c as D,d as Be,e as N}from"./CTable-xt3rD9S2.js";import{E as Oe}from"./eye-D7aMrCc8.js";import{P as ke,T as Fe}from"./trash-2-BF777XP-.js";import{C as Me}from"./CForm-MO1FeFt6.js";import{C as c}from"./CFormLabel-CR2I6RN3.js";import{C as re}from"./CFormSelect-DoTC2PbA.js";import{C as h}from"./CFormInput-jpP4n98x.js";import"./CModalHeader-DE82pQwV.js";import"./CNavItem-qJi1XpZf.js";import"./CModalTitle-DY4WadaB.js";import"./CModalFooter-DMXwopYW.js";import"./createLucideIcon-cFB6LJia.js";const Ee=()=>{var te,se;const ne=ge(),[I,E]=n.useState([]),[V,w]=n.useState(!1),[Q,U]=n.useState(null),[b,ie]=n.useState(1),[B,Te]=n.useState(10),[oe,T]=n.useState(!1),[g,K]=n.useState(!1),[$e,W]=n.useState(null),[Pe,$]=n.useState(""),[de,P]=n.useState(!1),[Z,L]=n.useState(null),[i,_]=n.useState({}),{searchQuery:A,setSearchQuery:Le}=je(),[a,j]=n.useState({customerId:"",title:"",firstName:"",lastName:"",fullName:"",mobileNumber:"",gender:"",emailId:"",dateOfBirth:"",referCode:"",age:"",hospitalId:localStorage.getItem("HospitalId")||"",hospitalName:localStorage.getItem("HospitalName")||"",branchId:localStorage.getItem("branchId")||"",address:{houseNo:"",street:"",landmark:"",city:"",state:"",country:"India",postalCode:""}}),[Ae,Re]=n.useState([]),[He,Ye]=n.useState(!1),y=n.useRef(null);n.useEffect(()=>()=>{},[]);const u=(t,s,r)=>{j(l=>({...l,[t]:{...l[t],[s]:r}}))},J=t=>{/^\d*$/.test(t)&&(u("address","postalCode",t),y.current&&clearTimeout(y.current),t.length===6&&(y.current=setTimeout(async()=>{var s;try{const r=await fetch(`https://api.postalpincode.in/pincode/${t}`);if(!r.ok)throw new Error(`pincode API ${r.status}`);const l=await r.json();if(((s=l==null?void 0:l[0])==null?void 0:s.Status)==="Success"&&Array.isArray(l[0].PostOffice)&&l[0].PostOffice.length){const m=l[0].PostOffice[0];u("address","street",m.Name||""),u("address","city",m.Region||""),u("address","landmark",m.Block||""),u("address","state",m.State||"")}else console.warn("No PostOffice data returned for pincode",t,l)}catch(r){console.warn("Error fetching pincode data:",r)}},300)))};n.useEffect(()=>()=>{y.current&&clearTimeout(y.current)},[]);const R=n.useCallback(async()=>{w(!0),U(null);try{const t=await Ce(),s=Array.isArray(t)?t.filter(r=>r&&typeof r=="object"):[];E(s)}catch(t){console.error("Error fetching customers:",t),U("Failed to fetch customer data."),E([])}finally{w(!1)}},[]);n.useEffect(()=>{R()},[R]);const v=t=>t?t.toLowerCase().replace(/\b\w/g,s=>s.toUpperCase()):"",ce=t=>{ne(`/customer-management/${t}`)},me=async t=>{var s,r,l,m,p,O,ae;try{w(!0);const k=await be(t),o=k.data||k;let Y="";const F=o.dateOfBirth;if(F)if(/^\d{2}-\d{2}-\d{4}$/.test(F)){const[C,q,G]=F.split("-");Y=`${G}-${q}-${C}`}else{const C=new Date(F);if(!isNaN(C)){const q=C.getFullYear().toString().padStart(4,"0"),G=String(C.getMonth()+1).padStart(2,"0"),xe=String(C.getDate()).padStart(2,"0");Y=`${q}-${G}-${xe}`}}j({customerId:o.customerId||"",title:o.title||"",firstName:o.firstName||"",lastName:o.lastName||"",fullName:o.fullName||"",mobileNumber:o.mobileNumber||"",gender:o.gender||"",emailId:o.emailId||"",dateOfBirth:Y,referCode:o.referCode||"",age:o.age||"",hospitalId:localStorage.getItem("HospitalId"),hospitalName:localStorage.getItem("HospitalName"),branchId:localStorage.getItem("branchId"),address:{houseNo:((s=o.address)==null?void 0:s.houseNo)||"",street:((r=o.address)==null?void 0:r.street)||"",landmark:((l=o.address)==null?void 0:l.landmark)||"",city:((m=o.address)==null?void 0:m.city)||"",state:((p=o.address)==null?void 0:p.state)||"",country:((O=o.address)==null?void 0:O.country)||"India",postalCode:((ae=o.address)==null?void 0:ae.postalCode)||""}}),W(t),K(!0),T(!0)}catch(k){console.error("Failed to fetch customer:",k),x.error("Failed to load customer data")}finally{w(!1)}},f=t=>{const{name:s,value:r}=t.target;j({...a,[s]:r});const l={...i};l[s]&&(delete l[s],_(l))};n.useEffect(()=>{g&&a.address.postalCode&&J(a.address.postalCode)},[g]);const he=async t=>{var s;if(t.preventDefault(),console.log("Submitting form",a),!!fe())try{const r={...a};if(r.fullName=`${a.title} ${a.firstName} ${a.lastName}`.trim(),r.dateOfBirth){const l=new Date(r.dateOfBirth);if(!isNaN(l)){const m=String(l.getDate()).padStart(2,"0"),p=String(l.getMonth()+1).padStart(2,"0"),O=l.getFullYear();r.dateOfBirth=`${m}-${p}-${O}`}}g?(await ye(a.customerId,r),x.success("Customer updated successfully")):(await ve(r),x.success("Customer added successfully")),await R(),X()}catch(r){console.error("Error submitting customer:",r),((s=r==null?void 0:r.response)==null?void 0:s.status)===409?x.error("Customer already exists with this mobile number or email."):x.error("Something went wrong while submitting.")}},X=()=>{T(!1),K(!1),W(null),j({fullName:"",mobileNumber:"",gender:"",emailId:"",dateOfBirth:"",referCode:"",address:{houseNo:"",street:"",city:"",state:"",landmark:"",pincode:""}})},H=le.useMemo(()=>{const t=A.toLowerCase().trim();return t?I.filter(s=>Object.values(s).some(r=>String(r).toLowerCase().includes(t))):I},[A,I]),ee=H.slice((b-1)*B,b*B);n.useEffect(()=>{if(a.dateOfBirth){const t=new Date(a.dateOfBirth);if(isNaN(t))$("");else{const s=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),l=t.getFullYear();$(`${s}-${r}-${l}`)}}else $("")},[a.dateOfBirth]);const ue=async()=>{try{await Ne(Z),x.success("Customer deleted successfully");const t=I.filter(s=>(s==null?void 0:s.customerId)!==Z);E(t)}catch(t){console.error("Delete failed:",t),x.error("Failed to delete customer")}finally{P(!1),L(null)}},fe=()=>{const t={};if(a.title.trim()?/\d/.test(a.title)&&(t.title="Title should not contain numbers"):t.title="Title is required",a.firstName.trim()?/\d/.test(a.firstName)&&(t.firstName="First Name should not contain numbers"):t.firstName="First Name is required",a.mobileNumber.trim()?/^[1-9]\d{9}$/.test(a.mobileNumber)||(t.mobileNumber="Mobile number must be 10 digits (starting from 1-9)"):t.mobileNumber="Mobile number is required",a.emailId.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.emailId)||(t.emailId="Email must be valid and contain @"):t.emailId="Email is required",!a.dateOfBirth.trim())t.dateOfBirth="Date of Birth is required";else{const s=new Date(a.dateOfBirth),r=s.getFullYear(),l=new Date;if(isNaN(s))t.dateOfBirth="Invalid Date of Birth";else if(r.toString().length!==4)t.dateOfBirth="Year must be 4 digits";else if(s>l)t.dateOfBirth="Date of Birth cannot be in the future";else{const m=new Date;m.setFullYear(l.getFullYear()-120),s<m&&(t.dateOfBirth="Date of Birth must not be more than 120 years ago")}}return a.gender||(t.gender="Gender is required"),a.referCode&&/[^a-zA-Z0-9]/.test(a.referCode)&&(t.referCode="Refer code must contain only letters and numbers"),_(t),Object.keys(t).length===0};return e.jsx(e.Fragment,{children:oe?e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"mb-4",children:g?"Edit Customer":"Add New Customer"}),e.jsxs(Me,{onSubmit:he,children:[e.jsxs(S,{className:"mb-3",children:[e.jsxs(d,{md:2,children:[e.jsxs(c,{children:["Title ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(re,{name:"title",value:a.title,onChange:f,invalid:!!i.title,children:[e.jsx("option",{value:"",children:"Select Title"}),e.jsx("option",{value:"Mr.",children:"Mr."}),e.jsx("option",{value:"Mrs.",children:"Mrs."}),e.jsx("option",{value:"Miss",children:"Miss."}),e.jsx("option",{value:"Ms.",children:"Ms."}),e.jsx("option",{value:"Mx.",children:"Mx."}),e.jsx("option",{value:"Dr.",children:"Dr."}),e.jsx("option",{value:"Prof.",children:"Prof."}),e.jsx("option",{value:"Rev.",children:"Rev."}),e.jsx("option",{value:"Sir",children:"Sir."}),e.jsx("option",{value:"Dame",children:"Dame."}),e.jsx("option",{value:"Lord",children:"Lord"}),e.jsx("option",{value:"Lady",children:"Lady"}),e.jsx("option",{value:"Capt.",children:"Capt."}),e.jsx("option",{value:"Col.",children:"Col."}),e.jsx("option",{value:"Gen.",children:"Gen."}),e.jsx("option",{value:"Hon.",children:"Hon."})]}),i.title&&e.jsx("div",{className:"text-danger small",children:i.title})]}),e.jsxs(d,{md:4,children:[e.jsxs(c,{children:["First Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(h,{name:"firstName",value:a.firstName,onChange:f,invalid:!!i.firstName}),i.firstName&&e.jsx("div",{className:"text-danger small",children:i.firstName})]}),e.jsxs(d,{md:3,children:[e.jsx(c,{children:"Last Name"}),e.jsx(h,{name:"lastName",value:a.lastName,onChange:f})]}),e.jsxs(d,{md:3,children:[e.jsxs(c,{children:["Date of Birth ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(h,{type:"date",name:"dateOfBirth",value:a.dateOfBirth,onChange:t=>{f(t);const s=new Date(t.target.value);if(isNaN(s))j(r=>({...r,age:""}));else{const r=Date.now()-s.getTime(),l=new Date(r),m=Math.abs(l.getUTCFullYear()-1970);j(p=>({...p,age:m.toString()}))}},max:new Date().toISOString().split("T")[0],invalid:!!i.dateOfBirth}),i.dateOfBirth&&e.jsx("div",{className:"text-danger small",children:i.dateOfBirth})]})]}),e.jsxs(S,{className:"mb-3",children:[e.jsxs(d,{md:2,children:[e.jsx(c,{children:"Age"}),e.jsx(h,{name:"age",value:a.age||"",readOnly:!0})]}),e.jsxs(d,{md:4,children:[e.jsxs(c,{children:["Email ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(h,{type:"email",name:"emailId",value:a.emailId,onChange:f,invalid:!!i.emailId}),i.emailId&&e.jsx("div",{className:"text-danger small",children:i.emailId})]}),e.jsxs(d,{md:3,children:[e.jsxs(c,{children:["Mobile Number",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(h,{name:"mobileNumber",value:a.mobileNumber,onChange:f,onKeyDown:t=>{!/[0-9]/.test(t.key)&&t.key!=="Backspace"&&t.key!=="Delete"&&t.preventDefault()},onPaste:t=>t.preventDefault(),maxLength:10,invalid:!!i.mobileNumber,disabled:g}),i.mobileNumber&&e.jsx("div",{className:"text-danger small",children:i.mobileNumber})]}),e.jsxs(d,{md:3,children:[e.jsxs(c,{children:["Gender ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(re,{name:"gender",value:a.gender,onChange:f,invalid:!!i.gender,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Others",children:"Others"})]}),i.gender&&e.jsx("div",{className:"text-danger small",children:i.gender})]})]}),e.jsxs(S,{className:"mt-3",children:[e.jsxs(d,{md:2,children:[e.jsxs(c,{children:["House No ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(h,{type:"text",value:((te=a.address)==null?void 0:te.houseNo)||"",onChange:t=>u("address","houseNo",t.target.value)})]}),e.jsxs(d,{md:4,children:[e.jsxs(c,{children:["Postal Code ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(h,{type:"text",maxLength:6,value:((se=a.address)==null?void 0:se.postalCode)||"",onChange:t=>J(t.target.value),placeholder:"6-digit PIN"})]}),e.jsxs(d,{md:3,children:[e.jsxs(c,{children:["Street ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(h,{type:"text",value:v(a.address.street),onChange:t=>u("address","street",t.target.value)})]}),e.jsxs(d,{md:3,children:[e.jsx(c,{children:"Landmark"}),e.jsx(h,{type:"text",value:v(a.address.landmark),onChange:t=>u("address","landmark",t.target.value)})]})]}),e.jsxs(S,{children:[e.jsxs(d,{md:2,children:[e.jsxs(c,{children:["City ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(h,{type:"text",value:v(a.address.city),onChange:t=>u("address","city",t.target.value)})]}),e.jsxs(d,{md:4,children:[e.jsxs(c,{children:["State ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(h,{type:"text",value:v(a.address.state),onChange:t=>u("address","state",t.target.value)})]}),e.jsxs(d,{md:3,children:[e.jsxs(c,{children:["Country ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(h,{type:"text",value:v(a.address.country),onChange:t=>u("address","country",t.target.value)})]}),e.jsxs(d,{md:3,children:[e.jsx(c,{children:"Referral Code"}),e.jsx(h,{name:"referCode",value:a.referCode,onChange:f}),i.referCode&&e.jsx("div",{className:"text-danger",children:i.referCode})]})]}),e.jsx("br",{}),e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(M,{color:"secondary",className:"me-2",onClick:X,children:"Cancel"}),e.jsx(M,{type:"submit",color:"success",style:{backgroundColor:"var(--color-black)",color:"white",border:"none"},children:g?"Update":"Submit"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(S,{className:"d-flex align-items-center mb-3",children:[e.jsx(pe,{}),e.jsx("div",{className:"mb-3 w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(M,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>T(!0),children:"Add New Customer"})})]}),e.jsx(De,{isVisible:de,title:"Delete Customer",message:"Are you sure you want to delete this Customer? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:ue,onCancel:()=>{P(!1),L(null)}}),V?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(Se,{message:"Loading customers..."})}):Q?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:Q}):H.length===0?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:"No Customer Data Found"}):e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{hover:!0,striped:!0,responsive:!0,children:[e.jsx(we,{className:"pink-table  w-auto",children:e.jsxs(z,{children:[e.jsx(D,{children:"S.No"}),e.jsx(D,{children:"Full Name"}),e.jsx(D,{children:"Mobile Number"}),e.jsx(D,{children:"Gender"}),e.jsx(D,{className:"text-end",children:"Actions"})]})}),e.jsx(Be,{className:"pink-table",children:ee.length>0?ee.map((t,s)=>e.jsxs(z,{children:[e.jsxs(N,{children:[" ",(b-1)*B+s+1]}),e.jsx(N,{children:(t==null?void 0:t.fullName)||"-"}),e.jsx(N,{children:(t==null?void 0:t.mobileNumber)||"-"}),e.jsx(N,{children:(t==null?void 0:t.gender)||"-"}),e.jsx(N,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2  ",children:[e.jsx("button",{className:"actionBtn",onClick:()=>ce(t==null?void 0:t.customerId),title:"View",children:e.jsx(Oe,{size:18})}),e.jsx("button",{className:"actionBtn",onClick:()=>me(t==null?void 0:t.customerId),title:"Edit",children:e.jsx(ke,{size:18})}),e.jsx("button",{className:"actionBtn",onClick:()=>{L(t==null?void 0:t.customerId),P(!0)},title:"Delete",children:e.jsx(Fe,{size:18})})]})})]},t.mobileNumber||s)):e.jsx(z,{children:e.jsxs(N,{colSpan:5,className:"text-center text-muted",children:['ðŸ” No diseases found matching "',e.jsx("b",{children:A}),'"']})})})]}),!V&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(H.length/B)},(t,s)=>e.jsx(M,{style:{backgroundColor:b===s+1?"var(--color-black)":"#fff",color:b===s+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>ie(s+1),children:s+1},s))})]})]})})},nt=le.memo(Ee);export{nt as default};
