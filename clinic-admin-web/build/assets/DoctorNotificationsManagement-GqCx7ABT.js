import{h as Z,e as U,w as J,x as ee,N as se,r as x,b as re,u as oe,j as e,Q as te,B as y}from"./index-DIpuK5ve.js";import{b as u}from"./index.esm-D1QouA3b.js";import"./index.es-ylDXcgl1.js";import{C as ae,a as ne,b as D,c as j,d as ce,e as i}from"./CTable-BtWMeZmL.js";import{C as V,a as z,b as _}from"./CModalHeader-CaIVx0Az.js";import{C as G}from"./CModalTitle-CKY4mbYL.js";import{C as Q}from"./CModalFooter-CUSCQX1g.js";import{C as ie}from"./CFormLabel-DjU27C7A.js";import{C as le}from"./CFormInput-BUyqDmRK.js";import"./CNavItem-bk6AY8R-.js";const de=async(l,t)=>{console.log("DoctorNotifyData calling...");try{const r=await U.get(`${J}/${ee}/${l}/${t}`);return console.log("DoctorNotifyData response:",r.data),r}catch(r){throw console.error("Error fetching doctor notifications:",r.message),r.response?(console.error("Error Response Data:",r.response.data),console.error("Error Response Status:",r.response.status),console.error("Error Response Headers:",r.response.headers)):r.request?console.error("Error Request:",r.request):console.error("Error Message:",r.message),r}},he=async l=>{var t,r,g,N;try{return console.log("Sending data to API"),(await U.post(`${J}/${se}`,l,{headers:{"Content-Type":"application/json"}})).data}catch(p){throw console.error("Error response:",p.response),alert(`Error: ${(t=p.response)==null?void 0:t.status} - ${((g=(r=p.response)==null?void 0:r.data)==null?void 0:g.message)||((N=p.response)==null?void 0:N.statusText)}`),p}},xe=async l=>{try{return await Z.get(`/doctors/hospitalById/${l}`)}catch(t){throw console.error("Error fetching doctor notifications:",t),t}},Ne=()=>{var E,T,A,M,$,k,F,H,B,P,L,q;const[l,t]=x.useState([]),[r,g]=x.useState(!1),[N,p]=x.useState(null),[s,K]=x.useState(null),[O,C]=x.useState(!1),[W,b]=x.useState(!1),[w,S]=x.useState(""),{setNotificationCount:R}=re(),X=oe(),v=async(o,d="")=>{var f,n,m,h;const a={hospitalId:(f=s==null?void 0:s.data)==null?void 0:f.clinicId,doctorId:(n=s==null?void 0:s.data)==null?void 0:n.doctorId,notificationId:s==null?void 0:s.notificationId,appointmentId:(m=s==null?void 0:s.data)==null?void 0:m.bookingId,subServiceId:(h=s==null?void 0:s.data)==null?void 0:h.subServiceId,status:o,reasonForCancel:d};try{(await he(a)).status===200&&(y.success(`Notification ${o} successfully`),C(!1),b(!1),S(""),t(I=>I.filter(Y=>Y.notificationId!==s.notificationId)),R(I=>I-1))}catch{y.error("Something went wrong!")}};return x.useEffect(()=>{(async()=>{g(!0);const d=localStorage.getItem("HospitalId");if(!d){y.error("Missing Hospital ID in localStorage"),g(!1);return}try{const a=await xe(d);if(a.status===200&&Array.isArray(a.data.data)&&a.data.data.length>0){const f=a.data.data;let n=[];for(const m of f){const h=m.doctorId;try{const c=await de(d,h);c.status===200&&Array.isArray(c.data.data)&&(n=[...n,...c.data.data])}catch(c){console.error(`Error fetching notifications for doctor ${h}:`,c)}}t(n),R(n.length)}else t([])}catch{y.error("Error fetching doctor list.")}finally{g(!1)}})()},[]),e.jsxs("div",{className:"container mt-4",children:[e.jsx(te,{}),e.jsx("h5",{children:"Doctor Notifications"}),e.jsxs(ae,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(ne,{children:e.jsxs(D,{children:[e.jsx(j,{children:"S.No"}),e.jsx(j,{children:"Doctor Name"}),e.jsx(j,{children:"Patient Name"}),e.jsx(j,{children:"Mobile Number"}),e.jsx(j,{children:"Consultation Type"}),e.jsx(j,{children:"Date"}),e.jsx(j,{children:"Time"}),e.jsx(j,{children:"Action"})]})}),e.jsx(ce,{children:r?e.jsx(D,{children:e.jsx(i,{colSpan:"8",className:"text-center text-primary fw-bold",children:"Loading notifications..."})}):l.length>0?l.map((o,d)=>{var a,f,n,m,h,c;return e.jsxs(D,{children:[e.jsx(i,{children:d+1}),e.jsx(i,{children:((a=o.data)==null?void 0:a.doctorName)||"-"}),e.jsx(i,{children:((f=o.data)==null?void 0:f.name)||"-"}),e.jsx(i,{children:((n=o.data)==null?void 0:n.mobileNumber)||"-"}),e.jsx(i,{children:((m=o.data)==null?void 0:m.consultationType)||"-"}),e.jsx(i,{children:((h=o.data)==null?void 0:h.serviceDate)||"-"}),e.jsx(i,{children:((c=o.data)==null?void 0:c.servicetime)||"-"}),e.jsx(i,{children:e.jsx(u,{color:"primary",size:"sm",onClick:()=>{K(o),C(!0)},children:"View"})})]},o.notificationId||d)}):e.jsx(D,{children:e.jsx(i,{colSpan:"8",className:"text-center text-secondary fw-bold",children:"No notifications available."})})})]}),e.jsxs(V,{visible:O,onClose:()=>C(!1),children:[e.jsx(z,{children:e.jsx(G,{children:"Appointment Details"})}),e.jsx(_,{children:s&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Doctor:"})," ",(E=s.data)==null?void 0:E.doctorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Patient:"})," ",(T=s.data)==null?void 0:T.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",(A=s.data)==null?void 0:A.age]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gender:"})," ",(M=s.data)==null?void 0:M.gender]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mobile:"})," ",($=s.data)==null?void 0:$.mobileNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Problem:"})," ",(k=s.data)==null?void 0:k.problem]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Clinic:"})," ",(F=s.data)==null?void 0:F.clinicName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Service:"})," ",(H=s.data)==null?void 0:H.subServiceName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",(B=s.data)==null?void 0:B.serviceDate]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",(P=s.data)==null?void 0:P.servicetime]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",(L=s.data)==null?void 0:L.consultationType]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fee:"})," â‚¹",(q=s.data)==null?void 0:q.consultationFee]})]})}),e.jsxs(Q,{children:[e.jsx(u,{color:"primary",size:"sm",className:"px-3",onClick:()=>{var o;X(`/doctor/${(o=s.data)==null?void 0:o.doctorId}`)},children:"Doctor Details"}),e.jsx(u,{color:"success",className:"text-white",onClick:()=>v("Accepted"),children:"Accept"}),e.jsx(u,{color:"danger",className:"text-white",onClick:()=>{C(!1),b(!0)},children:"Reject"}),e.jsx(u,{color:"secondary",onClick:()=>C(!1),children:"Close"})]})]}),e.jsxs(V,{visible:W,onClose:()=>b(!1),children:[e.jsx(z,{children:e.jsx(G,{children:"Reject Appointment"})}),e.jsxs(_,{children:[e.jsx(ie,{htmlFor:"rejectReason",children:"Reason for Rejection"}),e.jsx(le,{id:"rejectReason",value:w,onChange:o=>S(o.target.value),placeholder:"Enter reason here"})]}),e.jsxs(Q,{children:[e.jsx(u,{color:"danger",className:"text-white",onClick:()=>{if(!w.trim()){y.warning("Please provide a reason.");return}v("Rejected",w)},children:"Submit"}),e.jsx(u,{color:"secondary",onClick:()=>b(!1),children:"Cancel"})]})]})]})};export{Ne as default};
