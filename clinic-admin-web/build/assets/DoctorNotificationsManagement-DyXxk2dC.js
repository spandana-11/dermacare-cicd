import{o as y,E as U,F as Y,H as Z,r as i,k as ee,h as oe,j as e,Q as se,D as d}from"./index-EDE8c9MU.js";/* empty css                      */import{a as g}from"./index.esm-DqT4Gkkm.js";import{C as re,a as te,b as v,c as h,d as ae,e as l}from"./CTable-BN_W_bcG.js";import{C as V,a as z,b as L}from"./CModalHeader-k2y6NKTg.js";import{C as G}from"./CModalTitle-CRlyRkpg.js";import{C as Q}from"./CModalFooter-CQoPGTjO.js";import{C as ne}from"./CFormLabel-C4ojgCO_.js";import{C as ce}from"./CFormInput-3elEoRX0.js";import"./CConditionalPortal-By2M8GBy.js";const ie=async(j,c)=>{console.log("DoctorNotifyData calling...");try{const t=await y.get(`${U}/${Z}/${j}/${c}`);return console.log("DoctorNotifyData response:",t.data),t}catch(t){throw console.error("Error fetching doctor notifications:",t.message),t.response?(console.error("Error Response Data:",t.response.data),console.error("Error Response Status:",t.response.status),console.error("Error Response Headers:",t.response.headers)):t.request?console.error("Error Request:",t.request):console.error("Error Message:",t.message),t}},le=async j=>{var c,t,D,S;try{return console.log("Sending data to API"),(await y.post(`${U}/${Y}`,j,{headers:{"Content-Type":"application/json"}})).data}catch(p){throw console.error("Error response:",p.response),alert(`Error: ${(c=p.response)==null?void 0:c.status} - ${((D=(t=p.response)==null?void 0:t.data)==null?void 0:D.message)||((S=p.response)==null?void 0:S.statusText)}`),p}},Ce=()=>{var E,A,H,T,k,M,$,F,P,B,q,O;const[j,c]=i.useState([]),[t,D]=i.useState(!1),[S,p]=i.useState(null),[s,_]=i.useState(null),[J,u]=i.useState(!1),[K,C]=i.useState(!1),[b,w]=i.useState(""),{setNotificationCount:W}=ee(),R=async(r,a="")=>{var n,m,f,I;const o={hospitalId:(n=s==null?void 0:s.data)==null?void 0:n.clinicId,doctorId:(m=s==null?void 0:s.data)==null?void 0:m.doctorId,notificationId:s==null?void 0:s.notificationId,appointmentId:(f=s==null?void 0:s.data)==null?void 0:f.bookingId,subServiceId:(I=s==null?void 0:s.data)==null?void 0:I.subServiceId,status:r,reasonForCancel:a};console.log(o);try{const x=await le(o);console.log(x),x.status===200&&(d.success(`Notification ${r} successfully`),u(!1),C(!1),w(""),N())}catch{d.error("Something went wrong!")}},X=oe();i.useEffect(()=>{(async()=>{const a=localStorage.getItem("HospitalId");if(console.log("ðŸ§ª HospitalId from localStorage:",a),!a){d.error("âŒ Hospital ID missing in localStorage");return}try{console.log("ðŸ“¡ Calling API:",`http://192.168.1.24:8080/clinic-admin/doctors/hospitalById/${a}`);const o=await y.get(`http://192.168.1.24:8080/clinic-admin/doctors/hospitalById/${a}`);if(console.log("âœ… Response:",o),o.status===200&&o.data&&Array.isArray(o.data.data)&&o.data.data.length>0){const n=o.data.data[0].doctorId;localStorage.setItem("DoctorId",n),N()}}catch(o){console.error("âŒ Error fetching doctors:",o),o.response?(console.log("Status:",o.response.status),console.log("Error Data:",o.response.data)):o.request?console.log("ðŸš« No response received. Request:",o.request):console.log("â—Other error:",o.message)}})()},[]);const N=async()=>{try{const r=localStorage.getItem("HospitalId"),a=localStorage.getItem("DoctorId");if(console.log("Fetch Notifications: Checking IDs -> HospitalId:",r,"DoctorId:",a),!r||!a){d.error("Authentication Error: Missing Hospital or Doctor ID. Please log in again.",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),c([]);return}const o=await ie(r,a);o.status===200&&Array.isArray(o.data.data)?(W(o.data.data.length),c(o.data.data)):c([])}catch(r){console.error("Error in fetchNotifications:",r),d.error("Failed to fetch notifications. Please check your network or try again later.",{position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"colored"}),c([])}};return i.useEffect(()=>{(async()=>{const a=localStorage.getItem("HospitalId");if(!a){d.error("Missing Hospital ID in localStorage");return}try{const o=await y.get(`http://192.168.1.24:8080/clinic-admin/doctors/hospitalById/${a}`);if(o.status===200&&Array.isArray(o.data)&&o.data.length>0){const n=o.data[0].doctorId;localStorage.setItem("DoctorId",n),console.log("Doctor ID set in localStorage:",n),N()}}catch(o){console.error("Error fetching doctors:",o),d.error("Error fetching doctor list.")}})()},[]),e.jsxs("div",{className:"container mt-4",children:[e.jsx(se,{}),e.jsx("h5",{children:"Doctor Notifications"}),e.jsxs(re,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(te,{children:e.jsxs(v,{children:[e.jsx(h,{children:"S.No"}),e.jsx(h,{children:"Doctor Name"}),e.jsx(h,{children:"Patient Name"}),e.jsx(h,{children:"Mobile Number"}),e.jsx(h,{children:"Consultation Type"}),e.jsx(h,{children:"Date"}),e.jsx(h,{children:"Time"}),e.jsx(h,{children:"Action"})]})}),e.jsx(ae,{children:j.length>0?j.map((r,a)=>{var o,n,m,f,I,x;return e.jsxs(v,{children:[" ",e.jsx(l,{children:a+1}),e.jsx(l,{children:((o=r.data)==null?void 0:o.doctorName)||"-"}),e.jsx(l,{children:((n=r.data)==null?void 0:n.name)||"-"}),e.jsx(l,{children:((m=r.data)==null?void 0:m.mobileNumber)||"-"}),e.jsx(l,{children:((f=r.data)==null?void 0:f.consultationType)||"-"}),e.jsx(l,{children:((I=r.data)==null?void 0:I.serviceDate)||"-"}),e.jsx(l,{children:((x=r.data)==null?void 0:x.servicetime)||"-"}),e.jsx(l,{children:e.jsx(g,{color:"primary",size:"sm",onClick:()=>{_(r),u(!0)},children:"View"})})]},r.notificationId||a)}):e.jsx(v,{children:e.jsx(l,{colSpan:"9",className:"text-center text-secondary fw-bold",children:"No notifications available or data could not be loaded."})})})]}),e.jsxs(V,{visible:J,onClose:()=>u(!1),children:[e.jsx(z,{children:e.jsx(G,{children:"Appointment Details"})}),e.jsx(L,{children:s&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Doctor:"})," ",(E=s.data)==null?void 0:E.doctorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Patient:"})," ",(A=s.data)==null?void 0:A.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",(H=s.data)==null?void 0:H.age]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gender:"})," ",(T=s.data)==null?void 0:T.gender]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mobile:"})," ",(k=s.data)==null?void 0:k.mobileNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Problem:"})," ",(M=s.data)==null?void 0:M.problem]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Clinic:"})," ",($=s.data)==null?void 0:$.clinicName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Service:"})," ",(F=s.data)==null?void 0:F.subServiceName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",(P=s.data)==null?void 0:P.serviceDate]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",(B=s.data)==null?void 0:B.servicetime]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",(q=s.data)==null?void 0:q.consultationType]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fee:"})," â‚¹",(O=s.data)==null?void 0:O.consultationFee]})]})}),e.jsxs(Q,{children:[e.jsx(g,{color:"primary",size:"sm",className:"px-3",onClick:()=>X("/doctor"),children:"Doctor Details"}),e.jsx(g,{color:"success",className:"text-white",onClick:()=>R("Accepted"),children:"Accept"}),e.jsx(g,{color:"danger",className:"text-white",onClick:()=>{u(!1),C(!0)},children:"Reject"}),e.jsx(g,{color:"secondary",onClick:()=>u(!1),children:"Close"})]})]}),e.jsxs(V,{visible:K,onClose:()=>C(!1),children:[e.jsx(z,{children:e.jsx(G,{children:"Reject Appointment"})}),e.jsxs(L,{children:[e.jsx(ne,{htmlFor:"rejectReason",children:"Reason for Rejection"}),e.jsx(ce,{id:"rejectReason",value:b,onChange:r=>w(r.target.value),placeholder:"Enter reason here"})]}),e.jsxs(Q,{children:[e.jsx(g,{color:"danger",className:"text-white",onClick:()=>{if(!b.trim()){d.warning("Please provide a reason.");return}R("Rejected",b)},children:"Submit"}),e.jsx(g,{color:"secondary",onClick:()=>C(!1),children:"Cancel"})]})]})]})};export{Ce as default};
