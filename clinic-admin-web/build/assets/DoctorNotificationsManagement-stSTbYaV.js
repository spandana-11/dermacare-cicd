import{v as Z,z as U,a5 as J,a6 as ee,a7 as se,r as j,i as re,h as oe,j as e,Q as te,B as y}from"./index-DwsJnlHn.js";import{a as u}from"./index.esm-j8L8OUOY.js";import"./index.es-DfI9IbaY.js";import{C as ae,a as ne,b as D,c as x,d as ce,e as i}from"./CTable-D5A-WoAX.js";import{C as z,a as V,b as _}from"./CModalHeader-C9V0HcQQ.js";import{C as G}from"./CModalTitle-JHBt9lNf.js";import{C as Q}from"./CModalFooter-FSUtuZlu.js";import{C as ie}from"./CFormLabel-BsqO6Mxs.js";import{C as le}from"./CFormInput-F3j-R7Zc.js";import"./CNavItem-D-_vrklN.js";const de=async(l,t)=>{console.log("DoctorNotifyData calling...");try{const r=await U.get(`${J}/${ee}/${l}/${t}`);return console.log("DoctorNotifyData response:",r.data),r}catch(r){throw console.error("Error fetching doctor notifications:",r.message),r.response?(console.error("Error Response Data:",r.response.data),console.error("Error Response Status:",r.response.status),console.error("Error Response Headers:",r.response.headers)):r.request?console.error("Error Request:",r.request):console.error("Error Message:",r.message),r}},he=async l=>{var t,r,g,I;try{return console.log("Sending data to API"),(await U.post(`${J}/${se}`,l,{headers:{"Content-Type":"application/json"}})).data}catch(p){throw console.error("Error response:",p.response),alert(`Error: ${(t=p.response)==null?void 0:t.status} - ${((g=(r=p.response)==null?void 0:r.data)==null?void 0:g.message)||((I=p.response)==null?void 0:I.statusText)}`),p}},je=async l=>{try{return await Z.get(`/doctors/hospitalById/${l}`)}catch(t){throw console.error("Error fetching doctor notifications:",t),t}},Ie=()=>{var E,T,A,M,$,k,F,H,B,P,L,q;const[l,t]=j.useState([]),[r,g]=j.useState(!1),[I,p]=j.useState(null),[s,K]=j.useState(null),[O,C]=j.useState(!1),[W,b]=j.useState(!1),[N,S]=j.useState(""),{setNotificationCount:R}=re(),X=oe(),v=async(o,d="")=>{var f,n,m,h;const a={hospitalId:(f=s==null?void 0:s.data)==null?void 0:f.clinicId,doctorId:(n=s==null?void 0:s.data)==null?void 0:n.doctorId,notificationId:s==null?void 0:s.notificationId,appointmentId:(m=s==null?void 0:s.data)==null?void 0:m.bookingId,subServiceId:(h=s==null?void 0:s.data)==null?void 0:h.subServiceId,status:o,reasonForCancel:d};try{(await he(a)).status===200&&(y.success(`Notification ${o} successfully`),C(!1),b(!1),S(""),t(w=>w.filter(Y=>Y.notificationId!==s.notificationId)),R(w=>w-1))}catch{y.error("Something went wrong!")}};return j.useEffect(()=>{(async()=>{g(!0);const d=localStorage.getItem("HospitalId");if(!d){y.error("Missing Hospital ID in localStorage"),g(!1);return}try{const a=await je(d);if(a.status===200&&Array.isArray(a.data.data)&&a.data.data.length>0){const f=a.data.data;let n=[];for(const m of f){const h=m.doctorId;try{const c=await de(d,h);c.status===200&&Array.isArray(c.data.data)&&(n=[...n,...c.data.data])}catch(c){console.error(`Error fetching notifications for doctor ${h}:`,c)}}t(n),R(n.length)}else t([])}catch{y.error("Error fetching doctor list.")}finally{g(!1)}})()},[]),e.jsxs("div",{className:"container mt-4",children:[e.jsx(te,{}),e.jsx("h5",{children:"Doctor Notifications"}),e.jsxs(ae,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(ne,{children:e.jsxs(D,{children:[e.jsx(x,{children:"S.No"}),e.jsx(x,{children:"Doctor Name"}),e.jsx(x,{children:"Patient Name"}),e.jsx(x,{children:"Mobile Number"}),e.jsx(x,{children:"Consultation Type"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Time"}),e.jsx(x,{children:"Action"})]})}),e.jsx(ce,{children:r?e.jsx(D,{children:e.jsx(i,{colSpan:"8",className:"text-center text-primary fw-bold",children:"Loading notifications..."})}):l.length>0?l.map((o,d)=>{var a,f,n,m,h,c;return e.jsxs(D,{children:[e.jsx(i,{children:d+1}),e.jsx(i,{children:((a=o.data)==null?void 0:a.doctorName)||"-"}),e.jsx(i,{children:((f=o.data)==null?void 0:f.name)||"-"}),e.jsx(i,{children:((n=o.data)==null?void 0:n.mobileNumber)||"-"}),e.jsx(i,{children:((m=o.data)==null?void 0:m.consultationType)||"-"}),e.jsx(i,{children:((h=o.data)==null?void 0:h.serviceDate)||"-"}),e.jsx(i,{children:((c=o.data)==null?void 0:c.servicetime)||"-"}),e.jsx(i,{children:e.jsx(u,{color:"primary",size:"sm",onClick:()=>{K(o),C(!0)},children:"View"})})]},o.notificationId||d)}):e.jsx(D,{children:e.jsx(i,{colSpan:"8",className:"text-center text-secondary fw-bold",children:"No notifications available."})})})]}),e.jsxs(z,{visible:O,onClose:()=>C(!1),children:[e.jsx(V,{children:e.jsx(G,{children:"Appointment Details"})}),e.jsx(_,{children:s&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Doctor:"})," ",(E=s.data)==null?void 0:E.doctorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Patient:"})," ",(T=s.data)==null?void 0:T.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",(A=s.data)==null?void 0:A.age]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gender:"})," ",(M=s.data)==null?void 0:M.gender]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mobile:"})," ",($=s.data)==null?void 0:$.mobileNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Problem:"})," ",(k=s.data)==null?void 0:k.problem]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Clinic:"})," ",(F=s.data)==null?void 0:F.clinicName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Service:"})," ",(H=s.data)==null?void 0:H.subServiceName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",(B=s.data)==null?void 0:B.serviceDate]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",(P=s.data)==null?void 0:P.servicetime]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",(L=s.data)==null?void 0:L.consultationType]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fee:"})," â‚¹",(q=s.data)==null?void 0:q.consultationFee]})]})}),e.jsxs(Q,{children:[e.jsx(u,{color:"primary",size:"sm",className:"px-3",onClick:()=>{var o;X(`/doctor/${(o=s.data)==null?void 0:o.doctorId}`)},children:"Doctor Details"}),e.jsx(u,{color:"success",className:"text-white",onClick:()=>v("Accepted"),children:"Accept"}),e.jsx(u,{color:"danger",className:"text-white",onClick:()=>{C(!1),b(!0)},children:"Reject"}),e.jsx(u,{color:"secondary",onClick:()=>C(!1),children:"Close"})]})]}),e.jsxs(z,{visible:W,onClose:()=>b(!1),children:[e.jsx(V,{children:e.jsx(G,{children:"Reject Appointment"})}),e.jsxs(_,{children:[e.jsx(ie,{htmlFor:"rejectReason",children:"Reason for Rejection"}),e.jsx(le,{id:"rejectReason",value:N,onChange:o=>S(o.target.value),placeholder:"Enter reason here"})]}),e.jsxs(Q,{children:[e.jsx(u,{color:"danger",className:"text-white",onClick:()=>{if(!N.trim()){y.warning("Please provide a reason.");return}v("Rejected",N)},children:"Submit"}),e.jsx(u,{color:"secondary",onClick:()=>b(!1),children:"Cancel"})]})]})]})};export{Ie as default};
