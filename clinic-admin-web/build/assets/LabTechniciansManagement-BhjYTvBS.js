import{r as x,j as e,B as h,h as W,i as Q,a as ue,b as xe,R as je}from"./index-uxa4g2ur.js";import{a as G,f as be}from"./Features-D45jZVjg.js";import{c as S}from"./capitalizeWords-CuwF8AcI.js";import{U as ge}from"./UserPermissionModal-DMp9aDy6.js";import{C as te,a as le,b as ie}from"./CModalHeader-B9tHwb6P.js";import{C as ve}from"./CModalTitle-C7iQGtyU.js";import{C as fe}from"./CForm-DBDKG-J3.js";import{C as m}from"./CFormLabel-BuZXY1hU.js";import{C as b}from"./CFormInput-Bq8b7aaW.js";import{C as se}from"./CFormSelect-CgaU_adc.js";import{C as pe}from"./CFormTextarea-ByafMj5b.js";import{b as D}from"./index.esm-DjiU8BSy.js";import{C as de}from"./CModalFooter-Bsfp-_9q.js";import{C as Ne}from"./ConfirmationModal-CqaUvATP.js";import{L as ye}from"./loader-Ch8liZ7R.js";import{C as Ce,a as ke,b as ae,c as A,d as we,e as k}from"./CTable-Kp0k1S59.js";import{E as Ae}from"./eye-DN3aaGKd.js";import{P as De,T as Pe}from"./trash-2-CD6lLqDu.js";import"./CNavItem-BPRZGw1g.js";const Ie=({visible:p,onClose:N,onSave:_,initialData:C,viewMode:P,technicians:g,fetchTechs:re})=>{const R={},y={clinicId:localStorage.getItem("HospitalId"),branchId:localStorage.getItem("branchId"),hospitalName:localStorage.getItem("HospitalName"),fullName:"",gender:"",dateOfBirth:"",contactNumber:"",emailId:"",governmentId:"",qualificationOrCertifications:"",dateOfJoining:"",departmentOrAssignedLab:"",yearOfExperience:"",specialization:"",shiftTimingsOrAvailability:"",role:"lab_technician",address:{houseNo:"",street:"",landmark:"",city:"",state:"",postalCode:"",country:"India"},emergencyContact:"",bankAccountDetails:{accountNumber:"",accountHolderName:"",ifscCode:"",bankName:"",branchName:"",panCardNumber:""},medicalFitnessCertificate:"",profilePicture:"",labLicenseOrRegistration:"",vaccinationStatus:"Fully Vaccinated",previousEmploymentHistory:"",permissions:R,userName:"",password:""},[a,v]=x.useState(y),[ne,K]=x.useState(localStorage.getItem("HospitalId")),[ce,$]=x.useState(!1),[F,M]=x.useState(!1),[X,z]=x.useState(null),[T,V]=x.useState(!1),U=["fullName","gender","dateOfBirth","contactNumber","emailId","governmentId","dateOfJoining","departmentOrAssignedLab","yearOfExperience","clinicId","vaccinationStatus","profilePicture","role","address.houseNo","address.street","address.city","address.state","address.postalCode","address.country","bankAccountDetails.accountNumber","bankAccountDetails.accountHolderName","bankAccountDetails.bankName","bankAccountDetails.branchName","bankAccountDetails.ifscCode","bankAccountDetails.panCardNumber"];function O(s,l){const t=[];for(const c of l){const i=c.split(".");let d=s;for(const f of i)d=d==null?void 0:d[f];(!d||String(d).trim()==="")&&t.push(c)}return t}const q=s=>{v(l=>{const t={...l.permissions};return t[s]?delete t[s]:t[s]=[],{...l,permissions:t}})},ee=(s,l)=>{v(t=>{const c={...t.permissions};return c[s]||(c[s]=[]),c[s].includes(l)?c[s]=c[s].filter(i=>i!==l):c[s]=[...c[s],l],{...t,permissions:c}})},J=s=>{v(l=>{const t={...l.permissions};return t[s]?t[s].length===G.length?t[s]=[]:t[s]=[...G]:t[s]=[...G],{...l,permissions:t}})},L=s=>new Promise((l,t)=>{const c=new FileReader;c.readAsDataURL(s),c.onload=()=>l(c.result),c.onerror=i=>t(i)});x.useEffect(()=>{v(C||y)},[C]);const u=(s,l)=>{v(t=>({...t,[s]:l}))},j=(s,l,t)=>{v(c=>({...c,[s]:{...c[s],[l]:t}}))},B=(s,l)=>{const t=s.target.files[0];if(!t)return;const c=new FileReader;c.onloadend=()=>{v(i=>({...i,[l]:c.result,[`${l}Name`]:t.name,[`${l}Type`]:t.type}))},c.readAsDataURL(t)},E=()=>{const s=O(a,U);if(s.length>0){h.error(`Please fill required fields: ${s.join(", ")}`);return}if(a.dateOfBirth){const d=new Date(a.dateOfBirth),f=new Date,w=f.getFullYear()-d.getFullYear();if((f.getMonth()<d.getMonth()||f.getMonth()===d.getMonth()&&f.getDate()<d.getDate()?w-1:w)<18){h.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(a.contactNumber)){h.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.emailId)){h.error("Please enter a valid email address.");return}if(g==null?void 0:g.some(d=>d.contactNumber===a.contactNumber&&d.id!==a.id)){h.error("Contact number already exists!");return}if(g==null?void 0:g.some(d=>d.emailId===a.emailId&&d.id!==a.id)){h.error("Email already exists!");return}if(Object.keys(a.permissions).length===0){h.error("Please assign at least one user permission before saving.");return}console.log(a),_(a),v(y),N()},Y=()=>{const s=O(a,U);if(s.length>0){h.error(`Please fill required fields: ${s.join(", ")}`);return}if(a.dateOfBirth){const d=new Date(a.dateOfBirth),f=new Date,w=f.getFullYear()-d.getFullYear();if((f.getMonth()<d.getMonth()||f.getMonth()===d.getMonth()&&f.getDate()<d.getDate()?w-1:w)<18){h.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(a.contactNumber)){h.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.emailId)){h.error("Please enter a valid email address.");return}if(g==null?void 0:g.some(d=>d.contactNumber===a.contactNumber&&d.id!==a.id)){h.error("Contact number already exists!");return}if(g==null?void 0:g.some(d=>d.emailId===a.emailId&&d.id!==a.id)){h.error("Email already exists!");return}console.log(a),M(!0)},H=()=>{$(!1),z(null),V(!1)},Z=(s,l)=>{z(s),V(l==null?void 0:l.includes("pdf")),$(!0)},n=s=>{try{return atob(s)}catch{return null}},r=({title:s,children:l})=>e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-semibold border-b pb-2 mb-4",children:s}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:l})]}),o=({label:s,value:l})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:l||"N/A"})]}),I=({label:s,value:l})=>e.jsxs("div",{className:"col-span-3",children:[s&&e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:s}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:l||"N/A"})]}),oe=({label:s,type:l,data:t})=>{if(!t)return e.jsxs("p",{children:[s," "]});const c=l==null?void 0:l.startsWith("image/"),i=t.startsWith("data:")?t:`data:${l};base64,${t}`;return e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsxs("strong",{children:[s,":"]}),e.jsxs("div",{className:"mt-2",children:[c?e.jsx("img",{src:i,alt:s,className:"w-32 h-32 object-cover rounded-md border cursor-pointer",onClick:()=>Z(i,l)}):e.jsx("button",{type:"button ",className:" btn text-blue-600 hover:underline block mx-2",onClick:()=>Z(i,l),style:{backgroundColor:"var(--color-black)",color:"white"},children:"Preview"}),e.jsx("a",{href:i,download:s.replace(/\s+/g,"_"),className:"text-green-600 hover:underline text-sm block  btn",style:{backgroundColor:"var(--color-black)",color:"white"},children:"Download"})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(te,{visible:p,onClose:N,size:"lg",className:"custom-modal",backdrop:"static",children:[e.jsx(le,{children:e.jsx(ve,{children:P?"Personal Information":"Add / Edit Lab Technician"})}),e.jsx(ie,{children:P?e.jsxs("div",{className:"p-4 border rounded shadow-sm bg-white ",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Name : "}),e.jsx("span",{children:a.fullName})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold",children:"Email : "}),e.jsx("span",{children:a.emailId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-bold",children:"Cantact : "}),e.jsx("span",{children:a.contactNumber})]})]}),e.jsxs("div",{className:"text-center",children:[a.profilePicture?e.jsx("img",{src:n(a.profilePicture),alt:a.fullName,width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsxs("div",{style:{color:"var(--color-black)",marginTop:"5px",fontSize:"14px",fontWeight:"500"},children:["ID: ",a.id]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-5 mt-5",children:[e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Full Name",value:a.fullName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Email",value:a.emailId})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Contact",value:a.contactNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Gender",value:a.gender})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Date of Birth",value:a.dateOfBirth})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Government ID",value:a.governmentId})})]}),e.jsx(r,{title:"Work Information",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Date of Joining",value:a.dateOfJoining})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Department",value:a.departmentOrAssignedLab})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Experience",value:a.yearOfExperience})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Specialization",value:a.specialization})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Shift Timings",value:a.shiftTimingsOrAvailability})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Emergency Contact",value:a.emergencyContact})})]})}),e.jsx(r,{title:"Address",children:e.jsx(I,{value:`${a.address.houseNo}, ${a.address.street}, ${a.address.city}, ${a.address.state} - ${a.address.postalCode}, ${a.address.country}`})}),e.jsx(r,{title:"Bank Details",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Account Number",value:a.bankAccountDetails.accountNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Account Holder Name",value:a.bankAccountDetails.accountHolderName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"IFSC Code",value:a.bankAccountDetails.ifscCode})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Bank Name",value:a.bankAccountDetails.bankName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"Branch Name",value:a.bankAccountDetails.branchName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(o,{label:"PAN Card",value:a.bankAccountDetails.panCardNumber})})]})}),e.jsx(r,{title:"Documents",children:e.jsxs("div",{className:"row",children:[a.qualificationOrCertifications!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(oe,{label:"Qualification / Certifications",type:a.qualificationOrCertificationsType,data:a.qualificationOrCertifications})}):e.jsx("p",{className:"col-md-6",children:"Not Provided qualification/Certifications"}),a.medicalFitnessCertificate!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(oe,{label:"Medical Fitness Certificate",type:a.medicalFitnessCertificateType||"application/pdf",data:a.medicalFitnessCertificate})}):e.jsx("p",{className:"col-md-6",children:"Not Provided medical Fitness Certificate"})]})}),e.jsx("div",{className:"mt-4"}),e.jsx(r,{title:"Other Information ",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(o,{label:"Lab License",value:a.labLicenseOrRegistration})}),e.jsx("div",{className:"col-md-6",children:e.jsx(o,{label:"Vaccination Status",value:a.vaccinationStatus})}),e.jsx("div",{className:"col-md-12",children:e.jsx(I,{label:"Previous Employment",value:a.previousEmploymentHistory})}),e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(I,{label:"User Name",value:a.userName})}),e.jsx("div",{className:"col-md-6",children:e.jsx(I,{label:"Password",value:a.password})})]})]})})]})]}):e.jsxs(fe,{children:[e.jsx("h5",{children:"Basic Information"}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-5",children:[e.jsxs(m,{children:["ClinicID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:ne,disabled:!0,onChange:s=>u("clinicId",s.target.value)})]}),e.jsxs("div",{className:"col-md-7",children:[e.jsxs(m,{children:["Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:a.role,disabled:!0,onChange:s=>u("role",s.target.value)})]})]})}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Full Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:a.fullName,onChange:s=>u("fullName",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Gender ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(se,{value:a.gender,onChange:s=>u("gender",s.target.value),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Date of Birth ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"date",value:a.dateOfBirth,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],onChange:s=>u("dateOfBirth",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Contact Number ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"text",maxLength:10,value:a.contactNumber,onChange:s=>{const l=s.target.value;/^\d*$/.test(l)&&u("contactNumber",l)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Email ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"email",value:a.emailId,onChange:s=>u("emailId",s.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["GovernmentID(AadharCard No) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{maxLength:12,value:a.governmentId,onChange:s=>{const l=s.target.value;/^\d*$/.test(l)&&u("governmentId",l)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(m,{children:"Lab License / Registration"}),e.jsx(b,{value:S(a.labLicenseOrRegistration),onChange:s=>u("labLicenseOrRegistration",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Date of Joining ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"date",value:a.dateOfJoining,onChange:s=>u("dateOfJoining",s.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[" ",e.jsx(m,{children:"Department / Assigned Lab"}),e.jsx(b,{value:S(a.departmentOrAssignedLab),onChange:s=>u("departmentOrAssignedLab",s.target.value)})," "]}),e.jsxs("div",{className:"col-md-4",children:[" ",e.jsxs(m,{children:["Years of Experience ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"number",value:a.yearOfExperience,onChange:s=>u("yearOfExperience",s.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[" ",e.jsx(m,{children:"Specialization"}),e.jsx(b,{value:S(a.specialization),onChange:s=>u("specialization",s.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Shift Timings / Availability ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(se,{value:a.shiftTimingsOrAvailability,onChange:s=>u("shiftTimingsOrAvailability",s.target.value),children:[e.jsx("option",{value:"",children:"Select Shift"}),e.jsx("option",{value:"06:00-12:00",children:"Morning (06:00 AM – 12:00 PM) – 6 hrs"}),e.jsx("option",{value:"12:00-18:00",children:"Afternoon (12:00 PM – 06:00 PM) – 6 hrs"}),e.jsx("option",{value:"18:00-00:00",children:"Evening (06:00 PM – 12:00 AM) – 6 hrs"}),e.jsx("option",{value:"00:00-06:00",children:"Night (12:00 AM – 06:00 AM) – 6 hrs"}),e.jsx("option",{value:"06:00-15:00",children:"Day Shift (06:00 AM – 03:00 PM) – 9 hrs"}),e.jsx("option",{value:"15:00-00:00",children:"Evening Shift (03:00 PM – 12:00 AM) – 9 hrs"}),e.jsx("option",{value:"21:00-06:00",children:"Night Shift (09:00 PM – 06:00 AM) – 9 hrs"}),e.jsx("option",{value:"06:00-18:00",children:"Long Day (06:00 AM – 06:00 PM) – 12 hrs"}),e.jsx("option",{value:"18:00-06:00",children:"Long Night (06:00 PM – 06:00 AM) – 12 hrs"})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(m,{children:"Emergency Contact"}),e.jsx(b,{type:"text",maxLength:10,value:a.emergencyContact,onChange:s=>{const l=s.target.value;/^\d*$/.test(l)&&u("emergencyContact",s.target.value)}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Vaccination Status ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(se,{value:a.vaccinationStatus,onChange:s=>u("vaccinationStatus",s.target.value),children:[e.jsx("option",{value:"",children:"Select Status"}),e.jsx("option",{value:"Not Vaccinated",children:"Not Vaccinated"}),e.jsx("option",{value:"Partially Vaccinated",children:"Partially Vaccinated"}),e.jsx("option",{value:"Fully Vaccinated",children:"Fully Vaccinated"})]})]})]}),e.jsx("h5",{className:"mt-3",children:"Address"}),Object.keys(a.address).reduce((s,l,t)=>(t%3===0&&s.push([]),s[s.length-1].push(l),s),[]).map((s,l)=>e.jsx("div",{className:"row mb-3",children:s.map(t=>e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{className:"text-capitalize",children:[t," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"text",maxLength:t==="postalCode"?6:void 0,value:S(a.address[t]),onChange:c=>{let i=c.target.value;t==="postalCode"?/^\d*$/.test(i)&&j("address",t,i):j("address",t,i)}})]},t))},l)),e.jsx("h5",{className:"mt-3",children:"Bank Account Details"}),Object.keys(a.bankAccountDetails).reduce((s,l,t)=>(t%3===0&&s.push([]),s[s.length-1].push(l),s),[]).map((s,l)=>e.jsx("div",{className:"row mb-3",children:s.map(t=>e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{className:"text-capitalize",children:[t," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:a.bankAccountDetails[t],maxLength:t==="accountNumber"?20:t==="panCardNumber"?10:t==="ifscCode"?11:void 0,onChange:async c=>{let i=c.target.value;if(t==="accountNumber"){/^\d*$/.test(i)&&j("bankAccountDetails",t,i);return}if(t==="panCardNumber"){i=i.toUpperCase(),/^[A-Z]{0,5}[0-9]{0,4}[A-Z]{0,1}$/.test(i)&&j("bankAccountDetails",t,i),i.length===10&&(/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(i)||h.error("Invalid PAN format (e.g., ABCDE1234F)"));return}if(t==="ifscCode"){if(i=i.toUpperCase(),!/^[A-Z0-9]*$/.test(i))return;if(j("bankAccountDetails",t,i),i.length===11){if(!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(i)){h.error("Invalid IFSC format (e.g., HDFC0001234)"),j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","");return}try{const f=await fetch(`https://ifsc.razorpay.com/${i}`);if(f.ok){const w=await f.json();j("bankAccountDetails","bankName",w.BANK||""),j("bankAccountDetails","branchName",w.BRANCH||"")}else h.error("Invalid IFSC Code"),j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","")}catch{h.error("Error fetching bank details"),j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","")}}else j("bankAccountDetails","bankName",""),j("bankAccountDetails","branchName","");return}j("bankAccountDetails",t,i)}})]},t))},l)),e.jsx("h5",{className:"mt-3",children:"Documents"}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(m,{children:["Profile Image ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"file",accept:"image/*",onChange:async s=>{const l=s.target.files[0];if(l){const t=await L(l);u("profilePicture",t)}}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(m,{children:"Medical Fitness Certificate"}),e.jsx(b,{type:"file",onChange:s=>B(s,"medicalFitnessCertificate")})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(m,{children:"Qualification / Certifications"}),e.jsx(b,{type:"file",onChange:s=>B(s,"qualificationOrCertifications")})]})]}),e.jsx(m,{children:"Previous Employment History"}),e.jsx(pe,{rows:3,value:a.previousEmploymentHistory,onChange:s=>u("previousEmploymentHistory",s.target.value),placeholder:"Enter previous employment history"}),e.jsx("div",{className:"mb-3 w-100 mt-4",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(D,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:Y,children:"User Permissions"})}),e.jsx(ge,{show:F,onClose:()=>M(!1),features:be,actions:G,permissions:a.permissions,toggleFeature:q,toggleAllActions:J,togglePermission:ee,onSave:()=>{console.log("Saved Permissions",a.permissions),M(!1)}})]})}),e.jsx(de,{children:P?e.jsx(D,{color:"secondary",onClick:N,children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(D,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)"},onClick:()=>v(y),children:"Clear"}),e.jsx(D,{color:"secondary",onClick:N,children:"Cancel"}),e.jsx(D,{style:{backgroundColor:"var(--color-black)",color:"white"},onClick:E,children:"Save"})]})})]}),e.jsxs(te,{visible:ce,onClose:H,size:"xl",children:[e.jsx(le,{onClose:H,children:e.jsx("strong",{children:T?"PDF Preview":"Image Preview"})}),e.jsx(ie,{className:"text-center",children:T?e.jsx("iframe",{src:X,title:"PDF Preview",style:{width:"100%",height:"80vh",border:"none"}}):e.jsx("img",{src:X,alt:"Preview",style:{maxWidth:"100%",maxHeight:"80vh",borderRadius:"8px"}})})]})]})},Se=p=>W.get(`${Q}/getLabTechniciansByClinicById/${p}`),Fe=p=>W.post(`${Q}/addLabTechnician`,p),Me=(p,N)=>W.put(`${Q}/updateById/${p}`,N),Te=p=>W.delete(`${Q}/deleteById/${p}`),Xe=()=>{const[p,N]=x.useState([]),[_,C]=x.useState(!1),[P,g]=x.useState(null),[re,R]=x.useState(!1),[y,a]=x.useState(1),[v,ne]=x.useState(10),{searchQuery:K,setSearchQuery:ce}=ue(),[$,F]=x.useState(!1),[M,X]=x.useState(null),[z,T]=x.useState(!1),[V,U]=x.useState(null),[O,q]=x.useState(null),[ee,J]=x.useState(!1),L=async()=>{var n;F(!0);try{const r=localStorage.getItem("HospitalId");if(r){const o=await Se(r);console.log("API Response:",o),F(!1),N(((n=o.data)==null?void 0:n.data)||[])}}catch(r){console.error("❌ Error fetching lab technicians:",r),N([]),F(!1)}finally{F(!1)}};x.useEffect(()=>{L()},[]);const u=async n=>{try{if(P)await Me(P.id,n),L(),h.success("Technician updated successfully!");else{const r=await Fe(n);await L(),console.log(r),q({username:r.data.data.userName,password:r.data.data.password}),C(!1),J(!0),h.success("Technician added successfully!")}}catch(r){h.error("❌ Failed to save technician."),console.error("API error:",r)}},j=async n=>{try{await Te(n),N(r=>r.filter(o=>o.id!==n)),h.success("Technician deleted successfully!")}catch(r){h.error("❌ Failed to delete technician."),console.error("Delete error:",r)}finally{T(!1)}},{user:B}=xe(),E=(n,r)=>{var o,I;return(I=(o=B==null?void 0:B.permissions)==null?void 0:o[n])==null?void 0:I.includes(r)},Y=je.useMemo(()=>{const n=K.toLowerCase().trim();return n?p.filter(r=>Object.values(r).some(o=>String(o).toLowerCase().includes(n))):p},[K,p]),H=Y.slice((y-1)*v,y*v),Z=n=>{try{return atob(n)}catch{return null}};return e.jsxs("div",{children:[E("Laboratory","create")&&e.jsx("div",{className:"mb-3 w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(D,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>C(!0),children:"Add Technician"})}),e.jsxs(te,{visible:ee,backdrop:"static",keyboard:!1,children:[e.jsx(le,{children:e.jsx("h5",{children:"Technician Credentials"})}),e.jsx(ie,{children:O?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",O.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," ",O.password]}),e.jsx("small",{className:"text-danger",children:"⚠️ Please save these credentials securely. They will not be shown again."})]}):e.jsx("p",{children:"No data available"})}),e.jsx(de,{children:e.jsx(D,{color:"primary",onClick:()=>{J(!1),q(null)},children:"Close"})})]}),e.jsx(Ne,{isVisible:z,title:"Delete Technician",message:"Are you sure you want to delete this technician? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>j(V),onCancel:()=>T(!1)}),$?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(ye,{message:"Loading technician..."})}):M?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:M}):e.jsxs(Ce,{className:"mt-3",striped:!0,hover:!0,responsive:!0,children:[e.jsx(ke,{children:e.jsxs(ae,{className:"pink-table  w-auto",children:[e.jsx(A,{children:"#"}),e.jsx(A,{children:"Photo"})," ",e.jsx(A,{children:"Name"}),e.jsx(A,{children:"Contact"}),e.jsx(A,{children:"Sex"}),e.jsx(A,{children:"Specialization"}),e.jsx(A,{children:"Date Of Joining"}),e.jsx(A,{className:"text-end",children:"Actions"})]})}),e.jsx(we,{className:"pink-table",children:H.length>0?H.map((n,r)=>e.jsxs(ae,{children:[e.jsx(k,{children:(y-1)*v+r+1}),e.jsx(k,{children:n.profilePicture?e.jsx("img",{src:Z(n.profilePicture),alt:n.fullName,width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}})}),e.jsx(k,{children:S(n.fullName)}),e.jsx(k,{children:S(n.contactNumber)}),e.jsx(k,{children:S(n.gender)}),e.jsx(k,{children:n.specialization||"NA"}),e.jsx(k,{children:n.dateOfJoining}),e.jsx(k,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2  ",children:[E("Laboratory","read")&&e.jsx("button",{className:"actionBtn",onClick:()=>{g(n),R(!0),C(!0)},title:"View",children:e.jsx(Ae,{size:18})}),E("Laboratory","update")&&e.jsx("button",{className:"actionBtn",onClick:()=>{g(n),R(!1),C(!0)},title:"Edit",children:e.jsx(De,{size:18})}),E("Laboratory","delete")&&e.jsx("button",{className:"actionBtn",onClick:()=>{U(n.id),T(!0)},title:"Delete",children:e.jsx(Pe,{size:18})})]})})]},n.id)):e.jsx(ae,{children:e.jsx(k,{colSpan:"9",className:"text-center",style:{color:"var(--color-black)"},children:"No lab technician found."})})})]}),!$&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(Y.length/v)},(n,r)=>e.jsx(D,{style:{backgroundColor:y===r+1?"var(--color-black)":"#fff",color:y===r+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>a(r+1),children:r+1},r))}),e.jsx(Ie,{visible:_,onClose:()=>{C(!1),g(null),R(!1)},onSave:u,initialData:P,viewMode:re,technicians:p,fetchTechs:L})]})};export{Xe as default};
