import{r as h,j as e,B as x,h as me,i as re,e as ge,b as be,a as ve,R as fe}from"./index-BpN0qZrt.js";import{v as C,a as ae,f as Ne}from"./Validators-FoVLkSgm.js";import{c as te}from"./capitalizeWords-CuwF8AcI.js";import{U as ye}from"./UserPermissionModal-Cy15BOgE.js";import{C as ie,a as oe,b as de}from"./CModalHeader-DLH-68_W.js";import{C as Ce}from"./CModalTitle-CwvqIfsB.js";import{C as Pe}from"./CForm-D_Fm9Pc8.js";import{C as j}from"./CFormLabel-DO0eStXP.js";import{C as b}from"./CFormInput-DMF4wKOV.js";import{C as ke}from"./CFormSelect-DDJD4c8G.js";import{C as we}from"./CFormTextarea-BePoUAyB.js";import{b as R}from"./index.esm-BAveQmLP.js";import{C as ue}from"./CModalFooter-Dm04Litg.js";import{C as De}from"./ConfirmationModal-Blpddd1P.js";import{L as Ie}from"./loader-OBkaezw1.js";import{C as Ae,a as Se,b as ne,c as F,d as Be,e as I}from"./CTable-Bgk4qBUR.js";import{E as Fe}from"./eye-BuIXT__x.js";import{P as Re,T as Le}from"./trash-2-CRkTwtCJ.js";import"./CNavItem-DIVzBTzM.js";const Oe=({visible:N,onClose:w,onSave:le,editData:M,initialData:D,viewMode:L,pharmacists:P,fetchTechs:J})=>{const A={viewPatients:!1,manageInventory:!1,accessReports:!1},S={hospitalId:localStorage.getItem("HospitalId"),branchId:localStorage.getItem("branchId"),hospitalName:localStorage.getItem("HospitalName"),fullName:"",gender:"",dateOfBirth:"",contactNumber:"",emailID:"",governmentId:"",dPharmaOrBPharmaCertificate:"",experienceCertificates:"",statePharmacyCouncilRegistration:"",dateOfJoining:"",department:"",qualification:"",role:"pharmacist",address:{houseNo:"",street:"",landmark:"",city:"",state:"",postalCode:"",country:"India"},emergencyContactNumber:"",bankAccountDetails:{accountNumber:"",accountHolderName:"",ifscCode:"",bankName:"",branchName:"",panCardNumber:""},profilePicture:"",pharmacyLicense:"",previousEmploymentHistory:"",permissions:A},[t,k]=h.useState(S),[Y,xe]=h.useState(localStorage.getItem("HospitalId")),[Z,T]=h.useState(!1),[q,H]=h.useState(!1),[G,O]=h.useState(null),[W,_]=h.useState(!1),[he,je]=h.useState([]),[u,y]=h.useState({}),Q=["fullName","gender","dateOfBirth","contactNumber","emailID","governmentId","dateOfJoining","department","hospitalId","profilePicture","role","address.houseNo","address.street","address.city","address.state","address.postalCode","address.country","bankAccountDetails.accountNumber","bankAccountDetails.accountHolderName","bankAccountDetails.bankName","bankAccountDetails.branchName","bankAccountDetails.ifscCode","bankAccountDetails.panCardNumber"];function z(a,r){const s=[];for(const l of r){const d=l.split(".");let c=a;for(const o of d)c=c==null?void 0:c[o];(!c||String(c).trim()==="")&&s.push(l)}return s}const $=a=>{k(r=>{const s={...r.permissions};return s[a]?delete s[a]:s[a]=[],{...r,permissions:s}})},K=(a,r)=>{k(s=>{const l={...s.permissions};return l[a]||(l[a]=[]),l[a].includes(r)?l[a]=l[a].filter(d=>d!==r):l[a]=[...l[a],r],{...s,permissions:l}})},U=a=>{k(r=>{const s={...r.permissions};return s[a]?s[a].length===ae.length?s[a]=[]:s[a]=[...ae]:s[a]=[...ae],{...r,permissions:s}})},ce=a=>new Promise((r,s)=>{const l=new FileReader;l.readAsDataURL(a),l.onload=()=>r(l.result),l.onerror=d=>s(d)});h.useEffect(()=>{k(D?a=>({...a,...D,address:{...S.address,...D.address||{}},bankAccountDetails:{...S.bankAccountDetails,...D.bankAccountDetails||{}},permissions:{...A,...D.permissions||{}}}):S)},[D]);const v=(a,r)=>{k(s=>({...s,[a]:r}))},f=(a,r,s)=>{k(l=>({...l,[a]:{...l[a],[r]:s}}))},B=(a,r)=>{const s=a.target.files[0];if(!s)return;const l=new FileReader;l.onloadend=()=>{k(d=>({...d,[r]:l.result,[`${r}Name`]:s.name,[`${r}Type`]:s.type}))},l.readAsDataURL(s)},X=()=>{const a=z(t,Q);if(a.length>0){x.error(`Please fill required fields: ${a.join(", ")}`);return}if(t.dateOfBirth){const c=new Date(t.dateOfBirth),o=new Date,g=o.getFullYear()-c.getFullYear();if((o.getMonth()<c.getMonth()||o.getMonth()===c.getMonth()&&o.getDate()<c.getDate()?g-1:g)<18){x.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(t.contactNumber)){x.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.emailID)){x.error("Please enter a valid email address.");return}if(P==null?void 0:P.some(c=>c.contactNumber===t.contactNumber&&c.pharmacistId!==t.pharmacistId)){x.error("Contact number already exists!");return}if(he.some(c=>c.emailID===t.emailID&&c.pharmacistId!==t.pharmacistId)){x.error("Email already exists!");return}if(!t.pharmacistId&&!Object.values(t.permissions||{}).some(o=>Array.isArray(o)?o.length>0:!!o)){x.error("Please assign at least one user permission before saving.");return}console.log("Saving pharmacist data:",t),le(t),t.pharmacistId||k(S),w()},ee=()=>{const a=z(t,Q);if(a.length>0){x.error(`Please fill required fields: ${a.join(", ")}`);return}if(t.dateOfBirth){const c=new Date(t.dateOfBirth),o=new Date,g=o.getFullYear()-c.getFullYear();if((o.getMonth()<c.getMonth()||o.getMonth()===c.getMonth()&&o.getDate()<c.getDate()?g-1:g)<18){x.error("Technician must be at least 18 years old.");return}}if(!/^[6-9]\d{9}$/.test(t.contactNumber)){x.error("Contact number must be 10 digits and start with 6-9.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.emailID)){x.error("Please enter a valid email address.");return}if(P==null?void 0:P.some(c=>c.contactNumber===t.contactNumber&&c.pharmacistId!==t.pharmacistId)){x.error("Contact number already exists!");return}if(P==null?void 0:P.some(c=>c.emailID===t.emailID&&c.pharmacistId!==t.pharmacistId)){x.error("Email already exists!");return}console.log(t),H(!0)},n=()=>{T(!1),O(null),_(!1)},i=(a,r)=>{O(a),_(r==null?void 0:r.includes("pdf")),T(!0)},p=({title:a,children:r})=>e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-semibold border-b pb-2 mb-4",children:a}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:r})]}),m=({label:a,value:r})=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:a}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:r||"N/A"})]}),V=({label:a,value:r})=>e.jsxs("div",{className:"col-span-3",children:[a&&e.jsx("p",{className:"text-sm font-medium text-gray-600 fw-bold",children:a}),e.jsx("p",{className:"text-base text-gray-900 text-break",children:r||"N/A"})]}),E=({label:a,type:r,data:s})=>{if(!s)return e.jsxs("p",{children:[a," "]});const l=r==null?void 0:r.startsWith("image/"),d=s.startsWith("data:")?s:`data:${r};base64,${s}`;return e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsxs("strong",{children:[a,":"]}),e.jsxs("div",{className:"mt-2",children:[l?e.jsx("img",{src:d,alt:a,className:"w-32 h-32 object-cover rounded-md border cursor-pointer",onClick:()=>i(d,r)}):e.jsx("button",{type:"button ",className:" btn text-blue-600 hover:underline block mx-2",onClick:()=>i(d,r),style:{backgroundColor:"var(--color-black)",color:"white"},children:"Preview"}),e.jsx("a",{href:d,download:a.replace(/\s+/g,"_"),className:"text-green-600 hover:underline text-sm block  btn",style:{backgroundColor:"var(--color-black)",color:"white"},children:"Download"})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(ie,{visible:N,onClose:w,size:"lg",className:"custom-modal",backdrop:"static",children:[e.jsx(oe,{children:e.jsx(Ce,{children:L?"Personal Information":"Add / Edit Pharmacist "})}),e.jsx(de,{children:L?e.jsxs("div",{className:"p-4 border rounded shadow-sm bg-white ",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Name : "}),e.jsx("span",{children:t.fullName})]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"fw-bold ",children:"Email : "}),e.jsx("span",{children:t.emailID})]}),e.jsxs("div",{children:[e.jsx("span",{className:"fw-bold",children:"Contact : "}),e.jsx("span",{children:t.contactNumber})]})]}),e.jsxs("div",{className:"text-center",children:[t.profilePicture?e.jsx("img",{src:t.profilePicture||"/assets/images/default-avatar.png",alt:t.fullName,width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsxs("div",{style:{color:"var(--color-black)",marginTop:"5px",fontSize:"14px",fontWeight:"500"},children:["ID: ",t.pharmacistId]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"space-y-5 mt-5",children:[e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Full Name",value:t.fullName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Email",value:t.emailID})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Contact",value:t.contactNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Gender",value:t.gender})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Date of Birth",value:t.dateOfBirth})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Government ID",value:t.governmentId})})]}),e.jsx(p,{title:"Work Information",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Date of Joining",value:t.dateOfJoining})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Department",value:t.department})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Specialization",value:t.qualification})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Emergency Contact",value:t.emergencyContactNumber})})]})}),e.jsx(p,{title:"Address",children:e.jsx(V,{value:`${t.address.houseNo}, ${t.address.street}, ${t.address.city}, ${t.address.state} - ${t.address.postalCode}, ${t.address.country}`})}),e.jsx(p,{title:"Bank Details",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Account Number",value:t.bankAccountDetails.accountNumber})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Account Holder Name",value:t.bankAccountDetails.accountHolderName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Bank Name",value:t.bankAccountDetails.bankName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Branch Name",value:t.bankAccountDetails.branchName})}),e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"PAN Card",value:t.bankAccountDetails.panCardNumber})})]})}),e.jsx(p,{title:"Documents",children:e.jsxs("div",{className:"row",children:[t.dPharmaOrBPharmaCertificate!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(E,{label:"dPharmaOrBPharmaCertificate",type:t.dPharmaOrBPharmaCertificateType||"application/pdf",data:t.dPharmaOrBPharmaCertificate})}):e.jsx("p",{className:"col-md-6",children:"Not Provided dPharmaOrBPharmaCertificate"}),t.statePharmacyCouncilRegistration!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(E,{label:"statePharmacyCouncilRegistration",type:t.statePharmacyCouncilRegistrationType||"application/pdf",data:t.statePharmacyCouncilRegistration})}):e.jsx("p",{className:"col-md-6",children:"Not Provided statePharmacyCouncilRegistration"}),t.experienceCertificates!=""?e.jsx("div",{className:"col-md-6",children:e.jsx(E,{label:"experienceCertificates",type:t.experienceCertificatesType||"application/pdf",data:t.experienceCertificates})}):e.jsx("p",{className:"col-md-6",children:"Not Provided experienceCertificates"})]})}),e.jsx("div",{className:"mt-4"}),e.jsx(p,{title:"Other Information ",children:e.jsxs("div",{className:"row mb-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(m,{label:"Pharmacy License",value:t.pharmacyLicense})}),e.jsx("div",{className:"col-md-12",children:e.jsx(V,{label:"Previous Employment",value:t.previousEmploymentHistory})})]})})]})]}):e.jsxs(Pe,{children:[e.jsx("h5",{children:"Basic Information"}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-5",children:[e.jsxs(j,{children:["ClinicID ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:Y,disabled:!0,onChange:a=>v("hospitalId",a.target.value)})]}),e.jsxs("div",{className:"col-md-7",children:[e.jsxs(j,{children:["Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:t.role,disabled:!0,onChange:a=>v("role",a.target.value)})]})]})}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(j,{children:["Full Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:t.fullName,onChange:a=>{const r=a.target.value;v("fullName",r);const s=C("fullName",r);y(l=>({...l,fullName:s}))}}),u.fullName&&e.jsx("div",{className:"text-danger mt-1",children:u.fullName})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(j,{children:["Gender ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsxs(ke,{value:t.gender,onChange:a=>v("gender",a.target.value),children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(j,{children:["Date of Birth ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"date",value:t.dateOfBirth,max:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],onChange:a=>v("dateOfBirth",a.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(j,{children:["Contact Number ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"text",maxLength:10,value:t.contactNumber,onChange:a=>{const r=a.target.value;if(/^\d*$/.test(r)){v("contactNumber",r);const s=C("contactNumber",r);y(l=>({...l,contactNumber:s}))}}}),u.contactNumber&&e.jsx("div",{className:"text-danger mt-1",children:u.contactNumber})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(j,{children:["Email ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"email",value:t.emailId,onChange:a=>{const r=a.target.value;v("emailId",r);const s=C("emailId",r);y(l=>({...l,emailId:s}))}}),u.emailId&&e.jsx("div",{className:"text-danger mt-1",children:u.emailId})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(j,{children:["GovernmentID(AadharCard No) ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{maxLength:12,value:t.governmentId,onChange:a=>{const r=a.target.value;if(/^\d*$/.test(r)){v("governmentId",r);const s=C("governmentId",r);y(l=>({...l,governmentId:s}))}}}),u.governmentId&&e.jsx("div",{className:"text-danger mt-1",children:u.governmentId})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(j,{children:"Pharmacy License"}),e.jsx(b,{type:"text",value:t.pharmacyLicense,onChange:a=>{const r=a.target.value;v("pharmacyLicense",r);const s=C("pharmacyLicense",r);y(l=>({...l,pharmacyLicense:s}))}}),u.pharmacyLicense&&e.jsx("div",{className:"text-danger mt-1",children:u.pharmacyLicense})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs(j,{children:["Date of Joining ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"date",value:t.dateOfJoining,onChange:a=>v("dateOfJoining",a.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[" ",e.jsx(j,{children:"Department"}),e.jsx(b,{value:te(t.department),onChange:a=>{const r=a.target.value;v("department",r);const s=C("department",r);y(l=>({...l,department:s}))}}),u.department&&e.jsx("div",{className:"text-danger mt-1",children:u.department})]}),e.jsxs("div",{className:"col-md-4",children:[" ",e.jsx(j,{children:"Specialization"}),e.jsx(b,{value:te(t.specialization),onChange:a=>{const r=a.target.value;v("specialization",r);const s=C("specialization",r);y(l=>({...l,specialization:s}))}}),u.specialization&&e.jsx("div",{className:"text-danger mt-1",children:u.specialization})]})]}),e.jsx("div",{className:"row mb-3",children:e.jsxs("div",{className:"col-md-4",children:[e.jsx(j,{children:"Emergency Contact"}),e.jsx(b,{type:"text",maxLength:10,value:t.emergencyContactNumber,onChange:a=>{const r=a.target.value;/^\d*$/.test(r)&&v("emergencyContactNumber",r);const s=C("emergencyContactNumber",r);y(l=>({...l,emergencyContactNumber:s}))}}),u.emergencyContactNumber&&e.jsx("small",{className:"text-danger",children:u.emergencyContactNumber})]})}),e.jsx("h5",{className:"mt-3",children:"Address"}),Object.keys(t.address).reduce((a,r,s)=>(s%3===0&&a.push([]),a[a.length-1].push(r),a),[]).map((a,r)=>e.jsx("div",{className:"row mb-3",children:a.map(s=>{var l;return e.jsxs("div",{className:"col-md-4",children:[e.jsxs(j,{className:"text-capitalize",children:[s," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{type:"text",maxLength:s==="postalCode"?6:void 0,value:te(t.address[s]),onChange:d=>{let c=d.target.value;if(s==="postalCode"){if(/^\d*$/.test(c)){f("address",s,c);const o=C(s,c,t);y(g=>({...g,address:{...g.address,[s]:o}}))}}else{f("address",s,c);const o=C(s,c,t);y(g=>({...g,address:{...g.address,[s]:o}}))}}}),((l=u.address)==null?void 0:l[s])&&e.jsx("div",{className:"text-danger mt-1",children:u.address[s]})]},s)})},r)),e.jsx("h5",{className:"mt-3",children:"Bank Account Details"}),Object.keys(t.bankAccountDetails).reduce((a,r,s)=>(s%3===0&&a.push([]),a[a.length-1].push(r),a),[]).map((a,r)=>e.jsx("div",{className:"row mb-3",children:a.map(s=>{var l;return e.jsxs("div",{className:"col-md-4",children:[e.jsxs(j,{className:"text-capitalize",children:[s," ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx(b,{value:t.bankAccountDetails[s],maxLength:s==="accountNumber"?20:s==="panCardNumber"?10:s==="ifscCode"?11:void 0,onChange:async d=>{let c=d.target.value;s==="accountNumber"?/^\d*$/.test(c)&&f("bankAccountDetails",s,c):s==="panCardNumber"?(c=c.toUpperCase(),/^[A-Z]{0,5}[0-9]{0,4}[A-Z]{0,1}$/.test(c)&&f("bankAccountDetails",s,c)):s==="ifscCode"?(c=c.toUpperCase(),/^[A-Z0-9]*$/.test(c)&&f("bankAccountDetails",s,c)):f("bankAccountDetails",s,c);const o=C(s,c,t);y(g=>({...g,bankAccountDetails:{...g.bankAccountDetails,[s]:o}}))},onBlur:async()=>{const d=t.bankAccountDetails[s],c=C(s,d,t);if(y(o=>({...o,bankAccountDetails:{...o.bankAccountDetails,[s]:c}})),s==="panCardNumber"&&d.length===10&&(/^[A-Z]{5}[0-9]{4}[A-Z]$/.test(d)||x.error("Invalid PAN format (e.g., ABCDE1234F)")),s==="ifscCode"&&d.length===11)if(!/^[A-Z]{4}0[A-Z0-9]{6}$/.test(d))x.error("Invalid IFSC format (e.g., HDFC0001234)"),f("bankAccountDetails","bankName",""),f("bankAccountDetails","branchName","");else try{const g=await fetch(`https://ifsc.razorpay.com/${d}`);if(g.ok){const se=await g.json();f("bankAccountDetails","bankName",se.BANK||""),f("bankAccountDetails","branchName",se.BRANCH||"")}}catch{x.error("Error fetching bank details"),f("bankAccountDetails","bankName",""),f("bankAccountDetails","branchName","")}}}),((l=u.bankAccountDetails)==null?void 0:l[s])&&e.jsx("div",{className:"text-danger mt-1",children:u.bankAccountDetails[s]})]},s)})},r)),e.jsx("h5",{className:"mt-3",children:"Documents"}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(j,{children:["Profile Picture",e.jsx("span",{className:"text-danger",children:"*"})]}),t.profilePicture&&e.jsxs("div",{className:"mb-2",children:[e.jsx("img",{src:t.profilePicture,alt:"Profile",width:"80",height:"80",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}),e.jsx("br",{}),e.jsx("a",{href:t.profilePicture,download:"profile-picture",target:"_blank",rel:"noopener noreferrer",children:"Download"})]}),e.jsx(b,{type:"file",accept:"image/*",onChange:async a=>{const r=a.target.files[0];if(r){const s=await ce(r);v("profilePicture",s)}}})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(j,{children:"dPharma/BPharma Certificate"}),e.jsx(b,{type:"file",onChange:a=>B(a,"dPharmaOrBPharmaCertificate")})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(j,{children:"statePharmacyCouncilRegistration"}),e.jsx(b,{type:"file",onChange:a=>B(a,"statePharmacyCouncilRegistration")})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx(j,{children:"experience Certificate"}),e.jsx(b,{type:"file",onChange:a=>B(a,"experienceCertificates")})]})]}),e.jsx(j,{children:"Previous Employment History"}),e.jsx(we,{rows:3,value:t.previousEmploymentHistory,onChange:a=>v("previousEmploymentHistory",a.target.value),placeholder:"Enter previous employment history"}),e.jsx("div",{className:"mb-3 w-100 mt-4",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(R,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:ee,children:"User Permissions"})}),e.jsx(ye,{show:q,onClose:()=>H(!1),features:Ne,actions:ae,permissions:t.permissions,toggleFeature:$,toggleAllActions:U,togglePermission:K,onSave:()=>{console.log("Saved Permissions",t.permissions),H(!1)}})]})}),e.jsx(ue,{children:L?e.jsx(R,{color:"secondary",onClick:w,children:"Close"}):e.jsxs(e.Fragment,{children:[e.jsx(R,{style:{backgroundColor:"var(--color-bgcolor)",color:"var(--color-black)"},onClick:()=>k(S),children:"Clear"}),e.jsx(R,{color:"secondary",onClick:w,children:"Cancel"}),e.jsx(R,{style:{backgroundColor:"var(--color-black)",color:"white"},onClick:X,children:"Save"})]})})]}),e.jsxs(ie,{visible:Z,onClose:n,size:"xl",children:[e.jsx(oe,{onClose:n,children:e.jsx("strong",{children:W?"PDF Preview":"Image Preview"})}),e.jsx(de,{className:"text-center",children:W?e.jsx("iframe",{src:G,title:"PDF Preview",style:{width:"100%",height:"80vh",border:"none"}}):e.jsx("img",{src:G,alt:"Preview",style:{maxWidth:"100%",maxHeight:"80vh",borderRadius:"8px"}})})]})]})},$e=N=>me.get(`${re}/getAllPharmacists/${N}`),Ee=N=>ge.post(`${re}/addPharmacist`,N,{headers:{"Content-Type":"application/json"}}),Me=(N,w)=>me.put(`${re}/updatePharmacist/${N}`,w,{headers:{"Content-Type":"application/json"}}),Te=N=>me.delete(`${re}/deletePharmacist/${N}`),ls=()=>{const[N,w]=h.useState([]),[le,M]=h.useState(!1),[D,L]=h.useState(null),[P,J]=h.useState(!1),[A,S]=h.useState(1),[t,k]=h.useState(10),{searchQuery:Y,setSearchQuery:xe}=be(),[Z,T]=h.useState(!1),[q,H]=h.useState(null),[G,O]=h.useState(!1),[W,_]=h.useState(null),[he,je]=h.useState(null),[u,y]=h.useState(!1),[Q,z]=h.useState(!1),[$,K]=h.useState(null),U=async()=>{var n;T(!0);try{const i=localStorage.getItem("HospitalId");if(i){const p=await $e(i),m=((n=p.data)==null?void 0:n.data)||p.data||[];w(m)}}catch(i){console.error("❌ Error fetching pharmacists:",i),w([]),H("Failed to fetch pharmacists.")}finally{T(!1)}};h.useEffect(()=>{U()},[]);const ce=async n=>{var i,p,m,V,E,a;try{const r={...n,permissions:{Laboratory:Object.entries(n.permissions.Laboratory||{}).filter(([s,l])=>l).map(([s])=>s),viewPatients:n.permissions.viewPatients?["read"]:[]}};if(D)await Me(D.pharmacistId,r),x.success("Pharmacist updated successfully!");else{const s=await Ee(r);await U(),(p=(i=s==null?void 0:s.data)==null?void 0:i.data)!=null&&p.userName&&((V=(m=s==null?void 0:s.data)==null?void 0:m.data)!=null&&V.password)&&(K({username:s.data.data.userName,password:s.data.data.password,pharmacistName:s.data.data.fullName}),z(!0)),x.success("Pharmacist added successfully!")}}catch(r){console.error("API error:",r),x.error(((a=(E=r.response)==null?void 0:E.data)==null?void 0:a.message)||"❌ Failed to save pharmacist.")}},v=async n=>{try{await Te(n),w(i=>i.filter(p=>p.pharmacistId!==n)),x.success("Pharmacist deleted successfully!")}catch(i){console.error("Delete error:",i),x.error("❌ Failed to delete pharmacist.")}finally{O(!1)}},{user:f}=ve(),B=(n,i)=>{var p,m;return(m=(p=f==null?void 0:f.permissions)==null?void 0:p[n])==null?void 0:m.includes(i)},X=fe.useMemo(()=>{const n=Y.toLowerCase().trim();return n?N.filter(i=>Object.values(i).some(p=>String(p).toLowerCase().includes(n))):N},[Y,N]),ee=X.slice((A-1)*t,A*t);return e.jsxs("div",{children:[B("Laboratory","create")&&e.jsx("div",{className:"mb-3 w-100",style:{display:"flex",justifyContent:"end",alignContent:"end",alignItems:"end"},children:e.jsx(R,{style:{color:"var(--color-black)",backgroundColor:"var(--color-bgcolor)"},onClick:()=>M(!0),children:"Add Pharmacist"})}),e.jsxs(ie,{visible:Q,backdrop:"static",keyboard:!1,children:[e.jsx(oe,{children:e.jsx("h5",{children:"Pharmacist Credentials"})}),e.jsx(de,{children:$?e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",$.pharmacistName||"New Pharmacist"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",$.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Password:"})," ",$.password]}),e.jsx("small",{className:"text-danger",children:"⚠️ Please save these credentials securely. They will not be shown again."})]}):e.jsx("p",{children:"No data available"})}),e.jsx(ue,{children:e.jsx(R,{color:"primary",onClick:()=>{z(!1),K(null)},children:"Close"})})]}),e.jsx(De,{isVisible:G,title:"Delete Pharmacist",message:"Are you sure you want to delete this pharmacist? This action cannot be undone.",confirmText:"Yes, Delete",cancelText:"Cancel",confirmColor:"danger",cancelColor:"secondary",onConfirm:()=>v(W),onCancel:()=>O(!1)}),Z?e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx(Ie,{message:"Loading pharmacists..."})}):q?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",color:"var(--color-black)"},children:q}):e.jsxs(Ae,{className:"mt-3",striped:!0,hover:!0,responsive:!0,children:[e.jsx(Se,{children:e.jsxs(ne,{className:"pink-table  w-auto",children:[e.jsx(F,{children:"#"}),e.jsx(F,{children:"Photo"}),e.jsx(F,{children:"Name"}),e.jsx(F,{children:"Contact"}),e.jsx(F,{children:"Sex"}),e.jsx(F,{children:"Qualification"}),e.jsx(F,{children:"Date Of Joining"}),e.jsx(F,{className:"text-end",children:"Actions"})]})}),e.jsx(Be,{className:"pink-table",children:ee.length?ee.map((n,i)=>e.jsxs(ne,{children:[e.jsx(I,{children:(A-1)*t+i+1}),e.jsx(I,{children:n.profilePicture?e.jsx("img",{src:n.profilePicture,alt:n.fullName,width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}}):e.jsx("img",{src:"/assets/images/default-avatar.png",alt:"No profile",width:"40",height:"40",style:{borderRadius:"50%",objectFit:"cover",border:"1px solid var(--color-black)"}})}),e.jsx(I,{children:te(n.fullName)}),e.jsx(I,{children:n.contactNumber||"NA"}),e.jsx(I,{children:n.gender||"NA"}),e.jsx(I,{children:n.qualification||"NA"}),e.jsx(I,{children:n.dateOfJoining||"NA"}),e.jsx(I,{className:"text-end",children:e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[B("Laboratory","read")&&e.jsx("button",{className:"actionBtn",onClick:()=>{L(n),J(!0),M(!0)},title:"View",children:e.jsx(Fe,{size:18})}),B("Laboratory","update")&&e.jsx("button",{className:"actionBtn",onClick:()=>{L(n),J(!1),M(!0)},title:"Edit",children:e.jsx(Re,{size:18})}),B("Laboratory","delete")&&e.jsx("button",{className:"actionBtn",onClick:()=>{_(n.pharmacistId),O(!0)},title:"Delete",children:e.jsx(Le,{size:18})})]})})]},n.id)):e.jsx(ne,{children:e.jsx(I,{colSpan:"9",className:"text-center",style:{color:"var(--color-black)"},children:"No pharmacist found."})})})]}),!Z&&e.jsx("div",{className:"d-flex justify-content-end mt-3",style:{marginRight:"40px"},children:Array.from({length:Math.ceil(X.length/t)},(n,i)=>e.jsx(R,{style:{backgroundColor:A===i+1?"var(--color-black)":"#fff",color:A===i+1?"#fff":"var(--color-black)",border:"1px solid #ccc",borderRadius:"5px",cursor:"pointer"},className:"ms-2",onClick:()=>S(i+1),children:i+1},i))}),e.jsx(Oe,{visible:le,onClose:()=>{M(!1),L(null),J(!1)},onSave:ce,initialData:D,viewMode:P,pharmacistList:N,pharmacist:N,fetchTechs:U})]})};export{ls as default};
