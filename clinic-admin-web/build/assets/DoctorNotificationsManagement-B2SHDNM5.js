import{o as S,B as ee,E as J,F as se,H as oe,r as d,k as re,h as te,j as e,Q as ae,D as p}from"./index-DMPCYSqc.js";/* empty css                      */import{a as x}from"./index.esm-D9gv5oTs.js";import{C as ne,a as ce,b as w,c as h,d as ie,e as i}from"./CTable-BHk8O2Tr.js";import{C as _,a as z,b as U}from"./CModalHeader-BX4ULTBt.js";import{C as G}from"./CModalTitle-zfkxkmW_.js";import{C as Q}from"./CModalFooter-rES8gYOy.js";import{C as le}from"./CFormLabel-GUXGHPkG.js";import{C as de}from"./CFormInput-B0lGc2Bv.js";import"./CConditionalPortal-DmZQ0Uz0.js";const he=async(l,a)=>{console.log("DoctorNotifyData calling...");try{const t=await S.get(`${J}/${oe}/${l}/${a}`);return console.log("DoctorNotifyData response:",t.data),t}catch(t){throw console.error("Error fetching doctor notifications:",t.message),t.response?(console.error("Error Response Data:",t.response.data),console.error("Error Response Status:",t.response.status),console.error("Error Response Headers:",t.response.headers)):t.request?console.error("Error Request:",t.request):console.error("Error Message:",t.message),t}},je=async l=>{var a,t,D,b;try{return console.log("Sending data to API"),(await S.post(`${J}/${se}`,l,{headers:{"Content-Type":"application/json"}})).data}catch(j){throw console.error("Error response:",j.response),alert(`Error: ${(a=j.response)==null?void 0:a.status} - ${((D=(t=j.response)==null?void 0:t.data)==null?void 0:D.message)||((b=j.response)==null?void 0:b.statusText)}`),j}},pe=async l=>{try{return await S.get(`${ee}/doctors/hospitalById/${l}`)}catch(a){throw console.error("Error fetching doctor notifications:",a),a}},Ie=()=>{var A,T,M,$,F,k,H,B,P,q,L,V;const[l,a]=d.useState([]),[t,D]=d.useState(!1),[b,j]=d.useState(null),[s,K]=d.useState(null),[O,f]=d.useState(!1),[W,C]=d.useState(!1),[N,R]=d.useState(""),{setNotificationCount:v}=re(),E=async(r,n="")=>{var c,m,u,g;const o={hospitalId:(c=s==null?void 0:s.data)==null?void 0:c.clinicId,doctorId:(m=s==null?void 0:s.data)==null?void 0:m.doctorId,notificationId:s==null?void 0:s.notificationId,appointmentId:(u=s==null?void 0:s.data)==null?void 0:u.bookingId,subServiceId:(g=s==null?void 0:s.data)==null?void 0:g.subServiceId,status:r,reasonForCancel:n};try{(await je(o)).status===200&&(p.success(`Notification ${r} successfully`),f(!1),C(!1),R(""),a(I=>I.filter(Z=>Z.notificationId!==s.notificationId)),v(I=>I-1))}catch{p.error("Something went wrong!")}},X=te(),Y=async(r,n)=>{try{if(!r||!n){a([]);return}const o=await he(r,n);console.log("DoctorNotifyData response:",o),o.status===200&&Array.isArray(o.data.data)?(v(o.data.data.length),a(o.data.data)):a([])}catch(o){console.error("Error in fetchNotifications:",o),p.error("Failed to fetch notifications"),a([])}};return d.useEffect(()=>{(async()=>{const n=localStorage.getItem("HospitalId");if(!n){p.error("Missing Hospital ID in localStorage");return}try{const o=await pe(n);if(o.status===200&&Array.isArray(o.data.data)&&o.data.data.length>0){const c=o.data.data[0].doctorId;localStorage.setItem("DoctorId",c),console.log("✅ Doctor ID set:",c),Y(n,c)}else p.warning("No doctors found for this hospital.")}catch(o){console.error("Error fetching doctors:",o),p.error("Error fetching doctor list.")}})()},[]),e.jsxs("div",{className:"container mt-4",children:[e.jsx(ae,{}),e.jsx("h5",{children:"Doctor Notifications"}),e.jsxs(ne,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(ce,{children:e.jsxs(w,{children:[e.jsx(h,{children:"S.No"}),e.jsx(h,{children:"Doctor Name"}),e.jsx(h,{children:"Patient Name"}),e.jsx(h,{children:"Mobile Number"}),e.jsx(h,{children:"Consultation Type"}),e.jsx(h,{children:"Date"}),e.jsx(h,{children:"Time"}),e.jsx(h,{children:"Action"})]})}),e.jsx(ie,{children:l.length>0?l.map((r,n)=>{var o,c,m,u,g,y;return e.jsxs(w,{children:[" ",e.jsx(i,{children:n+1}),e.jsx(i,{children:((o=r.data)==null?void 0:o.doctorName)||"-"}),e.jsx(i,{children:((c=r.data)==null?void 0:c.name)||"-"}),e.jsx(i,{children:((m=r.data)==null?void 0:m.mobileNumber)||"-"}),e.jsx(i,{children:((u=r.data)==null?void 0:u.consultationType)||"-"}),e.jsx(i,{children:((g=r.data)==null?void 0:g.serviceDate)||"-"}),e.jsx(i,{children:((y=r.data)==null?void 0:y.servicetime)||"-"}),e.jsx(i,{children:e.jsx(x,{color:"primary",size:"sm",onClick:()=>{K(r),f(!0)},children:"View"})})]},r.notificationId||n)}):e.jsx(w,{children:e.jsx(i,{colSpan:"9",className:"text-center text-secondary fw-bold",children:"No notifications available or data could not be loaded."})})})]}),e.jsxs(_,{visible:O,onClose:()=>f(!1),children:[e.jsx(z,{children:e.jsx(G,{children:"Appointment Details"})}),e.jsx(U,{children:s&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Doctor:"})," ",(A=s.data)==null?void 0:A.doctorName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Patient:"})," ",(T=s.data)==null?void 0:T.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",(M=s.data)==null?void 0:M.age]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gender:"})," ",($=s.data)==null?void 0:$.gender]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Mobile:"})," ",(F=s.data)==null?void 0:F.mobileNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Problem:"})," ",(k=s.data)==null?void 0:k.problem]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Clinic:"})," ",(H=s.data)==null?void 0:H.clinicName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Service:"})," ",(B=s.data)==null?void 0:B.subServiceName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",(P=s.data)==null?void 0:P.serviceDate]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",(q=s.data)==null?void 0:q.servicetime]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",(L=s.data)==null?void 0:L.consultationType]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fee:"})," ₹",(V=s.data)==null?void 0:V.consultationFee]})]})}),e.jsxs(Q,{children:[e.jsx(x,{color:"primary",size:"sm",className:"px-3",onClick:()=>X("/doctor"),children:"Doctor Details"}),e.jsx(x,{color:"success",className:"text-white",onClick:()=>E("Accepted"),children:"Accept"}),e.jsx(x,{color:"danger",className:"text-white",onClick:()=>{f(!1),C(!0)},children:"Reject"}),e.jsx(x,{color:"secondary",onClick:()=>f(!1),children:"Close"})]})]}),e.jsxs(_,{visible:W,onClose:()=>C(!1),children:[e.jsx(z,{children:e.jsx(G,{children:"Reject Appointment"})}),e.jsxs(U,{children:[e.jsx(le,{htmlFor:"rejectReason",children:"Reason for Rejection"}),e.jsx(de,{id:"rejectReason",value:N,onChange:r=>R(r.target.value),placeholder:"Enter reason here"})]}),e.jsxs(Q,{children:[e.jsx(x,{color:"danger",className:"text-white",onClick:()=>{if(!N.trim()){p.warning("Please provide a reason.");return}E("Rejected",N)},children:"Submit"}),e.jsx(x,{color:"secondary",onClick:()=>C(!1),children:"Cancel"})]})]})]})};export{Ie as default};
